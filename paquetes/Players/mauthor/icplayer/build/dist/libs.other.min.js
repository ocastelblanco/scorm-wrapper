(function(v){var u="0.3.4",t="hasOwnProperty",s=/[\.\/]/,r="*",q=function(){},p=function(d,c){return d-c;},o,n,m={n:{}},l=function(D,C){var B=m,A=n,z=Array.prototype.slice.call(arguments,2),y=l.listeners(D),x=0,w=!1,k,j=[],i={},h=[],g=o,G=[];o=D,n=0;for(var F=0,E=y.length;F<E;F++){"zIndex" in y[F]&&(j.push(y[F].zIndex),y[F].zIndex<0&&(i[y[F].zIndex]=y[F]));}j.sort(p);while(j[x]<0){k=i[j[x++]],h.push(k.apply(C,z));if(n){n=A;return h;}}for(F=0;F<E;F++){k=y[F];if("zIndex" in k){if(k.zIndex==j[x]){h.push(k.apply(C,z));if(n){break;}do{x++,k=i[j[x]],k&&h.push(k.apply(C,z));if(n){break;}}while(k);}else{i[k.zIndex]=k;}}else{h.push(k.apply(C,z));if(n){break;}}}n=A,o=g;return h.length?h:null;};l.listeners=function(F){var E=F.split(s),D=m,C,B,A,z,y,x,w,j,e=[D],d=[];for(z=0,y=E.length;z<y;z++){j=[];for(x=0,w=e.length;x<w;x++){D=e[x].n,B=[D[E[z]],D[r]],A=2;while(A--){C=B[A],C&&(j.push(C),d=d.concat(C.f||[]));}}e=j;}return d;},l.on=function(f,d){var w=f.split(s),k=m;for(var j=0,i=w.length;j<i;j++){k=k.n,!k[w[j]]&&(k[w[j]]={n:{}}),k=k[w[j]];}k.f=k.f||[];for(j=0,i=k.f.length;j<i;j++){if(k.f[j]==d){return q;}}k.f.push(d);return function(b){+b==+b&&(d.zIndex=+b);};},l.stop=function(){n=1;},l.nt=function(b){if(b){return(new RegExp("(?:\\.|\\/|^)"+b+"(?:\\.|\\/|$)")).test(o);}return o;},l.off=l.unbind=function(D,C){var B=D.split(s),A,z,y,x,w,j,e,d=[m];for(x=0,w=B.length;x<w;x++){for(j=0;j<d.length;j+=y.length-2){y=[j,1],A=d[j].n;if(B[x]!=r){A[B[x]]&&y.push(A[B[x]]);}else{for(z in A){A[t](z)&&y.push(A[z]);}}d.splice.apply(d,y);}}for(x=0,w=d.length;x<w;x++){A=d[x];while(A.n){if(C){if(A.f){for(j=0,e=A.f.length;j<e;j++){if(A.f[j]==C){A.f.splice(j,1);break;}}!A.f.length&&delete A.f;}for(z in A.n){if(A.n[t](z)&&A.n[z].f){var c=A.n[z].f;for(j=0,e=c.length;j<e;j++){if(c[j]==C){c.splice(j,1);break;}}!c.length&&delete A.n[z].f;}}}else{delete A.f;for(z in A.n){A.n[t](z)&&A.n[z].f&&delete A.n[z].f;}}A=A.n;}}},l.once=function(e,d){var f=function(){var a=d.apply(this,arguments);l.unbind(e,f);return a;};return l.on(e,f);},l.version=u,l.toString=function(){return"You are running Eve "+u;},typeof module!="undefined"&&module.exports?module.exports=l:typeof define!="undefined"?define("eve",[],function(){return l;}):v.eve=l;})(this),function(){function ad(br,bq,bp,bo,bn,bm){bp=cH(bp);var bl,bk,bj,bi=[],bh,bg,be,bb=br.ms,Z={},X={},V={};if(bo){for(Q=0,C=aj.length;Q<C;Q++){var T=aj[Q];if(T.el.id==bq.id&&T.anim==br){T.percent!=bp?(aj.splice(Q,1),bj=1):bk=T,bq.attr(T.totalOrigin);break;}}}else{bo=+X;}for(var Q=0,C=br.percents.length;Q<C;Q++){if(br.percents[Q]==bp||br.percents[Q]>bo*br.top){bp=br.percents[Q],bg=br.percents[Q-1]||0,bb=bb/br.top*(bp-bg),bh=br.percents[Q+1],bl=br.anim[bp];break;}bo&&bq.attr(br.anim[br.percents[Q]]);}if(!!bl){if(!bk){for(var bf in bl){if(bl[aS](bf)){if(cz[aS](bf)||bq.paper.customAttributes[aS](bf)){Z[bf]=bq.attr(bf),Z[bf]==null&&(Z[bf]=cB[bf]),X[bf]=bl[bf];switch(cz[bf]){case c4:V[bf]=(X[bf]-Z[bf])/bb;break;case"colour":Z[bf]=a4.getRGB(Z[bf]);var bd=a4.getRGB(X[bf]);V[bf]={r:(bd.r-Z[bf].r)/bb,g:(bd.g-Z[bf].g)/bb,b:(bd.b-Z[bf].b)/bb};break;case"path":var bc=dj(Z[bf],X[bf]),ba=bc[1];Z[bf]=bc[0],V[bf]=[];for(Q=0,C=Z[bf].length;Q<C;Q++){V[bf][Q]=[0];for(var Y=1,W=Z[bf][Q].length;Y<W;Y++){V[bf][Q][Y]=(ba[Q][Y]-Z[bf][Q][Y])/bb;}}break;case"transform":var U=bq._,S=da(U[bf],X[bf]);if(S){Z[bf]=S.from,X[bf]=S.to,V[bf]=[],V[bf].real=!0;for(Q=0,C=Z[bf].length;Q<C;Q++){V[bf][Q]=[Z[bf][Q][0]];for(Y=1,W=Z[bf][Q].length;Y<W;Y++){V[bf][Q][Y]=(X[bf][Q][Y]-Z[bf][Q][Y])/bb;}}}else{var N=bq.matrix||new c9,s={_:{transform:U.transform},getBBox:function(){return bq.getBBox(1);}};Z[bf]=[N.a,N.b,N.c,N.d,N.e,N.f],dc(s,X[bf]),X[bf]=s._.transform,V[bf]=[(s.matrix.a-N.a)/bb,(s.matrix.b-N.b)/bb,(s.matrix.c-N.c)/bb,(s.matrix.d-N.d)/bb,(s.matrix.e-N.e)/bb,(s.matrix.e-N.f)/bb];}break;case"csv":var r=aA(bl[bf])[az](aZ),n=aA(Z[bf])[az](aZ);if(bf=="clip-rect"){Z[bf]=n,V[bf]=[],Q=n.length;while(Q--){V[bf][Q]=(r[Q]-Z[bf][Q])/bb;}}X[bf]=r;break;default:r=[][aJ](bl[bf]),n=[][aJ](Z[bf]),V[bf]=[],Q=bq.paper.customAttributes[bf].length;while(Q--){V[bf][Q]=((r[Q]||0)-(n[Q]||0))/bb;}}}}}var g=bl.easing,c=a4.easing_formulas[g];if(!c){c=aA(g).match(cM);if(c&&c.length==5){var a=c;c=function(b){return af(b,+a[1],+a[2],+a[3],+a[4],bb);};}else{c=cA;}}be=bl.start||br.start||+(new Date),T={anim:br,percent:bp,timestamp:be,start:be+(br.del||0),status:0,initstatus:bo||0,stop:!1,ms:bb,easing:c,from:Z,diff:V,to:X,el:bq,callback:bl.callback,prev:bg,next:bh,repeat:bm||br.times,origin:bq.attr(),totalOrigin:bn},aj.push(T);if(bo&&!bk&&!bj){T.stop=!0,T.start=new Date-bb*bo;if(aj.length==1){return ah();}}bj&&(T.start=new Date-T.ms*bo),aj.length==1&&ai(ah);}else{bk.initstatus=bo,bk.start=new Date-bk.ms*bo;}eve("anim.start."+bq.id,bq,br);}}function ae(g,f){var j=[],i={};this.ms=f,this.times=1;if(g){for(var h in g){g[aS](h)&&(i[cH(h)]=g[h],j.push(cH(h)));}j.sort(cE);}this.anim=i,this.top=j[j.length-1],this.percents=j;}function af(D,C,B,A,z,y){function p(h,g){var E,o,n,m,l,i;for(n=h,i=0;i<8;i++){m=r(n)-h;if(ak(m)<g){return n;}l=(3*v*n+2*w)*n+x;if(ak(l)<0.000001){break;}n=n-m/l;}E=0,o=1,n=h;if(n<E){return E;}if(n>o){return o;}while(E<o){m=r(n);if(ak(m-h)<g){return n;}h>m?E=n:o=n,n=(o-E)/2+E;}return n;}function q(e,d){var f=p(e,d);return((s*f+t)*f+u)*f;}function r(b){return((v*b+w)*b+x)*b;}var x=3*C,w=3*(A-C)-x,v=1-x-w,u=3*B,t=3*(z-B)-u,s=1-u-t;return q(D,1/(200*y));}function aB(){return this.x+aC+this.y+aC+this.width+" × "+this.height;}function aD(){return this.x+aC+this.y;}function c9(h,g,l,k,j,i){h!=null?(this.a=+h,this.b=+g,this.c=+l,this.d=+k,this.e=+j,this.f=+i):(this.a=1,this.b=0,this.c=0,this.d=1,this.e=0,this.f=0);}function aU(h,g){var l=[];for(var k=0,j=h.length;j-2*!g>k;k+=2){var i=[{x:+h[k-2],y:+h[k-1]},{x:+h[k],y:+h[k+1]},{x:+h[k+2],y:+h[k+3]},{x:+h[k+4],y:+h[k+5]}];g?k?j-4==k?i[3]={x:+h[0],y:+h[1]}:j-2==k&&(i[2]={x:+h[0],y:+h[1]},i[3]={x:+h[2],y:+h[3]}):i[0]={x:+h[j-2],y:+h[j-1]}:j-4==k?i[3]=i[2]:k||(i[0]={x:+h[k],y:+h[k+1]}),l.push(["C",(-i[0].x+6*i[1].x+i[2].x)/6,(-i[0].y+6*i[1].y+i[2].y)/6,(i[1].x+6*i[2].x-i[3].x)/6,(i[1].y+6*i[2].y-i[3].y)/6,i[2].x,i[2].y]);}return l;}function aW(){return this.hex;}function a0(f,e,h){function g(){var d=Array.prototype.slice.call(arguments,0),c=d.join("␀"),b=g.cache=g.cache||{},a=g.count=g.count||[];if(b[aS](c)){a2(a,c);return h?h(b[c]):b[c];}a.length>=1000&&delete b[a.shift()],a.push(c),b[c]=f[aK](e,d);return h?h(b[c]):b[c];}return g;}function a2(f,e){for(var h=0,g=f.length;h<g;h++){if(f[h]===e){return f.push(f.splice(h,1)[0]);}}}function a4(f){if(a4.is(f,"function")){return a1?f():eve.on("DOMload",f);}if(a4.is(f,c0)){return a4._engine.create[aK](a4,f.splice(0,3+a4.is(f[0],c4))).add(f);}var b=Array.prototype.slice.call(arguments,0);if(a4.is(b[b.length-1],"function")){var a=b.pop();return a1?a.call(a4._engine.create[aK](a4,b)):eve.on("DOMload",function(){a.call(a4._engine.create[aK](a4,b));});}return a4._engine.create[aK](a4,arguments);}a4.version="2.0.2",a4.eve=eve;var a1,aZ=/[, ]+/,aY={circle:1,rect:1,path:1,ellipse:1,text:1,image:1},aV=/\{(\d+)\}/g,aT="prototype",aS="hasOwnProperty",aQ={doc:document,win:window},aO={was:Object.prototype[aS].call(aQ.win,"Raphael"),is:aQ.win.Raphael},aN=function(){this.ca=this.customAttributes={};},aM,aL="appendChild",aK="apply",aJ="concat",aH="createTouch" in aQ.doc,aF="",aC=" ",aA=String,az="split",ax="click dblclick mousedown mousemove mouseout mouseover mouseup touchstart touchmove touchend touchcancel"[az](aC),av={mousedown:"touchstart",mousemove:"touchmove",mouseup:"touchend"},at=aA.prototype.toLowerCase,aq=Math,ao=aq.max,am=aq.min,ak=aq.abs,c8=aq.pow,c6=aq.PI,c4="number",c2="string",c0="array",cY="toString",cW="fill",cU=Object.prototype.toString,cS={},cR="push",cQ=a4._ISURL=/^url\(['"]?([^\)]+?)['"]?\)$/i,cP=/^\s*((#[a-f\d]{6})|(#[a-f\d]{3})|rgba?\(\s*([\d\.]+%?\s*,\s*[\d\.]+%?\s*,\s*[\d\.]+%?(?:\s*,\s*[\d\.]+%?)?)\s*\)|hsba?\(\s*([\d\.]+(?:deg|\xb0|%)?\s*,\s*[\d\.]+%?\s*,\s*[\d\.]+(?:%?\s*,\s*[\d\.]+)?)%?\s*\)|hsla?\(\s*([\d\.]+(?:deg|\xb0|%)?\s*,\s*[\d\.]+%?\s*,\s*[\d\.]+(?:%?\s*,\s*[\d\.]+)?)%?\s*\))\s*$/i,cO={NaN:1,Infinity:1,"-Infinity":1},cM=/^(?:cubic-)?bezier\(([^,]+),([^,]+),([^,]+),([^\)]+)\)/,cL=aq.round,cJ="setAttribute",cH=parseFloat,cF=parseInt,cD=aA.prototype.toUpperCase,cB=a4._availableAttrs={"arrow-end":"none","arrow-start":"none",blur:0,"clip-rect":"0 0 1e9 1e9",cursor:"default",cx:0,cy:0,fill:"#fff","fill-opacity":1,font:'10px "Arial"',"font-family":'"Arial"',"font-size":"10","font-style":"normal","font-weight":400,gradient:0,height:0,href:"http://raphaeljs.com/","letter-spacing":0,opacity:1,path:"M0,0",r:0,rx:0,ry:0,src:"",stroke:"#000","stroke-dasharray":"","stroke-linecap":"butt","stroke-linejoin":"butt","stroke-miterlimit":0,"stroke-opacity":1,"stroke-width":1,target:"_blank","text-anchor":"middle",title:"Raphael",transform:"",width:0,x:0,y:0},cz=a4._availableAnimAttrs={blur:c4,"clip-rect":"csv",cx:c4,cy:c4,fill:"colour","fill-opacity":c4,"font-size":c4,height:c4,opacity:c4,path:"path",r:c4,rx:c4,ry:c4,stroke:"colour","stroke-opacity":c4,"stroke-width":c4,transform:"transform",width:c4,x:c4,y:c4},cx=/[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]/g,b9=/[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*,[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*/,b7={hs:1,rg:1},b5=/,?([achlmqrstvxz]),?/gi,b3=/([achlmrqstvz])[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029,]*((-?\d*\.?\d*(?:e[\-+]?\d+)?[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*,?[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*)+)/ig,ds=/([rstm])[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029,]*((-?\d*\.?\d*(?:e[\-+]?\d+)?[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*,?[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*)+)/ig,a7=/(-?\d*\.?\d*(?:e[\-+]?\d+)?)[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*,?[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*/ig,cK=a4._radial_gradient=/^r(?:\(([^,]+?)[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*,[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*([^\)]+?)\))?/,cI={},cG=function(d,c){return d.key-c.key;
},cE=function(d,c){return cH(d)-cH(c);},cC=function(){},cA=function(b){return b;},cy=a4._rectPath=function(g,f,j,i,h){if(h){return[["M",g+h,f],["l",j-h*2,0],["a",h,h,0,0,1,h,h],["l",0,i-h*2],["a",h,h,0,0,1,-h,h],["l",h*2-j,0],["a",h,h,0,0,1,-h,-h],["l",0,h*2-i],["a",h,h,0,0,1,h,-h],["z"]];}return[["M",g,f],["l",j,0],["l",0,i],["l",-j,0],["z"]];},cw=function(f,e,h,g){g==null&&(g=h);return[["M",f,e],["m",0,-g],["a",h,g,0,1,1,0,2*g],["a",h,g,0,1,1,0,-2*g],["z"]];},b8=a4._getPath={path:function(b){return b.attr("path");},circle:function(d){var c=d.attrs;return cw(c.cx,c.cy,c.r);},ellipse:function(d){var c=d.attrs;return cw(c.cx,c.cy,c.rx,c.ry);},rect:function(d){var c=d.attrs;return cy(c.x,c.y,c.width,c.height,c.r);},image:function(d){var c=d.attrs;return cy(c.x,c.y,c.width,c.height);},text:function(d){var c=d._getBBox();return cy(c.x,c.y,c.width,c.height);}},b6=a4.mapPath=function(r,q){if(!q){return r;}var p,o,n,m,l,k,j;r=dj(r);for(n=0,l=r.length;n<l;n++){j=r[n];for(m=1,k=j.length;m<k;m+=2){p=q.x(j[m],j[m+1]),o=q.y(j[m],j[m+1]),j[m]=p,j[m+1]=o;}}return r;};a4._g=aQ,a4.type=aQ.win.SVGAngle||aQ.doc.implementation.hasFeature("http://www.w3.org/TR/SVG11/feature#BasicStructure","1.1")?"SVG":"VML";if(a4.type=="VML"){var b4=aQ.doc.createElement("div"),b2;b4.innerHTML='<v:shape adj="1"/>',b2=b4.firstChild,b2.style.behavior="url(#default#VML)";if(!b2||typeof b2.adj!="object"){return a4.type=aF;}b4=null;}a4.svg=!(a4.vml=a4.type=="VML"),a4._Paper=aN,a4.fn=aM=aN.prototype=a4.prototype,a4._id=0,a4._oid=0,a4.is=function(d,c){c=at.call(c);if(c=="finite"){return !cO[aS](+d);}if(c=="array"){return d instanceof Array;}return c=="null"&&d===null||c==typeof d&&d!==null||c=="object"&&d===Object(d)||c=="array"&&Array.isArray&&Array.isArray(d)||cU.call(d).slice(8,-1).toLowerCase()==c;},a4.angle=function(a,p,o,n,m,l){if(m==null){var k=a-o,j=p-n;if(!k&&!j){return 0;}return(180+aq.atan2(-j,-k)*180/c6+360)%360;}return a4.angle(a,p,m,l)-a4.angle(o,n,m,l);},a4.rad=function(b){return b%360*c6/180;},a4.deg=function(b){return b*180/c6%360;},a4.snapTo=function(a,j,i){i=a4.is(i,"finite")?i:10;if(a4.is(a,c0)){var h=a.length;while(h--){if(ak(a[h]-j)<=i){return a[h];}}}else{a=+a;var g=j%a;if(g<i){return j-g;}if(g>a-i){return j-g+a;}}return j;};var b1=a4.createUUID=function(d,c){return function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(d,c).toUpperCase();};}(/[xy]/g,function(e){var d=aq.random()*16|0,f=e=="x"?d:d&3|8;return f.toString(16);});a4.setWindow=function(a){eve("setWindow",a4,aQ.win,a),aQ.win=a,aQ.doc=aQ.win.document,a4._engine.initWin&&a4._engine.initWin(aQ.win);};var b0=function(a){if(a4.vml){var n=/^\s+|\s+$/g,m;try{var l=new ActiveXObject("htmlfile");l.write("<body>"),l.close(),m=l.body;}catch(k){m=createPopup().document.body;}var j=m.createTextRange();b0=a0(function(d){try{m.style.color=aA(d).replace(n,aF);var c=j.queryCommandValue("ForeColor");c=(c&255)<<16|c&65280|(c&16711680)>>>16;return"#"+("000000"+c.toString(16)).slice(-6);}catch(f){return"none";}});}else{var h=aQ.doc.createElement("i");h.title="Raphaël Colour Picker",h.style.display="none",aQ.doc.body.appendChild(h),b0=a0(function(b){h.style.color=b;return aQ.doc.defaultView.getComputedStyle(h,aF).getPropertyValue("color");});}return b0(a);},a9=function(){return"hsb("+[this.h,this.s,this.b]+")";},a8=function(){return"hsl("+[this.h,this.s,this.l]+")";},a6=function(){return this.hex;},a5=function(a,h,g){h==null&&a4.is(a,"object")&&"r" in a&&"g" in a&&"b" in a&&(g=a.b,h=a.g,a=a.r);if(h==null&&a4.is(a,c2)){var f=a4.getRGB(a);a=f.r,h=f.g,g=f.b;}if(a>1||h>1||g>1){a/=255,h/=255,g/=255;}return[a,h,g];},a3=function(a,j,i,h){a*=255,j*=255,i*=255;var g={r:a,g:j,b:i,hex:a4.rgb(a,j,i),toString:a6};a4.is(h,"finite")&&(g.opacity=h);return g;};a4.color=function(a){var d;a4.is(a,"object")&&"h" in a&&"s" in a&&"b" in a?(d=a4.hsb2rgb(a),a.r=d.r,a.g=d.g,a.b=d.b,a.hex=d.hex):a4.is(a,"object")&&"h" in a&&"s" in a&&"l" in a?(d=a4.hsl2rgb(a),a.r=d.r,a.g=d.g,a.b=d.b,a.hex=d.hex):(a4.is(a,"string")&&(a=a4.getRGB(a)),a4.is(a,"object")&&"r" in a&&"g" in a&&"b" in a?(d=a4.rgb2hsl(a),a.h=d.h,a.s=d.s,a.l=d.l,d=a4.rgb2hsb(a),a.v=d.b):(a={hex:"none"},a.r=a.g=a.b=a.h=a.s=a.v=a.l=-1)),a.toString=a6;return a;},a4.hsb2rgb=function(r,q,p,o){this.is(r,"object")&&"h" in r&&"s" in r&&"b" in r&&(p=r.b,q=r.s,r=r.h,o=r.o),r*=360;var n,m,l,k,j;r=r%360/60,j=p*q,k=j*(1-ak(r%2-1)),n=m=l=p-j,r=~~r,n+=[j,k,0,0,k,j][r],m+=[k,j,j,k,0,0][r],l+=[0,0,k,j,j,k][r];return a3(n,m,l,o);},a4.hsl2rgb=function(r,q,p,o){this.is(r,"object")&&"h" in r&&"s" in r&&"l" in r&&(p=r.l,q=r.s,r=r.h);if(r>1||q>1||p>1){r/=360,q/=100,p/=100;}r*=360;var n,m,l,k,j;r=r%360/60,j=2*q*(p<0.5?p:1-p),k=j*(1-ak(r%2-1)),n=m=l=p-j/2,r=~~r,n+=[j,k,0,0,k,j][r],m+=[k,j,j,k,0,0][r],l+=[0,0,k,j,j,k][r];return a3(n,m,l,o);},a4.rgb2hsb=function(i,h,n){n=a5(i,h,n),i=n[0],h=n[1],n=n[2];var m,l,k,j;k=ao(i,h,n),j=k-am(i,h,n),m=j==0?null:k==i?(h-n)/j:k==h?(n-i)/j+2:(i-h)/j+4,m=(m+360)%6*60/360,l=j==0?0:j/k;return{h:m,s:l,b:k,toString:a9};},a4.rgb2hsl=function(r,q,p){p=a5(r,q,p),r=p[0],q=p[1],p=p[2];var o,n,m,l,k,j;l=ao(r,q,p),k=am(r,q,p),j=l-k,o=j==0?null:l==r?(q-p)/j:l==q?(p-r)/j+2:(r-q)/j+4,o=(o+360)%6*60/360,m=(l+k)/2,n=j==0?0:m<0.5?j/(2*m):j/(2-2*m);return{h:o,s:n,l:m,toString:a8};},a4._path2string=function(){return this.join(",").replace(b5,"$1");};var aX=a4._preload=function(e,d){var f=aQ.doc.createElement("img");f.style.cssText="position:absolute;left:-9999em;top:-9999em",f.onload=function(){d.call(this),this.onload=null,aQ.doc.body.removeChild(this);},f.onerror=function(){aQ.doc.body.removeChild(this);},aQ.doc.body.appendChild(f),f.src=e;};a4.getRGB=a0(function(r){if(!r||!!((r=aA(r)).indexOf("-")+1)){return{r:-1,g:-1,b:-1,hex:"none",error:1,toString:aW};}if(r=="none"){return{r:-1,g:-1,b:-1,hex:"none",toString:aW};}!b7[aS](r.toLowerCase().substring(0,2))&&r.charAt()!="#"&&(r=b0(r));var q,p,o,n,m,l,g,a=r.match(cP);if(a){a[2]&&(n=cF(a[2].substring(5),16),o=cF(a[2].substring(3,5),16),p=cF(a[2].substring(1,3),16)),a[3]&&(n=cF((l=a[3].charAt(3))+l,16),o=cF((l=a[3].charAt(2))+l,16),p=cF((l=a[3].charAt(1))+l,16)),a[4]&&(g=a[4][az](b9),p=cH(g[0]),g[0].slice(-1)=="%"&&(p*=2.55),o=cH(g[1]),g[1].slice(-1)=="%"&&(o*=2.55),n=cH(g[2]),g[2].slice(-1)=="%"&&(n*=2.55),a[1].toLowerCase().slice(0,4)=="rgba"&&(m=cH(g[3])),g[3]&&g[3].slice(-1)=="%"&&(m/=100));if(a[5]){g=a[5][az](b9),p=cH(g[0]),g[0].slice(-1)=="%"&&(p*=2.55),o=cH(g[1]),g[1].slice(-1)=="%"&&(o*=2.55),n=cH(g[2]),g[2].slice(-1)=="%"&&(n*=2.55),(g[0].slice(-3)=="deg"||g[0].slice(-1)=="°")&&(p/=360),a[1].toLowerCase().slice(0,4)=="hsba"&&(m=cH(g[3])),g[3]&&g[3].slice(-1)=="%"&&(m/=100);return a4.hsb2rgb(p,o,n,m);}if(a[6]){g=a[6][az](b9),p=cH(g[0]),g[0].slice(-1)=="%"&&(p*=2.55),o=cH(g[1]),g[1].slice(-1)=="%"&&(o*=2.55),n=cH(g[2]),g[2].slice(-1)=="%"&&(n*=2.55),(g[0].slice(-3)=="deg"||g[0].slice(-1)=="°")&&(p/=360),a[1].toLowerCase().slice(0,4)=="hsla"&&(m=cH(g[3])),g[3]&&g[3].slice(-1)=="%"&&(m/=100);return a4.hsl2rgb(p,o,n,m);}a={r:p,g:o,b:n,toString:aW},a.hex="#"+(16777216|n|o<<8|p<<16).toString(16).slice(1),a4.is(m,"finite")&&(a.opacity=m);return a;}return{r:-1,g:-1,b:-1,hex:"none",error:1,toString:aW};},a4),a4.hsb=a0(function(a,f,e){return a4.hsb2rgb(a,f,e).hex;}),a4.hsl=a0(function(a,f,e){return a4.hsl2rgb(a,f,e).hex;}),a4.rgb=a0(function(e,d,f){return"#"+(16777216|f|d<<8|e<<16).toString(16).slice(1);}),a4.getColor=function(e){var d=this.getColor.start=this.getColor.start||{h:0,s:1,b:e||0.75},f=this.hsb2rgb(d.h,d.s,d.b);d.h+=0.075,d.h>1&&(d.h=0,d.s-=0.2,d.s<=0&&(this.getColor.start={h:0,s:1,b:d.b}));
return f.hex;},a4.getColor.reset=function(){delete this.start;},a4.parsePathString=a0(function(a){if(!a){return null;}var f={a:7,c:6,h:1,l:2,m:2,r:4,q:4,s:4,t:2,v:1,z:0},e=[];a4.is(a,c0)&&a4.is(a[0],c0)&&(e=aP(a)),e.length||aA(a).replace(b3,function(d,c,j){var i=[],h=c.toLowerCase();j.replace(a7,function(k,g){g&&i.push(+g);}),h=="m"&&i.length>2&&(e.push([c][aJ](i.splice(0,2))),h="l",c=c=="m"?"l":"L");if(h=="r"){e.push([c][aJ](i));}else{while(i.length>=f[h]){e.push([c][aJ](i.splice(0,f[h])));if(!f[h]){break;}}}}),e.toString=a4._path2string;return e;}),a4.parseTransformString=a0(function(a){if(!a){return null;}var f={r:3,s:4,t:2,m:6},e=[];a4.is(a,c0)&&a4.is(a[0],c0)&&(e=aP(a)),e.length||aA(a).replace(ds,function(g,d,j){var i=[],h=at.call(d);j.replace(a7,function(k,c){c&&i.push(+c);}),e.push([d][aJ](i));}),e.toString=a4._path2string;return e;}),a4.findDotsAtSegment=function(X,W,V,U,T,S,R,Q,P){var O=1-P,N=c8(O,3),M=c8(O,2),L=P*P,K=L*P,J=N*X+M*3*P*V+O*3*P*P*T+K*R,I=N*W+M*3*P*U+O*3*P*P*S+K*Q,H=X+2*P*(V-X)+L*(T-2*V+X),G=W+2*P*(U-W)+L*(S-2*U+W),F=V+2*P*(T-V)+L*(R-2*T+V),E=U+2*P*(S-U)+L*(Q-2*S+U),D=O*X+P*V,C=O*W+P*U,B=O*T+P*R,A=O*S+P*Q,w=90-aq.atan2(H-F,G-E)*180/c6;(H>F||G<E)&&(w+=180);return{x:J,y:I,m:{x:H,y:G},n:{x:F,y:E},start:{x:D,y:C},end:{x:B,y:A},alpha:w};},a4._removedFactory=function(b){return function(){throw new Error("Raphaël: you are calling to method “"+b+"” of removed object");};};var aR=a0(function(v){if(!v){return{x:0,y:0,width:0,height:0};}v=dj(v);var u=0,t=0,s=[],r=[],q;for(var p=0,o=v.length;p<o;p++){q=v[p];if(q[0]=="M"){u=q[1],t=q[2],s.push(u),r.push(t);}else{var n=dk(u,t,q[1],q[2],q[3],q[4],q[5],q[6]);s=s[aJ](n.min.x,n.max.x),r=r[aJ](n.min.y,n.max.y),u=q[5],t=q[6];}}var m=am[aK](0,s),l=am[aK](0,r);return{x:m,y:l,width:ao[aK](0,s)-m,height:ao[aK](0,r)-l};},null,function(b){return{x:b.x,y:b.y,width:b.width,height:b.height};}),aP=function(a){var l=[];if(!a4.is(a,c0)||!a4.is(a&&a[0],c0)){a=a4.parsePathString(a);}for(var k=0,j=a.length;k<j;k++){l[k]=[];for(var i=0,h=a[k].length;i<h;i++){l[k][i]=a[k][i];}}l.toString=a4._path2string;return l;},dr=a4._pathToRelative=a0(function(F){if(!a4.is(F,c0)||!a4.is(F&&F[0],c0)){F=a4.parsePathString(F);}var E=[],D=0,C=0,B=0,A=0,z=0;F[0][0]=="M"&&(D=F[0][1],C=F[0][2],B=D,A=C,z++,E.push(["M",D,C]));for(var y=z,x=F.length;y<x;y++){var w=E[y]=[],v=F[y];if(v[0]!=at.call(v[0])){w[0]=at.call(v[0]);switch(w[0]){case"a":w[1]=v[1],w[2]=v[2],w[3]=v[3],w[4]=v[4],w[5]=v[5],w[6]=+(v[6]-D).toFixed(3),w[7]=+(v[7]-C).toFixed(3);break;case"v":w[1]=+(v[1]-C).toFixed(3);break;case"m":B=v[1],A=v[2];default:for(var u=1,t=v.length;u<t;u++){w[u]=+(v[u]-(u%2?D:C)).toFixed(3);}}}else{w=E[y]=[],v[0]=="m"&&(B=v[1]+D,A=v[2]+C);for(var s=0,r=v.length;s<r;s++){E[y][s]=v[s];}}var a=E[y].length;switch(E[y][0]){case"z":D=B,C=A;break;case"h":D+=+E[y][a-1];break;case"v":C+=+E[y][a-1];break;default:D+=+E[y][a-2],C+=+E[y][a-1];}}E.toString=a4._path2string;return E;},0,aP),dq=a4._pathToAbsolute=a0(function(G){if(!a4.is(G,c0)||!a4.is(G&&G[0],c0)){G=a4.parsePathString(G);}if(!G||!G.length){return[["M",0,0]];}var F=[],E=0,D=0,C=0,B=0,A=0;G[0][0]=="M"&&(E=+G[0][1],D=+G[0][2],C=E,B=D,A++,F[0]=["M",E,D]);var z=G.length==3&&G[0][0]=="M"&&G[1][0].toUpperCase()=="R"&&G[2][0].toUpperCase()=="Z";for(var y,x,w=A,v=G.length;w<v;w++){F.push(y=[]),x=G[w];if(x[0]!=cD.call(x[0])){y[0]=cD.call(x[0]);switch(y[0]){case"A":y[1]=x[1],y[2]=x[2],y[3]=x[3],y[4]=x[4],y[5]=x[5],y[6]=+(x[6]+E),y[7]=+(x[7]+D);break;case"V":y[1]=+x[1]+D;break;case"H":y[1]=+x[1]+E;break;case"R":var u=[E,D][aJ](x.slice(1));for(var t=2,n=u.length;t<n;t++){u[t]=+u[t]+E,u[++t]=+u[t]+D;}F.pop(),F=F[aJ](aU(u,z));break;case"M":C=+x[1]+E,B=+x[2]+D;default:for(t=1,n=x.length;t<n;t++){y[t]=+x[t]+(t%2?E:D);}}}else{if(x[0]=="R"){u=[E,D][aJ](x.slice(1)),F.pop(),F=F[aJ](aU(u,z)),y=["R"][aJ](x.slice(-2));}else{for(var a=0,H=x.length;a<H;a++){y[a]=x[a];}}}switch(y[0]){case"Z":E=C,D=B;break;case"H":E=y[1];break;case"V":D=y[1];break;case"M":C=y[y.length-2],B=y[y.length-1];default:E=y[y.length-2],D=y[y.length-1];}}F.toString=a4._path2string;return F;},null,aP),dp=function(f,e,h,g){return[f,e,h,g,h,g];},dn=function(j,i,p,o,n,m){var l=1/3,k=2/3;return[l*j+k*p,l*i+k*o,l*n+k*p,l*m+k*o,n,m];},dm=function(bL,bK,bJ,bI,bH,bG,bF,bE,bD,bC){var bB=c6*120/180,bA=c6/180*(+bH||0),bz=[],by,bx=a0(function(g,f,j){var i=g*aq.cos(j)-f*aq.sin(j),h=g*aq.sin(j)+f*aq.cos(j);return{x:i,y:h};});if(!bC){by=bx(bL,bK,-bA),bL=by.x,bK=by.y,by=bx(bE,bD,-bA),bE=by.x,bD=by.y;var bw=aq.cos(c6/180*bH),bv=aq.sin(c6/180*bH),bu=(bL-bE)/2,bt=(bK-bD)/2,bs=bu*bu/(bJ*bJ)+bt*bt/(bI*bI);bs>1&&(bs=aq.sqrt(bs),bJ=bs*bJ,bI=bs*bI);var br=bJ*bJ,bq=bI*bI,bp=(bG==bF?-1:1)*aq.sqrt(ak((br*bq-br*bt*bt-bq*bu*bu)/(br*bt*bt+bq*bu*bu))),bo=bp*bJ*bt/bI+(bL+bE)/2,bn=bp*-bI*bu/bJ+(bK+bD)/2,bm=aq.asin(((bK-bn)/bI).toFixed(9)),bl=aq.asin(((bD-bn)/bI).toFixed(9));bm=bL<bo?c6-bm:bm,bl=bE<bo?c6-bl:bl,bm<0&&(bm=c6*2+bm),bl<0&&(bl=c6*2+bl),bF&&bm>bl&&(bm=bm-c6*2),!bF&&bl>bm&&(bl=bl-c6*2);}else{bm=bC[0],bl=bC[1],bo=bC[2],bn=bC[3];}var bk=bl-bm;if(ak(bk)>bB){var bj=bl,bi=bE,bh=bD;bl=bm+bB*(bF&&bl>bm?1:-1),bE=bo+bJ*aq.cos(bl),bD=bn+bI*aq.sin(bl),bz=dm(bE,bD,bJ,bI,bH,0,bF,bi,bh,[bl,bj,bo,bn]);}bk=bl-bm;var bg=aq.cos(bm),bf=aq.sin(bm),be=aq.cos(bl),bd=aq.sin(bl),bc=aq.tan(bk/4),bb=4/3*bJ*bc,ba=4/3*bI*bc,Z=[bL,bK],Y=[bL+bb*bf,bK-ba*bg],B=[bE+bb*bd,bD-ba*be],z=[bE,bD];Y[0]=2*Z[0]-Y[0],Y[1]=2*Z[1]-Y[1];if(bC){return[Y,B,z][aJ](bz);}bz=[Y,B,z][aJ](bz).join()[az](",");var w=[];for(var s=0,n=bz.length;s<n;s++){w[s]=s%2?bx(bz[s-1],bz[s],bA).y:bx(bz[s],bz[s+1],bA).x;}return w;},dl=function(t,s,r,q,p,o,n,m,l){var k=1-l;return{x:c8(k,3)*t+c8(k,2)*3*l*r+k*3*l*l*p+c8(l,3)*n,y:c8(k,3)*s+c8(k,2)*3*l*q+k*3*l*l*o+c8(l,3)*m};},dk=a0(function(F,E,D,C,B,A,z,y){var x=B-2*D+F-(z-2*B+D),w=2*(D-F)-2*(B-D),v=F-D,u=(-w+aq.sqrt(w*w-4*x*v))/2/x,t=(-w-aq.sqrt(w*w-4*x*v))/2/x,s=[E,y],r=[F,z],m;ak(u)>"1e12"&&(u=0.5),ak(t)>"1e12"&&(t=0.5),u>0&&u<1&&(m=dl(F,E,D,C,B,A,z,y,u),r.push(m.x),s.push(m.y)),t>0&&t<1&&(m=dl(F,E,D,C,B,A,z,y,t),r.push(m.x),s.push(m.y)),x=A-2*C+E-(y-2*A+C),w=2*(C-E)-2*(A-C),v=E-C,u=(-w+aq.sqrt(w*w-4*x*v))/2/x,t=(-w-aq.sqrt(w*w-4*x*v))/2/x,ak(u)>"1e12"&&(u=0.5),ak(t)>"1e12"&&(t=0.5),u>0&&u<1&&(m=dl(F,E,D,C,B,A,z,y,u),r.push(m.x),s.push(m.y)),t>0&&t<1&&(m=dl(F,E,D,C,B,A,z,y,t),r.push(m.x),s.push(m.y));return{min:{x:am[aK](0,r),y:am[aK](0,s)},max:{x:ao[aK](0,r),y:ao[aK](0,s)}};}),dj=a4._path2curve=a0(function(D,C){var B=dq(D),A=C&&dq(C),z={x:0,y:0,bx:0,by:0,X:0,Y:0,qx:null,qy:null},y={x:0,y:0,bx:0,by:0,X:0,Y:0,qx:null,qy:null},x=function(f,e){var h,g;if(!f){return["C",e.x,e.y,e.x,e.y,e.x,e.y];}!(f[0] in {T:1,Q:1})&&(e.qx=e.qy=null);switch(f[0]){case"M":e.X=f[1],e.Y=f[2];break;case"A":f=["C"][aJ](dm[aK](0,[e.x,e.y][aJ](f.slice(1))));break;case"S":h=e.x+(e.x-(e.bx||e.x)),g=e.y+(e.y-(e.by||e.y)),f=["C",h,g][aJ](f.slice(1));break;case"T":e.qx=e.x+(e.x-(e.qx||e.x)),e.qy=e.y+(e.y-(e.qy||e.y)),f=["C"][aJ](dn(e.x,e.y,e.qx,e.qy,f[1],f[2]));break;case"Q":e.qx=f[1],e.qy=f[2],f=["C"][aJ](dn(e.x,e.y,f[1],f[2],f[3],f[4]));break;case"L":f=["C"][aJ](dp(e.x,e.y,f[1],f[2]));break;case"H":f=["C"][aJ](dp(e.x,e.y,f[1],e.y));break;case"V":f=["C"][aJ](dp(e.x,e.y,e.x,f[1]));break;case"Z":f=["C"][aJ](dp(e.x,e.y,e.X,e.Y));}return f;},w=function(d,c){if(d[c].length>7){d[c].shift();var f=d[c];while(f.length){d.splice(c++,0,["C"][aJ](f.splice(0,6)));}d.splice(c,1),t=ao(B.length,A&&A.length||0);}},v=function(d,c,j,i,h){d&&c&&d[h][0]=="M"&&c[h][0]!="M"&&(c.splice(h,0,["M",i.x,i.y]),j.bx=0,j.by=0,j.x=d[h][1],j.y=d[h][2],t=ao(B.length,A&&A.length||0));
};for(var u=0,t=ao(B.length,A&&A.length||0);u<t;u++){B[u]=x(B[u],z),w(B,u),A&&(A[u]=x(A[u],y)),A&&w(A,u),v(B,A,z,y,u),v(A,B,y,z,u);var s=B[u],r=A&&A[u],n=s.length,m=A&&r.length;z.x=s[n-2],z.y=s[n-1],z.bx=cH(s[n-4])||z.x,z.by=cH(s[n-3])||z.y,y.bx=A&&(cH(r[m-4])||y.x),y.by=A&&(cH(r[m-3])||y.y),y.x=A&&r[m-2],y.y=A&&r[m-1];}return A?[B,A]:B;},null,aP),di=a4._parseDots=a0(function(t){var s=[];for(var r=0,q=t.length;r<q;r++){var p={},o=t[r].match(/^([^:]*):?([\d\.]*)/);p.color=a4.getRGB(o[1]);if(p.color.error){return null;}p.color=p.color.hex,o[2]&&(p.offset=o[2]+"%"),s.push(p);}for(r=1,q=s.length-1;r<q;r++){if(!s[r].offset){var n=cH(s[r-1].offset||0),m=0;for(var l=r+1;l<q;l++){if(s[l].offset){m=s[l].offset;break;}}m||(m=100,l=q),m=cH(m);var a=(m-n)/(l-r+1);for(;r<l;r++){n+=a,s[r].offset=n+"%";}}}return s;}),dh=a4._tear=function(d,c){d==c.top&&(c.top=d.prev),d==c.bottom&&(c.bottom=d.next),d.next&&(d.next.prev=d.prev),d.prev&&(d.prev.next=d.next);},dg=a4._tofront=function(d,c){c.top!==d&&(dh(d,c),d.next=null,d.prev=c.top,c.top.next=d,c.top=d);},df=a4._toback=function(d,c){c.bottom!==d&&(dh(d,c),d.next=c.bottom,d.prev=null,c.bottom.prev=d,c.bottom=d);},de=a4._insertafter=function(e,d,f){dh(e,f),d==f.top&&(f.top=e),d.next&&(d.next.prev=e),e.next=d.next,e.prev=d,d.next=e;},dd=a4._insertbefore=function(e,d,f){dh(e,f),d==f.bottom&&(f.bottom=e),d.prev&&(d.prev.next=e),e.prev=d.prev,d.prev=e,e.next=d;},dc=a4._extractTransform=function(R,Q){if(Q==null){return R._.transform;}Q=aA(Q).replace(/\.{3}|\u2026/g,R._.transform||aF);var P=a4.parseTransformString(Q),O=0,N=0,M=0,L=1,K=1,J=R._,I=new c9;J.transform=P||[];if(P){for(var H=0,G=P.length;H<G;H++){var F=P[H],E=F.length,D=aA(F[0]).toLowerCase(),C=F[0]!=D,B=C?I.invert():0,A,z,r,p,a;D=="t"&&E==3?C?(A=B.x(0,0),z=B.y(0,0),r=B.x(F[1],F[2]),p=B.y(F[1],F[2]),I.translate(r-A,p-z)):I.translate(F[1],F[2]):D=="r"?E==2?(a=a||R.getBBox(1),I.rotate(F[1],a.x+a.width/2,a.y+a.height/2),O+=F[1]):E==4&&(C?(r=B.x(F[2],F[3]),p=B.y(F[2],F[3]),I.rotate(F[1],r,p)):I.rotate(F[1],F[2],F[3]),O+=F[1]):D=="s"?E==2||E==3?(a=a||R.getBBox(1),I.scale(F[1],F[E-1],a.x+a.width/2,a.y+a.height/2),L*=F[1],K*=F[E-1]):E==5&&(C?(r=B.x(F[3],F[4]),p=B.y(F[3],F[4]),I.scale(F[1],F[2],r,p)):I.scale(F[1],F[2],F[3],F[4]),L*=F[1],K*=F[2]):D=="m"&&E==7&&I.add(F[1],F[2],F[3],F[4],F[5],F[6]),J.dirtyT=1,R.matrix=I;}}R.matrix=I,J.sx=L,J.sy=K,J.deg=O,J.dx=N=I.e,J.dy=M=I.f,L==1&&K==1&&!O&&J.bbox?(J.bbox.x+=+N,J.bbox.y+=+M):J.dirtyT=1;},db=function(d){var c=d[0];switch(c.toLowerCase()){case"t":return[c,0,0];case"m":return[c,1,0,0,1,0,0];case"r":return d.length==4?[c,0,d[2],d[3]]:[c,0];case"s":return d.length==5?[c,1,1,d[3],d[4]]:d.length==3?[c,1,1]:[c,1];}},da=a4._equaliseTransform=function(t,s){s=aA(s).replace(/\.{3}|\u2026/g,t),t=a4.parseTransformString(t)||[],s=a4.parseTransformString(s)||[];var r=ao(t.length,s.length),q=[],p=[],o=0,n,m,l,a;for(;o<r;o++){l=t[o]||db(s[o]),a=s[o]||db(l);if(l[0]!=a[0]||l[0].toLowerCase()=="r"&&(l[2]!=a[2]||l[3]!=a[3])||l[0].toLowerCase()=="s"&&(l[3]!=a[3]||l[4]!=a[4])){return;}q[o]=[],p[o]=[];for(n=0,m=ao(l.length,a.length);n<m;n++){n in l&&(q[o][n]=l[n]),n in a&&(p[o][n]=a[n]);}}return{from:q,to:p};};a4._getContainer=function(a,j,i,h){var g;g=h==null&&!a4.is(a,"object")?aQ.doc.getElementById(a):a;if(g!=null){if(g.tagName){return j==null?{container:g,width:g.style.pixelWidth||g.offsetWidth,height:g.style.pixelHeight||g.offsetHeight}:{container:g,width:j,height:i};}return{container:1,x:a,y:j,width:i,height:h};}},a4.pathToRelative=dr,a4._engine={},a4.path2curve=dj,a4.matrix=function(h,g,l,k,j,i){return new c9(h,g,l,k,j,i);},function(a){function e(d){var c=aq.sqrt(f(d));d[0]&&(d[0]/=c),d[1]&&(d[1]/=c);}function f(b){return b[0]*b[0]+b[1]*b[1];}a.add=function(z,y,x,w,v,u){var t=[[],[],[]],s=[[this.a,this.c,this.e],[this.b,this.d,this.f],[0,0,1]],r=[[z,x,v],[y,w,u],[0,0,1]],q,p,o,n;z&&z instanceof c9&&(r=[[z.a,z.c,z.e],[z.b,z.d,z.f],[0,0,1]]);for(q=0;q<3;q++){for(p=0;p<3;p++){n=0;for(o=0;o<3;o++){n+=s[q][o]*r[o][p];}t[q][p]=n;}}this.a=t[0][0],this.b=t[1][0],this.c=t[0][1],this.d=t[1][1],this.e=t[0][2],this.f=t[1][2];},a.invert=function(){var d=this,c=d.a*d.d-d.b*d.c;return new c9(d.d/c,-d.b/c,-d.c/c,d.a/c,(d.c*d.f-d.d*d.e)/c,(d.b*d.e-d.a*d.f)/c);},a.clone=function(){return new c9(this.a,this.b,this.c,this.d,this.e,this.f);},a.translate=function(d,c){this.add(1,0,0,1,d,c);},a.scale=function(h,g,j,i){g==null&&(g=h),(j||i)&&this.add(1,0,0,1,j,i),this.add(h,0,0,g,0,0),(j||i)&&this.add(1,0,0,1,-j,-i);},a.rotate=function(g,k,j){g=a4.rad(g),k=k||0,j=j||0;var i=+aq.cos(g).toFixed(9),h=+aq.sin(g).toFixed(9);this.add(i,h,-h,i,k,j),this.add(1,0,0,1,-k,-j);},a.x=function(d,c){return d*this.a+c*this.c+this.e;},a.y=function(d,c){return d*this.b+c*this.d+this.f;},a.get=function(b){return +this[aA.fromCharCode(97+b)].toFixed(4);},a.toString=function(){return a4.svg?"matrix("+[this.get(0),this.get(1),this.get(2),this.get(3),this.get(4),this.get(5)].join()+")":[this.get(0),this.get(2),this.get(1),this.get(3),0,0].join();},a.toFilter=function(){return"progid:DXImageTransform.Microsoft.Matrix(M11="+this.get(0)+", M12="+this.get(2)+", M21="+this.get(1)+", M22="+this.get(3)+", Dx="+this.get(4)+", Dy="+this.get(5)+", sizingmethod='auto expand')";},a.offset=function(){return[this.e.toFixed(4),this.f.toFixed(4)];},a.split=function(){var c={};c.dx=this.e,c.dy=this.f;var i=[[this.a,this.c],[this.b,this.d]];c.scalex=aq.sqrt(f(i[0])),e(i[0]),c.shear=i[0][0]*i[1][0]+i[0][1]*i[1][1],i[1]=[i[1][0]-i[0][0]*c.shear,i[1][1]-i[0][1]*c.shear],c.scaley=aq.sqrt(f(i[1])),e(i[1]),c.shear/=c.scaley;var h=-i[0][1],d=i[1][1];d<0?(c.rotate=a4.deg(aq.acos(d)),h<0&&(c.rotate=360-c.rotate)):c.rotate=a4.deg(aq.asin(h)),c.isSimple=!+c.shear.toFixed(9)&&(c.scalex.toFixed(9)==c.scaley.toFixed(9)||!c.rotate),c.isSuperSimple=!+c.shear.toFixed(9)&&c.scalex.toFixed(9)==c.scaley.toFixed(9)&&!c.rotate,c.noRotation=!+c.shear.toFixed(9)&&!c.rotate;return c;},a.toTransformString=function(d){var c=d||this[az]();if(c.isSimple){c.scalex=+c.scalex.toFixed(4),c.scaley=+c.scaley.toFixed(4),c.rotate=+c.rotate.toFixed(4);return(c.dx||c.dy?"t"+[c.dx,c.dy]:aF)+(c.scalex!=1||c.scaley!=1?"s"+[c.scalex,c.scaley,0,0]:aF)+(c.rotate?"r"+[c.rotate,0,0]:aF);}return"m"+[this.get(0),this.get(1),this.get(2),this.get(3),this.get(4),this.get(5)];};}(c9.prototype);var c7=navigator.userAgent.match(/Version\/(.*?)\s/)||navigator.userAgent.match(/Chrome\/(\d+)/);navigator.vendor=="Apple Computer, Inc."&&(c7&&c7[1]<4||navigator.platform.slice(0,2)=="iP")||navigator.vendor=="Google Inc."&&c7&&c7[1]<8?aM.safari=function(){var b=this.rect(-99,-99,this.width+99,this.height+99).attr({stroke:"none"});setTimeout(function(){b.remove();});}:aM.safari=cC;var c5=function(){this.returnValue=!1;},c3=function(){return this.originalEvent.preventDefault();},c1=function(){this.cancelBubble=!0;},cZ=function(){return this.originalEvent.stopPropagation();},cX=function(){if(aQ.doc.addEventListener){return function(h,g,l,k){var j=aH&&av[g]?av[g]:g,i=function(q){var p=aQ.doc.documentElement.scrollTop||aQ.doc.body.scrollTop,o=aQ.doc.documentElement.scrollLeft||aQ.doc.body.scrollLeft,d=q.clientX+o,c=q.clientY+p;if(aH&&av[aS](g)){for(var b=0,a=q.targetTouches&&q.targetTouches.length;b<a;b++){if(q.targetTouches[b].target==h){var r=q;q=q.targetTouches[b],q.originalEvent=r,q.preventDefault=c3,q.stopPropagation=cZ;break;}}}return l.call(k,q,d,c);};h.addEventListener(j,i,!1);return function(){h.removeEventListener(j,i,!1);return !0;};};}if(aQ.doc.attachEvent){return function(h,g,l,k){var j=function(d){d=d||aQ.win.event;
var c=aQ.doc.documentElement.scrollTop||aQ.doc.body.scrollTop,o=aQ.doc.documentElement.scrollLeft||aQ.doc.body.scrollLeft,n=d.clientX+o,m=d.clientY+c;d.preventDefault=d.preventDefault||c5,d.stopPropagation=d.stopPropagation||c1;return l.call(k,d,n,m);};h.attachEvent("on"+g,j);var i=function(){h.detachEvent("on"+g,j);return !0;};return i;};}}(),cV=[],cT=function(B){var A=B.clientX,z=B.clientY,y=aQ.doc.documentElement.scrollTop||aQ.doc.body.scrollTop,x=aQ.doc.documentElement.scrollLeft||aQ.doc.body.scrollLeft,w,v=cV.length;while(v--){w=cV[v];if(aH){var u=B.touches.length,t;while(u--){t=B.touches[u];if(t.identifier==w.el._drag.id){A=t.clientX,z=t.clientY,(B.originalEvent?B.originalEvent:B).preventDefault();break;}}}else{B.preventDefault();}var s=w.el.node,r,q=s.nextSibling,o=s.parentNode,h=s.style.display;aQ.win.opera&&o.removeChild(s),s.style.display="none",r=w.el.paper.getElementByPoint(A,z),s.style.display=h,aQ.win.opera&&(q?o.insertBefore(s,q):o.appendChild(s)),r&&eve("drag.over."+w.el.id,w.el,r),A+=x,z+=y,eve("drag.move."+w.el.id,w.move_scope||w.el,A-w.el._drag.x,z-w.el._drag.y,A,z,B);}},dt=function(a){a4.unmousemove(cT).unmouseup(dt);var f=cV.length,e;while(f--){e=cV[f],e.el._drag={},eve("drag.end."+e.el.id,e.end_scope||e.start_scope||e.move_scope||e.el,a);}cV=[];},cN=a4.el={};for(var aI=ax.length;aI--;){(function(a){a4[a]=cN[a]=function(e,b){a4.is(e,"function")&&(this.events=this.events||[],this.events.push({name:a,f:e,unbind:cX(this.shape||this.node||aQ.doc,a,e,b||this)}));return this;},a4["un"+a]=cN["un"+a]=function(b){var f=this.events||[],e=f.length;while(e--){if(f[e].name==a&&f[e].f==b){f[e].unbind(),f.splice(e,1),!f.length&&delete this.events;return this;}}return this;};})(ax[aI]);}cN.data=function(a,h){var g=cI[this.id]=cI[this.id]||{};if(arguments.length==1){if(a4.is(a,"object")){for(var f in a){a[aS](f)&&this.data(f,a[f]);}return this;}eve("data.get."+this.id,this,g[a],a);return g[a];}g[a]=h,eve("data.set."+this.id,this,h,a);return this;},cN.removeData=function(b){b==null?cI[this.id]={}:cI[this.id]&&delete cI[this.id][b];return this;},cN.hover=function(f,e,h,g){return this.mouseover(f,h).mouseout(e,g||h);},cN.unhover=function(d,c){return this.unmouseover(d).unmouseout(c);};var aG=[];cN.drag=function(a,n,m,l,k,j){function h(d){(d.originalEvent||d).preventDefault();var c=aQ.doc.documentElement.scrollTop||aQ.doc.body.scrollTop,b=aQ.doc.documentElement.scrollLeft||aQ.doc.body.scrollLeft;this._drag.x=d.clientX+b,this._drag.y=d.clientY+c,this._drag.id=d.identifier,!cV.length&&a4.mousemove(cT).mouseup(dt),cV.push({el:this,move_scope:l,start_scope:k,end_scope:j}),n&&eve.on("drag.start."+this.id,n),a&&eve.on("drag.move."+this.id,a),m&&eve.on("drag.end."+this.id,m),eve("drag.start."+this.id,k||l||this,d.clientX+b,d.clientY+c,d);}this._drag={},aG.push({el:this,start:h}),this.mousedown(h);return this;},cN.onDragOver=function(b){b?eve.on("drag.over."+this.id,b):eve.unbind("drag.over."+this.id);},cN.undrag=function(){var a=aG.length;while(a--){aG[a].el==this&&(this.unmousedown(aG[a].start),aG.splice(a,1),eve.unbind("drag.*."+this.id));}!aG.length&&a4.unmousemove(cT).unmouseup(dt);},aM.circle=function(a,h,g){var f=a4._engine.circle(this,a||0,h||0,g||0);this.__set__&&this.__set__.push(f);return f;},aM.rect=function(a,l,k,j,i){var h=a4._engine.rect(this,a||0,l||0,k||0,j||0,i||0);this.__set__&&this.__set__.push(h);return h;},aM.ellipse=function(a,j,i,h){var g=a4._engine.ellipse(this,a||0,j||0,i||0,h||0);this.__set__&&this.__set__.push(g);return g;},aM.path=function(a){a&&!a4.is(a,c2)&&!a4.is(a[0],c0)&&(a+=aF);var d=a4._engine.path(a4.format[aK](a4,arguments),this);this.__set__&&this.__set__.push(d);return d;},aM.image=function(a,l,k,j,i){var h=a4._engine.image(this,a||"about:blank",l||0,k||0,j||0,i||0);this.__set__&&this.__set__.push(h);return h;},aM.text=function(a,h,g){var f=a4._engine.text(this,a||0,h||0,aA(g));this.__set__&&this.__set__.push(f);return f;},aM.set=function(a){!a4.is(a,"array")&&(a=Array.prototype.splice.call(arguments,0,arguments.length));var d=new ac(a);this.__set__&&this.__set__.push(d);return d;},aM.setStart=function(b){this.__set__=b||this.set();},aM.setFinish=function(d){var c=this.__set__;delete this.__set__;return c;},aM.setSize=function(a,d){return a4._engine.setSize.call(this,a,d);},aM.setViewBox=function(a,j,i,h,g){return a4._engine.setViewBox.call(this,a,j,i,h,g);},aM.top=aM.bottom=null,aM.raphael=a4;var aE=function(r){var q=r.getBoundingClientRect(),p=r.ownerDocument,o=p.body,n=p.documentElement,m=n.clientTop||o.clientTop||0,l=n.clientLeft||o.clientLeft||0,k=q.top+(aQ.win.pageYOffset||n.scrollTop||o.scrollTop)-m,h=q.left+(aQ.win.pageXOffset||n.scrollLeft||o.scrollLeft)-l;return{y:k,x:h};};aM.getElementByPoint=function(j,h){var p=this,o=p.canvas,n=aQ.doc.elementFromPoint(j,h);if(aQ.win.opera&&n.tagName=="svg"){var m=aE(o),l=o.createSVGRect();l.x=j-m.x,l.y=h-m.y,l.width=l.height=1;var k=o.getIntersectionList(l,null);k.length&&(n=k[k.length-1]);}if(!n){return null;}while(n.parentNode&&n!=o.parentNode&&!n.raphael){n=n.parentNode;}n==p.canvas.parentNode&&(n=o),n=n&&n.raphael?p.getById(n.raphaelid):null;return n;},aM.getById=function(d){var c=this.bottom;while(c){if(c.id==d){return c;}c=c.next;}return null;},aM.forEach=function(e,d){var f=this.bottom;while(f){if(e.call(d,f)===!1){return this;}f=f.next;}return this;},cN.getBBox=function(d){if(this.removed){return{};}var c=this._;if(d){if(c.dirty||!c.bboxwt){this.realPath=b8[this.type](this),c.bboxwt=aR(this.realPath),c.bboxwt.toString=aB,c.dirty=0;}return c.bboxwt;}if(c.dirty||c.dirtyT||!c.bbox){if(c.dirty||!this.realPath){c.bboxwt=0,this.realPath=b8[this.type](this);}c.bbox=aR(b6(this.realPath,this.matrix)),c.bbox.toString=aB,c.dirty=c.dirtyT=0;}return c.bbox;},cN.clone=function(){if(this.removed){return null;}var b=this.paper[this.type]().attr(this.attr());this.__set__&&this.__set__.push(b);return b;},cN.glow=function(i){if(this.type=="text"){return null;}i=i||{};var h={width:(i.width||10)+(+this.attr("stroke-width")||1),fill:i.fill||!1,opacity:i.opacity||0.5,offsetx:i.offsetx||0,offsety:i.offsety||0,color:i.color||"#000"},n=h.width/2,m=this.paper,l=m.set(),k=this.realPath||b8[this.type](this);k=this.matrix?b6(k,this.matrix):k;for(var j=1;j<n+1;j++){l.push(m.path(k).attr({stroke:h.color,fill:h.fill?h.color:"none","stroke-linejoin":"round","stroke-linecap":"round","stroke-width":+(h.width/n*j).toFixed(3),opacity:+(h.opacity/n).toFixed(3)}));}return l.insertBefore(this).translate(h.offsetx,h.offsety);};var ay={},aw=function(H,G,F,E,D,C,B,A,z){var y=0,x=100,w=[H,G,F,E,D,C,B,A].join(),v=ay[w],u,t;!v&&(ay[w]=v={data:[]}),v.timer&&clearTimeout(v.timer),v.timer=setTimeout(function(){delete ay[w];},2000);if(z!=null&&!v.precision){var s=aw(H,G,F,E,D,C,B,A);v.precision=~~s*10,v.data=[];}x=v.precision||x;for(var a=0;a<x+1;a++){v.data[a*x]?t=v.data[a*x]:(t=a4.findDotsAtSegment(H,G,F,E,D,C,B,A,a/x),v.data[a*x]=t),a&&(y+=c8(c8(u.x-t.x,2)+c8(u.y-t.y,2),0.5));if(z!=null&&y>=z){return t;}u=t;}if(z==null){return y;}},au=function(a,d){return function(A,z,y){A=dj(A);var x,w,v,u,t="",s={},r,q=0;for(var c=0,b=A.length;c<b;c++){v=A[c];if(v[0]=="M"){x=+v[1],w=+v[2];}else{u=aw(x,w,v[1],v[2],v[3],v[4],v[5],v[6]);if(q+u>z){if(d&&!s.start){r=aw(x,w,v[1],v[2],v[3],v[4],v[5],v[6],z-q),t+=["C"+r.start.x,r.start.y,r.m.x,r.m.y,r.x,r.y];if(y){return t;}s.start=t,t=["M"+r.x,r.y+"C"+r.n.x,r.n.y,r.end.x,r.end.y,v[5],v[6]].join(),q+=u,x=+v[5],w=+v[6];continue;}if(!a&&!d){r=aw(x,w,v[1],v[2],v[3],v[4],v[5],v[6],z-q);return{x:r.x,y:r.y,alpha:r.alpha};
}}q+=u,x=+v[5],w=+v[6];}t+=v.shift()+v;}s.end=t,r=a?q:d?s:a4.findDotsAtSegment(x,w,v[0],v[1],v[2],v[3],v[4],v[5],1),r.alpha&&(r={x:r.x,y:r.y,alpha:r.alpha});return r;};},ar=au(1),ap=au(),an=au(0,1);a4.getTotalLength=ar,a4.getPointAtLength=ap,a4.getSubpath=function(f,e,h){if(this.getTotalLength(f)-h<0.000001){return an(f,e).end;}var g=an(f,h,1);return e?an(g,e).end:g;},cN.getTotalLength=function(){if(this.type=="path"){if(this.node.getTotalLength){return this.node.getTotalLength();}return ar(this.attrs.path);}},cN.getPointAtLength=function(b){if(this.type=="path"){return ap(this.attrs.path,b);}},cN.getSubpath=function(a,d){if(this.type=="path"){return a4.getSubpath(this.attrs.path,a,d);}};var al=a4.easing_formulas={linear:function(b){return b;},"<":function(b){return c8(b,1.7);},">":function(b){return c8(b,0.48);},"<>":function(j){var i=0.48-j/1.04,p=aq.sqrt(0.1734+i*i),o=p-i,n=c8(ak(o),1/3)*(o<0?-1:1),m=-p-i,l=c8(ak(m),1/3)*(m<0?-1:1),k=n+l+0.5;return(1-k)*3*k*k+k*k*k;},backIn:function(d){var c=1.70158;return d*d*((c+1)*d-c);},backOut:function(d){d=d-1;var c=1.70158;return d*d*((c+1)*d+c)+1;},elastic:function(b){if(b==!!b){return b;}return c8(2,-10*b)*aq.sin((b-0.075)*2*c6/0.3)+1;},bounce:function(f){var e=7.5625,h=2.75,g;f<1/h?g=e*f*f:f<2/h?(f-=1.5/h,g=e*f*f+0.75):f<2.5/h?(f-=2.25/h,g=e*f*f+0.9375):(f-=2.625/h,g=e*f*f+0.984375);return g;}};al.easeIn=al["ease-in"]=al["<"],al.easeOut=al["ease-out"]=al[">"],al.easeInOut=al["ease-in-out"]=al["<>"],al["back-in"]=al.backIn,al["back-out"]=al.backOut;var aj=[],ai=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(b){setTimeout(b,16);},ah=function(){var T=+(new Date),S=0;for(;S<aj.length;S++){var R=aj[S];if(R.el.removed||R.paused){continue;}var Q=T-R.start,P=R.ms,O=R.easing,N=R.from,M=R.diff,L=R.to,K=R.t,J=R.el,I={},H,F={},E;R.initstatus?(Q=(R.initstatus*R.anim.top-R.prev)/(R.percent-R.prev)*P,R.status=R.initstatus,delete R.initstatus,R.stop&&aj.splice(S--,1)):R.status=(R.prev+(R.percent-R.prev)*(Q/P))/R.anim.top;if(Q<0){continue;}if(Q<P){var D=O(Q/P);for(var C in N){if(N[aS](C)){switch(cz[C]){case c4:H=+N[C]+D*P*M[C];break;case"colour":H="rgb("+[ag(cL(N[C].r+D*P*M[C].r)),ag(cL(N[C].g+D*P*M[C].g)),ag(cL(N[C].b+D*P*M[C].b))].join(",")+")";break;case"path":H=[];for(var B=0,q=N[C].length;B<q;B++){H[B]=[N[C][B][0]];for(var n=1,g=N[C][B].length;n<g;n++){H[B][n]=+N[C][B][n]+D*P*M[C][B][n];}H[B]=H[B].join(aC);}H=H.join(aC);break;case"transform":if(M[C].real){H=[];for(B=0,q=N[C].length;B<q;B++){H[B]=[N[C][B][0]];for(n=1,g=N[C][B].length;n<g;n++){H[B][n]=N[C][B][n]+D*P*M[C][B][n];}}}else{var a=function(b){return +N[C][b]+D*P*M[C][b];};H=[["m",a(0),a(1),a(2),a(3),a(4),a(5)]];}break;case"csv":if(C=="clip-rect"){H=[],B=4;while(B--){H[B]=+N[C][B]+D*P*M[C][B];}}break;default:var G=[][aJ](N[C]);H=[],B=J.paper.customAttributes[C].length;while(B--){H[B]=+G[B]+D*P*M[C][B];}}I[C]=H;}}J.attr(I),function(e,d,f){setTimeout(function(){eve("anim.frame."+e,d,f);});}(J.id,J,R.anim);}else{(function(e,h,f){setTimeout(function(){eve("anim.frame."+h.id,h,f),eve("anim.finish."+h.id,h,f),a4.is(e,"function")&&e.call(h);});})(R.callback,J,R.anim),J.attr(L),aj.splice(S--,1);if(R.repeat>1&&!R.next){for(E in L){L[aS](E)&&(F[E]=R.totalOrigin[E]);}R.el.attr(F),ad(R.anim,R.el,R.anim.percents[0],null,R.totalOrigin,R.repeat-1);}R.next&&!R.stop&&ad(R.anim,R.el,R.next,null,R.totalOrigin,R.repeat);}}a4.svg&&J&&J.paper&&J.paper.safari(),aj.length&&ai(ah);},ag=function(b){return b>255?255:b<0?0:b;};cN.animateWith=function(x,w,v,u,t,s){var r=this;if(r.removed){s&&s.call(r);return r;}var q=v instanceof ae?v:a4.animation(v,u,t,s),p,o;ad(q,r,q.percents[0],null,r.attr());for(var n=0,a=aj.length;n<a;n++){if(aj[n].anim==w&&aj[n].el==x){aj[a-1].start=aj[n].start;break;}}return r;},cN.onAnimation=function(b){b?eve.on("anim.frame."+this.id,b):eve.unbind("anim.frame."+this.id);return this;},ae.prototype.delay=function(d){var c=new ae(this.anim,this.ms);c.times=this.times,c.del=+d||0;return c;},ae.prototype.repeat=function(d){var c=new ae(this.anim,this.ms);c.del=this.del,c.times=aq.floor(ao(d,0))||1;return c;},a4.animation=function(a,n,m,l){if(a instanceof ae){return a;}if(a4.is(m,"function")||!m){l=l||m||null,m=null;}a=Object(a),n=+n||0;var k={},j,g;for(g in a){a[aS](g)&&cH(g)!=g&&cH(g)+"%"!=g&&(j=!0,k[g]=a[g]);}if(!j){return new ae(a,n);}m&&(k.easing=m),l&&(k.callback=l);return new ae({100:k},n);},cN.animate=function(a,l,k,j){var i=this;if(i.removed){j&&j.call(i);return i;}var h=a instanceof ae?a:a4.animation(a,l,k,j);ad(h,i,h.percents[0],null,i.attr());return i;},cN.setTime=function(d,c){d&&c!=null&&this.status(d,am(c,d.ms)/d.ms);return this;},cN.status=function(h,g){var l=[],k=0,j,i;if(g!=null){ad(h,this,-1,am(g,1));return this;}j=aj.length;for(;k<j;k++){i=aj[k];if(i.el.id==this.id&&(!h||i.anim==h)){if(h){return i.status;}l.push({anim:i.anim,status:i.status});}}if(h){return 0;}return l;},cN.pause=function(d){for(var c=0;c<aj.length;c++){aj[c].el.id==this.id&&(!d||aj[c].anim==d)&&eve("anim.pause."+this.id,this,aj[c].anim)!==!1&&(aj[c].paused=!0);}return this;},cN.resume=function(e){for(var d=0;d<aj.length;d++){if(aj[d].el.id==this.id&&(!e||aj[d].anim==e)){var f=aj[d];eve("anim.resume."+this.id,this,f.anim)!==!1&&(delete f.paused,this.status(f.anim,f.status));}}return this;},cN.stop=function(d){for(var c=0;c<aj.length;c++){aj[c].el.id==this.id&&(!d||aj[c].anim==d)&&eve("anim.stop."+this.id,this,aj[c].anim)!==!1&&aj.splice(c--,1);}return this;},cN.toString=function(){return"Raphaël’s object";};var ac=function(e){this.items=[],this.length=0,this.type="set";if(e){for(var d=0,f=e.length;d<f;d++){e[d]&&(e[d].constructor==cN.constructor||e[d].constructor==ac)&&(this[this.items.length]=this.items[this.items.length]=e[d],this.length++);}}},ab=ac.prototype;ab.push=function(){var f,e;for(var h=0,g=arguments.length;h<g;h++){f=arguments[h],f&&(f.constructor==cN.constructor||f.constructor==ac)&&(e=this.items.length,this[e]=this.items[e]=f,this.length++);}return this;},ab.pop=function(){this.length&&delete this[this.length--];return this.items.pop();},ab.forEach=function(f,e){for(var h=0,g=this.items.length;h<g;h++){if(f.call(e,this.items[h],h)===!1){return this;}}return this;};for(var aa in cN){cN[aS](aa)&&(ab[aa]=function(b){return function(){var a=arguments;return this.forEach(function(d){d[b][aK](d,a);});};}(aa));}ab.attr=function(a,l){if(a&&a4.is(a,c0)&&a4.is(a[0],"object")){for(var k=0,j=a.length;k<j;k++){this.items[k].attr(a[k]);}}else{for(var i=0,h=this.items.length;i<h;i++){this.items[i].attr(a,l);}}return this;},ab.clear=function(){while(this.length){this.pop();}},ab.splice=function(j,i,p){j=j<0?ao(this.length+j,0):j,i=ao(0,am(this.length-j,i));var o=[],n=[],m=[],l;for(l=2;l<arguments.length;l++){m.push(arguments[l]);}for(l=0;l<i;l++){n.push(this[j+l]);}for(;l<this.length-j;l++){o.push(this[j+l]);}var k=m.length;for(l=0;l<k+o.length;l++){this.items[j+l]=this[j+l]=l<k?m[l]:o[l-k];}l=this.items.length=this.length-=i-k;while(this[l]){delete this[l++];}return new ac(n);},ab.exclude=function(e){for(var d=0,f=this.length;d<f;d++){if(this[d]==e){this.splice(d,1);return !0;}}},ab.animate=function(t,s,r,q){(a4.is(r,"function")||!r)&&(q=r||null);var p=this.items.length,o=p,n,m=this,l;if(!p){return this;}q&&(l=function(){!--p&&q.call(m);}),r=a4.is(r,c2)?r:l;var a=a4.animation(t,s,r,l);n=this.items[--o].animate(a);while(o--){this.items[o]&&!this.items[o].removed&&this.items[o].animateWith(n,a,a);
}return this;},ab.insertAfter=function(d){var c=this.items.length;while(c--){this.items[c].insertAfter(d);}return this;},ab.getBBox=function(){var h=[],g=[],l=[],k=[];for(var j=this.items.length;j--;){if(!this.items[j].removed){var i=this.items[j].getBBox();h.push(i.x),g.push(i.y),l.push(i.x+i.width),k.push(i.y+i.height);}}h=am[aK](0,h),g=am[aK](0,g);return{x:h,y:g,width:ao[aK](0,l)-h,height:ao[aK](0,k)-g};},ab.clone=function(e){e=new ac;for(var d=0,f=this.items.length;d<f;d++){e.push(this.items[d].clone());}return e;},ab.toString=function(){return"Raphaël‘s set";},a4.registerFont=function(i){if(!i.face){return i;}this.fonts=this.fonts||{};var g={w:i.w,face:{},glyphs:{}},n=i.face["font-family"];for(var m in i.face){i.face[aS](m)&&(g.face[m]=i.face[m]);}this.fonts[n]?this.fonts[n].push(g):this.fonts[n]=[g];if(!i.svg){g.face["units-per-em"]=cF(i.face["units-per-em"],10);for(var l in i.glyphs){if(i.glyphs[aS](l)){var k=i.glyphs[l];g.glyphs[l]={w:k.w,k:{},d:k.d&&"M"+k.d.replace(/[mlcxtrv]/g,function(b){return{l:"L",c:"C",x:"z",t:"m",r:"l",v:"c"}[b]||"M";})+"z"};if(k.k){for(var j in k.k){k[aS](j)&&(g.glyphs[l].k[j]=k.k[j]);}}}}}return i;},aM.getFont=function(t,s,r,q){q=q||"normal",r=r||"normal",s=+s||{normal:400,bold:700,lighter:300,bolder:800}[s]||400;if(!!a4.fonts){var p=a4.fonts[t];if(!p){var o=new RegExp("(^|\\s)"+t.replace(/[^\w\d\s+!~.:_-]/g,aF)+"(\\s|$)","i");for(var n in a4.fonts){if(a4.fonts[aS](n)&&o.test(n)){p=a4.fonts[n];break;}}}var m;if(p){for(var g=0,a=p.length;g<a;g++){m=p[g];if(m.face["font-weight"]==s&&(m.face["font-style"]==r||!m.face["font-style"])&&m.face["font-stretch"]==q){break;}}}return m;}},aM.print=function(L,K,J,I,H,G,F){G=G||"middle",F=ao(am(F||0,1),-1);var E=this.set(),D=aA(J)[az](aF),C=0,B=aF,A;a4.is(I,J)&&(I=this.getFont(I));if(I){A=(H||16)/I.face["units-per-em"];var y=I.face.bbox[az](aZ),x=+y[0],s=+y[1]+(G=="baseline"?y[3]-y[1]+ +I.face.descent:(y[3]-y[1])/2);for(var r=0,p=D.length;r<p;r++){var c=r&&I.glyphs[D[r-1]]||{},a=I.glyphs[D[r]];C+=r?(c.w||I.w)+(c.k&&c.k[D[r]]||0)+I.w*F:0,a&&a.d&&E.push(this.path(a.d).attr({fill:"#000",stroke:"none",transform:[["t",C*A,0]]}));}E.transform(["...s",A,A,x,s,"t",(L-x)/A,(K-s)/A]);}return E;},aM.add=function(a){if(a4.is(a,"array")){var j=this.set(),i=0,g=a.length,d;for(;i<g;i++){d=a[i]||{},aY[aS](d.type)&&j.push(this[d.type]().attr(d));}}return j;},a4.format=function(a,f){var e=a4.is(f,c0)?[0][aJ](f):arguments;a&&a4.is(a,c2)&&e.length-1&&(a=a.replace(aV,function(d,c){return e[++c]==null?aF:e[c];}));return a||aF;},a4.fullfill=function(){var e=/\{([^\}]+)\}/g,d=/(?:(?:^|\.)(.+?)(?=\[|\.|$|\()|\[('|")(.+?)\2\])(\(\))?/g,f=function(b,i,h){var g=h;i.replace(d,function(k,j,n,m,l){j=j||m,g&&(j in g&&(g=g[j]),typeof g=="function"&&l&&(g=g()));}),g=(g==null||g==h?b:g)+"";return g;};return function(a,c){return String(a).replace(e,function(h,g){return f(h,g,c);});};}(),a4.ninja=function(){aO.was?aQ.win.Raphael=aO.is:delete Raphael;return a4;},a4.st=ab,function(a,h,g){function f(){/in/.test(a.readyState)?setTimeout(f,9):a4.eve("DOMload");}a.readyState==null&&a.addEventListener&&(a.addEventListener(h,g=function(){a.removeEventListener(h,g,!1),a.readyState="complete";},!1),a.readyState="loading"),f();}(document,"DOMContentLoaded"),aO.was?aQ.win.Raphael=a4:Raphael=a4,eve.on("DOMload",function(){a1=!0;});}(),window.Raphael.svg&&function(af){var ae="hasOwnProperty",ad=String,ac=parseFloat,ab=parseInt,aa=Math,Z=aa.max,Y=aa.abs,X=aa.pow,W=/[, ]+/,V=af.eve,U="",T=" ",S="http://www.w3.org/1999/xlink",R={block:"M5,0 0,2.5 5,5z",classic:"M5,0 0,2.5 5,5 3.5,3 3.5,2z",diamond:"M2.5,0 5,2.5 2.5,5 0,2.5z",open:"M6,1 1,3.5 6,6",oval:"M2.5,0A2.5,2.5,0,0,1,2.5,5 2.5,2.5,0,0,1,2.5,0z"},Q={};af.toString=function(){return"Your browser supports SVG.\nYou are running Raphaël "+this.version;};var O=function(c,b){if(b){typeof c=="string"&&(c=O(c));for(var a in b){b[ae](a)&&(a.substring(0,6)=="xlink:"?c.setAttributeNS(S,a.substring(6),ad(b[a])):c.setAttribute(a,ad(b[a])));}}else{c=af._g.doc.createElementNS("http://www.w3.org/2000/svg",c),c.style&&(c.style.webkitTapHighlightColor="rgba(0,0,0,0)");}return c;},M=function(z,l){var i="linear",h=z.id+l,g=0.5,f=0.5,d=z.node,c=z.paper,a=d.style,ai=af._g.doc.getElementById(h);if(!ai){l=ad(l).replace(af._radial_gradient,function(k,j,n){i="radial";if(j&&n){g=ac(j),f=ac(n);var m=(f>0.5)*2-1;X(g-0.5,2)+X(f-0.5,2)>0.25&&(f=aa.sqrt(0.25-X(g-0.5,2))*m+0.5)&&f!=0.5&&(f=f.toFixed(5)-0.00001*m);}return U;}),l=l.split(/\s*\-\s*/);if(i=="linear"){var ah=l.shift();ah=-ac(ah);if(isNaN(ah)){return null;}var ag=[0,0,aa.cos(af.rad(ah)),aa.sin(af.rad(ah))],C=1/(Z(Y(ag[2]),Y(ag[3]))||1);ag[2]*=C,ag[3]*=C,ag[2]<0&&(ag[0]=-ag[2],ag[2]=0),ag[3]<0&&(ag[1]=-ag[3],ag[3]=0);}var B=af._parseDots(l);if(!B){return null;}h=h.replace(/[\(\)\s,\xb0#]/g,"_"),z.gradient&&h!=z.gradient.id&&(c.defs.removeChild(z.gradient),delete z.gradient);if(!z.gradient){ai=O(i+"Gradient",{id:h}),z.gradient=ai,O(ai,i=="radial"?{fx:g,fy:f}:{x1:ag[0],y1:ag[1],x2:ag[2],y2:ag[3],gradientTransform:z.matrix.invert()}),c.defs.appendChild(ai);for(var A=0,q=B.length;A<q;A++){ai.appendChild(O("stop",{offset:B[A].offset?B[A].offset:A?"100%":"0%","stop-color":B[A].color||"#fff"}));}}}O(d,{fill:"url(#"+h+")",opacity:1,"fill-opacity":1}),a.fill=U,a.opacity=1,a.fillOpacity=1;return 1;},K=function(d){var c=d.getBBox(1);O(d.pattern,{patternTransform:d.matrix.invert()+" translate("+c.x+","+c.y+")"});},J=function(ay,ax,aw){if(ay.type=="path"){var av=ad(ax).toLowerCase().split("-"),au=ay.paper,at=aw?"end":"start",ar=ay.node,aq=ay.attrs,ap=aq["stroke-width"],ao=av.length,al="classic",aj,ah,ag,p,l,c=3,b=3,a=5;while(ao--){switch(av[ao]){case"block":case"classic":case"oval":case"diamond":case"open":case"none":al=av[ao];break;case"wide":b=5;break;case"narrow":b=2;break;case"long":c=5;break;case"short":c=2;}}al=="open"?(c+=2,b+=2,a+=2,ag=1,p=aw?4:1,l={fill:"none",stroke:aq.stroke}):(p=ag=c/2,l={fill:aq.stroke,stroke:"none"}),ay._.arrows?aw?(ay._.arrows.endPath&&Q[ay._.arrows.endPath]--,ay._.arrows.endMarker&&Q[ay._.arrows.endMarker]--):(ay._.arrows.startPath&&Q[ay._.arrows.startPath]--,ay._.arrows.startMarker&&Q[ay._.arrows.startMarker]--):ay._.arrows={};if(al!="none"){var an="raphael-marker-"+al,am="raphael-marker-"+at+al+c+b;af._g.doc.getElementById(an)?Q[an]++:(au.defs.appendChild(O(O("path"),{"stroke-linecap":"round",d:R[al],id:an})),Q[an]=1);var ak=af._g.doc.getElementById(am),ai;ak?(Q[am]++,ai=ak.getElementsByTagName("use")[0]):(ak=O(O("marker"),{id:am,markerHeight:b,markerWidth:c,orient:"auto",refX:p,refY:b/2}),ai=O(O("use"),{"xlink:href":"#"+an,transform:(aw?"rotate(180 "+c/2+" "+b/2+") ":U)+"scale("+c/a+","+b/a+")","stroke-width":(1/((c/a+b/a)/2)).toFixed(4)}),ak.appendChild(ai),au.defs.appendChild(ak),Q[am]=1),O(ai,l);var q=ag*(al!="diamond"&&al!="oval");aw?(aj=ay._.arrows.startdx*ap||0,ah=af.getTotalLength(aq.path)-q*ap):(aj=q*ap,ah=af.getTotalLength(aq.path)-(ay._.arrows.enddx*ap||0)),l={},l["marker-"+at]="url(#"+am+")";if(ah||aj){l.d=Raphael.getSubpath(aq.path,aj,ah);}O(ar,l),ay._.arrows[at+"Path"]=an,ay._.arrows[at+"Marker"]=am,ay._.arrows[at+"dx"]=q,ay._.arrows[at+"Type"]=al,ay._.arrows[at+"String"]=ax;}else{aw?(aj=ay._.arrows.startdx*ap||0,ah=af.getTotalLength(aq.path)-aj):(aj=0,ah=af.getTotalLength(aq.path)-(ay._.arrows.enddx*ap||0)),ay._.arrows[at+"Path"]&&O(ar,{d:Raphael.getSubpath(aq.path,aj,ah)}),delete ay._.arrows[at+"Path"],delete ay._.arrows[at+"Marker"],delete ay._.arrows[at+"dx"],delete ay._.arrows[at+"Type"],delete ay._.arrows[at+"String"];
}for(l in Q){if(Q[ae](l)&&!Q[l]){var o=af._g.doc.getElementById(l);o&&o.parentNode.removeChild(o);}}}},I={"":[0],none:[0],"-":[3,1],".":[1,1],"-.":[3,1,1,1],"-..":[3,1,1,1,1,1],". ":[1,3],"- ":[4,3],"--":[8,3],"- .":[4,3,1,3],"--.":[8,3,1,3],"--..":[8,3,1,3,1,3]},H=function(i,c,n){c=I[ad(c).toLowerCase()];if(c){var m=i.attrs["stroke-width"]||"1",l={round:m,square:m,butt:0}[i.attrs["stroke-linecap"]||n["stroke-linecap"]]||0,k=[],j=c.length;while(j--){k[j]=c[j]*m+(j%2?1:-1)*l;}O(i.node,{"stroke-dasharray":k.join(",")});}},G=function(ak,aj){var ai=ak.node,ah=ak.attrs,ag=ai.style.visibility;ai.style.visibility="hidden";for(var y in aj){if(aj[ae](y)){if(!af._availableAttrs[ae](y)){continue;}var v=aj[y];ah[y]=v;switch(y){case"blur":ak.blur(v);break;case"href":case"title":case"target":var n=ai.parentNode;if(n.tagName.toLowerCase()!="a"){var h=O("a");n.insertBefore(h,ai),h.appendChild(ai),n=h;}y=="target"?n.setAttributeNS(S,"show",v=="blank"?"new":v):n.setAttributeNS(S,y,v);break;case"cursor":ai.style.cursor=v;break;case"transform":ak.transform(v);break;case"arrow-start":J(ak,v);break;case"arrow-end":J(ak,v,1);break;case"clip-rect":var e=ad(v).split(W);if(e.length==4){ak.clip&&ak.clip.parentNode.parentNode.removeChild(ak.clip.parentNode);var a=O("clipPath"),t=O("rect");a.id=af.createUUID(),O(t,{x:e[0],y:e[1],width:e[2],height:e[3]}),a.appendChild(t),ak.paper.defs.appendChild(a),O(ai,{"clip-path":"url(#"+a.id+")"}),ak.clip=t;}if(!v){var s=ai.getAttribute("clip-path");if(s){var r=af._g.doc.getElementById(s.replace(/(^url\(#|\)$)/g,U));r&&r.parentNode.removeChild(r),O(ai,{"clip-path":U}),delete ak.clip;}}break;case"path":ak.type=="path"&&(O(ai,{d:v?ah.path=af._pathToAbsolute(v):"M0,0"}),ak._.dirty=1,ak._.arrows&&("startString" in ak._.arrows&&J(ak,ak._.arrows.startString),"endString" in ak._.arrows&&J(ak,ak._.arrows.endString,1)));break;case"width":ai.setAttribute(y,v),ak._.dirty=1;if(ah.fx){y="x",v=ah.x;}else{break;}case"x":ah.fx&&(v=-ah.x-(ah.width||0));case"rx":if(y=="rx"&&ak.type=="rect"){break;}case"cx":ai.setAttribute(y,v),ak.pattern&&K(ak),ak._.dirty=1;break;case"height":ai.setAttribute(y,v),ak._.dirty=1;if(ah.fy){y="y",v=ah.y;}else{break;}case"y":ah.fy&&(v=-ah.y-(ah.height||0));case"ry":if(y=="ry"&&ak.type=="rect"){break;}case"cy":ai.setAttribute(y,v),ak.pattern&&K(ak),ak._.dirty=1;break;case"r":ak.type=="rect"?O(ai,{rx:v,ry:v}):ai.setAttribute(y,v),ak._.dirty=1;break;case"src":ak.type=="image"&&ai.setAttributeNS(S,"href",v);break;case"stroke-width":if(ak._.sx!=1||ak._.sy!=1){v/=Z(Y(ak._.sx),Y(ak._.sy))||1;}ak.paper._vbSize&&(v*=ak.paper._vbSize),ai.setAttribute(y,v),ah["stroke-dasharray"]&&H(ak,ah["stroke-dasharray"],aj),ak._.arrows&&("startString" in ak._.arrows&&J(ak,ak._.arrows.startString),"endString" in ak._.arrows&&J(ak,ak._.arrows.endString,1));break;case"stroke-dasharray":H(ak,v,aj);break;case"fill":var q=ad(v).match(af._ISURL);if(q){a=O("pattern");var l=O("image");a.id=af.createUUID(),O(a,{x:0,y:0,patternUnits:"userSpaceOnUse",height:1,width:1}),O(l,{x:0,y:0,"xlink:href":q[1]}),a.appendChild(l),function(d){af._preload(q[1],function(){var f=this.offsetWidth,i=this.offsetHeight;O(d,{width:f,height:i}),O(l,{width:f,height:i}),ak.paper.safari();});}(a),ak.paper.defs.appendChild(a),O(ai,{fill:"url(#"+a.id+")"}),ak.pattern=a,ak.pattern&&K(ak);break;}var j=af.getRGB(v);if(!j.error){delete aj.gradient,delete ah.gradient,!af.is(ah.opacity,"undefined")&&af.is(aj.opacity,"undefined")&&O(ai,{opacity:ah.opacity}),!af.is(ah["fill-opacity"],"undefined")&&af.is(aj["fill-opacity"],"undefined")&&O(ai,{"fill-opacity":ah["fill-opacity"]});}else{if((ak.type=="circle"||ak.type=="ellipse"||ad(v).charAt()!="r")&&M(ak,v)){if("opacity" in ah||"fill-opacity" in ah){var g=af._g.doc.getElementById(ai.getAttribute("fill").replace(/^url\(#|\)$/g,U));if(g){var c=g.getElementsByTagName("stop");O(c[c.length-1],{"stop-opacity":("opacity" in ah?ah.opacity:1)*("fill-opacity" in ah?ah["fill-opacity"]:1)});}}ah.gradient=v,ah.fill="none";break;}}j[ae]("opacity")&&O(ai,{"fill-opacity":j.opacity>1?j.opacity/100:j.opacity});case"stroke":j=af.getRGB(v),ai.setAttribute(y,j.hex),y=="stroke"&&j[ae]("opacity")&&O(ai,{"stroke-opacity":j.opacity>1?j.opacity/100:j.opacity}),y=="stroke"&&ak._.arrows&&("startString" in ak._.arrows&&J(ak,ak._.arrows.startString),"endString" in ak._.arrows&&J(ak,ak._.arrows.endString,1));break;case"gradient":(ak.type=="circle"||ak.type=="ellipse"||ad(v).charAt()!="r")&&M(ak,v);break;case"opacity":ah.gradient&&!ah[ae]("stroke-opacity")&&O(ai,{"stroke-opacity":v>1?v/100:v});case"fill-opacity":if(ah.gradient){g=af._g.doc.getElementById(ai.getAttribute("fill").replace(/^url\(#|\)$/g,U)),g&&(c=g.getElementsByTagName("stop"),O(c[c.length-1],{"stop-opacity":v}));break;}default:y=="font-size"&&(v=ab(v,10)+"px");var b=y.replace(/(\-.)/g,function(d){return d.substring(1).toUpperCase();});ai.style[b]=v,ak._.dirty=1,ai.setAttribute(y,v);}}}E(ak,aj),ai.style.visibility=ag;},F=1.2,E=function(x,w){if(x.type=="text"&&!!(w[ae]("text")||w[ae]("font")||w[ae]("font-size")||w[ae]("x")||w[ae]("y"))){var v=x.attrs,u=x.node,t=u.firstChild?ab(af._g.doc.defaultView.getComputedStyle(u.firstChild,U).getPropertyValue("font-size"),10):10;if(w[ae]("text")){v.text=w.text;while(u.firstChild){u.removeChild(u.firstChild);}var s=ad(w.text).split("\n"),q=[],l;for(var e=0,c=s.length;e<c;e++){l=O("tspan"),e&&O(l,{dy:t*F,x:v.x}),l.appendChild(af._g.doc.createTextNode(s[e])),u.appendChild(l),q[e]=l;}}else{q=u.getElementsByTagName("tspan");for(e=0,c=q.length;e<c;e++){e?O(q[e],{dy:t*F,x:v.x}):O(q[0],{dy:0});}}O(u,{x:v.x,y:v.y}),x._.dirty=1;var b=x._getBBox(),a=v.y-(b.y+b.height/2);a&&af.is(a,"finite")&&O(q[0],{dy:a});}},D=function(a,h){var g=0,f=0;this[0]=this.node=a,a.raphael=!0,this.id=af._oid++,a.raphaelid=this.id,this.matrix=af.matrix(),this.realPath=null,this.paper=h,this.attrs=this.attrs||{},this._={transform:[],sx:1,sy:1,deg:0,dx:0,dy:0,dirty:1},!h.bottom&&(h.bottom=this),this.prev=h.top,h.top&&(h.top.next=this),h.top=this,this.next=null;},P=af.el;D.prototype=P,P.constructor=D,af._engine.path=function(f,e){var h=O("path");e.canvas&&e.canvas.appendChild(h);var g=new D(h,e);g.type="path",G(g,{fill:"none",stroke:"#000",path:f});return g;},P.rotate=function(d,c,h){if(this.removed){return this;}d=ad(d).split(W),d.length-1&&(c=ac(d[1]),h=ac(d[2])),d=ac(d[0]),h==null&&(c=h);if(c==null||h==null){var g=this.getBBox(1);c=g.x+g.width/2,h=g.y+g.height/2;}this.transform(this._.transform.concat([["r",d,c,h]]));return this;},P.scale=function(d,c,j,i){if(this.removed){return this;}d=ad(d).split(W),d.length-1&&(c=ac(d[1]),j=ac(d[2]),i=ac(d[3])),d=ac(d[0]),c==null&&(c=d),i==null&&(j=i);if(j==null||i==null){var h=this.getBBox(1);}j=j==null?h.x+h.width/2:j,i=i==null?h.y+h.height/2:i,this.transform(this._.transform.concat([["s",d,c,j,i]]));return this;},P.translate=function(d,c){if(this.removed){return this;}d=ad(d).split(W),d.length-1&&(c=ac(d[1])),d=ac(d[0])||0,c=+c||0,this.transform(this._.transform.concat([["t",d,c]]));return this;},P.transform=function(f){var b=this._;if(f==null){return b.transform;}af._extractTransform(this,f),this.clip&&O(this.clip,{transform:this.matrix.invert()}),this.pattern&&K(this),this.node&&O(this.node,{transform:this.matrix});if(b.sx!=1||b.sy!=1){var a=this.attrs[ae]("stroke-width")?this.attrs["stroke-width"]:1;this.attr({"stroke-width":a});}return this;},P.hide=function(){!this.removed&&this.paper.safari(this.node.style.display="none");return this;},P.show=function(){!this.removed&&this.paper.safari(this.node.style.display="");
return this;},P.remove=function(){if(!this.removed){var a=this.paper;a.__set__&&a.__set__.exclude(this),V.unbind("*.*."+this.id),this.gradient&&a.defs.removeChild(this.gradient),af._tear(this,a),this.node.parentNode.tagName.toLowerCase()=="a"?this.node.parentNode.parentNode.removeChild(this.node.parentNode):this.node.parentNode.removeChild(this.node);for(var d in this){this[d]=typeof this[d]=="function"?af._removedFactory(d):null;}this.removed=!0;}},P._getBBox=function(){if(this.node.style.display=="none"){this.show();var e=!0;}var d={};try{d=this.node.getBBox();}catch(f){}finally{d=d||{};}e&&this.hide();return d;},P.attr=function(x,w){if(this.removed){return this;}if(x==null){var v={};for(var u in this.attrs){this.attrs[ae](u)&&(v[u]=this.attrs[u]);}v.gradient&&v.fill=="none"&&(v.fill=v.gradient)&&delete v.gradient,v.transform=this._.transform;return v;}if(w==null&&af.is(x,"string")){if(x=="fill"&&this.attrs.fill=="none"&&this.attrs.gradient){return this.attrs.gradient;}if(x=="transform"){return this._.transform;}var t=x.split(W),s={};for(var r=0,q=t.length;r<q;r++){x=t[r],x in this.attrs?s[x]=this.attrs[x]:af.is(this.paper.customAttributes[x],"function")?s[x]=this.paper.customAttributes[x].def:s[x]=af._availableAttrs[x];}return q-1?s:s[t[0]];}if(w==null&&af.is(x,"array")){s={};for(r=0,q=x.length;r<q;r++){s[x[r]]=this.attr(x[r]);}return s;}if(w!=null){var k={};k[x]=w;}else{x!=null&&af.is(x,"object")&&(k=x);}for(var j in k){V("attr."+j+"."+this.id,this,k[j]);}for(j in this.paper.customAttributes){if(this.paper.customAttributes[ae](j)&&k[ae](j)&&af.is(this.paper.customAttributes[j],"function")){var b=this.paper.customAttributes[j].apply(this,[].concat(k[j]));this.attrs[j]=k[j];for(var a in b){b[ae](a)&&(k[a]=b[a]);}}}G(this,k);return this;},P.toFront=function(){if(this.removed){return this;}this.node.parentNode.tagName.toLowerCase()=="a"?this.node.parentNode.parentNode.appendChild(this.node.parentNode):this.node.parentNode.appendChild(this.node);var a=this.paper;a.top!=this&&af._tofront(this,a);return this;},P.toBack=function(){if(this.removed){return this;}var a=this.node.parentNode;a.tagName.toLowerCase()=="a"?a.parentNode.insertBefore(this.node.parentNode,this.node.parentNode.parentNode.firstChild):a.firstChild!=this.node&&a.insertBefore(this.node,this.node.parentNode.firstChild),af._toback(this,this.paper);var d=this.paper;return this;},P.insertAfter=function(a){if(this.removed){return this;}var d=a.node||a[a.length-1].node;d.nextSibling?d.parentNode.insertBefore(this.node,d.nextSibling):d.parentNode.appendChild(this.node),af._insertafter(this,a,this.paper);return this;},P.insertBefore=function(a){if(this.removed){return this;}var d=a.node||a[0].node;d.parentNode.insertBefore(this.node,d),af._insertbefore(this,a,this.paper);return this;},P.blur=function(a){var h=this;if(+a!==0){var g=O("filter"),f=O("feGaussianBlur");h.attrs.blur=a,g.id=af.createUUID(),O(f,{stdDeviation:+a||1.5}),g.appendChild(f),h.paper.defs.appendChild(g),h._blur=g,O(h.node,{filter:"url(#"+g.id+")"});}else{h._blur&&(h._blur.parentNode.removeChild(h._blur),delete h._blur,delete h.attrs.blur),h.node.removeAttribute("filter");}},af._engine.circle=function(h,g,l,k){var j=O("circle");h.canvas&&h.canvas.appendChild(j);var i=new D(j,h);i.attrs={cx:g,cy:l,r:k,fill:"none",stroke:"#000"},i.type="circle",O(j,i.attrs);return i;},af._engine.rect=function(j,i,p,o,n,m){var l=O("rect");j.canvas&&j.canvas.appendChild(l);var k=new D(l,j);k.attrs={x:i,y:p,width:o,height:n,r:m||0,rx:m||0,ry:m||0,fill:"none",stroke:"#000"},k.type="rect",O(l,k.attrs);return k;},af._engine.ellipse=function(i,h,n,m,l){var k=O("ellipse");i.canvas&&i.canvas.appendChild(k);var j=new D(k,i);j.attrs={cx:h,cy:n,rx:m,ry:l,fill:"none",stroke:"#000"},j.type="ellipse",O(k,j.attrs);return j;},af._engine.image=function(j,i,p,o,n,m){var l=O("image");O(l,{x:p,y:o,width:n,height:m,preserveAspectRatio:"none"}),l.setAttributeNS(S,"href",i),j.canvas&&j.canvas.appendChild(l);var k=new D(l,j);k.attrs={x:p,y:o,width:n,height:m,src:i},k.type="image";return k;},af._engine.text=function(a,l,k,j){var i=O("text");a.canvas&&a.canvas.appendChild(i);var h=new D(i,a);h.attrs={x:l,y:k,"text-anchor":"middle",text:j,font:af._availableAttrs.font,stroke:"none",fill:"#000"},h.type="text",G(h,h.attrs);return h;},af._engine.setSize=function(d,c){this.width=d||this.width,this.height=c||this.height,this.canvas.setAttribute("width",this.width),this.canvas.setAttribute("height",this.height),this._viewBox&&this.setViewBox.apply(this,this._viewBox);return this;},af._engine.create=function(){var r=af._getContainer.apply(0,arguments),q=r&&r.container,p=r.x,o=r.y,n=r.width,m=r.height;if(!q){throw new Error("SVG container not found.");}var l=O("svg"),k="overflow:hidden;",a;p=p||0,o=o||0,n=n||512,m=m||342,O(l,{height:m,version:1.1,width:n,xmlns:"http://www.w3.org/2000/svg"}),q==1?(l.style.cssText=k+"position:absolute;left:"+p+"px;top:"+o+"px",af._g.doc.body.appendChild(l),a=1):(l.style.cssText=k+"position:relative",q.firstChild?q.insertBefore(l,q.firstChild):q.appendChild(l)),q=new af._Paper,q.width=n,q.height=m,q.canvas=l,q.clear(),q._left=q._top=0,a&&(q.renderfix=function(){}),q.renderfix();return q;},af._engine.setViewBox=function(t,s,r,q,p){V("setViewBox",this,this._viewBox,[t,s,r,q,p]);var o=Z(r/this.width,q/this.height),n=this.top,m=p?"meet":"xMinYMin",k,g;t==null?(this._vbSize&&(o=1),delete this._vbSize,k="0 0 "+this.width+T+this.height):(this._vbSize=o,k=t+T+s+T+r+T+q),O(this.canvas,{viewBox:k,preserveAspectRatio:m});while(o&&n){g="stroke-width" in n.attrs?n.attrs["stroke-width"]:1,n.attr({"stroke-width":g}),n._.dirty=1,n._.dirtyT=1,n=n.prev;}this._viewBox=[t,s,r,q,!!p];return this;},af.prototype.renderfix=function(){var h=this.canvas,g=h.style,l;try{l=h.getScreenCTM()||h.createSVGMatrix();}catch(k){l=h.createSVGMatrix();}var j=-l.e%1,i=-l.f%1;if(j||i){j&&(this._left=(this._left+j)%1,g.left=this._left+"px"),i&&(this._top=(this._top+i)%1,g.top=this._top+"px");}},af.prototype.clear=function(){af.eve("clear",this);var a=this.canvas;while(a.firstChild){a.removeChild(a.firstChild);}this.bottom=this.top=null,(this.desc=O("desc")).appendChild(af._g.doc.createTextNode("Created with Raphaël "+af.version)),a.appendChild(this.desc),a.appendChild(this.defs=O("defs"));},af.prototype.remove=function(){V("remove",this),this.canvas.parentNode&&this.canvas.parentNode.removeChild(this.canvas);for(var a in this){this[a]=typeof this[a]=="function"?af._removedFactory(a):null;}};var N=af.st;for(var L in P){P[ae](L)&&!N[ae](L)&&(N[L]=function(b){return function(){var a=arguments;return this.forEach(function(d){d[b].apply(d,a);});};}(L));}}(window.Raphael),window.Raphael.vml&&function(ap){var ao="hasOwnProperty",an=String,am=parseFloat,al=Math,ak=al.round,aj=al.max,ai=al.min,ah=al.abs,ag="fill",af=/[, ]+/,ae=ap.eve,ad=" progid:DXImageTransform.Microsoft",ac=" ",ab="",aa={M:"m",L:"l",C:"c",Z:"x",m:"t",l:"r",c:"v",z:"x"},Y=/([clmz]),?([^clmz]*)/gi,W=/ progid:\S+Blur\([^\)]+\)/g,U=/-?[^,\s-]+/g,S="position:absolute;left:0;top:0;width:1px;height:1px",Q=21600,O={path:1,rect:1,image:1},M={circle:1,ellipse:1},K=function(v){var u=/[ahqstv]/ig,t=ap._pathToAbsolute;an(v).match(u)&&(t=ap._path2curve),u=/[clmz]/g;if(t==ap._pathToAbsolute&&!an(v).match(u)){var s=an(v).replace(Y,function(i,h,m){var l=[],k=h.toLowerCase()=="m",j=aa[h];m.replace(U,function(b){k&&l.length==2&&(j+=l+aa[h=="m"?"l":"L"],l=[]),l.push(ak(b*Q));});return j+l;});return s;}var q=t(v),p,o;s=[];for(var n=0,f=q.length;n<f;n++){p=q[n],o=q[n][0].toLowerCase(),o=="z"&&(o="x");
for(var c=1,a=p.length;c<a;c++){o+=ak(p[c]*Q)+(c!=a-1?",":ab);}s.push(o);}return s.join(ac);},J=function(a,h,g){var f=ap.matrix();f.rotate(-a,0.5,0.5);return{dx:f.x(h,g),dy:f.y(h,g)};},I=function(ar,aq,H,G,F,E){var D=ar._,C=ar.matrix,B=D.fillpos,A=ar.node,z=A.style,y=1,x="",w,u=Q/aq,n=Q/H;z.visibility="hidden";if(!!aq&&!!H){A.coordsize=ah(u)+ac+ah(n),z.rotation=E*(aq*H<0?-1:1);if(E){var j=J(E,G,F);G=j.dx,F=j.dy;}aq<0&&(x+="x"),H<0&&(x+=" y")&&(y=-1),z.flip=x,A.coordorigin=G*-u+ac+F*-n;if(B||D.fillsize){var i=A.getElementsByTagName(ag);i=i&&i[0],A.removeChild(i),B&&(j=J(E,C.x(B[0],B[1]),C.y(B[0],B[1])),i.position=j.dx*y+ac+j.dy*y),D.fillsize&&(i.size=D.fillsize[0]*ah(aq)+ac+D.fillsize[1]*ah(H)),A.appendChild(i);}z.visibility="visible";}};ap.toString=function(){return"Your browser doesn’t support SVG. Falling down to VML.\nYou are running Raphaël "+this.version;};var Z=function(t,s,r){var q=an(s).toLowerCase().split("-"),p=r?"end":"start",o=q.length,n="classic",m="medium",l="medium";while(o--){switch(q[o]){case"block":case"classic":case"oval":case"diamond":case"open":case"none":n=q[o];break;case"wide":case"narrow":l=q[o];break;case"long":case"short":m=q[o];}}var c=t.node.getElementsByTagName("stroke")[0];c[p+"arrow"]=n,c[p+"arrowlength"]=m,c[p+"arrowwidth"]=l;},X=function(aF,aE){aF.attrs=aF.attrs||{};var aD=aF.node,aC=aF.attrs,aB=aD.style,aA,ay=O[aF.type]&&(aE.x!=aC.x||aE.y!=aC.y||aE.width!=aC.width||aE.height!=aC.height||aE.cx!=aC.cx||aE.cy!=aC.cy||aE.rx!=aC.rx||aE.ry!=aC.ry||aE.r!=aC.r),aw=M[aF.type]&&(aC.cx!=aE.cx||aC.cy!=aE.cy||aC.r!=aE.r||aC.rx!=aE.rx||aC.ry!=aE.ry),av=aF;for(var F in aE){aE[ao](F)&&(aC[F]=aE[F]);}ay&&(aC.path=ap._getPath[aF.type](aF),aF._.dirty=1),aE.href&&(aD.href=aE.href),aE.title&&(aD.title=aE.title),aE.target&&(aD.target=aE.target),aE.cursor&&(aB.cursor=aE.cursor),"blur" in aE&&aF.blur(aE.blur);if(aE.path&&aF.type=="path"||ay){aD.path=K(~an(aC.path).toLowerCase().indexOf("r")?ap._pathToAbsolute(aC.path):aC.path),aF.type=="image"&&(aF._.fillpos=[aC.x,aC.y],aF._.fillsize=[aC.width,aC.height],I(aF,1,1,0,0,0));}"transform" in aE&&aF.transform(aE.transform);if(aw){var az=+aC.cx,ax=+aC.cy,au=+aC.rx||+aC.r||0,at=+aC.ry||+aC.r||0;aD.path=ap.format("ar{0},{1},{2},{3},{4},{1},{4},{1}x",ak((az-au)*Q),ak((ax-at)*Q),ak((az+au)*Q),ak((ax+at)*Q),ak(az*Q));}if("clip-rect" in aE){var ar=an(aE["clip-rect"]).split(af);if(ar.length==4){ar[2]=+ar[2]+ +ar[0],ar[3]=+ar[3]+ +ar[1];var aq=aD.clipRect||ap._g.doc.createElement("div"),C=aq.style;C.clip=ap.format("rect({1}px {2}px {3}px {0}px)",ar),aD.clipRect||(C.position="absolute",C.top=0,C.left=0,C.width=aF.paper.width+"px",C.height=aF.paper.height+"px",aD.parentNode.insertBefore(aq,aD),aq.appendChild(aD),aD.clipRect=aq);}aE["clip-rect"]||aD.clipRect&&(aD.clipRect.style.clip="auto");}if(aF.textpath){var A=aF.textpath.style;aE.font&&(A.font=aE.font),aE["font-family"]&&(A.fontFamily='"'+aE["font-family"].split(",")[0].replace(/^['"]+|['"]+$/g,ab)+'"'),aE["font-size"]&&(A.fontSize=aE["font-size"]),aE["font-weight"]&&(A.fontWeight=aE["font-weight"]),aE["font-style"]&&(A.fontStyle=aE["font-style"]);}"arrow-start" in aE&&Z(av,aE["arrow-start"]),"arrow-end" in aE&&Z(av,aE["arrow-end"],1);if(aE.opacity!=null||aE["stroke-width"]!=null||aE.fill!=null||aE.src!=null||aE.stroke!=null||aE["stroke-width"]!=null||aE["stroke-opacity"]!=null||aE["fill-opacity"]!=null||aE["stroke-dasharray"]!=null||aE["stroke-miterlimit"]!=null||aE["stroke-linejoin"]!=null||aE["stroke-linecap"]!=null){var z=aD.getElementsByTagName(ag),x=!1;z=z&&z[0],!z&&(x=z=P(ag)),aF.type=="image"&&aE.src&&(z.src=aE.src),aE.fill&&(z.on=!0);if(z.on==null||aE.fill=="none"||aE.fill===null){z.on=!1;}if(z.on&&aE.fill){var w=an(aE.fill).match(ap._ISURL);if(w){z.parentNode==aD&&aD.removeChild(z),z.rotate=!0,z.src=w[1],z.type="tile";var v=aF.getBBox(1);z.position=v.x+ac+v.y,aF._.fillpos=[v.x,v.y],ap._preload(w[1],function(){aF._.fillsize=[this.offsetWidth,this.offsetHeight];});}else{z.color=ap.getRGB(aE.fill).hex,z.src=ab,z.type="solid",ap.getRGB(aE.fill).error&&(av.type in {circle:1,ellipse:1}||an(aE.fill).charAt()!="r")&&V(av,aE.fill,z)&&(aC.fill="none",aC.gradient=aE.fill,z.rotate=!1);}}if("fill-opacity" in aE||"opacity" in aE){var u=((+aC["fill-opacity"]+1||2)-1)*((+aC.opacity+1||2)-1)*((+ap.getRGB(aE.fill).o+1||2)-1);u=ai(aj(u,0),1),z.opacity=u,z.src&&(z.color="none");}aD.appendChild(z);var n=aD.getElementsByTagName("stroke")&&aD.getElementsByTagName("stroke")[0],h=!1;!n&&(h=n=P("stroke"));if(aE.stroke&&aE.stroke!="none"||aE["stroke-width"]||aE["stroke-opacity"]!=null||aE["stroke-dasharray"]||aE["stroke-miterlimit"]||aE["stroke-linejoin"]||aE["stroke-linecap"]){n.on=!0;}(aE.stroke=="none"||aE.stroke===null||n.on==null||aE.stroke==0||aE["stroke-width"]==0)&&(n.on=!1);var g=ap.getRGB(aE.stroke);n.on&&aE.stroke&&(n.color=g.hex),u=((+aC["stroke-opacity"]+1||2)-1)*((+aC.opacity+1||2)-1)*((+g.o+1||2)-1);var f=(am(aE["stroke-width"])||1)*0.75;u=ai(aj(u,0),1),aE["stroke-width"]==null&&(f=aC["stroke-width"]),aE["stroke-width"]&&(n.weight=f),f&&f<1&&(u*=f)&&(n.weight=1),n.opacity=u,aE["stroke-linejoin"]&&(n.joinstyle=aE["stroke-linejoin"]||"miter"),n.miterlimit=aE["stroke-miterlimit"]||8,aE["stroke-linecap"]&&(n.endcap=aE["stroke-linecap"]=="butt"?"flat":aE["stroke-linecap"]=="square"?"square":"round");if(aE["stroke-dasharray"]){var d={"-":"shortdash",".":"shortdot","-.":"shortdashdot","-..":"shortdashdotdot",". ":"dot","- ":"dash","--":"longdash","- .":"dashdot","--.":"longdashdot","--..":"longdashdotdot"};n.dashstyle=d[ao](aE["stroke-dasharray"])?d[aE["stroke-dasharray"]]:ab;}h&&aD.appendChild(n);}if(av.type=="text"){av.paper.canvas.style.display=ab;var c=av.paper.span,b=100,a=aC.font&&aC.font.match(/\d+(?:\.\d*)?(?=px)/);aB=c.style,aC.font&&(aB.font=aC.font),aC["font-family"]&&(aB.fontFamily=aC["font-family"]),aC["font-weight"]&&(aB.fontWeight=aC["font-weight"]),aC["font-style"]&&(aB.fontStyle=aC["font-style"]),a=am(aC["font-size"]||a&&a[0])||10,aB.fontSize=a*b+"px",av.textpath.string&&(c.innerHTML=an(av.textpath.string).replace(/</g,"&#60;").replace(/&/g,"&#38;").replace(/\n/g,"<br>"));var j=c.getBoundingClientRect();av.W=aC.w=(j.right-j.left)/b,av.H=aC.h=(j.bottom-j.top)/b,av.X=aC.x,av.Y=aC.y+av.H/2,("x" in aE||"y" in aE)&&(av.path.v=ap.format("m{0},{1}l{2},{1}",ak(aC.x*Q),ak(aC.y*Q),ak(aC.x*Q)+1));var aG=["x","y","text","font","font-family","font-weight","font-style","font-size"];for(var o=0,k=aG.length;o<k;o++){if(aG[o] in aE){av._.dirty=1;break;}}switch(aC["text-anchor"]){case"start":av.textpath.style["v-text-align"]="left",av.bbx=av.W/2;break;case"end":av.textpath.style["v-text-align"]="right",av.bbx=-av.W/2;break;default:av.textpath.style["v-text-align"]="center",av.bbx=0;}av.textpath.style["v-text-kern"]=!0;}},V=function(z,y,x){z.attrs=z.attrs||{};var w=z.attrs,v=Math.pow,u,o,n="linear",e=".5 .5";z.attrs.gradient=y,y=an(y).replace(ap._radial_gradient,function(g,f,h){n="radial",f&&h&&(f=am(f),h=am(h),v(f-0.5,2)+v(h-0.5,2)>0.25&&(h=al.sqrt(0.25-v(f-0.5,2))*((h>0.5)*2-1)+0.5),e=f+ac+h);return ab;}),y=y.split(/\s*\-\s*/);if(n=="linear"){var d=y.shift();d=-am(d);if(isNaN(d)){return null;}}var c=ap._parseDots(y);if(!c){return null;}z=z.shape||z.node;if(c.length){z.removeChild(x),x.on=!0,x.method="none",x.color=c[0].color,x.color2=c[c.length-1].color;var a=[];for(var B=0,A=c.length;B<A;B++){c[B].offset&&a.push(c[B].offset+ac+c[B].color);}x.colors=a.length?a.join():"0% "+x.color,n=="radial"?(x.type="gradientTitle",x.focus="100%",x.focussize="0 0",x.focusposition=e,x.angle=0):(x.type="gradient",x.angle=(270-d)%360),z.appendChild(x);
}return 1;},T=function(a,d){this[0]=this.node=a,a.raphael=!0,this.id=ap._oid++,a.raphaelid=this.id,this.X=0,this.Y=0,this.attrs={},this.paper=d,this.matrix=ap.matrix(),this._={transform:[],sx:1,sy:1,dx:0,dy:0,deg:0,dirty:1,dirtyT:1},!d.bottom&&(d.bottom=this),this.prev=d.top,d.top&&(d.top.next=this),d.top=this,this.next=null;},R=ap.el;T.prototype=R,R.constructor=T,R.transform=function(B){if(B==null){return this._.transform;}var A=this.paper._viewBoxShift,z=A?"s"+[A.scale,A.scale]+"-1-1t"+[A.dx,A.dy]:ab,y;A&&(y=B=an(B).replace(/\.{3}|\u2026/g,this._.transform||ab)),ap._extractTransform(this,z+B);var x=this.matrix.clone(),w=this.skew,v=this.node,u,t=~an(this.attrs.fill).indexOf("-"),s=!an(this.attrs.fill).indexOf("url(");x.translate(-0.5,-0.5);if(s||t||this.type=="image"){w.matrix="1 0 0 1",w.offset="0 0",u=x.split();if(t&&u.noRotation||!u.isSimple){v.style.filter=x.toFilter();var o=this.getBBox(),n=this.getBBox(1),c=o.x-n.x,a=o.y-n.y;v.coordorigin=c*-Q+ac+a*-Q,I(this,1,1,c,a,0);}else{v.style.filter=ab,I(this,u.scalex,u.scaley,u.dx,u.dy,u.rotate);}}else{v.style.filter=ab,w.matrix=an(x),w.offset=x.offset();}y&&(this._.transform=y);return this;},R.rotate=function(d,c,h){if(this.removed){return this;}if(d!=null){d=an(d).split(af),d.length-1&&(c=am(d[1]),h=am(d[2])),d=am(d[0]),h==null&&(c=h);if(c==null||h==null){var g=this.getBBox(1);c=g.x+g.width/2,h=g.y+g.height/2;}this._.dirtyT=1,this.transform(this._.transform.concat([["r",d,c,h]]));return this;}},R.translate=function(d,c){if(this.removed){return this;}d=an(d).split(af),d.length-1&&(c=am(d[1])),d=am(d[0])||0,c=+c||0,this._.bbox&&(this._.bbox.x+=d,this._.bbox.y+=c),this.transform(this._.transform.concat([["t",d,c]]));return this;},R.scale=function(d,c,j,i){if(this.removed){return this;}d=an(d).split(af),d.length-1&&(c=am(d[1]),j=am(d[2]),i=am(d[3]),isNaN(j)&&(j=null),isNaN(i)&&(i=null)),d=am(d[0]),c==null&&(c=d),i==null&&(j=i);if(j==null||i==null){var h=this.getBBox(1);}j=j==null?h.x+h.width/2:j,i=i==null?h.y+h.height/2:i,this.transform(this._.transform.concat([["s",d,c,j,i]])),this._.dirtyT=1;return this;},R.hide=function(){!this.removed&&(this.node.style.display="none");return this;},R.show=function(){!this.removed&&(this.node.style.display=ab);return this;},R._getBBox=function(){if(this.removed){return{};}return{x:this.X+(this.bbx||0)-this.W/2,y:this.Y-this.H,width:this.W,height:this.H};},R.remove=function(){if(!this.removed){this.paper.__set__&&this.paper.__set__.exclude(this),ap.eve.unbind("*.*."+this.id),ap._tear(this,this.paper),this.node.parentNode.removeChild(this.node),this.shape&&this.shape.parentNode.removeChild(this.shape);for(var a in this){this[a]=typeof this[a]=="function"?ap._removedFactory(a):null;}this.removed=!0;}},R.attr=function(x,w){if(this.removed){return this;}if(x==null){var v={};for(var u in this.attrs){this.attrs[ao](u)&&(v[u]=this.attrs[u]);}v.gradient&&v.fill=="none"&&(v.fill=v.gradient)&&delete v.gradient,v.transform=this._.transform;return v;}if(w==null&&ap.is(x,"string")){if(x==ag&&this.attrs.fill=="none"&&this.attrs.gradient){return this.attrs.gradient;}var t=x.split(af),s={};for(var r=0,l=t.length;r<l;r++){x=t[r],x in this.attrs?s[x]=this.attrs[x]:ap.is(this.paper.customAttributes[x],"function")?s[x]=this.paper.customAttributes[x].def:s[x]=ap._availableAttrs[x];}return l-1?s:s[t[0]];}if(this.attrs&&w==null&&ap.is(x,"array")){s={};for(r=0,l=x.length;r<l;r++){s[x[r]]=this.attr(x[r]);}return s;}var k;w!=null&&(k={},k[x]=w),w==null&&ap.is(x,"object")&&(k=x);for(var j in k){ae("attr."+j+"."+this.id,this,k[j]);}if(k){for(j in this.paper.customAttributes){if(this.paper.customAttributes[ao](j)&&k[ao](j)&&ap.is(this.paper.customAttributes[j],"function")){var b=this.paper.customAttributes[j].apply(this,[].concat(k[j]));this.attrs[j]=k[j];for(var a in b){b[ao](a)&&(k[a]=b[a]);}}}k.text&&this.type=="text"&&(this.textpath.string=k.text),X(this,k);}return this;},R.toFront=function(){!this.removed&&this.node.parentNode.appendChild(this.node),this.paper&&this.paper.top!=this&&ap._tofront(this,this.paper);return this;},R.toBack=function(){if(this.removed){return this;}this.node.parentNode.firstChild!=this.node&&(this.node.parentNode.insertBefore(this.node,this.node.parentNode.firstChild),ap._toback(this,this.paper));return this;},R.insertAfter=function(a){if(this.removed){return this;}a.constructor==ap.st.constructor&&(a=a[a.length-1]),a.node.nextSibling?a.node.parentNode.insertBefore(this.node,a.node.nextSibling):a.node.parentNode.appendChild(this.node),ap._insertafter(this,a,this.paper);return this;},R.insertBefore=function(a){if(this.removed){return this;}a.constructor==ap.st.constructor&&(a=a[0]),a.node.parentNode.insertBefore(this.node,a.node),ap._insertbefore(this,a,this.paper);return this;},R.blur=function(a){var f=this.node.runtimeStyle,e=f.filter;e=e.replace(W,ab),+a!==0?(this.attrs.blur=a,f.filter=e+ac+ad+".Blur(pixelradius="+(+a||1.5)+")",f.margin=ap.format("-{0}px 0 0 -{0}px",ak(+a||1.5))):(f.filter=e,f.margin=0,delete this.attrs.blur);},ap._engine.path=function(h,g){var l=P("shape");l.style.cssText=S,l.coordsize=Q+ac+Q,l.coordorigin=g.coordorigin;var k=new T(l,g),j={fill:"none",stroke:"#000"};h&&(j.path=h),k.type="path",k.path=[],k.Path=ab,X(k,j),g.canvas.appendChild(l);var i=P("skew");i.on=!0,l.appendChild(i),k.skew=i,k.transform(ab);return k;},ap._engine.rect=function(r,q,p,o,n,m){var l=ap._rectPath(q,p,o,n,m),k=r.path(l),a=k.attrs;k.X=a.x=q,k.Y=a.y=p,k.W=a.width=o,k.H=a.height=n,a.r=m,a.path=l,k.type="rect";return k;},ap._engine.ellipse=function(i,h,n,m,l){var k=i.path(),j=k.attrs;k.X=h-m,k.Y=n-l,k.W=m*2,k.H=l*2,k.type="ellipse",X(k,{cx:h,cy:n,rx:m,ry:l});return k;},ap._engine.circle=function(h,g,l,k){var j=h.path(),i=j.attrs;j.X=g-k,j.Y=l-k,j.W=j.H=k*2,j.type="circle",X(j,{cx:g,cy:l,r:k});return j;},ap._engine.image=function(v,u,t,s,r,q){var p=ap._rectPath(t,s,r,q),o=v.path(p).attr({stroke:"none"}),n=o.attrs,j=o.node,a=j.getElementsByTagName(ag)[0];n.src=u,o.X=n.x=t,o.Y=n.y=s,o.W=n.width=r,o.H=n.height=q,n.path=p,o.type="image",a.parentNode==j&&j.removeChild(a),a.rotate=!0,a.src=u,a.type="tile",o._.fillpos=[t,s],o._.fillsize=[r,q],j.appendChild(a),I(o,1,1,0,0,0);return o;},ap._engine.text=function(t,s,r,q){var p=P("shape"),o=P("path"),n=P("textpath");s=s||0,r=r||0,q=q||"",o.v=ap.format("m{0},{1}l{2},{1}",ak(s*Q),ak(r*Q),ak(s*Q)+1),o.textpathok=!0,n.string=an(q),n.on=!0,p.style.cssText=S,p.coordsize=Q+ac+Q,p.coordorigin="0 0";var f=new T(p,t),c={fill:"#000",stroke:"none",font:ap._availableAttrs.font,text:q};f.shape=p,f.path=o,f.textpath=n,f.type="text",f.attrs.text=an(q),f.attrs.x=s,f.attrs.y=r,f.attrs.w=1,f.attrs.h=1,X(f,c),p.appendChild(n),p.appendChild(o),t.canvas.appendChild(p);var a=P("skew");a.on=!0,p.appendChild(a),f.skew=a,f.transform(ab);return f;},ap._engine.setSize=function(a,f){var e=this.canvas.style;this.width=a,this.height=f,a==+a&&(a+="px"),f==+f&&(f+="px"),e.width=a,e.height=f,e.clip="rect(0 "+a+" "+f+" 0)",this._viewBox&&ap._engine.setViewBox.apply(this,this._viewBox);return this;},ap._engine.setViewBox=function(t,s,r,q,p){ap.eve("setViewBox",this,this._viewBox,[t,s,r,q,p]);var o=this.width,n=this.height,m=1/aj(r/o,q/n),g,a;p&&(g=n/q,a=o/r,r*g<o&&(t-=(o-r*g)/2/g),q*a<n&&(s-=(n-q*a)/2/a)),this._viewBox=[t,s,r,q,!!p],this._viewBoxShift={dx:-t,dy:-s,scale:m},this.forEach(function(b){b.transform("...");});return this;};var P;ap._engine.initWin=function(e){var d=e.document;d.createStyleSheet().addRule(".rvml","behavior:url(#default#VML)");try{!d.namespaces.rvml&&d.namespaces.add("rvml","urn:schemas-microsoft-com:vml"),P=function(b){return d.createElement("<rvml:"+b+' class="rvml">');
};}catch(f){P=function(b){return d.createElement("<"+b+' xmlns="urn:schemas-microsoft.com:vml" class="rvml">');};}},ap._engine.initWin(ap._g.win),ap._engine.create=function(){var t=ap._getContainer.apply(0,arguments),s=t.container,r=t.height,q,p=t.width,o=t.x,n=t.y;if(!s){throw new Error("VML container not found.");}var m=new ap._Paper,l=m.canvas=ap._g.doc.createElement("div"),a=l.style;o=o||0,n=n||0,p=p||512,r=r||342,m.width=p,m.height=r,p==+p&&(p+="px"),r==+r&&(r+="px"),m.coordsize=Q*1000+ac+Q*1000,m.coordorigin="0 0",m.span=ap._g.doc.createElement("span"),m.span.style.cssText="position:absolute;left:-9999em;top:-9999em;padding:0;margin:0;line-height:1;",l.appendChild(m.span),a.cssText=ap.format("top:0;left:0;width:{0};height:{1};display:inline-block;position:relative;clip:rect(0 {0} {1} 0);overflow:hidden",p,r),s==1?(ap._g.doc.body.appendChild(l),a.left=o+"px",a.top=n+"px",a.position="absolute"):s.firstChild?s.insertBefore(l,s.firstChild):s.appendChild(l),m.renderfix=function(){};return m;},ap.prototype.clear=function(){ap.eve("clear",this),this.canvas.innerHTML=ab,this.span=ap._g.doc.createElement("span"),this.span.style.cssText="position:absolute;left:-9999em;top:-9999em;padding:0;margin:0;line-height:1;display:inline;",this.canvas.appendChild(this.span),this.bottom=this.top=null;},ap.prototype.remove=function(){ap.eve("remove",this),this.canvas.parentNode.removeChild(this.canvas);for(var a in this){this[a]=typeof this[a]=="function"?ap._removedFactory(a):null;}return !0;};var N=ap.st;for(var L in R){R[ao](L)&&!N[ao](L)&&(N[L]=function(b){return function(){var a=arguments;return this.forEach(function(d){d[b].apply(d,a);});};}(L));}}(window.Raphael);
/*
 * Licensed under the MIT license:
 * http://www.opensource.org/licenses/mit-license.php
 *
 */

Raphael.fn.freeTransform=function(e,m,n){function l(b){if(b&&a.opts.dragSnap){var c=b.x,h=b.y,g={x:0,y:0},d=0,e=0;[0,1].map(function(){g.x=c-Math.round(c/a.opts.dragSnap)*a.opts.dragSnap;g.y=h-Math.round(h/a.opts.dragSnap)*a.opts.dragSnap;Math.abs(g.x)<=a.opts.dragSnapDist&&(d=g.x);Math.abs(g.y)<=a.opts.dragSnapDist&&(e=g.y);c+=b.width-d;h+=b.height-e});a.attrs.translate.x-=d;a.attrs.translate.y-=e}if(a.opts.boundary){var f=a.opts.boundary;a.attrs.center.x+a.attrs.translate.x<f.x&&(a.attrs.translate.x+=
f.x-(a.attrs.center.x+a.attrs.translate.x));a.attrs.center.y+a.attrs.translate.y<f.y&&(a.attrs.translate.y+=f.y-(a.attrs.center.y+a.attrs.translate.y));a.attrs.center.x+a.attrs.translate.x>f.x+f.width&&(a.attrs.translate.x+=f.x+f.width-(a.attrs.center.x+a.attrs.translate.x));a.attrs.center.y+a.attrs.translate.y>f.y+f.height&&(a.attrs.translate.y+=f.y+f.height-(a.attrs.center.y+a.attrs.translate.y))}a.opts.keepRatio&&(a.attrs.scale.x=a.attrs.scale.y);g=Math.abs(a.attrs.rotate%a.opts.rotateSnap);g=
Math.min(g,a.opts.rotateSnap-g);g<a.opts.rotateSnapDist&&(a.attrs.rotate=Math.round(a.attrs.rotate/a.opts.rotateSnap)*a.opts.rotateSnap);a.opts.scaleSnap&&(a.attrs.scale.x=Math.round(a.attrs.scale.x*a.attrs.size.x/a.opts.scaleSnap)*a.opts.scaleSnap/a.attrs.size.x,a.attrs.scale.y=Math.round(a.attrs.scale.y*a.attrs.size.y/a.opts.scaleSnap)*a.opts.scaleSnap/a.attrs.size.y);if(a.opts.rotateRange&&(f=(360+a.attrs.rotate)%360,180<f&&(f-=360),f<a.opts.rotateRange[0]&&(a.attrs.rotate+=a.opts.rotateRange[0]-
f),f>a.opts.rotateRange[1]))a.attrs.rotate+=a.opts.rotateRange[1]-f}function k(a){var c={},h;for(h in a)c[h]="object"==typeof a[h]?k(a[h]):a[h];return c}function i(b){if(a.callback){var c=[];b.map(function(a){a&&c.push(a)});clearTimeout(o);setTimeout(function(){a.callback&&a.callback(a,c)},1)}}if(e.freeTransform)return e.freeTransform;"map"in Array.prototype||(Array.prototype.map=function(a,c){var h=[],g;for(g in this)this.hasOwnProperty(g)&&(h[g]=a.call(c,this[g],g,this));return h});var d=this,j=
e.getBBox(!0),a=e.freeTransform={attrs:{x:j.x,y:j.y,size:{x:j.width,y:j.height},center:{x:j.x+j.width/2,y:j.y+j.height/2},rotate:0,scale:{x:1,y:1},translate:{x:0,y:0}},axes:null,bbox:null,callback:null,items:[],handles:{center:null,x:null,y:null},offset:{rotate:0,scale:{x:1,y:1},translate:{x:0,y:0}},opts:{attrs:{fill:"#000",stroke:"#000"},boundary:{x:d._left?d._left:0,y:d._top?d._top:0,width:d.width,height:d.height},distance:1.2,drag:!0,dragRotate:!1,dragScale:!1,dragSnap:!1,dragSnapDist:0,keepRatio:!1,
rotate:!0,rotateRange:[-180,180],rotateSnap:!1,rotateSnapDist:0,scale:!0,scaleSnap:!1,scaleRange:!1,showBBox:!1,size:5},subject:e};a.updateHandles=function(){if(a.opts.showBBox||a.opts.dragRotate){var b,c=a.attrs.rotate*Math.PI/180,h=(a.attrs.rotate+90)*Math.PI/180,g=a.attrs.size.x/2*a.attrs.scale.x,d=a.attrs.size.y/2*a.attrs.scale.y,e=[];[{x:-1,y:-1},{x:1,y:-1},{x:1,y:1},{x:-1,y:1}].map(function(b){e.push({x:a.attrs.center.x+a.attrs.translate.x+b.x*g*Math.cos(c)+b.y*d*Math.cos(h),y:a.attrs.center.y+
a.attrs.translate.y+b.x*g*Math.sin(c)+b.y*d*Math.sin(h)})});b=e}var f={x:a.attrs.rotate*Math.PI/180,y:(a.attrs.rotate+90)*Math.PI/180},i={x:a.attrs.size.x/2*a.attrs.scale.x,y:a.attrs.size.y/2*a.attrs.scale.y};a.axes.map(function(c){if(a.handles[c]){var b=a.attrs.center.x+a.attrs.translate.x+i[c]*a.opts.distance*Math.cos(f[c]),h=a.attrs.center.y+a.attrs.translate.y+i[c]*a.opts.distance*Math.sin(f[c]);if(a.opts.boundary){b=Math.max(Math.min(b,a.opts.boundary.x+a.opts.boundary.width),a.opts.boundary.x);
h=Math.max(Math.min(h,a.opts.boundary.y+a.opts.boundary.height),a.opts.boundary.y)}a.handles[c].disc.attr({cx:b,cy:h});a.handles[c].line.toFront().attr({path:[["M",a.attrs.center.x+a.attrs.translate.x,a.attrs.center.y+a.attrs.translate.y],["L",a.handles[c].disc.attrs.cx,a.handles[c].disc.attrs.cy]]});a.handles[c].disc.toFront()}});a.handles.center&&a.handles.center.disc.toFront().attr({cx:a.attrs.center.x+a.attrs.translate.x,cy:a.attrs.center.y+a.attrs.translate.y});a.opts.showBBox&&a.bbox.toFront().attr({path:[["M",
b[0].x,b[0].y],["L",b[1].x,b[1].y],["L",b[2].x,b[2].y],["L",b[3].x,b[3].y],["L",b[0].x,b[0].y]]});if(a.opts.dragRotate){i=Math.max(Math.sqrt(Math.pow(b[1].x-b[0].x,2)+Math.pow(b[1].y-b[0].y,2)),Math.sqrt(Math.pow(b[2].x-b[1].x,2)+Math.pow(b[2].y-b[1].y,2)))/2;a.circle.attr({cx:a.attrs.center.x+a.attrs.translate.x,cy:a.attrs.center.y+a.attrs.translate.y,r:i*a.opts.distance})}};a.showHandles=function(){a.hideHandles();(a.opts.rotate||a.opts.scale)&&a.axes.map(function(c){a.handles[c]={};a.handles[c].line=
d.path(["M",a.attrs.center.x,a.attrs.center.y]).attr({stroke:a.opts.attrs.stroke,"stroke-dasharray":"- ",opacity:0.5});a.handles[c].disc=d.circle(a.attrs.center.x,a.attrs.center.y,a.opts.size).attr(a.opts.attrs)});if(a.opts.drag){a.handles.center={};a.handles.center.disc=d.circle(a.attrs.center.x,a.attrs.center.y,a.opts.size).attr(a.opts.attrs)}if(a.opts.showBBox)a.bbox=d.path("").attr({stroke:a.opts.attrs.stroke,"stroke-dasharray":"- ",opacity:0.5});if(a.opts.dragRotate||a.opts.dragScale)a.circle=
d.circle(0,0,0).attr({stroke:a.opts.attrs.stroke,"stroke-dasharray":"- ",opacity:0.3});a.axes.map(function(c){a.handles[c]&&a.handles[c].disc.drag(function(b,g){if(a.o.viewBoxRatio){b=b*a.o.viewBoxRatio.x;g=g*a.o.viewBoxRatio.y}var d=b+a.handles[c].disc.ox,e=g+a.handles[c].disc.oy,f={x:a.o.scale.x<0,y:a.o.scale.y<0};if(a.opts.rotate){var j=Math.atan2(e-a.o.center.y-a.o.translate.y,d-a.o.center.x-a.o.translate.x);a.attrs.rotate=j*180/Math.PI-(c=="y"?90:0);if(f[c])a.attrs.rotate=a.attrs.rotate-180}if(a.opts.boundary){d=
Math.max(Math.min(d,a.opts.boundary.x+a.opts.boundary.width),a.opts.boundary.x);e=Math.max(Math.min(e,a.opts.boundary.y+a.opts.boundary.height),a.opts.boundary.y)}d=Math.sqrt(Math.pow(d-a.o.center.x-a.o.translate.x,2)+Math.pow(e-a.o.center.y-a.o.translate.y,2));if(a.opts.scale){a.attrs.scale={x:c=="x"?d/(a.o.size.x/2*a.opts.distance):a.o.scale.x,y:c=="y"?d/(a.o.size.y/2*a.opts.distance):a.o.scale.y};f[c]&&(a.attrs.scale[c]=a.attrs.scale[c]*-1)}l();a.attrs.scale.x&&a.attrs.scale.y&&a.apply();i([a.opts.rotate?
"rotate":null,a.opts.scale?"scale":null])},function(){a.o=k(a.attrs);if(d._viewBox)a.o.viewBoxRatio={x:d._viewBox[2]/d.width,y:d._viewBox[3]/d.height};a.handles[c].disc.ox=this.attrs.cx;a.handles[c].disc.oy=this.attrs.cy;i([a.opts.rotate?"rotate start":null,a.opts.scale?"scale start":null])},function(){i([a.opts.rotate?"rotate end":null,a.opts.scale?"scale end":null])})});if(a.opts.drag){var b=[];!a.opts.dragRotate&&!a.opts.dragScale&&b.push(e);a.handles.center&&b.push(a.handles.center.disc);b.map(function(c){c.drag(function(c,
b){if(a.o.viewBoxRatio){c=c*a.o.viewBoxRatio.x;b=b*a.o.viewBoxRatio.y}a.attrs.translate.x=a.o.translate.x+c;a.attrs.translate.y=a.o.translate.y+b;var d=k(a.o.bbox);d.x=d.x+c;d.y=d.y+b;l(d);a.apply();i(["drag"])},function(){a.o=k(a.attrs);if(a.opts.dragSnap)a.o.bbox=e.getBBox();if(d._viewBox)a.o.viewBoxRatio={x:d._viewBox[2]/d.width,y:d._viewBox[3]/d.height};a.axes.map(function(c){if(a.handles[c]){a.handles[c].disc.ox=a.handles[c].disc.attrs.cx;a.handles[c].disc.oy=a.handles[c].disc.attrs.cy}});i(["drag start"])},
function(){i(["drag end"])})})}(a.opts.dragRotate||a.opts.dragScale)&&e.drag(function(c,b,d,e){if(a.opts.dragRotate){c=Math.atan2(e-a.o.center.y-a.o.translate.y,d-a.o.center.x-a.o.translate.x);a.attrs.rotate=a.o.rotate+c*180/Math.PI-a.o.deg}c=a.o.scale.x<0;b=a.o.scale.y<0;if(a.opts.dragScale){d=Math.sqrt(Math.pow(d-a.o.center.x-a.o.translate.x,2)+Math.pow(e-a.o.center.y-a.o.translate.y,2));a.attrs.scale.x=a.attrs.scale.y=(c?-1:1)*a.o.scale.x+(d-a.o.radius)/(a.o.size.x/2);if(c)a.attrs.scale.x=a.attrs.scale.x*
-1;if(b)a.attrs.scale.y=a.attrs.scale.y*-1}l();a.apply();i([a.opts.dragRotate?"rotate":null,a.opts.dragScale?"scale":null])},function(c,b){a.o=k(a.attrs);a.o.deg=Math.atan2(b-a.o.center.y-a.o.translate.y,c-a.o.center.x-a.o.translate.x)*180/Math.PI;a.o.radius=Math.sqrt(Math.pow(c-a.o.center.x-a.o.translate.x,2)+Math.pow(b-a.o.center.y-a.o.translate.y,2));if(d._viewBox)a.o.viewBoxRatio={x:d._viewBox[2]/d.width,y:d._viewBox[3]/d.height};i([a.opts.dragRotate?"rotate start":null,a.opts.dragScale?"scale start":
null])},function(){i([a.opts.dragRotate?"rotate end":null,a.opts.dragScale?"scale end":null])});a.updateHandles()};a.hideHandles=function(){a.items.map(function(a){a.el.undrag()});if(a.handles.center){a.handles.center.disc.remove();a.handles.center=null}["x","y"].map(function(b){if(a.handles[b]){a.handles[b].disc.remove();a.handles[b].line.remove();a.handles[b]=null}});if(a.bbox){a.bbox.remove();a.bbox=null}if(a.circle){a.circle.remove();a.circle=null}};a.setOpts=function(b,c){a.callback=typeof c==
"function"?c:false;for(var d in b)a.opts[d]=b[d];if(!a.opts.scale)a.opts.keepRatio=true;a.axes=a.opts.keepRatio?["y"]:["x","y"];if(!a.opts.dragSnapDist)a.opts.dragSnapDist=a.opts.dragSnap;if(!a.opts.rotateSnapDist)a.opts.rotateSnapDist=a.opts.rotateSnap;a.opts.rotateRange=[parseInt(a.opts.rotateRange[0]),parseInt(a.opts.rotateRange[1])];a.showHandles();i(["init"])};a.setOpts(m,n);a.apply=function(){a.items.map(function(b,c){var d=a.attrs.center.x+a.offset.translate.x,e=a.attrs.center.y+a.offset.translate.y,
i=a.attrs.rotate-a.offset.rotate;scale={x:a.attrs.scale.x/a.offset.scale.x,y:a.attrs.scale.y/a.offset.scale.y};translate={x:a.attrs.translate.x-a.offset.translate.x,y:a.attrs.translate.y-a.offset.translate.y};b.el.transform(["R",i,d,e,"S",scale.x,scale.y,d,e,"T",translate.x,translate.y]+a.items[c].transformString)});a.updateHandles()};a.unplug=function(){var b=a.attrs;a.hideHandles();delete e.freeTransform;return b};("set"==e.type?e.items:[e]).map(function(b){a.items.push({el:b,attrs:{rotate:0,scale:{x:1,
y:1},translate:{x:0,y:0}},transformString:b.matrix.toTransformString()})});a.items.map(function(b,c){b.el._&&b.el._.transform&&b.el._.transform.map(function(b){if(b[0])switch(b[0].toUpperCase()){case "T":a.items[c].attrs.translate.x=a.items[c].attrs.translate.x+b[1];a.items[c].attrs.translate.y=a.items[c].attrs.translate.y+b[2];break;case "S":a.items[c].attrs.scale.x=a.items[c].attrs.scale.x*b[1];a.items[c].attrs.scale.y=a.items[c].attrs.scale.y*b[2];break;case "R":a.items[c].attrs.rotate=a.items[c].attrs.rotate+
b[1]}})});"set"!=e.type&&(a.attrs.rotate=a.items[0].attrs.rotate,a.attrs.scale=a.items[0].attrs.scale,a.attrs.translate=a.items[0].attrs.translate,a.items[0].attrs={rotate:0,scale:{x:1,y:1},translate:{x:0,y:0}},a.items[0].transformString="");var o=!1;a.updateHandles();return a};
/*
 Copyright (c) 2012 Humu humu2009@gmail.com
 jsc3d is freely distributable under the terms of the MIT license.

 Permission is hereby granted, free of charge, to any person obtaining a copy
 of this software and associated documentation files (the "Software"), to deal
 in the Software without restriction, including without limitation the rights
 to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 copies of the Software, and to permit persons to whom the Software is
 furnished to do so, subject to the following conditions:

 The above copyright notice and this permission notice shall be included in
 all copies or substantial portions of the Software.

 THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 THE SOFTWARE.
*/
var JSC3D=JSC3D||{};
JSC3D.Viewer=function(a,b){this.params=b?{SceneUrl:b.SceneUrl||"",MtlLibUrl:b.MtlLibUrl||"",InitRotationX:b.InitRotationX||0,InitRotationY:b.InitRotationY||0,InitRotationZ:b.InitRotationZ||0,ModelColor:b.ModelColor||"#caa618",BackgroundColor1:b.BackgroundColor1||"#ffffff",BackgroundColor2:b.BackgroundColor2||"#383840",BackgroundImageUrl:b.BackgroundImageUrl||"",RenderMode:b.RenderMode||"flat",Definition:b.Definition||"standard",MipMapping:b.MipMapping||"off",SphereMapUrl:b.SphereMapUrl||""}:{SceneUrl:"",
MtlLibUrl:"",InitRotationX:0,InitRotationY:0,InitRotationZ:0,ModelColor:"#caa618",BackgroundColor1:"#ffffff",BackgroundColor2:"#383840",BackgroundImageUrl:"",RenderMode:"flat",Definition:"standard",MipMapping:"off",SphereMapUrl:""};this.canvas=a;this.selectionBuffer=this.zBuffer=this.colorBuffer=this.bkgColorBuffer=this.canvasData=this.ctx=null;this.frameWidth=a.width;this.frameHeight=a.height;this.sphereMap=this.defaultMaterial=this.scene=null;this.isFailed=this.isLoaded=!1;this.errorMsg="";this.needRepaint=
this.needUpdate=!1;this.initRotZ=this.initRotY=this.initRotX=0;this.zoomFactor=1;this.rotMatrix=new JSC3D.Matrix3x4;this.transformMatrix=new JSC3D.Matrix3x4;this.mtlLibUrl=this.sceneUrl="";this.modelColor=13280792;this.bkgColor1=16777215;this.bkgColor2=3684416;this.bkgImageUrl="";this.bkgImage=null;this.renderMode="flat";this.definition="standard";this.isMipMappingOn=!1;this.sphereMapUrl="";this.buttonStates={};this.keyStates={};this.mouseY=this.mouseX=0;this.afterupdate=this.beforeupdate=this.onmousemove=
this.onmouseup=this.onmousedown=null;this.mouseUsage="default";this.isDefaultInputHandlerEnabled=!0;var c=this;void 0==document.createTouch?(this.canvas.addEventListener("mousedown",function(a){c.mouseDownHandler(a)},!1),this.canvas.addEventListener("mouseup",function(a){c.mouseUpHandler(a)},!1),this.canvas.addEventListener("mousemove",function(a){c.mouseMoveHandler(a)},!1),document.addEventListener("keydown",function(a){c.keyDownHandler(a)},!1),document.addEventListener("keyup",function(a){c.keyUpHandler(a)},
!1)):(this.canvas.addEventListener("touchstart",function(a){c.touchStartHandler(a)},!1),this.canvas.addEventListener("touchend",function(a){c.touchEndHandler(a)},!1),this.canvas.addEventListener("touchmove",function(a){c.touchMoveHandler(a)},!1))};JSC3D.Viewer.prototype.setParameter=function(a,b){this.params[a]=b};
JSC3D.Viewer.prototype.init=function(){this.sceneUrl=this.params.SceneUrl;this.mtlLibUrl=this.params.MtlLibUrl;this.initRotX=parseFloat(this.params.InitRotationX);this.initRotY=parseFloat(this.params.InitRotationY);this.initRotZ=parseFloat(this.params.InitRotationZ);this.modelColor=parseInt("0x"+this.params.ModelColor.substring(1));this.bkgColor1=parseInt("0x"+this.params.BackgroundColor1.substring(1));this.bkgColor2=parseInt("0x"+this.params.BackgroundColor2.substring(1));this.bkgImageUrl=this.params.BackgroundImageUrl;
this.renderMode=this.params.RenderMode.toLowerCase();this.definition=this.params.Definition.toLowerCase();this.isMipMappingOn="on"==this.params.MipMapping.toLowerCase();this.sphereMapUrl=this.params.SphereMapUrl;try{this.ctx=this.canvas.getContext("2d"),this.canvasData=this.ctx.getImageData(0,0,this.canvas.width,this.canvas.height)}catch(a){this.canvasData=this.ctx=null}if(2>=this.canvas.width||2>=this.canvas.height)this.definition="standard";switch(this.definition){case "low":this.frameWidth=~~((this.canvas.width+
1)/2);this.frameHeight=~~((this.canvas.height+1)/2);break;case "high":this.frameWidth=2*this.canvas.width;this.frameHeight=2*this.canvas.height;break;default:this.frameWidth=this.canvas.width,this.frameHeight=this.canvas.height}this.zoomFactor=1;this.rotMatrix.identity();this.transformMatrix.identity();this.isFailed=this.isLoaded=!1;this.errorMsg="";this.needRepaint=this.needUpdate=!1;this.scene=null;this.colorBuffer=Array(this.frameWidth*this.frameHeight);this.zBuffer=Array(this.frameWidth*this.frameHeight);
this.selectionBuffer=Array(this.frameWidth*this.frameHeight);this.bkgColorBuffer=Array(this.frameWidth*this.frameHeight);this.generateBackground();this.defaultMaterial=new JSC3D.Material;this.defaultMaterial.ambientColor=0;this.defaultMaterial.diffuseColor=this.modelColor;this.defaultMaterial.transparency=0;this.defaultMaterial.simulateSpecular=!0;this.drawBackground();var b=this;setInterval(function(){b.doUpdate()},30);this.setBackgroudImageFromUrl(this.bkgImageUrl);this.loadScene();this.setSphereMapFromUrl(this.sphereMapUrl)};
JSC3D.Viewer.prototype.update=function(a){this.isFailed?this.reportError(this.errorMsg):a?this.needRepaint=!0:this.needUpdate=!0};JSC3D.Viewer.prototype.rotate=function(a,b,c){this.rotMatrix.rotateAboutXAxis(a);this.rotMatrix.rotateAboutYAxis(b);this.rotMatrix.rotateAboutZAxis(c)};JSC3D.Viewer.prototype.setRenderMode=function(a){this.renderMode=this.params.RenderMode=a};
JSC3D.Viewer.prototype.setDefinition=function(a){if(2>=this.canvas.width||2>=this.canvas.height)a="standard";if(a!=this.definition){this.definition=this.params.Definition=a;a=this.frameWidth;switch(this.definition){case "low":this.frameWidth=~~((this.canvas.width+1)/2);this.frameHeight=~~((this.canvas.height+1)/2);break;case "high":this.frameWidth=2*this.canvas.width;this.frameHeight=2*this.canvas.height;break;default:this.frameWidth=this.canvas.width,this.frameHeight=this.canvas.height}var b=this.frameWidth*
this.frameHeight;this.colorBuffer.length<b&&(this.colorBuffer=Array(b));this.zBuffer.length<b&&(this.zBuffer=Array(b));this.selectionBuffer.length<b&&(this.selectionBuffer=Array(b));this.bkgColorBuffer.length<b&&(this.bkgColorBuffer=Array(b));this.generateBackground();this.zoomFactor*=this.frameWidth/a}};
JSC3D.Viewer.prototype.setBackgroudImageFromUrl=function(a){this.bkgImageUrl=this.params.BackgroundImageUrl=a;if(""==a)this.bkgImage=null;else{var b=this,c=new Image;c.onload=function(){b.bkgImage=this;b.generateBackground()};c.src=a}};JSC3D.Viewer.prototype.setSphereMapFromUrl=function(a){this.sphereMapUrl=this.params.SphereMapUrl=a;if(""==a)this.sphereMap=null;else{var b=this,c=new JSC3D.Texture;c.onready=function(){b.sphereMap=c;b.update()};c.createFromUrl(this.sphereMapUrl)}};
JSC3D.Viewer.prototype.enableDefaultInputHandler=function(a){this.isDefaultInputHandlerEnabled=a};JSC3D.Viewer.prototype.setMouseUsage=function(a){this.mouseUsage=a};JSC3D.Viewer.prototype.replaceSceneFromUrl=function(a){this.sceneUrl=this.params.SceneUrl=a;this.isFailed=this.isLoaded=!1;this.loadScene()};JSC3D.Viewer.prototype.replaceScene=function(a){this.sceneUrl=this.params.SceneUrl="";this.isFailed=!1;this.isLoaded=!0;this.errorMsg="";this.setupScene(a)};JSC3D.Viewer.prototype.getScene=function(){return this.scene};
JSC3D.Viewer.prototype.pick=function(a,b){var c=new JSC3D.PickInfo,e=this.canvas.getBoundingClientRect(),d=a-e.left,e=b-e.top,f=d,g=e;if(null!=this.selectionBuffer&&0<=d&&d<this.canvas.width&&0<=e&&e<this.canvas.height){switch(this.definition){case "low":f=~~(f/2);g=~~(g/2);break;case "high":f*=2,g*=2}var h=this.selectionBuffer[g*this.frameWidth+f];if(0<h)for(var k=this.scene.getChildren(),l=0;l<k.length;l++)if(k[l].internalId==h){c.mesh=k[l];break}}c.canvasX=d;c.canvasY=e;c.mesh&&(c.depth=this.zBuffer[g*
this.frameWidth+f]);return c};JSC3D.Viewer.prototype.doUpdate=function(){if(this.needUpdate||this.needRepaint)null!=this.beforeupdate&&"function"==typeof this.beforeupdate&&this.beforeupdate(),this.scene?(this.needUpdate&&null!=this.colorBuffer&&(this.beginScene(),this.render(),this.endScene()),this.paint()):this.drawBackground(),this.needUpdate=this.needRepaint=!1,null!=this.afterupdate&&"function"==typeof this.afterupdate&&this.afterupdate()};
JSC3D.Viewer.prototype.paint=function(){this.canvasData&&this.ctx.putImageData(this.canvasData,0,0)};JSC3D.Viewer.prototype.mouseDownHandler=function(a){if(this.onmousedown){var b=this.pick(a.clientX,a.clientY);this.onmousedown(b.canvasX,b.canvasY,a.button,b.depth,b.mesh)}a.preventDefault();this.isDefaultInputHandlerEnabled&&(this.buttonStates[a.button]=!0,this.mouseX=a.clientX,this.mouseY=a.clientY)};
JSC3D.Viewer.prototype.mouseUpHandler=function(a){if(this.onmouseup){var b=this.pick(a.clientX,a.clientY);this.onmouseup(b.canvasX,b.canvasY,a.button,b.depth,b.mesh)}a.preventDefault();this.isDefaultInputHandlerEnabled&&(this.buttonStates[a.button]=!1)};
JSC3D.Viewer.prototype.mouseMoveHandler=function(a){if(this.onmousemove){var b=this.pick(a.clientX,a.clientY);this.onmousemove(b.canvasX,b.canvasY,a.button,b.depth,b.mesh)}a.preventDefault();if(this.isDefaultInputHandlerEnabled&&(b=!0==this.keyStates[16],!0==this.buttonStates[0])){if(b&&"default"==this.mouseUsage||"zoom"==this.mouseUsage)this.zoomFactor*=this.mouseY<=a.clientY?1.11:0.9;else if("default"==this.mouseUsage||"rotate"==this.mouseUsage)b=360*(a.clientX-this.mouseX)/this.canvas.height,this.rotMatrix.rotateAboutXAxis(360*
(a.clientY-this.mouseY)/this.canvas.width),this.rotMatrix.rotateAboutYAxis(b);this.mouseX=a.clientX;this.mouseY=a.clientY;this.update()}};JSC3D.Viewer.prototype.touchStartHandler=function(a){if(0<a.touches.length){var b=a.touches[0].clientX,c=a.touches[0].clientY;if(this.onmousedown){var e=this.pick(b,c);this.onmousedown(e.canvasX,e.canvasY,0,e.depth,e.mesh)}a.preventDefault();this.isDefaultInputHandlerEnabled&&(this.buttonStates[0]=!0,this.mouseX=b,this.mouseY=c)}};
JSC3D.Viewer.prototype.touchEndHandler=function(a){if(this.onmouseup){var b=this.pick(this.mouseX,this.mouseY);this.onmouseup(b.canvasX,b.canvasY,0,b.depth,b.mesh)}a.preventDefault();this.isDefaultInputHandlerEnabled&&(this.buttonStates[0]=!1)};
JSC3D.Viewer.prototype.touchMoveHandler=function(a){if(0<a.touches.length){var b=a.touches[0].clientX,c=a.touches[0].clientY;if(this.onmousemove){var e=this.pick(b,c);this.onmousemove(e.canvasX,e.canvasY,0,e.depth,e.mesh)}a.preventDefault();if(this.isDefaultInputHandlerEnabled){if("zoom"==this.mouseUsage)this.zoomFactor*=this.mouseY<=c?1.11:0.9;else if("default"==this.mouseUsage||"rotate"==this.mouseUsage)a=360*(b-this.mouseX)/this.canvas.height,this.rotMatrix.rotateAboutXAxis(360*(c-this.mouseY)/
this.canvas.width),this.rotMatrix.rotateAboutYAxis(a);this.mouseX=b;this.mouseY=c;this.update()}}};JSC3D.Viewer.prototype.keyDownHandler=function(a){this.isDefaultInputHandlerEnabled&&(this.keyStates[a.keyCode]=!0)};JSC3D.Viewer.prototype.keyUpHandler=function(a){this.isDefaultInputHandlerEnabled&&(this.keyStates[a.keyCode]=!1)};
JSC3D.Viewer.prototype.loadScene=function(){this.scene=null;this.isLoaded=!1;if(""==this.sceneUrl)return!1;var a=this.sceneUrl.lastIndexOf("/");-1==a&&(a=this.sceneUrl.lastIndexOf("\\"));var a=this.sceneUrl.substring(a+1),b=a.lastIndexOf(".");if(-1==b)return!1;a=a.substring(b+1);a=JSC3D.LoaderSelector.getLoader(a);if(!a)return!1;a.setMtlLibUrl(this.mtlLibUrl);var c=this;c.dfd=new $.Deferred;c.loadPromise=c.dfd.promise();a.onload=function(a){c.setupScene(a);c.dfd.resolve()};a.onerror=function(a){c.scene=
null;c.isLoaded=!1;c.isFailed=!0;c.errorMsg=a;c.update();c.dfd.fail()};a.onprogress=function(a,b){c.reportProgress(a,b);c.dfd.progress()};a.onresource=function(a){a instanceof JSC3D.Texture&&(c.isMipMappingOn&&!a.hasMipmap())&&a.generateMipmaps();c.update();c.dfd.resolve()};a.loadFromUrl(this.sceneUrl);return!0};
JSC3D.Viewer.prototype.setupScene=function(a){a.init();if(!a.isEmpty()){var b=a.aabb.lengthOfDiagonal(),c=this.frameWidth,e=this.frameHeight;this.zoomFactor=0==b?1:(c<e?c:e)/b}this.rotMatrix.identity();this.rotMatrix.rotateAboutXAxis(this.initRotX);this.rotMatrix.rotateAboutYAxis(this.initRotY);this.rotMatrix.rotateAboutZAxis(this.initRotZ);this.scene=a;this.isLoaded=!0;this.isFailed=!1;this.errorMsg="";this.needRepaint=this.needUpdate=!1;this.update()};
JSC3D.Viewer.prototype.reportProgress=function(a,b){if(this.ctx){this.drawBackground();this.ctx.save();var c=255-((this.bkgColor1&65280)>>8),e=255-(this.bkgColor1&255),c="#"+(255-((this.bkgColor1&16711680)>>16)).toString(16)+c.toString(16)+e.toString(16);this.ctx.strokeStyle=c;this.ctx.fillStyle=c;c=0.38*this.canvas.height;e=this.canvas.width-80;this.ctx.strokeRect(40,c,e,20);this.ctx.fillRect(42,c+2,(e-4)*b,16);this.ctx.font="12px Courier New";this.ctx.textAlign="left";this.ctx.fillText(a,40,c-4,
e);this.ctx.restore()}};JSC3D.Viewer.prototype.reportError=function(a){if(this.ctx){this.drawBackground();this.ctx.save();var b=0.38*this.canvas.height-4,c=255-((this.bkgColor1&65280)>>8),e=255-(this.bkgColor1&255),c="#"+(255-((this.bkgColor1&16711680)>>16)).toString(16)+c.toString(16)+e.toString(16);this.ctx.fillStyle=c;this.ctx.font="16px Courier New";this.ctx.textAlign="left";this.ctx.fillText(a,40,b);this.ctx.restore()}};
JSC3D.Viewer.prototype.generateBackground=function(){this.bkgImage?this.fillBackgroundWithImage():this.fillGradientBackground()};
JSC3D.Viewer.prototype.fillGradientBackground=function(){for(var a=this.frameWidth,b=this.frameHeight,c=this.bkgColorBuffer,e=(this.bkgColor1&16711680)>>16,d=(this.bkgColor1&65280)>>8,f=this.bkgColor1&255,g=(this.bkgColor2&16711680)>>16,h=(this.bkgColor2&65280)>>8,k=this.bkgColor2&255,l=0,o=0;o<b;o++)for(var i=e+o*(g-e)/b&255,H=d+o*(h-d)/b&255,q=f+o*(k-f)/b&255,I=0;I<a;I++)c[l++]=i<<16|H<<8|q};
JSC3D.Viewer.prototype.fillBackgroundWithImage=function(){var a=this.frameWidth,b=this.frameHeight;if(!(0>=this.bkgImage.width||0>=this.bkgImage.height)){var c=!1,e=JSC3D.Texture.cv;if(!e)try{e=document.createElement("canvas"),JSC3D.Texture.cv=e,c=!0}catch(d){return}if(e.width!=a||e.height!=b)e.width=a,e.height=b,c=!0;var f=null;try{var g=e.getContext("2d");c||g.clearRect(0,0,a,b);g.drawImage(this.bkgImage,0,0,a,b);f=g.getImageData(0,0,a,b).data}catch(h){return}c=this.bkgColorBuffer;a*=b;for(e=b=
0;b<a;b++,e+=4)c[b]=f[e]<<16|f[e+1]<<8|f[e+2]}};JSC3D.Viewer.prototype.drawBackground=function(){this.canvasData&&(this.beginScene(),this.endScene(),this.paint())};JSC3D.Viewer.prototype.beginScene=function(){for(var a=this.colorBuffer,b=this.zBuffer,c=this.selectionBuffer,e=this.bkgColorBuffer,d=this.frameWidth*this.frameHeight,f=-Number.MAX_VALUE,g=0;g<d;g++)a[g]=e[g],b[g]=f,c[g]=0};
JSC3D.Viewer.prototype.endScene=function(){var a=this.canvasData.data,b=this.canvas.width,c=this.canvas.height,e=this.colorBuffer,d=this.frameWidth,f=d*this.frameHeight;switch(this.definition){case "low":for(var g=b>>1,h=d-g,k=0,l=0,f=0;f<c;f++){for(var o=0;o<b;o++)d=e[k],a[l]=(d&16711680)>>16,a[l+1]=(d&65280)>>8,a[l+2]=d&255,a[l+3]=255,k+=o&1,l+=4;k+=f&1?h:-g}break;case "high":for(f=l=k=0;f<c;f++){for(o=0;o<b;o++){var g=e[k],h=e[k+1],i=e[k+d],H=e[k+d+1];a[l]=(g&16711680)+(h&16711680)+(i&16711680)+
(H&16711680)>>18;a[l+1]=(g&65280)+(h&65280)+(i&65280)+(H&65280)>>10;a[l+2]=(g&255)+(h&255)+(i&255)+(H&255)>>2;a[l+3]=255;k+=2;l+=4}k+=d}break;default:for(l=k=0;k<f;k++,l+=4)d=e[k],a[l]=(d&16711680)>>16,a[l+1]=(d&65280)>>8,a[l+2]=d&255,a[l+3]=255}};
JSC3D.Viewer.prototype.render=function(){if(!this.scene.isEmpty()){var a=this.scene.aabb;this.transformMatrix.identity();this.transformMatrix.translate(-(a.minX+a.maxX)/2,-(a.minY+a.maxY)/2,-(a.minZ+a.maxZ)/2);this.transformMatrix.multiply(this.rotMatrix);this.transformMatrix.scale(this.zoomFactor,-this.zoomFactor,this.zoomFactor);this.transformMatrix.translate(this.frameWidth/2,this.frameHeight/2,0);for(var a=this.sortScene(this.transformMatrix),b=0;b<a.length;b++){var c=a[b];if(!c.isTrivial()&&
(JSC3D.Math3D.transformVectors(this.transformMatrix,c.vertexBuffer,c.transformedVertexBuffer),c.visible))switch(this.renderMode){case "point":this.renderPoint(c);break;case "wireframe":this.renderWireframe(c);break;case "flat":this.renderSolidFlat(c);break;case "smooth":this.renderSolidSmooth(c);break;case "texture":c.hasTexture()?this.renderSolidTexture(c):this.renderSolidFlat(c);break;case "textureflat":c.hasTexture()?this.renderTextureFlat(c):this.renderSolidFlat(c);break;case "texturesmooth":c.isEnvironmentCast&&
null!=this.sphereMap&&this.sphereMap.hasData()?this.renderSolidSphereMapped(c):c.hasTexture()?this.renderTextureSmooth(c):this.renderSolidSmooth(c);break;default:this.renderSolidFlat(c)}}}};
JSC3D.Viewer.prototype.sortScene=function(a){for(var b=[],c=this.scene.getChildren(),e=0;e<c.length;e++){var d=c[e];if(!d.isTrivial()){b.push(d);var f=d.aabb.center();JSC3D.Math3D.transformVectors(a,f,f);d.sortKey={depth:f[2],isTransparnt:0<(d.material?d.material:this.defaultMaterial).transparency||(d.hasTexture()?d.texture.hasTransparency:!1)}}}b.sort(function(a,b){return!a.sortKey.isTransparnt&&b.sortKey.isTransparnt?-1:a.sortKey.isTransparnt&&!b.sortKey.isTransparnt?1:a.sortKey.isTransparnt?a.sortKey.depth-
b.sortKey.depth:b.sortKey.depth-a.sortKey.depth});return b};
JSC3D.Viewer.prototype.renderPoint=function(a){var b=this.frameWidth,c=b-1,e=this.frameHeight-1,d=a.transformedVertexBuffer,f=a.transformedVertexNormalZBuffer,g=this.colorBuffer,h=this.zBuffer,k=this.selectionBuffer,l=d.length/3,o=a.internalId,i=a.material?a.material.diffuseColor:this.defaultMaterial.diffuseColor;if(!f||f.length<l)a.transformedVertexNormalZBuffer=Array(l),f=a.transformedVertexNormalZBuffer;JSC3D.Math3D.transformVectorZs(this.rotMatrix,a.vertexNormalBuffer,f);for(var H=0,q=0;H<l;H++,
q+=3){var I=f[H];a.isDoubleSided&&(I=0<I?I:-I);if(0<I){var v=~~(d[q]+0.5),t=~~(d[q+1]+0.5),I=d[q+2];if(0<=v&&(v<c&&0<=t&&t<e)&&(v=t*b+v,I>h[v]&&(h[v]=I,g[v]=i,k[v]=o),v++,I>h[v]&&(h[v]=I,g[v]=i,k[v]=o),v+=c,I>h[v]&&(h[v]=I,g[v]=i,k[v]=o),v++,I>h[v]))h[v]=I,g[v]=i,k[v]=o}}};
JSC3D.Viewer.prototype.renderWireframe=function(a){var b=this.frameWidth,c=b-1,e=this.frameHeight-1,d=a.indexBuffer,f=a.transformedVertexBuffer,g=a.transformedFaceNormalZBuffer,h=this.colorBuffer,k=this.zBuffer,l=this.selectionBuffer,o=a.faceCount,i=a.internalId,H=a.material?a.material.diffuseColor:this.defaultMaterial.diffuseColor;if(!g||g.length<o)a.transformedFaceNormalZBuffer=Array(o),g=a.transformedFaceNormalZBuffer;JSC3D.Math3D.transformVectorZs(this.rotMatrix,a.faceNormalBuffer,g);for(var q=
0,I=0;q<o;){var v=g[q++];a.isDoubleSided&&(v=0<v?v:-v);if(0>v){do;while(-1!=d[I++])}else{var t,B;t=3*d[I++];B=3*d[I++];for(var v=t,C=!1;!C;){var w=~~(f[t]+0.5),z=~~(f[t+1]+0.5),u=f[t+2],D=~~(f[B]+0.5),m=~~(f[B+1]+0.5),p=f[B+2],y=D-w,n=m-z,x=p-u,j,E,G;Math.abs(y)>Math.abs(n)?(j=y,E=0<y?1:-1,G=0!=y?E*n/y:0,y=0!=y?E*x/y:0):(j=n,G=0<n?1:-1,E=0!=n?G*y/n:0,y=0!=n?G*x/n:0);0>j&&(w=D,z=m,u=p,j=-j,E=-E,G=-G,y=-y);for(D=0;D<j;D++)0<=w&&(w<c&&0<=z&&z<e)&&(m=~~z*b+~~w,u>k[m]&&(k[m]=u,h[m]=H,l[m]=i)),w+=E,z+=
G,u+=y;B==v?C=!0:(t=B,B=-1!=d[I]?3*d[I++]:v)}I++}}};
JSC3D.Viewer.prototype.renderSolidFlat=function(a){var b=this.frameWidth,c=this.frameHeight,e=a.indexBuffer,d=a.transformedVertexBuffer,f=a.transformedFaceNormalZBuffer,g=this.colorBuffer,h=this.zBuffer,k=this.selectionBuffer,l=a.faceCount,o=a.internalId,i=a.material?a.material:this.defaultMaterial,H=i.getPalette(),q=0==i.transparency,I=255*i.transparency,v=255-I;if(1!=i.transparency){if(!f||f.length<l)a.transformedFaceNormalZBuffer=Array(l),f=a.transformedFaceNormalZBuffer;JSC3D.Math3D.transformVectorZs(this.rotMatrix,
a.faceNormalBuffer,f);for(var i=Array(3),t=Array(3),B=Array(3),C=0,w=0;C<l;){var z=f[C++];a.isDoubleSided&&(z=0<z?z:-z);if(0>z){do;while(-1!=e[w++])}else{var z=H[~~(255*z)],u,D,m;u=3*e[w++];D=3*e[w++];do{m=3*e[w++];i[0]=~~(d[u]+0.5);t[0]=~~(d[u+1]+0.5);B[0]=d[u+2];i[1]=~~(d[D]+0.5);t[1]=~~(d[D+1]+0.5);B[1]=d[D+2];i[2]=~~(d[m]+0.5);t[2]=~~(d[m+1]+0.5);B[2]=d[m+2];D=t[0]<t[1]?0:1;D=t[D]<t[2]?D:2;var p=t[0]>t[1]?0:1,p=t[p]>t[2]?p:2,y=3-p-D;if(D!=p)for(var n=i[p],x=B[p],j=t[p]-t[D],j=0!=j?j:1,E=(i[p]-
i[D])/j,j=(B[p]-B[D])/j,G=i[p],s=B[p],K=t[p]-t[y],K=0!=K?K:1,A=(i[p]-i[y])/K,K=(B[p]-B[y])/K,J=i[y],O=B[y],r=t[y]-t[D],r=0!=r?r:1,S=(i[y]-i[D])/r,r=(B[y]-B[D])/r,T=t[p]*b,p=t[p];p>t[D];p--){if(0<=p&&p<c){var X=~~n,Y=x,U,aa;p>t[y]?(U=~~G,aa=s):(U=~~J,aa=O);if(X>U){var P;P=X;X=U;U=P;P=Y;Y=aa;aa=P}0>X&&(X=0);U>=b&&(U=b-1);aa=X!=U?(aa-Y)/(U-X):1;P=T+X;if(q)for(;X<=U;X++,Y+=aa)Y>h[P]&&(h[P]=Y,g[P]=z,k[P]=o),P++;else for(;X<U;X++,Y+=aa){if(Y>h[P]){var ea=z,pa=g[P];g[P]=(pa&16711680)*I+(ea&16711680)*v>>
8&16711680|(pa&65280)*I+(ea&65280)*v>>8&65280|(pa&255)*I+(ea&255)*v>>8&255;k[P]=o}P++}}n-=E;x-=j;p>t[y]?(G-=A,s-=K):(J-=S,O-=r);T-=b}D=m}while(-1!=e[w]);w++}}}};
JSC3D.Viewer.prototype.renderSolidSmooth=function(a){var b=this.frameWidth,c=this.frameHeight,e=a.indexBuffer,d=a.transformedVertexBuffer,f=a.transformedVertexNormalZBuffer,g=a.transformedFaceNormalZBuffer,h=this.colorBuffer,k=this.zBuffer,l=this.selectionBuffer,o=a.faceCount,i=d.length/3,H=a.internalId,q=a.material?a.material:this.defaultMaterial,I=q.getPalette(),v=0==q.transparency,t=255*q.transparency,B=255-t;if(1!=q.transparency){if(!f||f.length<i)a.transformedVertexNormalZBuffer=Array(i),f=a.transformedVertexNormalZBuffer;
if(!g||g.length<o)a.transformedFaceNormalZBuffer=Array(o),g=a.transformedFaceNormalZBuffer;JSC3D.Math3D.transformVectorZs(this.rotMatrix,a.vertexNormalBuffer,f);JSC3D.Math3D.transformVectorZs(this.rotMatrix,a.faceNormalBuffer,g);for(var a=a.isDoubleSided,i=Array(3),q=Array(3),C=Array(3),w=Array(3),z=0,u=0;z<o;){var D=g[z++];a&&(D=0<D?D:-D);if(0>D){do;while(-1!=e[u++])}else{var m,p,y,n,x,D=e[u++];y=3*D;m=e[u++];n=3*m;do{p=e[u++];x=3*p;i[0]=~~(d[y]+0.5);q[0]=~~(d[y+1]+0.5);C[0]=d[y+2];i[1]=~~(d[n]+
0.5);q[1]=~~(d[n+1]+0.5);C[1]=d[n+2];i[2]=~~(d[x]+0.5);q[2]=~~(d[x+1]+0.5);C[2]=d[x+2];w[0]=f[D];w[1]=f[m];w[2]=f[p];a&&(0>w[0]&&(w[0]=-w[0]),0>w[1]&&(w[1]=-w[1]),0>w[2]&&(w[2]=-w[2]));m=q[0]<q[1]?0:1;m=q[m]<q[2]?m:2;var j=q[0]>q[1]?0:1,j=q[j]>q[2]?j:2;n=3-j-m;if(m!=j)for(var E=i[j],G=C[j],s=255*w[j],K=q[j]-q[m],K=0!=K?K:1,A=(i[j]-i[m])/K,J=(C[j]-C[m])/K,K=255*(w[j]-w[m])/K,O=i[j],r=C[j],S=255*w[j],T=q[j]-q[n],T=0!=T?T:1,X=(i[j]-i[n])/T,Y=(C[j]-C[n])/T,T=255*(w[j]-w[n])/T,U=i[n],aa=C[n],P=255*w[n],
ea=q[n]-q[m],ea=0!=ea?ea:1,pa=(i[n]-i[m])/ea,na=(C[n]-C[m])/ea,ea=255*(w[n]-w[m])/ea,ua=q[j]*b,j=q[j];j>q[m];j--){if(0<=j&&j<c){var M=~~E,F=G,N=s,fa,la,ia;j>q[n]?(fa=~~O,la=r,ia=S):(fa=~~U,la=aa,ia=P);if(M>fa){var L;L=M;M=fa;fa=L;L=F;F=la;la=L;L=N;N=ia;ia=L}la=M!=fa?(la-F)/(fa-M):1;ia=M!=fa?(ia-N)/(fa-M):1;0>M&&(F-=M*la,N-=M*ia,M=0);fa>=b&&(fa=b-1);L=ua+M;if(v)for(;M<=fa;M++,F+=la,N+=ia)F>k[L]&&(k[L]=F,h[L]=I[0<N?~~N:0],l[L]=H),L++;else for(;M<fa;M++,F+=la,N+=ia){if(F>k[L]){var Ba=I[0<N?~~N:0],qa=
h[L];h[L]=(qa&16711680)*t+(Ba&16711680)*B>>8&16711680|(qa&65280)*t+(Ba&65280)*B>>8&65280|(qa&255)*t+(Ba&255)*B>>8&255;l[L]=H}L++}}E-=A;G-=J;s-=K;j>q[n]?(O-=X,r-=Y,S-=T):(U-=pa,aa-=na,P-=ea);ua-=b}n=x;m=p}while(-1!=e[u]);u++}}}};
JSC3D.Viewer.prototype.renderSolidTexture=function(a){var b=this.frameWidth,c=this.frameHeight,e=a.indexBuffer,d=a.transformedVertexBuffer,f=a.transformedFaceNormalZBuffer,g=this.colorBuffer,h=this.zBuffer,k=this.selectionBuffer,l=a.faceCount,o=a.internalId,i=a.texture,H=!i.hasTransparency,q=a.texCoordBuffer,I=a.texCoordIndexBuffer,v=i.data,t=i.width,B=t-1,C=i.hasMipmap()?i.mipmaps:null,w=C?i.mipentries:null;if(!f||f.length<l)a.transformedFaceNormalZBuffer=Array(l),f=a.transformedFaceNormalZBuffer;
JSC3D.Math3D.transformVectorZs(this.rotMatrix,a.faceNormalBuffer,f);for(var z=Array(3),u=Array(3),D=Array(3),m=Array(3),p=Array(3),y=0,n=0;y<l;){var x=f[y++];a.isDoubleSided&&(x=0<x?x:-x);if(0>x){do;while(-1!=e[n++])}else{var j,E,G,s,K,x=3*e[n];G=2*I[n];n++;j=3*e[n];s=2*I[n];n++;if(C){E=3*e[n];K=2*I[n];t=i.width;z[0]=d[x];u[0]=d[x+1];z[1]=d[j];u[1]=d[j+1];z[2]=d[E];u[2]=d[E+1];m[0]=q[G]*t;p[0]=q[G+1]*t;m[1]=q[s]*t;p[1]=q[s+1]*t;m[2]=q[K]*t;p[2]=q[K+1]*t;v=(z[1]-z[0])*(u[2]-u[0])-(u[1]-u[0])*(z[2]-
z[0]);0>v&&(v=-v);v+=1;B=(m[1]-m[0])*(p[2]-p[0])-(p[1]-p[0])*(m[2]-m[0]);0>B&&(B=-B);v=B/v;B=0;if(v<w[1])B=0;else if(v>=w[w.length-1])B=w.length-1,t=1;else for(;v>=w[B+1];)B++,t/=2;v=C[B];B=t-1}do{E=3*e[n];K=2*I[n];n++;z[0]=~~(d[x]+0.5);u[0]=~~(d[x+1]+0.5);D[0]=d[x+2];z[1]=~~(d[j]+0.5);u[1]=~~(d[j+1]+0.5);D[1]=d[j+2];z[2]=~~(d[E]+0.5);u[2]=~~(d[E+1]+0.5);D[2]=d[E+2];m[0]=q[G]*t;p[0]=q[G+1]*t;m[1]=q[s]*t;p[1]=q[s+1]*t;m[2]=q[K]*t;p[2]=q[K+1]*t;j=u[0]<u[1]?0:1;j=u[j]<u[2]?j:2;var A=u[0]>u[1]?0:1,A=
u[A]>u[2]?A:2;s=3-A-j;if(j!=A)for(var J=z[A],O=D[A],r=m[A],S=p[A],T=u[A]-u[j],T=0!=T?T:1,X=(z[A]-z[j])/T,Y=(D[A]-D[j])/T,U=(m[A]-m[j])/T,T=(p[A]-p[j])/T,aa=z[A],P=D[A],ea=m[A],pa=p[A],na=u[A]-u[s],na=0!=na?na:1,ua=(z[A]-z[s])/na,M=(D[A]-D[s])/na,F=(m[A]-m[s])/na,na=(p[A]-p[s])/na,N=z[s],fa=D[s],la=m[s],ia=p[s],L=u[s]-u[j],L=0!=L?L:1,Ba=(z[s]-z[j])/L,qa=(D[s]-D[j])/L,Ca=(m[s]-m[j])/L,L=(p[s]-p[j])/L,Na=u[A]*b,A=u[A];A>u[j];A--){if(0<=A&&A<c){var ja=~~J,ra=O,oa=r,R=S,V,ba,W,Z;A>u[s]?(V=~~aa,ba=P,W=
ea,Z=pa):(V=~~N,ba=fa,W=la,Z=ia);if(ja>V){var Q;Q=ja;ja=V;V=Q;Q=ra;ra=ba;ba=Q;Q=oa;oa=W;W=Q;Q=R;R=Z;Z=Q}ba=ja!=V?(ba-ra)/(V-ja):1;W=ja!=V?(W-oa)/(V-ja):1;Z=ja!=V?(Z-R)/(V-ja):1;0>ja&&(ra-=ja*ba,oa-=ja*W,R-=ja*Z,ja=0);V>=b&&(V=b-1);Q=Na+ja;if(H)for(;ja<=V;ja++,ra+=ba,oa+=W,R+=Z)ra>h[Q]&&(h[Q]=ra,g[Q]=v[(R&B)*t+(oa&B)],k[Q]=o),Q++;else for(;ja<V;ja++,ra+=ba,oa+=W,R+=Z){if(ra>h[Q]){var sa=v[(R&B)*t+(oa&B)],va=g[Q],ca=sa>>24&255,wa=255-ca;g[Q]=(va&16711680)*wa+(sa&16711680)*ca>>8&16711680|(va&65280)*
wa+(sa&65280)*ca>>8&65280|(va&255)*wa+(sa&255)*ca>>8&255;k[Q]=o}Q++}}J-=X;O-=Y;r-=U;S-=T;A>u[s]?(aa-=ua,P-=M,ea-=F,pa-=na):(N-=Ba,fa-=qa,la-=Ca,ia-=L);Na-=b}j=E;s=K}while(-1!=e[n]);n++}}};
JSC3D.Viewer.prototype.renderTextureFlat=function(a){var b=this.frameWidth,c=this.frameHeight,e=a.indexBuffer,d=a.transformedVertexBuffer,f=a.transformedFaceNormalZBuffer,g=this.colorBuffer,h=this.zBuffer,k=this.selectionBuffer,l=a.faceCount,o=a.internalId,i=a.material?a.material:this.defaultMaterial,H=i.getPalette(),q=a.texture,I=0==i.transparency&&!q.hasTransparency,v=~~(255*(1-i.transparency)),t=a.texCoordBuffer,B=a.texCoordIndexBuffer,C=q.data,w=q.width,z=w-1,u=q.hasMipmap()?q.mipmaps:null,D=
u?q.mipentries:null;if(1!=i.transparency){if(!f||f.length<l)a.transformedFaceNormalZBuffer=Array(l),f=a.transformedFaceNormalZBuffer;JSC3D.Math3D.transformVectorZs(this.rotMatrix,a.faceNormalBuffer,f);for(var i=Array(3),m=Array(3),p=Array(3),y=Array(3),n=Array(3),x=0,j=0;x<l;){var E=f[x++];a.isDoubleSided&&(E=0<E?E:-E);if(0>E){do;while(-1!=e[j++])}else{var E=H[~~(255*E)],G,s,K,A,J,O;G=3*e[j];A=2*B[j];j++;s=3*e[j];J=2*B[j];j++;if(u){K=3*e[j];O=2*B[j];w=q.width;i[0]=d[G];m[0]=d[G+1];i[1]=d[s];m[1]=
d[s+1];i[2]=d[K];m[2]=d[K+1];y[0]=t[A]*w;n[0]=t[A+1]*w;y[1]=t[J]*w;n[1]=t[J+1]*w;y[2]=t[O]*w;n[2]=t[O+1]*w;C=(i[1]-i[0])*(m[2]-m[0])-(m[1]-m[0])*(i[2]-i[0]);0>C&&(C=-C);C+=1;z=(y[1]-y[0])*(n[2]-n[0])-(n[1]-n[0])*(y[2]-y[0]);0>z&&(z=-z);C=z/C;z=0;if(C<D[1])z=0;else if(C>=D[D.length-1])z=D.length-1,w=1;else for(;C>=D[z+1];)z++,w/=2;C=u[z];z=w-1}do{K=3*e[j];O=2*B[j];j++;i[0]=~~(d[G]+0.5);m[0]=~~(d[G+1]+0.5);p[0]=d[G+2];i[1]=~~(d[s]+0.5);m[1]=~~(d[s+1]+0.5);p[1]=d[s+2];i[2]=~~(d[K]+0.5);m[2]=~~(d[K+1]+
0.5);p[2]=d[K+2];y[0]=t[A]*w;n[0]=t[A+1]*w;y[1]=t[J]*w;n[1]=t[J+1]*w;y[2]=t[O]*w;n[2]=t[O+1]*w;s=m[0]<m[1]?0:1;s=m[s]<m[2]?s:2;var r=m[0]>m[1]?0:1,r=m[r]>m[2]?r:2;J=3-r-s;if(s!=r)for(var S=i[r],T=p[r],X=y[r],Y=n[r],U=m[r]-m[s],U=0!=U?U:1,aa=(i[r]-i[s])/U,P=(p[r]-p[s])/U,ea=(y[r]-y[s])/U,U=(n[r]-n[s])/U,pa=i[r],na=p[r],ua=y[r],M=n[r],F=m[r]-m[J],F=0!=F?F:1,N=(i[r]-i[J])/F,fa=(p[r]-p[J])/F,la=(y[r]-y[J])/F,F=(n[r]-n[J])/F,ia=i[J],L=p[J],Ba=y[J],qa=n[J],Ca=m[J]-m[s],Ca=0!=Ca?Ca:1,Na=(i[J]-i[s])/Ca,ja=
(p[J]-p[s])/Ca,ra=(y[J]-y[s])/Ca,Ca=(n[J]-n[s])/Ca,oa=m[r]*b,r=m[r];r>m[s];r--){if(0<=r&&r<c){var R=~~S,V=T,ba=X,W=Y,Z,Q,sa,va;r>m[J]?(Z=~~pa,Q=na,sa=ua,va=M):(Z=~~ia,Q=L,sa=Ba,va=qa);if(R>Z){var ca;ca=R;R=Z;Z=ca;ca=V;V=Q;Q=ca;ca=ba;ba=sa;sa=ca;ca=W;W=va;va=ca}Q=R!=Z?(Q-V)/(Z-R):1;sa=R!=Z?(sa-ba)/(Z-R):1;va=R!=Z?(va-W)/(Z-R):1;0>R&&(V-=R*Q,ba-=R*sa,W-=R*va,R=0);Z>=b&&(Z=b-1);ca=oa+R;if(I)for(;R<=Z;R++,V+=Q,ba+=sa,W+=va){if(V>h[ca]){h[ca]=V;var wa=C[(W&z)*w+(ba&z)],Da=((E&16711680)>>16)*((wa&16711680)>>
8),da=((E&65280)>>8)*((wa&65280)>>8),ma=(E&255)*(wa&255)>>8;g[ca]=Da&16711680|da&65280|ma&255;k[ca]=o}ca++}else for(;R<Z;R++,V+=Q,ba+=sa,W+=va){if(V>h[ca]){var ma=C[(W&z)*w+(ba&z)],wa=g[ca],xa=(ma>>24&255)*(v&255)>>8,Da=((E&16711680)>>16)*((ma&16711680)>>8),da=((E&65280)>>8)*((ma&65280)>>8),ma=(E&255)*(ma&255)>>8;if(250<xa)h[ca]=V;else var ya=255-xa,Da=Da*xa+(wa&16711680)*ya>>8,da=da*xa+(wa&65280)*ya>>8,ma=ma*xa+(wa&255)*ya>>8;g[ca]=Da&16711680|da&65280|ma&255;k[ca]=o}ca++}}S-=aa;T-=P;X-=ea;Y-=U;
r>m[J]?(pa-=N,na-=fa,ua-=la,M-=F):(ia-=Na,L-=ja,Ba-=ra,qa-=Ca);oa-=b}s=K;J=O}while(-1!=e[j]);j++}}}};
JSC3D.Viewer.prototype.renderTextureSmooth=function(a){var b=this.frameWidth,c=this.frameHeight,e=a.indexBuffer,d=a.transformedVertexBuffer,f=a.transformedVertexNormalZBuffer,g=a.transformedFaceNormalZBuffer,h=this.colorBuffer,k=this.zBuffer,l=this.selectionBuffer,o=a.faceCount,i=a.internalId,H=d.length/3,q=a.material?a.material:this.defaultMaterial,I=q.getPalette(),v=a.texture,t=0==q.transparency&&!v.hasTransparency,B=~~(255*(1-q.transparency)),C=a.texCoordBuffer,w=a.texCoordIndexBuffer,z=v.data,
u=v.width,D=u-1,m=v.hasMipmap()?v.mipmaps:null,p=m?v.mipentries:null;if(1!=q.transparency){if(!f||f.length<H)a.transformedVertexNormalZBuffer=Array(H),f=a.transformedVertexNormalZBuffer;if(!g||g.length<o)a.transformedFaceNormalZBuffer=Array(o),g=a.transformedFaceNormalZBuffer;JSC3D.Math3D.transformVectorZs(this.rotMatrix,a.vertexNormalBuffer,f);JSC3D.Math3D.transformVectorZs(this.rotMatrix,a.faceNormalBuffer,g);for(var y=a.isDoubleSided,n=Array(3),x=Array(3),j=Array(3),E=Array(3),G=Array(3),s=Array(3),
K=0,A=0;K<o;){var J=g[K++];y&&(J=0<J?J:-J);if(0>J){do;while(-1!=e[A++])}else{var O,r,S,T,X,Y,U,aa,P;O=e[A];T=3*O;U=2*w[A];A++;r=e[A];X=3*r;aa=2*w[A];A++;if(m){Y=3*e[A];P=2*w[A];u=v.width;n[0]=d[T];x[0]=d[T+1];n[1]=d[X];x[1]=d[X+1];n[2]=d[Y];x[2]=d[Y+1];G[0]=C[U]*u;s[0]=C[U+1]*u;G[1]=C[aa]*u;s[1]=C[aa+1]*u;G[2]=C[P]*u;s[2]=C[P+1]*u;var ea=(n[1]-n[0])*(x[2]-x[0])-(x[1]-x[0])*(n[2]-n[0]);0>ea&&(ea=-ea);var ea=ea+1,pa=(G[1]-G[0])*(s[2]-s[0])-(s[1]-s[0])*(G[2]-G[0]);0>pa&&(pa=-pa);var na=pa/ea,ua=0;if(na<
p[1])ua=0;else if(na>=p[p.length-1])ua=p.length-1,u=1;else for(;na>=p[ua+1];)ua++,u/=2;z=m[ua];D=u-1}do{S=e[A];Y=3*S;P=2*w[A];A++;n[0]=~~(d[T]+0.5);x[0]=~~(d[T+1]+0.5);j[0]=d[T+2];n[1]=~~(d[X]+0.5);x[1]=~~(d[X+1]+0.5);j[1]=d[X+2];n[2]=~~(d[Y]+0.5);x[2]=~~(d[Y+1]+0.5);j[2]=d[Y+2];G[0]=C[U]*u;s[0]=C[U+1]*u;G[1]=C[aa]*u;s[1]=C[aa+1]*u;G[2]=C[P]*u;s[2]=C[P+1]*u;E[0]=f[O];E[1]=f[r];E[2]=f[S];y&&(0>E[0]&&(E[0]=-E[0]),0>E[1]&&(E[1]=-E[1]),0>E[2]&&(E[2]=-E[2]));var M=x[0]<x[1]?0:1,M=x[M]<x[2]?M:2,F=x[0]>
x[1]?0:1,F=x[F]>x[2]?F:2,N=3-F-M;if(M!=F)for(var fa=n[F],la=j[F],ia=G[F],L=s[F],Ba=255*E[F],qa=x[F]-x[M],qa=0!=qa?qa:1,Ca=(n[F]-n[M])/qa,Na=(j[F]-j[M])/qa,ja=(G[F]-G[M])/qa,ra=(s[F]-s[M])/qa,oa=255*(E[F]-E[M])/qa,R=n[F],V=j[F],ba=G[F],W=s[F],Z=255*E[F],Q=x[F]-x[N],Q=0!=Q?Q:1,sa=(n[F]-n[N])/Q,va=(j[F]-j[N])/Q,ca=(G[F]-G[N])/Q,wa=(s[F]-s[N])/Q,Da=255*(E[F]-E[N])/Q,da=n[N],ma=j[N],xa=G[N],ya=s[N],Ia=255*E[N],ha=x[N]-x[M],ha=0!=ha?ha:1,Ta=(n[N]-n[M])/ha,Ua=(j[N]-j[M])/ha,Va=(G[N]-G[M])/ha,Wa=(s[N]-s[M])/
ha,Ja=255*(E[N]-E[M])/ha,Xa=x[F]*b,Ma=x[F];Ma>x[M];Ma--){if(0<=Ma&&Ma<c){var ka=~~fa,Ka=la,ta=ia,Ea=L,za=Ba,ga,Fa,Ga,Ha,Oa;Ma>x[N]?(ga=~~R,Fa=V,Ga=ba,Ha=W,Oa=Z):(ga=~~da,Fa=ma,Ga=xa,Ha=ya,Oa=Ia);if(ka>ga){var Aa;Aa=ka;ka=ga;ga=Aa;Aa=Ka;Ka=Fa;Fa=Aa;Aa=ta;ta=Ga;Ga=Aa;Aa=Ea;Ea=Ha;Ha=Aa;Aa=za;za=Oa;Oa=Aa}var Pa=ka!=ga?(Fa-Ka)/(ga-ka):1,Qa=ka!=ga?(Ga-ta)/(ga-ka):1,Ya=ka!=ga?(Ha-Ea)/(ga-ka):1,Za=ka!=ga?(Oa-za)/(ga-ka):0;0>ka&&(Ka-=ka*Pa,ta-=ka*Qa,Ea-=ka*Ya,za-=ka*Za,ka=0);ga>=b&&(ga=b-1);var La=Xa+ka;if(t)for(var cb=
ka,Ra=Ka,Sa=za,$a=ta,ab=Ea;cb<=ga;cb++,Ra+=Pa,Sa+=Za,$a+=Qa,ab+=Ya){if(Ra>k[La]){k[La]=Ra;var bb=I[0<Sa?~~Sa:0],ib=z[(ab&D)*u+($a&D)],db=((bb&16711680)>>16)*((ib&16711680)>>8),eb=((bb&65280)>>8)*((ib&65280)>>8),fb=(bb&255)*(ib&255)>>8;h[La]=db&16711680|eb&65280|fb&255;l[La]=i}La++}else{cb=ka;Ra=Ka;Sa=za;$a=ta;for(ab=Ea;cb<ga;cb++,Ra+=Pa,Sa+=Za,$a+=Qa,ab+=Ya){if(Ra>k[La]){var bb=I[0<Sa?~~Sa:0],hb=z[(ab&D)*u+($a&D)],jb=h[La],gb=(hb>>24&255)*(B&255)>>8,db=((bb&16711680)>>16)*((hb&16711680)>>8),eb=((bb&
65280)>>8)*((hb&65280)>>8),fb=(bb&255)*(hb&255)>>8;if(250<gb)k[La]=Ra;else var kb=255-gb,db=db*gb+(jb&16711680)*kb>>8,eb=eb*gb+(jb&65280)*kb>>8,fb=fb*gb+(jb&255)*kb>>8;h[La]=db&16711680|eb&65280|fb&255;l[La]=i}La++}}}fa-=Ca;la-=Na;ia-=ja;L-=ra;Ba-=oa;Ma>x[N]?(R-=sa,V-=va,ba-=ca,W-=wa,Z-=Da):(da-=Ta,ma-=Ua,xa-=Va,ya-=Wa,Ia-=Ja);Xa-=b}r=S;X=Y;aa=P}while(-1!=e[A]);A++}}}};
JSC3D.Viewer.prototype.renderSolidSphereMapped=function(a){var b=this.frameWidth,c=this.frameHeight,e=a.indexBuffer,d=a.transformedVertexBuffer,f=a.transformedVertexNormalBuffer,g=a.transformedFaceNormalZBuffer,h=this.colorBuffer,k=this.zBuffer,l=this.selectionBuffer,o=a.faceCount,i=d.length/3,H=a.internalId,q=a.material?a.material:this.defaultMaterial,I=q.getPalette(),v=this.sphereMap,t=v.data,B=v.width,C=B-1,w=0==q.transparency,z=255*q.transparency,u=255-z;if(1!=q.transparency){if(!f||f.length<
3*i)a.transformedVertexNormalBuffer=Array(3*i),f=a.transformedVertexNormalBuffer;if(!g||g.length<o)a.transformedFaceNormalZBuffer=Array(o),g=a.transformedFaceNormalZBuffer;JSC3D.Math3D.transformVectors(this.rotMatrix,a.vertexNormalBuffer,f);JSC3D.Math3D.transformVectorZs(this.rotMatrix,a.faceNormalBuffer,g);for(var D=a.isDoubleSided,m=Array(3),p=Array(3),y=Array(3),n=Array(3),x=Array(3),j=Array(3),E=0,G=0;E<o;){var s=g[E++];D&&(s=0<s?s:-s);if(0>s){do;while(-1!=e[G++])}else{var K,A,J;K=3*e[G++];A=
3*e[G++];do{J=3*e[G++];m[0]=~~(d[K]+0.5);p[0]=~~(d[K+1]+0.5);y[0]=d[K+2];m[1]=~~(d[A]+0.5);p[1]=~~(d[A+1]+0.5);y[1]=d[A+2];m[2]=~~(d[J]+0.5);p[2]=~~(d[J+1]+0.5);y[2]=d[J+2];n[0]=f[K];x[0]=f[K+1];j[0]=f[K+2];n[1]=f[A];x[1]=f[A+1];j[1]=f[A+2];n[2]=f[J];x[2]=f[J+1];j[2]=f[J+2];D&&(0>j[0]&&(j[0]=-j[0]),0>j[1]&&(j[1]=-j[1]),0>j[2]&&(j[2]=-j[2]));var O=p[0]<p[1]?0:1,O=p[O]<p[2]?O:2,r=p[0]>p[1]?0:1,r=p[r]>p[2]?r:2,S=3-r-O;if(O!=r)for(var T=m[r],X=y[r],Y=255*j[r],U=(n[r]/2+0.5)*B&C,aa=(0.5-x[r]/2)*B&C,P=
p[r]-p[O],P=0!=P?P:1,ea=(m[r]-m[O])/P,pa=(y[r]-y[O])/P,na=255*(j[r]-j[O])/P,ua=(n[r]-n[O])/2*B/P,M=(x[O]-x[r])/2*B/P,F=m[r],N=y[r],fa=255*j[r],la=(n[r]/2+0.5)*B&C,ia=(0.5-x[r]/2)*B&C,L=p[r]-p[S],L=0!=L?L:1,Ba=(m[r]-m[S])/L,qa=(y[r]-y[S])/L,Ca=255*(j[r]-j[S])/L,Na=(n[r]-n[S])/2*B/L,ja=(x[S]-x[r])/2*B/L,ra=m[S],oa=y[S],R=255*j[S],V=(n[S]/2+0.5)*B&C,ba=(0.5-x[S]/2)*B&C,W=p[S]-p[O],W=0!=W?W:1,Z=(m[S]-m[O])/W,Q=(y[S]-y[O])/W,sa=255*(j[S]-j[O])/W,va=(n[S]-n[O])/2*B/W,ca=(x[O]-x[S])/2*B/W,wa=p[r]*b,Da=p[r];Da>
p[O];Da--){if(0<=Da&&Da<c){var da=~~T,ma=X,xa=Y,ya=U,Ia=aa,ha,Ta,Ua,Va,Wa;Da>p[S]?(ha=~~F,Ta=N,Ua=fa,Va=la,Wa=ia):(ha=~~ra,Ta=oa,Ua=R,Va=V,Wa=ba);if(da>ha){var Ja;Ja=da;da=ha;ha=Ja;Ja=ma;ma=Ta;Ta=Ja;Ja=xa;xa=Ua;Ua=Ja;Ja=ya;ya=Va;Va=Ja;Ja=Ia;Ia=Wa;Wa=Ja}var Xa=da!=ha?(Ta-ma)/(ha-da):1,Ma=da!=ha?(Ua-xa)/(ha-da):1,ka=da!=ha?(Va-ya)/(ha-da):1,Ka=da!=ha?(Wa-Ia)/(ha-da):1;0>da&&(ma-=da*Xa,xa-=da*Ma,ya-=ya*ka,Ia-=Ia*Ka,da=0);ha>=b&&(ha=b-1);var ta=wa+da;if(w)for(var Ea=da,za=ma,ga=xa,Fa=ya,Ga=Ia;Ea<=ha;Ea++,
za+=Xa,ga+=Ma,Fa+=ka,Ga+=Ka){if(za>k[ta]){k[ta]=za;var Ha=I[0<ga?~~ga:0],Oa=t[(Ga&C)*B+(Fa&C)],Aa=((Ha&16711680)>>16)*((Oa&16711680)>>8),Pa=((Ha&65280)>>8)*((Oa&65280)>>8),Qa=(Ha&255)*(Oa&255)>>8;h[ta]=Aa&16711680|Pa&65280|Qa&255;l[ta]=H}ta++}else{Ea=da;za=ma;ga=xa;Fa=ya;for(Ga=Ia;Ea<ha;Ea++,za+=Xa,ga+=Ma,Fa+=ka,Ga+=Ka){if(za>k[ta]){var Ha=I[0<ga?~~ga:0],Ya=t[(Ga&C)*B+(Fa&C)],Za=h[ta],Aa=((Ha&16711680)>>16)*((Ya&16711680)>>8),Pa=((Ha&65280)>>8)*((Ya&65280)>>8),Qa=(Ha&255)*(Ya&255)>>8,Aa=Aa*u+(Za&
16711680)*z>>8,Pa=Pa*u+(Za&65280)*z>>8,Qa=Qa*u+(Za&255)*z>>8;h[ta]=Aa&16711680|Pa&65280|Qa&255;l[ta]=H}ta++}}}T-=ea;X-=pa;Y-=na;U-=ua;aa-=M;Da>p[S]?(F-=Ba,N-=qa,fa-=Ca,la-=Na,ia-=ja):(ra-=Z,oa-=Q,R-=sa,V-=va,ba-=ca);wa-=b}A=J}while(-1!=e[G]);G++}}}};JSC3D.Viewer.prototype.params=null;JSC3D.Viewer.prototype.canvas=null;JSC3D.Viewer.prototype.ctx=null;JSC3D.Viewer.prototype.canvasData=null;JSC3D.Viewer.prototype.bkgColorBuffer=null;JSC3D.Viewer.prototype.colorBuffer=null;
JSC3D.Viewer.prototype.zBuffer=null;JSC3D.Viewer.prototype.selectionBuffer=null;JSC3D.Viewer.prototype.frameWidth=0;JSC3D.Viewer.prototype.frameHeight=0;JSC3D.Viewer.prototype.scene=null;JSC3D.Viewer.prototype.defaultMaterial=null;JSC3D.Viewer.prototype.sphereMap=null;JSC3D.Viewer.prototype.isLoaded=!1;JSC3D.Viewer.prototype.isFailed=!1;JSC3D.Viewer.prototype.errorMsg="";JSC3D.Viewer.prototype.needUpdate=!1;JSC3D.Viewer.prototype.needRepaint=!1;JSC3D.Viewer.prototype.initRotX=0;
JSC3D.Viewer.prototype.initRotY=0;JSC3D.Viewer.prototype.initRotZ=0;JSC3D.Viewer.prototype.zoomFactor=1;JSC3D.Viewer.prototype.rotMatrix=null;JSC3D.Viewer.prototype.transformMatrix=null;JSC3D.Viewer.prototype.sceneUrl="";JSC3D.Viewer.prototype.mtlLibUrl="";JSC3D.Viewer.prototype.modelColor=13280792;JSC3D.Viewer.prototype.bkgColor1=16777215;JSC3D.Viewer.prototype.bkgColor2=16777088;JSC3D.Viewer.prototype.renderMode="flat";JSC3D.Viewer.prototype.definition="standard";
JSC3D.Viewer.prototype.isMipMappingOn=!1;JSC3D.Viewer.prototype.sphereMapUrl="";JSC3D.Viewer.prototype.buttonStates=null;JSC3D.Viewer.prototype.keyStates=null;JSC3D.Viewer.prototype.mouseX=0;JSC3D.Viewer.prototype.mouseY=0;JSC3D.Viewer.prototype.onmousedown=null;JSC3D.Viewer.prototype.onmouseup=null;JSC3D.Viewer.prototype.onmousemove=null;JSC3D.Viewer.prototype.beforeupdate=null;JSC3D.Viewer.prototype.afterupdate=null;JSC3D.Viewer.prototype.mouseUsage="default";
JSC3D.Viewer.prototype.isDefaultInputHandlerEnabled=!1;JSC3D.PickInfo=function(){this.canvasY=this.canvasX=0;this.depth=-Infinity;this.mesh=null};JSC3D.Scene=function(a){this.name=a||"";this.aabb=null;this.children=[];this.maxChildId=1};JSC3D.Scene.prototype.init=function(){if(!this.isEmpty()){for(var a=0;a<this.children.length;a++)this.children[a].init();this.aabb||(this.aabb=new JSC3D.AABB,this.calcAABB())}};JSC3D.Scene.prototype.isEmpty=function(){return 0==this.children.length};
JSC3D.Scene.prototype.addChild=function(a){a.internalId=this.maxChildId++;this.children.push(a)};JSC3D.Scene.prototype.removeChild=function(a){for(var b=0;b<this.children.length;b++)if(this.children[b]==a){this.children.splice(b,1);break}};JSC3D.Scene.prototype.getChildren=function(){return this.children};
JSC3D.Scene.prototype.calcAABB=function(){this.aabb.minX=this.aabb.minY=this.aabb.minZ=Number.MAX_VALUE;this.aabb.maxX=this.aabb.maxY=this.aabb.maxZ=-Number.MAX_VALUE;for(var a=0;a<this.children.length;a++){var b=this.children[a];if(!b.isTrivial()){var c=b.aabb.minX,e=b.aabb.minY,d=b.aabb.minZ,f=b.aabb.maxX,g=b.aabb.maxY,b=b.aabb.maxZ;this.aabb.minX>c&&(this.aabb.minX=c);this.aabb.minY>e&&(this.aabb.minY=e);this.aabb.minZ>d&&(this.aabb.minZ=d);this.aabb.maxX<f&&(this.aabb.maxX=f);this.aabb.maxY<g&&
(this.aabb.maxY=g);this.aabb.maxZ<b&&(this.aabb.maxZ=b)}}};JSC3D.Scene.prototype.name="";JSC3D.Scene.prototype.aabb=null;JSC3D.Scene.prototype.children=null;JSC3D.Scene.prototype.maxChildId=1;
JSC3D.Mesh=function(a,b,c,e,d,f,g,h,k,l){this.name=a||"";this.metadata="";this.visible=void 0!=b?b:!0;this.aabb=null;this.vertexBuffer=g||null;this.indexBuffer=h||null;this.faceNormalBuffer=this.vertexNormalBuffer=null;this.material=c||null;this.texture=e||null;this.faceCount=0;this.isDoubleSided=d||!1;this.isEnvironmentCast=f||!1;this.internalId=0;this.texCoordBuffer=k||null;this.texCoordIndexBuffer=l||null;this.transformedVertexNormalBuffer=this.transformedFaceNormalZBuffer=this.transformedVertexNormalZBuffer=
this.transformedVertexBuffer=null};JSC3D.Mesh.prototype.init=function(){if(!this.isTrivial()){if(0==this.faceCount&&(this.calcFaceCount(),0==this.faceCount))return;this.aabb||(this.aabb=new JSC3D.AABB,this.calcAABB());this.faceNormalBuffer||(this.faceNormalBuffer=Array(3*this.faceCount),this.calcFaceNormals());this.vertexNormalBuffer||(this.vertexNormalBuffer=Array(this.vertexBuffer.length),this.calcVertexNormals());this.normalizeFaceNormals();this.transformedVertexBuffer=Array(this.vertexBuffer.length)}};
JSC3D.Mesh.prototype.isTrivial=function(){return!this.vertexBuffer||3>this.vertexBuffer.length||!this.indexBuffer||3>this.indexBuffer.length};JSC3D.Mesh.prototype.setMaterial=function(a){this.material=a};JSC3D.Mesh.prototype.setTexture=function(a){this.texture=a};
JSC3D.Mesh.prototype.hasTexture=function(){return null!=this.texCoordBuffer&&2<=this.texCoordBuffer.length&&null!=this.texCoordIndexBuffer&&3<=this.texCoordIndexBuffer.length&&this.texCoordIndexBuffer.length>=this.indexBuffer.length&&null!=this.texture&&this.texture.hasData()};JSC3D.Mesh.prototype.calcFaceCount=function(){this.faceCount=0;var a=this.indexBuffer;-1!=a[a.length-1]&&a.push(-1);for(var b=0;b<a.length;b++)-1==a[b]&&this.faceCount++};
JSC3D.Mesh.prototype.calcAABB=function(){for(var a=minY=minZ=Number.MAX_VALUE,b=maxY=maxZ=-Number.MAX_VALUE,c=this.vertexBuffer,e=0;e<c.length;e+=3){var d=c[e],f=c[e+1],g=c[e+2];d<a&&(a=d);d>b&&(b=d);f<minY&&(minY=f);f>maxY&&(maxY=f);g<minZ&&(minZ=g);g>maxZ&&(maxZ=g)}this.aabb.minX=a;this.aabb.minY=minY;this.aabb.minZ=minZ;this.aabb.maxX=b;this.aabb.maxY=maxY;this.aabb.maxZ=maxZ};
JSC3D.Mesh.prototype.calcFaceNormals=function(){for(var a=this.vertexBuffer,b=this.indexBuffer,c=this.faceNormalBuffer,e=0,d=0;e<b.length;){var f=3*b[e++],g=a[f],h=a[f+1],k=a[f+2],f=3*b[e++],l=a[f],o=a[f+1],i=a[f+2],f=3*b[e++],l=l-g,o=o-h,i=i-k,g=a[f]-g,h=a[f+1]-h,k=a[f+2]-k,f=o*k-i*h,k=i*g-l*k,l=l*h-o*g;c[d++]=f;c[d++]=k;c[d++]=l;do;while(-1!=b[e++])}};
JSC3D.Mesh.prototype.calcVertexNormals=function(){this.faceNormalBuffer||(this.faceNormalBuffer=Array(3*this.faceCount),this.calcFaceNormals());for(var a=this.indexBuffer,b=this.faceNormalBuffer,c=this.vertexNormalBuffer,e=0;e<c.length;e++)c[e]=0;for(var d=e=0,f=0;e<a.length;)f=a[e++],-1==f?d+=3:(f*=3,c[f]+=b[d],c[f+1]+=b[d+1],c[f+2]+=b[d+2]);for(d=e=0;e<c.length;e+=3,d++){var a=c[e],b=c[e+1],f=c[e+2],g=Math.sqrt(a*a+b*b+f*f);0<g&&(a/=g,b/=g,f/=g);c[e]=a;c[e+1]=b;c[e+2]=f}};
JSC3D.Mesh.prototype.normalizeFaceNormals=function(){for(var a=this.faceNormalBuffer,b=0;b<a.length;b+=3){var c=a[b],e=a[b+1],d=a[b+2],f=Math.sqrt(c*c+e*e+d*d);0<f&&(c/=f,e/=f,d/=f);a[b]=c;a[b+1]=e;a[b+2]=d}};JSC3D.Mesh.prototype.checkValid=function(){};JSC3D.Mesh.prototype.name="";JSC3D.Mesh.prototype.metadata="";JSC3D.Mesh.prototype.visible=!1;JSC3D.Mesh.prototype.aabb=null;JSC3D.Mesh.prototype.vertexBuffer=null;JSC3D.Mesh.prototype.indexBuffer=null;JSC3D.Mesh.prototype.vertexNormalBuffer=null;
JSC3D.Mesh.prototype.faceNormalBuffer=null;JSC3D.Mesh.prototype.texCoordBuffer=null;JSC3D.Mesh.prototype.texCoordIndexBuffer=null;JSC3D.Mesh.prototype.material=null;JSC3D.Mesh.prototype.texture=null;JSC3D.Mesh.prototype.faceCount=0;JSC3D.Mesh.prototype.isDoubleSided=!1;JSC3D.Mesh.prototype.isEnvironmentCast=!1;JSC3D.Mesh.prototype.internalId=0;JSC3D.Mesh.prototype.transformedVertexBuffer=null;JSC3D.Mesh.prototype.transformedVertexNormalZBuffer=null;
JSC3D.Mesh.prototype.transformedFaceNormalZBuffer=null;JSC3D.Mesh.prototype.transformedVertexNormalBuffer=null;JSC3D.Material=function(a,b,c,e,d){this.name=a||"";this.ambientColor=b||0;this.diffuseColor=c||8355711;this.transparency=e||0;this.simulateSpecular=d||!1;this.palette=null};JSC3D.Material.prototype.getPalette=function(){this.palette||(this.palette=Array(256),this.generatePalette());return this.palette};
JSC3D.Material.prototype.generatePalette=function(){var a=(this.ambientColor&16711680)>>16,b=(this.ambientColor&65280)>>8,c=this.ambientColor&255,e=(this.diffuseColor&16711680)>>16,d=(this.diffuseColor&65280)>>8,f=this.diffuseColor&255;if(this.simulateSpecular){for(var g=0;204>g;){var h=a+g*e/204,k=b+g*d/204,l=c+g*f/204;255<h&&(h=255);255<k&&(k=255);255<l&&(l=255);this.palette[g++]=h<<16|k<<8|l}for(;256>g;)h=a+e+(g-204)*(255-e)/82,k=b+d+(g-204)*(255-d)/82,l=c+f+(g-204)*(255-f)/82,255<h&&(h=255),255<
k&&(k=255),255<l&&(l=255),this.palette[g++]=h<<16|k<<8|l}else for(g=0;256>g;)h=a+g*e/256,k=b+g*d/256,l=c+g*f/256,255<h&&(h=255),255<k&&(k=255),255<l&&(l=255),this.palette[g++]=h<<16|k<<8|l};JSC3D.Material.prototype.name="";JSC3D.Material.prototype.ambientColor=0;JSC3D.Material.prototype.diffuseColor=8355711;JSC3D.Material.prototype.transparency=0;JSC3D.Material.prototype.simulateSpecular=!1;JSC3D.Material.prototype.palette=null;
JSC3D.Texture=function(a,b){this.name=a||"";this.height=this.width=0;this.mipentries=this.mipmaps=this.data=null;this.hasTransparency=!1;this.srcUrl="";this.onready=b&&"function"==typeof b?b:null};
JSC3D.Texture.prototype.createFromUrl=function(a,b){var c=this,e=new Image;e.onload=function(){c.data=null;c.mipmaps=null;c.mipentries=null;c.width=0;c.height=0;c.hasTransparency=!1;c.srcUrl="";c.createFromImage(this,b);JSC3D.console&&JSC3D.console.logInfo('Finished loading texture image file "'+this.src+'".')};e.onerror=function(){c.data=null;c.mipmaps=null;c.mipentries=null;c.width=0;c.height=0;c.hasTransparency=!1;c.srcUrl="";JSC3D.console&&JSC3D.console.logWarning('Failed to load texture image file "'+
this.src+'". This texture will be discarded.')};e.src=a};
JSC3D.Texture.prototype.createFromImage=function(a,b){if(!(0>=a.width||0>=a.height)){var c=!1,e=JSC3D.Texture.cv;if(!e)try{e=document.createElement("canvas"),JSC3D.Texture.cv=e,c=!0}catch(d){return}var f=a.width>a.height?a.width:a.height,f=32>=f?32:64>=f?64:128>=f?128:256>=f?256:512;if(e.width!=f||e.height!=f)e.width=e.height=f,c=!0;var g;try{var h=e.getContext("2d");c||h.clearRect(0,0,f,f);h.drawImage(a,0,0,f,f);g=h.getImageData(0,0,f,f).data}catch(k){return}c=g.length/4;this.data=Array(c);for(var l=
h=0;h<c;h++,l+=4)e=g[l+3],this.data[h]=e<<24|g[l]<<16|g[l+1]<<8|g[l+2],255>e&&(this.hasTransparency=!0);this.height=this.width=f;this.mipmaps=null;b&&this.generateMipmaps();this.srcUrl=a.src;if(null!=this.onready&&"function"==typeof this.onready)this.onready()}};JSC3D.Texture.prototype.hasData=function(){return null!=this.data};
JSC3D.Texture.prototype.generateMipmaps=function(){if(!(1>=this.width||null==this.data||null!=this.mipmaps)){this.mipmaps=[this.data];this.mipentries=[1];for(var a=1+~~(0.1+Math.log(this.width)*Math.LOG2E),b=this.width>>1,c=1;c<a;c++){for(var e=Array(b*b),d=this.mipmaps[c-1],f=b<<1,g=0,h=0,k=0;k<b;k++){for(var l=0;l<b;l++){var o=d[g],i=d[g+1],H=d[g+f],q=d[g+f+1];e[h]=(((o&4278190080)>>>2)+((i&4278190080)>>>2)+((H&4278190080)>>>2)+((q&4278190080)>>>2)&4278190080)+((o&16711680)+(i&16711680)+(H&16711680)+
(q&16711680)>>2&16711680)+((o&65280)+(i&65280)+(H&65280)+(q&65280)>>2&65280)+((o&255)+(i&255)+(H&255)+(q&255)>>2&255);g+=2;h++}g+=f}this.mipmaps.push(e);this.mipentries.push(Math.pow(4,c));b>>=1}}};JSC3D.Texture.prototype.hasMipmap=function(){return null!=this.mipmaps};JSC3D.Texture.prototype.name="";JSC3D.Texture.prototype.data=null;JSC3D.Texture.prototype.mipmaps=null;JSC3D.Texture.prototype.mipentries=null;JSC3D.Texture.prototype.width=0;JSC3D.Texture.prototype.height=0;
JSC3D.Texture.prototype.hasTransparency=!1;JSC3D.Texture.prototype.srcUrl="";JSC3D.Texture.prototype.onready=null;JSC3D.Texture.cv=null;JSC3D.AABB=function(){this.minZ=this.maxZ=this.minY=this.maxY=this.minX=this.maxX=0};JSC3D.AABB.prototype.center=function(){return[(this.minX+this.maxX)/2,(this.minY+this.maxY)/2,(this.minZ+this.maxZ)/2]};JSC3D.AABB.prototype.lengthOfDiagonal=function(){var a=this.maxX-this.minX,b=this.maxY-this.minY,c=this.maxZ-this.minZ;return Math.sqrt(a*a+b*b+c*c)};
JSC3D.Matrix3x4=function(){this.m00=1;this.m10=this.m03=this.m02=this.m01=0;this.m11=1;this.m21=this.m20=this.m13=this.m12=0;this.m22=1;this.m23=0};JSC3D.Matrix3x4.prototype.identity=function(){this.m00=1;this.m10=this.m03=this.m02=this.m01=0;this.m11=1;this.m21=this.m20=this.m13=this.m12=0;this.m22=1;this.m23=0};
JSC3D.Matrix3x4.prototype.scale=function(a,b,c){this.m00*=a;this.m01*=a;this.m02*=a;this.m03*=a;this.m10*=b;this.m11*=b;this.m12*=b;this.m13*=b;this.m20*=c;this.m21*=c;this.m22*=c;this.m23*=c};JSC3D.Matrix3x4.prototype.translate=function(a,b,c){this.m03+=a;this.m13+=b;this.m23+=c};
JSC3D.Matrix3x4.prototype.rotateAboutXAxis=function(a){if(0!=a){var a=a*(Math.PI/180),b=Math.cos(a),a=Math.sin(a),c=b*this.m11-a*this.m21,e=b*this.m12-a*this.m22,d=b*this.m13-a*this.m23,f=b*this.m20+a*this.m10,g=b*this.m21+a*this.m11,h=b*this.m22+a*this.m12,k=b*this.m23+a*this.m13;this.m10=b*this.m10-a*this.m20;this.m11=c;this.m12=e;this.m13=d;this.m20=f;this.m21=g;this.m22=h;this.m23=k}};
JSC3D.Matrix3x4.prototype.rotateAboutYAxis=function(a){if(0!=a){var a=a*(Math.PI/180),b=Math.cos(a),a=Math.sin(a),c=b*this.m01+a*this.m21,e=b*this.m02+a*this.m22,d=b*this.m03+a*this.m23,f=b*this.m20-a*this.m00,g=b*this.m21-a*this.m01,h=b*this.m22-a*this.m02,k=b*this.m23-a*this.m03;this.m00=b*this.m00+a*this.m20;this.m01=c;this.m02=e;this.m03=d;this.m20=f;this.m21=g;this.m22=h;this.m23=k}};
JSC3D.Matrix3x4.prototype.rotateAboutZAxis=function(a){if(0!=a){var a=a*(Math.PI/180),b=Math.cos(a),a=Math.sin(a),c=b*this.m10+a*this.m00,e=b*this.m11+a*this.m01,d=b*this.m12+a*this.m02,f=b*this.m13+a*this.m03,g=b*this.m01-a*this.m11,h=b*this.m02-a*this.m12,k=b*this.m03-a*this.m13;this.m00=b*this.m00-a*this.m10;this.m01=g;this.m02=h;this.m03=k;this.m10=c;this.m11=e;this.m12=d;this.m13=f}};
JSC3D.Matrix3x4.prototype.multiply=function(a){var b=a.m00*this.m01+a.m01*this.m11+a.m02*this.m21,c=a.m00*this.m02+a.m01*this.m12+a.m02*this.m22,e=a.m00*this.m03+a.m01*this.m13+a.m02*this.m23+a.m03,d=a.m10*this.m00+a.m11*this.m10+a.m12*this.m20,f=a.m10*this.m01+a.m11*this.m11+a.m12*this.m21,g=a.m10*this.m02+a.m11*this.m12+a.m12*this.m22,h=a.m10*this.m03+a.m11*this.m13+a.m12*this.m23+a.m13,k=a.m20*this.m00+a.m21*this.m10+a.m22*this.m20,l=a.m20*this.m01+a.m21*this.m11+a.m22*this.m21,o=a.m20*this.m02+
a.m21*this.m12+a.m22*this.m22,i=a.m20*this.m03+a.m21*this.m13+a.m22*this.m23+a.m23;this.m00=a.m00*this.m00+a.m01*this.m10+a.m02*this.m20;this.m01=b;this.m02=c;this.m03=e;this.m10=d;this.m11=f;this.m12=g;this.m13=h;this.m20=k;this.m21=l;this.m22=o;this.m23=i};
JSC3D.Math3D={transformVectors:function(a,b,c){for(var e=0;e<b.length;e+=3){var d=b[e],f=b[e+1],g=b[e+2];c[e]=a.m00*d+a.m01*f+a.m02*g+a.m03;c[e+1]=a.m10*d+a.m11*f+a.m12*g+a.m13;c[e+2]=a.m20*d+a.m21*f+a.m22*g+a.m23}},transformVectorZs:function(a,b,c){for(var e=b.length/3,d=0,f=0;d<e;)c[d]=a.m20*b[f]+a.m21*b[f+1]+a.m22*b[f+2]+a.m23,d++,f+=3}};JSC3D.BinaryStream=function(a,b){if(b)throw"JSC3D.BinaryStream constructor failed: Big endian is not supported yet!";this.data=a;this.offset=0};
JSC3D.BinaryStream.prototype.size=function(){return this.data.length};JSC3D.BinaryStream.prototype.tell=function(){return this.offset};JSC3D.BinaryStream.prototype.seek=function(a){if(0>a||a>=this.data.length)return!1;this.offset=a;return!0};JSC3D.BinaryStream.prototype.reset=function(){this.offset=0};JSC3D.BinaryStream.prototype.skip=function(a){this.offset=this.offset+a>this.data.length?this.data.length:this.offset+a};JSC3D.BinaryStream.prototype.available=function(){return this.data.length-this.offset};
JSC3D.BinaryStream.prototype.eof=function(){return!(this.offset<this.data.length)};JSC3D.BinaryStream.prototype.readUInt8=function(){return this.decodeInt(1,!1)};JSC3D.BinaryStream.prototype.readInt8=function(){return this.decodeInt(1,!0)};JSC3D.BinaryStream.prototype.readUInt16=function(){return this.decodeInt(2,!1)};JSC3D.BinaryStream.prototype.readInt16=function(){return this.decodeInt(2,!0)};JSC3D.BinaryStream.prototype.readUInt32=function(){return this.decodeInt(4,!1)};
JSC3D.BinaryStream.prototype.readInt32=function(){return this.decodeInt(4,!0)};JSC3D.BinaryStream.prototype.readFloat32=function(){return this.decodeFloat(4,23)};JSC3D.BinaryStream.prototype.readFloat64=function(){return this.decodeFloat(8,52)};JSC3D.BinaryStream.prototype.readBytes=function(a,b){var c=b;this.offset+b>this.data.length&&(c=this.data.length-this.offset);for(var e=0;e<c;e++)a[e]=this.data[this.offset++].charCodeAt(0)&255;return c};
JSC3D.BinaryStream.prototype.decodeInt=function(a,b){if(this.offset+a>this.data.length)return this.offset=this.data.length,NaN;for(var c=0,e=1,d=0;d<a;d++)c+=(this.data[this.offset++].charCodeAt(0)&255)*e,e*=256;b&&c&Math.pow(2,8*a-1)&&(c-=Math.pow(2,8*a));return c};
JSC3D.BinaryStream.prototype.decodeFloat=function(a,b){if(this.offset+a>this.data.length)return this.offset=this.data.length,NaN;for(var c=8*a-b-1,e=(1<<c)-1,d=e>>1,f=a-1,g=this.data[this.offset+f].charCodeAt(0)&255,f=f+-1,h=-7,k=g&(1<<-h)-1,g=g>>-h,h=h+c;0<h;)k=256*k+(this.data[this.offset+f].charCodeAt(0)&255),f+=-1,h-=8;c=k&(1<<-h)-1;k>>=-h;for(h+=b;0<h;)c=256*c+(this.data[this.offset+f].charCodeAt(0)&255),f+=-1,h-=8;this.offset+=a;switch(k){case 0:k=1-d;break;case e:return c?NaN:Infinity*(g?-1:
1);default:c+=Math.pow(2,b),k-=d}return(g?-1:1)*c*Math.pow(2,k-b)};JSC3D.LoaderSelector={registerLoader:function(a,b){"function"==typeof b&&(JSC3D.LoaderSelector.loaderTable[a]=b)},getLoader:function(a){a=JSC3D.LoaderSelector.loaderTable[a.toLowerCase()];if(!a)return null;var b;try{b=new a}catch(c){b=null}return b},loaderTable:{}};
JSC3D.ObjLoader=function(a,b,c,e){this.onload=a&&"function"==typeof a?a:null;this.onerror=b&&"function"==typeof b?b:null;this.onprogress=c&&"function"==typeof c?c:null;this.onresource=e&&"function"==typeof e?e:null;this.requestCount=0;this.mtlLibUrl="";this.setMtlLibUrl=function(a){this.mtlLibUrl=a}};
JSC3D.ObjLoader.prototype.loadFromUrl=function(a){var b="",c=a,e=a.lastIndexOf("/");-1==e&&(e=a.lastIndexOf("\\"));-1!=e&&(b=a.substring(0,e+1),c=a.substring(e+1));this.requestCount=0;this.loadObjFile(b,c)};
JSC3D.ObjLoader.prototype.loadObjFile=function(a,b){var c=a+b,e=this,d=new XMLHttpRequest,c=c.replace(".obj","");d.open("POST",c,!0);d.onreadystatechange=function(){if(4==this.readyState)if(200==this.status||0==this.status){if(e.onload){if(e.onprogress)e.onprogress("Loading obj file ...",1);JSC3D.console&&JSC3D.console.logInfo('Finished loading obj file "'+c+'".');var a=new JSC3D.Scene,b=e.parseObj(a,this.responseText);0<b.length&&e.mtlLibUrl&&e.loadMtlFile(a,e.mtlLibUrl,b[0]);if(0==--e.requestCount)e.onload(a)}}else JSC3D.console&&
JSC3D.console.logError('Failed to load obj file "'+c+'".'),e.onerror&&(e.requestCount--,e.onerror('Failed to load obj file "'+c+'".'))};this.onprogress&&(this.onprogress("Loading obj file ...",0),d.onprogress=function(a){e.onprogress("Loading obj file ...",a.position/a.totalSize)});this.requestCount++;d.send()};
JSC3D.ObjLoader.prototype.loadMtlFile=function(a,b,c){var e=this,d=new XMLHttpRequest;d.open("POST",b,!0);d.onreadystatechange=function(){if(4==this.readyState){if(200==this.status||0==this.status){if(e.onprogress)e.onprogress("Loading mtl file ...",1);JSC3D.console&&JSC3D.console.logInfo('Finished loading mtl file "'+b+'".');for(var d=e.parseMtl(this.responseText),g={},h=a.getChildren(),k=0;k<h.length;k++){var l=h[k];if(null!=l.mtl&&null!=l.mtllib&&l.mtllib==c){var o=d[l.mtl];null!=o&&(null!=o.material&&
l.setMaterial(o.material),""!=o.textureFileName&&(g[o.textureFileName]?g[o.textureFileName].push(l):g[o.textureFileName]=[l]))}}for(var i in g)e.setupTexture(g[i],b+i)}else JSC3D.console&&JSC3D.console.logWarning('Failed to load mtl file "'+b+'". A default material will be applied.');if(0==--e.requestCount)e.onload(a)}};this.onprogress&&(this.onprogress("Loading mtl file ...",0),d.onprogress=function(a){e.onprogress("Loading mtl file ...",a.position/a.totalSize)});this.requestCount++;d.send()};
JSC3D.ObjLoader.prototype.parseObj=function(a,b){var c={},e=[],d=0,f=null,g="",h="",k=[],l=[],o="obj-"+d++,i=new JSC3D.Mesh;i.name=o;i.indexBuffer=[];for(var f=c.nomtl=i,H=b.split("\n"),o=0;o<H.length;o++)if(h=H[o].split(/[ \t]+/),0<h.length)switch(h[0]){case "v":if(3<h.length)for(var q=1;4>q;q++)k.push(parseFloat(h[q]));break;case "vt":2<h.length&&(l.push(parseFloat(h[1])),l.push(1-parseFloat(h[2])));break;case "f":if(3<h.length){for(q=1;q<h.length;q++){var I=h[q].split("/");f.indexBuffer.push(parseInt(I[0])-
1);1<I.length&&""!=I[1]&&(f.texCoordIndexBuffer||(f.texCoordIndexBuffer=[]),f.texCoordIndexBuffer.push(parseInt(I[1])-1))}f.indexBuffer.push(-1);f.texCoordIndexBuffer&&f.texCoordIndexBuffer.push(-1)}break;case "mtllib":1<h.length?(g=h[1],e.push(g)):g="";break;case "usemtl":1<h.length&&""!=h[1]&&""!=g?(h=h[1],q=g+"-"+h,f=c[q],f||(f=new JSC3D.Mesh,f.name="obj-"+d++,f.indexBuffer=[],f.mtllib=g,f.mtl=h,c[q]=f)):f=i}var d=3<=k.length?Array(k.length/3):null,g=2<=l.length?Array(l.length/2):null,v;for(v in c){f=
c[v];if(3<=k.length&&0<f.indexBuffer.length){for(o=0;o<d.length;o++)d[o]=-1;f.vertexBuffer=[];for(o=H=i=0;o<f.indexBuffer.length;o++)i=f.indexBuffer[o],-1!=i&&(-1==d[i]?(h=3*i,f.vertexBuffer.push(k[h]),f.vertexBuffer.push(k[h+1]),f.vertexBuffer.push(k[h+2]),f.indexBuffer[o]=H,d[i]=H,H++):f.indexBuffer[o]=d[i])}if(2<=l.length&&null!=f.texCoordIndexBuffer&&0<f.texCoordIndexBuffer.length){for(o=0;o<g.length;o++)g[o]=-1;f.texCoordBuffer=[];for(o=H=i=0;o<f.texCoordIndexBuffer.length;o++)i=f.texCoordIndexBuffer[o],
-1!=i&&(-1==g[i]?(h=2*i,f.texCoordBuffer.push(l[h]),f.texCoordBuffer.push(l[h+1]),f.texCoordIndexBuffer[o]=H,g[i]=H,H++):f.texCoordIndexBuffer[o]=g[i])}f.isTrivial()||a.addChild(f)}return e};
JSC3D.ObjLoader.prototype.parseMtl=function(a){for(var b={},c="",a=a.split("\n"),e=0;e<a.length;e++){var d=a[e].split(/[ \t]+/);if(0<d.length)switch(d[0]){case "newmtl":c=d[1];d={};d.material=new JSC3D.Material;d.textureFileName="";b[c]=d;break;case "Kd":if(4==d.length&&!isNaN(d[1])){var f=255*parseFloat(d[1])&255,g=255*parseFloat(d[2])&255,h=255*parseFloat(d[3])&255,d=b[c];null!=d&&(d.material.diffuseColor=f<<16|g<<8|h)}break;case "d":2==d.length&&!isNaN(d[1])&&(f=parseFloat(d[1]),d=b[c],null!=d&&
(d.material.transparency=1-f));break;case "map_Kd":2==d.length&&(f=d[1],d=b[c],null!=d&&(d.textureFileName=f))}}return b};JSC3D.ObjLoader.prototype.setupTexture=function(a,b){var c=this,e=new JSC3D.Texture;e.onready=function(){for(var b=0;b<a.length;b++)a[b].setTexture(this);if(c.onresource)c.onresource(this)};e.createFromUrl(b)};JSC3D.ObjLoader.prototype.onload=null;JSC3D.ObjLoader.prototype.onerror=null;JSC3D.ObjLoader.prototype.onprogress=null;JSC3D.ObjLoader.prototype.onresource=null;
JSC3D.ObjLoader.prototype.requestCount=0;JSC3D.LoaderSelector.registerLoader("obj",JSC3D.ObjLoader);JSC3D.StlLoader=function(a,b,c,e){this.onload=a&&"function"==typeof a?a:null;this.onerror=b&&"function"==typeof b?b:null;this.onprogress=c&&"function"==typeof c?c:null;this.onresource=e&&"function"==typeof e?e:null;this.decimalPrecision=3};
JSC3D.StlLoader.prototype.loadFromUrl=function(a){var b=this,c=new XMLHttpRequest;c.open("GET",a,!0);c.overrideMimeType("text/plain; charset=x-user-defined");c.onreadystatechange=function(){if(4==this.readyState)if(200==this.status||0==this.status){if(JSC3D.console&&JSC3D.console.logInfo('Finished loading STL file "'+a+'".'),b.onload){if(b.onprogress)b.onprogress("Loading STL file ...",1);var c=new JSC3D.Scene;b.parseStl(c,this.responseText);b.onload(c)}}else if(JSC3D.console&&JSC3D.console.logError('Failed to load STL file "'+
a+'".'),b.onerror)b.onerror('Failed to load STL file "'+a+'".')};this.onprogress&&(this.onprogress("Loading STL file ...",0),c.onprogress=function(a){b.onprogress("Loading STL file ...",a.position/a.totalSize)});c.send()};JSC3D.StlLoader.prototype.setDecimalPrecision=function(a){this.decimalPrecision=a};
JSC3D.StlLoader.prototype.parseStl=function(a,b){var c=new JSC3D.Mesh;c.vertexBuffer=[];c.indexBuffer=[];c.faceNormalBuffer=[];var e=!1,d=new JSC3D.BinaryStream(b);d.skip(84);for(var f=0;256>f&&!d.eof();f++)if(127<d.readUInt8()){e=!0;break}JSC3D.console&&JSC3D.console.logInfo("This is recognised as "+(e?"a binary":"an ASCII")+" STL file.");if(e){d.reset();d.skip(80);h=d.readUInt32();if(d.size()<84+50*h){JSC3D.console&&JSC3D.console.logError("Failed to parse contents of the file. It seems not complete.");
return}c.faceCount=h;e={};for(f=0;f<h;f++){c.faceNormalBuffer.push(d.readFloat32());c.faceNormalBuffer.push(d.readFloat32());c.faceNormalBuffer.push(d.readFloat32());for(var g=0;3>g;g++)k=d.readFloat32(),l=d.readFloat32(),o=d.readFloat32(),i=k.toFixed(this.decimalPrecision)+"-"+l.toFixed(this.decimalPrecision)+"-"+o.toFixed(this.decimalPrecision),H=e[i],void 0==H&&(H=c.vertexBuffer.length/3,e[i]=H,c.vertexBuffer.push(k),c.vertexBuffer.push(l),c.vertexBuffer.push(o)),c.indexBuffer.push(H);c.indexBuffer.push(-1);
d.skip(2)}}else if(d=RegExp("facet\\s+normal\\s+([-+]?\\b(?:[0-9]*\\.)?[0-9]+(?:[eE][-+]?[0-9]+)?\\b)\\s+([-+]?\\b(?:[0-9]*\\.)?[0-9]+(?:[eE][-+]?[0-9]+)?\\b)\\s+([-+]?\\b(?:[0-9]*\\.)?[0-9]+(?:[eE][-+]?[0-9]+)?\\b)\\s+outer\\s+loop\\s+vertex\\s+([-+]?\\b(?:[0-9]*\\.)?[0-9]+(?:[eE][-+]?[0-9]+)?\\b)\\s+([-+]?\\b(?:[0-9]*\\.)?[0-9]+(?:[eE][-+]?[0-9]+)?\\b)\\s+([-+]?\\b(?:[0-9]*\\.)?[0-9]+(?:[eE][-+]?[0-9]+)?\\b)\\s+vertex\\s+([-+]?\\b(?:[0-9]*\\.)?[0-9]+(?:[eE][-+]?[0-9]+)?\\b)\\s+([-+]?\\b(?:[0-9]*\\.)?[0-9]+(?:[eE][-+]?[0-9]+)?\\b)\\s+([-+]?\\b(?:[0-9]*\\.)?[0-9]+(?:[eE][-+]?[0-9]+)?\\b)\\s+vertex\\s+([-+]?\\b(?:[0-9]*\\.)?[0-9]+(?:[eE][-+]?[0-9]+)?\\b)\\s+([-+]?\\b(?:[0-9]*\\.)?[0-9]+(?:[eE][-+]?[0-9]+)?\\b)\\s+([-+]?\\b(?:[0-9]*\\.)?[0-9]+(?:[eE][-+]?[0-9]+)?\\b)\\s+endloop\\s+endfacet",
"ig"),f=b.match(d)){var h=f.length;c.faceCount=h;e={};d.lastIndex=0;d.global=!1;for(h=d.exec(b);null!=h;h=d.exec(b)){c.faceNormalBuffer.push(parseFloat(h[1]),parseFloat(h[2]),parseFloat(h[3]));for(f=0;3>f;f++){var k=parseFloat(h[4+3*f]),l=parseFloat(h[5+3*f]),o=parseFloat(h[6+3*f]),i=k.toFixed(this.decimalPrecision)+"-"+l.toFixed(this.decimalPrecision)+"-"+o.toFixed(this.decimalPrecision),H=e[i];void 0===H&&(H=c.vertexBuffer.length/3,e[i]=H,c.vertexBuffer.push(k),c.vertexBuffer.push(l),c.vertexBuffer.push(o));
c.indexBuffer.push(H)}c.indexBuffer.push(-1)}}c.isTrivial()||a.addChild(c)};JSC3D.StlLoader.prototype.onload=null;JSC3D.StlLoader.prototype.onerror=null;JSC3D.StlLoader.prototype.onprogress=null;JSC3D.StlLoader.prototype.onresource=null;JSC3D.StlLoader.prototype.decimalPrecision=3;JSC3D.LoaderSelector.registerLoader("stl",JSC3D.StlLoader);
if(!Array.indexOf){Array.prototype.indexOf=function(b,c){for(var a=(c||0);a<this.length;a++){if(this[a]===b){return a;}}return -1;};}var Parser=(function(d){function H(J){function I(){}I.prototype=J;return new I();}var h=0;var q=1;var p=2;var s=3;var w=4;function A(I,K,J,L){this.type_=I;this.index_=K||0;this.prio_=J||0;this.number_=(L!==undefined&&L!==null)?L:0;this.toString=function(){switch(this.type_){case h:return this.number_;case q:case p:case s:return this.index_;case w:return"CALL";default:return"Invalid Token";}};}function G(L,J,I,K){this.tokens=L;this.ops1=J;this.ops2=I;this.functions=K;}var f=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,m=/[\\\'\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,v={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r","'":"\\'","\\":"\\\\"};function z(I){if(typeof I==="string"){m.lastIndex=0;return m.test(I)?"'"+I.replace(m,function(J){var K=v[J];return typeof K==="string"?K:"\\u"+("0000"+J.charCodeAt(0).toString(16)).slice(-4);})+"'":"'"+I+"'";}return I;}G.prototype={simplify:function(R){R=R||{};var M=[];var K=[];var P;var O;var N;var Q=this.tokens.length;var S;var J=0;for(J=0;J<Q;J++){S=this.tokens[J];var I=S.type_;if(I===h){M.push(S);}else{if(I===s&&(S.index_ in R)){S=new A(h,0,0,R[S.index_]);M.push(S);}else{if(I===p&&M.length>1){O=M.pop();P=M.pop();N=this.ops2[S.index_];S=new A(h,0,0,N(P.number_,O.number_));M.push(S);}else{if(I===q&&M.length>0){P=M.pop();N=this.ops1[S.index_];S=new A(h,0,0,N(P.number_));M.push(S);}else{while(M.length>0){K.push(M.shift());}K.push(S);}}}}}while(M.length>0){K.push(M.shift());}return new G(K,H(this.ops1),H(this.ops2),H(this.functions));},substitute:function(J,S){if(!(S instanceof G)){S=new c().parse(String(S));}var P=[];var R=this.tokens.length;var T;var M=0;for(M=0;M<R;M++){T=this.tokens[M];var N=T.type_;if(N===s&&T.index_===J){for(var K=0;K<S.tokens.length;K++){var O=S.tokens[K];var I=new A(O.type_,O.index_,O.prio_,O.number_);P.push(I);}}else{P.push(T);}}var Q=new G(P,H(this.ops1),H(this.ops2),H(this.functions));return Q;},evaluate:function(Q){Q=Q||{};var K=[];var O;var N;var M;var P=this.tokens.length;var R;var J=0;for(J=0;J<P;J++){R=this.tokens[J];var I=R.type_;if(I===h){K.push(R.number_);}else{if(I===p){N=K.pop();O=K.pop();M=this.ops2[R.index_];K.push(M(O,N));}else{if(I===s){if(R.index_ in Q){K.push(Q[R.index_]);}else{if(R.index_ in this.functions){K.push(this.functions[R.index_]);}else{throw new Error("undefined variable: "+R.index_);}}}else{if(I===q){O=K.pop();M=this.ops1[R.index_];K.push(M(O));}else{if(I===w){O=K.pop();M=K.pop();if(M.apply&&M.call){if(Object.prototype.toString.call(O)=="[object Array]"){K.push(M.apply(undefined,O));}else{K.push(M.call(undefined,O));}}else{throw new Error(M+" is not a function");}}else{throw new Error("invalid Expression");}}}}}}if(K.length>1){throw new Error("invalid Expression (parity)");}return K[0];},toString:function(M){var K=[];var P;var O;var N;var Q=this.tokens.length;var R;var J=0;for(J=0;J<Q;J++){R=this.tokens[J];var I=R.type_;if(I===h){K.push(z(R.number_));}else{if(I===p){O=K.pop();P=K.pop();N=R.index_;if(M&&N=="^"){K.push("Math.pow("+P+","+O+")");}else{K.push("("+P+N+O+")");}}else{if(I===s){K.push(R.index_);}else{if(I===q){P=K.pop();N=R.index_;if(N==="-"){K.push("("+N+P+")");}else{K.push(N+"("+P+")");}}else{if(I===w){P=K.pop();N=K.pop();K.push(N+"("+P+")");}else{throw new Error("invalid Expression");}}}}}}if(K.length>1){throw new Error("invalid Expression (parity)");}return K[0];},variables:function(){var I=this.tokens.length;var M=[];for(var J=0;J<I;J++){var K=this.tokens[J];if(K.type_===s&&(M.indexOf(K.index_)==-1)){M.push(K.index_);}}return M;},toJSFunction:function(J,K){var I=new Function(J,"with(Parser.values) { return "+this.simplify(K).toString(true)+"; }");return I;}};function y(J,I){return Number(J)+Number(I);}function n(J,I){return J-I;}function E(J,I){return J*I;}function x(J,I){return J/I;}function F(J,I){return J%I;}function j(J,I){return""+J+I;}function b(I){return -I;}function a(I){return Math.random()*(I||1);}function l(J){J=Math.floor(J);var I=J;while(J>1){I=I*(--J);}return I;}function B(J,I){return Math.sqrt(J*J+I*I);}function D(J,I){if(Object.prototype.toString.call(J)!="[object Array]"){return[J,I];}J=J.slice();J.push(I);return J;}function c(){this.success=false;this.errormsg="";this.expression="";this.pos=0;this.tokennumber=0;this.tokenprio=0;this.tokenindex=0;this.tmpprio=0;this.ops1={"sin":Math.sin,"cos":Math.cos,"tan":Math.tan,"asin":Math.asin,"acos":Math.acos,"atan":Math.atan,"sqrt":Math.sqrt,"log":Math.log,"abs":Math.abs,"ceil":Math.ceil,"floor":Math.floor,"round":Math.round,"-":b,"exp":Math.exp};this.ops2={"+":y,"-":n,"*":E,"/":x,"%":F,"^":Math.pow,",":D,"||":j};this.functions={"random":a,"fac":l,"min":Math.min,"max":Math.max,"pyt":B,"pow":Math.pow,"atan2":Math.atan2};this.consts={"E":Math.E,"PI":Math.PI};}c.parse=function(I){return new c().parse(I);};c.evaluate=function(I,J){return c.parse(I).evaluate(J);};c.Expression=G;c.values={sin:Math.sin,cos:Math.cos,tan:Math.tan,asin:Math.asin,acos:Math.acos,atan:Math.atan,sqrt:Math.sqrt,log:Math.log,abs:Math.abs,ceil:Math.ceil,floor:Math.floor,round:Math.round,random:a,fac:l,exp:Math.exp,min:Math.min,max:Math.max,pyt:B,pow:Math.pow,atan2:Math.atan2,E:Math.E,PI:Math.PI};var C=1<<0;var r=1<<1;var k=1<<2;var o=1<<3;var e=1<<4;var u=1<<5;var i=1<<6;var g=1<<7;var t=1<<8;c.prototype={parse:function(P){this.errormsg="";this.success=true;var K=[];var Q=[];this.tmpprio=0;var M=(C|o|k|i);var N=0;this.expression=P;this.pos=0;while(this.pos<this.expression.length){if(this.isOperator()){if(this.isSign()&&(M&i)){if(this.isNegativeSign()){this.tokenprio=2;this.tokenindex="-";N++;this.addfunc(Q,K,q);}M=(C|o|k|i);}else{if(this.isComment()){}else{if((M&r)===0){this.error_parsing(this.pos,"unexpected operator");}N+=2;this.addfunc(Q,K,p);M=(C|o|k|i);}}}else{if(this.isNumber()){if((M&C)===0){this.error_parsing(this.pos,"unexpected number");}var J=new A(h,0,0,this.tokennumber);Q.push(J);M=(r|e|u);}else{if(this.isString()){if((M&C)===0){this.error_parsing(this.pos,"unexpected string");}var J=new A(h,0,0,this.tokennumber);Q.push(J);M=(r|e|u);}else{if(this.isLeftParenth()){if((M&o)===0){this.error_parsing(this.pos,'unexpected "("');}if(M&g){N+=2;this.tokenprio=-2;this.tokenindex=-1;this.addfunc(Q,K,w);}M=(C|o|k|i|t);}else{if(this.isRightParenth()){if(M&t){var J=new A(h,0,0,[]);Q.push(J);}else{if((M&e)===0){this.error_parsing(this.pos,'unexpected ")"');}}M=(r|e|u|o|g);}else{if(this.isComma()){if((M&u)===0){this.error_parsing(this.pos,'unexpected ","');}this.addfunc(Q,K,p);N+=2;M=(C|o|k|i);}else{if(this.isConst()){if((M&C)===0){this.error_parsing(this.pos,"unexpected constant");}var I=new A(h,0,0,this.tokennumber);Q.push(I);M=(r|e|u);}else{if(this.isOp2()){if((M&k)===0){this.error_parsing(this.pos,"unexpected function");}this.addfunc(Q,K,p);N+=2;M=(o);}else{if(this.isOp1()){if((M&k)===0){this.error_parsing(this.pos,"unexpected function");}this.addfunc(Q,K,q);N++;M=(o);}else{if(this.isVar()){if((M&C)===0){this.error_parsing(this.pos,"unexpected variable");}var O=new A(s,this.tokenindex,0,0);Q.push(O);M=(r|e|u|o|g);}else{if(this.isWhite()){}else{if(this.errormsg===""){this.error_parsing(this.pos,"unknown character");}else{this.error_parsing(this.pos,this.errormsg);}}}}}}}}}}}}}if(this.tmpprio<0||this.tmpprio>=10){this.error_parsing(this.pos,'unmatched "()"');}while(K.length>0){var L=K.pop();
Q.push(L);}if(N+1!==Q.length){this.error_parsing(this.pos,"parity");}return new G(Q,H(this.ops1),H(this.ops2),H(this.functions));},evaluate:function(I,J){return this.parse(I).evaluate(J);},error_parsing:function(I,J){this.success=false;this.errormsg="parse error [column "+(I)+"]: "+J;throw new Error(this.errormsg);},addfunc:function(L,I,K){var J=new A(K,this.tokenindex,this.tokenprio+this.tmpprio,0);while(I.length>0){if(J.prio_<=I[I.length-1].prio_){L.push(I.pop());}else{break;}}I.push(J);},isNumber:function(){var J=false;var K="";while(this.pos<this.expression.length){var I=this.expression.charCodeAt(this.pos);if((I>=48&&I<=57)||I===46){K+=this.expression.charAt(this.pos);this.pos++;this.tokennumber=parseFloat(K);J=true;}else{break;}}return J;},unescape:function(J,O){var I=[];var N=false;for(var L=0;L<J.length;L++){var M=J.charAt(L);if(N){switch(M){case"'":I.push("'");break;case"\\":I.push("\\");break;case"/":I.push("/");break;case"b":I.push("\b");break;case"f":I.push("\f");break;case"n":I.push("\n");break;case"r":I.push("\r");break;case"t":I.push("\t");break;case"u":var K=parseInt(J.substring(L+1,L+5),16);I.push(String.fromCharCode(K));L+=4;break;default:throw this.error_parsing(O+L,"Illegal escape sequence: '\\"+M+"'");}N=false;}else{if(M=="\\"){N=true;}else{I.push(M);}}}return I.join("");},isString:function(){var J=false;var L="";var K=this.pos;if(this.pos<this.expression.length&&this.expression.charAt(this.pos)=="'"){this.pos++;while(this.pos<this.expression.length){var I=this.expression.charAt(this.pos);if(I!="'"||L.slice(-1)=="\\"){L+=this.expression.charAt(this.pos);this.pos++;}else{this.pos++;this.tokennumber=this.unescape(L,K);J=true;break;}}}return J;},isConst:function(){var K;for(var J in this.consts){if(true){var I=J.length;K=this.expression.substr(this.pos,I);if(J===K){this.tokennumber=this.consts[J];this.pos+=I;return true;}}}return false;},isOperator:function(){var I=this.expression.charCodeAt(this.pos);if(I===43){this.tokenprio=0;this.tokenindex="+";}else{if(I===45){this.tokenprio=0;this.tokenindex="-";}else{if(I===124){if(this.expression.charCodeAt(this.pos+1)===124){this.pos++;this.tokenprio=0;this.tokenindex="||";}else{return false;}}else{if(I===42){this.tokenprio=1;this.tokenindex="*";}else{if(I===47){this.tokenprio=2;this.tokenindex="/";}else{if(I===37){this.tokenprio=2;this.tokenindex="%";}else{if(I===94){this.tokenprio=3;this.tokenindex="^";}else{return false;}}}}}}}this.pos++;return true;},isSign:function(){var I=this.expression.charCodeAt(this.pos-1);if(I===45||I===43){return true;}return false;},isPositiveSign:function(){var I=this.expression.charCodeAt(this.pos-1);if(I===43){return true;}return false;},isNegativeSign:function(){var I=this.expression.charCodeAt(this.pos-1);if(I===45){return true;}return false;},isLeftParenth:function(){var I=this.expression.charCodeAt(this.pos);if(I===40){this.pos++;this.tmpprio+=10;return true;}return false;},isRightParenth:function(){var I=this.expression.charCodeAt(this.pos);if(I===41){this.pos++;this.tmpprio-=10;return true;}return false;},isComma:function(){var I=this.expression.charCodeAt(this.pos);if(I===44){this.pos++;this.tokenprio=-1;this.tokenindex=",";return true;}return false;},isWhite:function(){var I=this.expression.charCodeAt(this.pos);if(I===32||I===9||I===10||I===13){this.pos++;return true;}return false;},isOp1:function(){var J="";for(var I=this.pos;I<this.expression.length;I++){var K=this.expression.charAt(I);if(K.toUpperCase()===K.toLowerCase()){if(I===this.pos||(K!="_"&&(K<"0"||K>"9"))){break;}}J+=K;}if(J.length>0&&(J in this.ops1)){this.tokenindex=J;this.tokenprio=5;this.pos+=J.length;return true;}return false;},isOp2:function(){var J="";for(var I=this.pos;I<this.expression.length;I++){var K=this.expression.charAt(I);if(K.toUpperCase()===K.toLowerCase()){if(I===this.pos||(K!="_"&&(K<"0"||K>"9"))){break;}}J+=K;}if(J.length>0&&(J in this.ops2)){this.tokenindex=J;this.tokenprio=5;this.pos+=J.length;return true;}return false;},isVar:function(){var J="";for(var I=this.pos;I<this.expression.length;I++){var K=this.expression.charAt(I);if(K.toUpperCase()===K.toLowerCase()){if(I===this.pos||(K!="_"&&(K<"0"||K>"9"))){break;}}J+=K;}if(J.length>0){this.tokenindex=J;this.tokenprio=4;this.pos+=J.length;return true;}return false;},isComment:function(){var I=this.expression.charCodeAt(this.pos-1);if(I===47&&this.expression.charCodeAt(this.pos)===42){this.pos=this.expression.indexOf("*/",this.pos)+2;if(this.pos===1){this.pos=this.expression.length;}return true;}return false;}};d.Parser=c;return c;})(typeof exports==="undefined"?{}:exports);
/*! KineticJS v5.1.0 2014-03-27 http://www.kineticjs.com by Eric Rowell @ericdrowell - MIT License https://github.com/ericdrowell/KineticJS/wiki/License*/
var Kinetic={};!function(a){var b=Math.PI/180;Kinetic={version:"5.1.0",stages:[],idCounter:0,ids:{},names:{},shapes:{},listenClickTap:!1,inDblClickWindow:!1,enableTrace:!1,traceArrMax:100,dblClickWindow:400,pixelRatio:void 0,dragDistance:0,angleDeg:!0,UA:function(){var b=a.navigator&&a.navigator.userAgent||"",c=b.toLowerCase(),d=/(chrome)[ \/]([\w.]+)/.exec(c)||/(webkit)[ \/]([\w.]+)/.exec(c)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(c)||/(msie) ([\w.]+)/.exec(c)||c.indexOf("compatible")<0&&/(mozilla)(?:.*? rv:([\w.]+)|)/.exec(c)||[],e=!!b.match(/Android|BlackBerry|iPhone|iPad|iPod|Opera Mini|IEMobile/i);return{browser:d[1]||"",version:d[2]||"0",mobile:e}}(),Filters:{},Node:function(a){this._init(a)},Shape:function(a){this.__init(a)},Container:function(a){this.__init(a)},Stage:function(a){this.___init(a)},BaseLayer:function(a){this.___init(a)},Layer:function(a){this.____init(a)},FastLayer:function(a){this.____init(a)},Group:function(a){this.___init(a)},isDragging:function(){var a=Kinetic.DD;return a?a.isDragging:!1},isDragReady:function(){var a=Kinetic.DD;return a?!!a.node:!1},_addId:function(a,b){void 0!==b&&(this.ids[b]=a)},_removeId:function(a){void 0!==a&&delete this.ids[a]},_addName:function(a,b){void 0!==b&&(void 0===this.names[b]&&(this.names[b]=[]),this.names[b].push(a))},_removeName:function(a,b){if(void 0!==a){var c=this.names[a];if(void 0!==c){for(var d=0;d<c.length;d++){var e=c[d];e._id===b&&c.splice(d,1)}0===c.length&&delete this.names[a]}}},getAngle:function(a){return this.angleDeg?a*b:a}}}(this),function(a,b){if("object"==typeof exports){var c=require("canvas"),d=require("jsdom").jsdom,e=d("<!DOCTYPE html><html><head></head><body></body></html>"),f=b();return Kinetic.document=e,Kinetic.window=Kinetic.document.createWindow(),Kinetic.window.Image=c.Image,Kinetic.root=a,Kinetic._nodeCanvas=c,void(module.exports=f)}"function"==typeof define&&define.amd&&define(b),Kinetic.document=document,Kinetic.window=window,Kinetic.root=a}((1,eval)("this"),function(){return Kinetic}),function(){Kinetic.Collection=function(){var a=[].slice.call(arguments),b=a.length,c=0;for(this.length=b;b>c;c++)this[c]=a[c];return this},Kinetic.Collection.prototype=[],Kinetic.Collection.prototype.each=function(a){for(var b=0;b<this.length;b++)a(this[b],b)},Kinetic.Collection.prototype.toArray=function(){var a,b=[],c=this.length;for(a=0;c>a;a++)b.push(this[a]);return b},Kinetic.Collection.toCollection=function(a){var b,c=new Kinetic.Collection,d=a.length;for(b=0;d>b;b++)c.push(a[b]);return c},Kinetic.Collection._mapMethod=function(a){Kinetic.Collection.prototype[a]=function(){var b,c=this.length,d=[].slice.call(arguments);for(b=0;c>b;b++)this[b][a].apply(this[b],d);return this}},Kinetic.Collection.mapMethods=function(a){var b=a.prototype;for(var c in b)Kinetic.Collection._mapMethod(c)},Kinetic.Transform=function(a){this.m=a&&a.slice()||[1,0,0,1,0,0]},Kinetic.Transform.prototype={copy:function(){return new Kinetic.Transform(this.m)},point:function(a){var b=this.m;return{x:b[0]*a.x+b[2]*a.y+b[4],y:b[1]*a.x+b[3]*a.y+b[5]}},translate:function(a,b){return this.m[4]+=this.m[0]*a+this.m[2]*b,this.m[5]+=this.m[1]*a+this.m[3]*b,this},scale:function(a,b){return this.m[0]*=a,this.m[1]*=a,this.m[2]*=b,this.m[3]*=b,this},rotate:function(a){var b=Math.cos(a),c=Math.sin(a),d=this.m[0]*b+this.m[2]*c,e=this.m[1]*b+this.m[3]*c,f=this.m[0]*-c+this.m[2]*b,g=this.m[1]*-c+this.m[3]*b;return this.m[0]=d,this.m[1]=e,this.m[2]=f,this.m[3]=g,this},getTranslation:function(){return{x:this.m[4],y:this.m[5]}},skew:function(a,b){var c=this.m[0]+this.m[2]*b,d=this.m[1]+this.m[3]*b,e=this.m[2]+this.m[0]*a,f=this.m[3]+this.m[1]*a;return this.m[0]=c,this.m[1]=d,this.m[2]=e,this.m[3]=f,this},multiply:function(a){var b=this.m[0]*a.m[0]+this.m[2]*a.m[1],c=this.m[1]*a.m[0]+this.m[3]*a.m[1],d=this.m[0]*a.m[2]+this.m[2]*a.m[3],e=this.m[1]*a.m[2]+this.m[3]*a.m[3],f=this.m[0]*a.m[4]+this.m[2]*a.m[5]+this.m[4],g=this.m[1]*a.m[4]+this.m[3]*a.m[5]+this.m[5];return this.m[0]=b,this.m[1]=c,this.m[2]=d,this.m[3]=e,this.m[4]=f,this.m[5]=g,this},invert:function(){var a=1/(this.m[0]*this.m[3]-this.m[1]*this.m[2]),b=this.m[3]*a,c=-this.m[1]*a,d=-this.m[2]*a,e=this.m[0]*a,f=a*(this.m[2]*this.m[5]-this.m[3]*this.m[4]),g=a*(this.m[1]*this.m[4]-this.m[0]*this.m[5]);return this.m[0]=b,this.m[1]=c,this.m[2]=d,this.m[3]=e,this.m[4]=f,this.m[5]=g,this},getMatrix:function(){return this.m},setAbsolutePosition:function(a,b){var c=this.m[0],d=this.m[1],e=this.m[2],f=this.m[3],g=this.m[4],h=this.m[5],i=(c*(b-h)-d*(a-g))/(c*f-d*e),j=(a-g-e*i)/c;return this.translate(j,i)}};var a="2d",b="[object Array]",c="[object Number]",d="[object String]",e=Math.PI/180,f=180/Math.PI,g="#",h="",i="0",j="Kinetic warning: ",k="Kinetic error: ",l="rgb(",m={aqua:[0,255,255],lime:[0,255,0],silver:[192,192,192],black:[0,0,0],maroon:[128,0,0],teal:[0,128,128],blue:[0,0,255],navy:[0,0,128],white:[255,255,255],fuchsia:[255,0,255],olive:[128,128,0],yellow:[255,255,0],orange:[255,165,0],gray:[128,128,128],purple:[128,0,128],green:[0,128,0],red:[255,0,0],pink:[255,192,203],cyan:[0,255,255],transparent:[255,255,255,0]},n=/rgb\((\d{1,3}),(\d{1,3}),(\d{1,3})\)/;Kinetic.Util={_isElement:function(a){return!(!a||1!=a.nodeType)},_isFunction:function(a){return!!(a&&a.constructor&&a.call&&a.apply)},_isObject:function(a){return!!a&&a.constructor==Object},_isArray:function(a){return Object.prototype.toString.call(a)==b},_isNumber:function(a){return Object.prototype.toString.call(a)==c},_isString:function(a){return Object.prototype.toString.call(a)==d},_throttle:function(a,b,c){var d,e,f,g=null,h=0;c||(c={});var i=function(){h=c.leading===!1?0:(new Date).getTime(),g=null,f=a.apply(d,e),d=e=null};return function(){var j=(new Date).getTime();h||c.leading!==!1||(h=j);var k=b-(j-h);return d=this,e=arguments,0>=k?(clearTimeout(g),g=null,h=j,f=a.apply(d,e),d=e=null):g||c.trailing===!1||(g=setTimeout(i,k)),f}},_hasMethods:function(a){var b,c=[];for(b in a)this._isFunction(a[b])&&c.push(b);return c.length>0},createCanvasElement:function(){var a=Kinetic.document.createElement("canvas");return a.style=a.style||{},a},isBrowser:function(){return"object"!=typeof exports},_isInDocument:function(a){for(;a=a.parentNode;)if(a==Kinetic.document)return!0;return!1},_simplifyArray:function(a){var b,c,d=[],e=a.length,f=Kinetic.Util;for(b=0;e>b;b++)c=a[b],f._isNumber(c)?c=Math.round(1e3*c)/1e3:f._isString(c)||(c=c.toString()),d.push(c);return d},_getImage:function(b,c){var d,e;if(b)if(this._isElement(b))c(b);else if(this._isString(b))d=new Kinetic.window.Image,d.onload=function(){c(d)},d.src=b;else if(b.data){e=Kinetic.Util.createCanvasElement(),e.width=b.width,e.height=b.height;var f=e.getContext(a);f.putImageData(b,0,0),this._getImage(e.toDataURL(),c)}else c(null);else c(null)},_getRGBAString:function(a){var b=a.red||0,c=a.green||0,d=a.blue||0,e=a.alpha||1;return["rgba(",b,",",c,",",d,",",e,")"].join(h)},_rgbToHex:function(a,b,c){return((1<<24)+(a<<16)+(b<<8)+c).toString(16).slice(1)},_hexToRgb:function(a){a=a.replace(g,h);var b=parseInt(a,16);return{r:b>>16&255,g:b>>8&255,b:255&b}},getRandomColor:function(){for(var a=(16777215*Math.random()<<0).toString(16);a.length<6;)a=i+a;return g+a},get:function(a,b){return void 0===a?b:a},getRGB:function(a){var b;return a in m?(b=m[a],{r:b[0],g:b[1],b:b[2]}):a[0]===g?this._hexToRgb(a.substring(1)):a.substr(0,4)===l?(b=n.exec(a.replace(/ /g,"")),{r:parseInt(b[1],10),g:parseInt(b[2],10),b:parseInt(b[3],10)}):{r:0,g:0,b:0}},_merge:function(a,b){var c=this._clone(b);for(var d in a)c[d]=this._isObject(a[d])?this._merge(a[d],c[d]):a[d];return c},cloneObject:function(a){var b={};for(var c in a)b[c]=this._isObject(a[c])?this.cloneObject(a[c]):this._isArray(a[c])?this.cloneArray(a[c]):a[c];return b},cloneArray:function(a){return a.slice(0)},_degToRad:function(a){return a*e},_radToDeg:function(a){return a*f},_capitalize:function(a){return a.charAt(0).toUpperCase()+a.slice(1)},error:function(a){throw new Error(k+a)},warn:function(a){Kinetic.root.console&&console.warn&&console.warn(j+a)},extend:function(a,b){for(var c in b.prototype)c in a.prototype||(a.prototype[c]=b.prototype[c])},addMethods:function(a,b){var c;for(c in b)a.prototype[c]=b[c]},_getControlPoints:function(a,b,c,d,e,f,g){var h=Math.sqrt(Math.pow(c-a,2)+Math.pow(d-b,2)),i=Math.sqrt(Math.pow(e-c,2)+Math.pow(f-d,2)),j=g*h/(h+i),k=g*i/(h+i),l=c-j*(e-a),m=d-j*(f-b),n=c+k*(e-a),o=d+k*(f-b);return[l,m,n,o]},_expandPoints:function(a,b){var c,d,e=a.length,f=[];for(c=2;e-2>c;c+=2)d=Kinetic.Util._getControlPoints(a[c-2],a[c-1],a[c],a[c+1],a[c+2],a[c+3],b),f.push(d[0]),f.push(d[1]),f.push(a[c]),f.push(a[c+1]),f.push(d[2]),f.push(d[3]);return f},_removeLastLetter:function(a){return a.substring(0,a.length-1)}}}(),function(){var a=Kinetic.Util.createCanvasElement(),b=a.getContext("2d"),c=Kinetic.UA.mobile?function(){var a=window.devicePixelRatio||1,c=b.webkitBackingStorePixelRatio||b.mozBackingStorePixelRatio||b.msBackingStorePixelRatio||b.oBackingStorePixelRatio||b.backingStorePixelRatio||1;return a/c}():1;Kinetic.Canvas=function(a){this.init(a)},Kinetic.Canvas.prototype={init:function(a){a=a||{};var b=a.pixelRatio||Kinetic.pixelRatio||c;this.pixelRatio=b,this._canvas=Kinetic.Util.createCanvasElement(),this._canvas.style.padding=0,this._canvas.style.margin=0,this._canvas.style.border=0,this._canvas.style.background="transparent",this._canvas.style.position="absolute",this._canvas.style.top=0,this._canvas.style.left=0},getContext:function(){return this.context},getPixelRatio:function(){return this.pixelRatio},setPixelRatio:function(a){this.pixelRatio=a,this.setSize(this.getWidth(),this.getHeight())},setWidth:function(a){this.width=this._canvas.width=a*this.pixelRatio,this._canvas.style.width=a+"px"},setHeight:function(a){this.height=this._canvas.height=a*this.pixelRatio,this._canvas.style.height=a+"px"},getWidth:function(){return this.width},getHeight:function(){return this.height},setSize:function(a,b){this.setWidth(a),this.setHeight(b)},toDataURL:function(a,b){try{return this._canvas.toDataURL(a,b)}catch(c){try{return this._canvas.toDataURL()}catch(d){return Kinetic.Util.warn("Unable to get data URL. "+d.message),""}}}},Kinetic.SceneCanvas=function(a){a=a||{};var b=a.width||0,c=a.height||0;Kinetic.Canvas.call(this,a),this.context=new Kinetic.SceneContext(this),this.setSize(b,c)},Kinetic.SceneCanvas.prototype={setWidth:function(a){var b=this.pixelRatio,c=this.getContext()._context;Kinetic.Canvas.prototype.setWidth.call(this,a),c.scale(b,b)},setHeight:function(a){var b=this.pixelRatio,c=this.getContext()._context;Kinetic.Canvas.prototype.setHeight.call(this,a),c.scale(b,b)}},Kinetic.Util.extend(Kinetic.SceneCanvas,Kinetic.Canvas),Kinetic.HitCanvas=function(a){a=a||{};var b=a.width||0,c=a.height||0;Kinetic.Canvas.call(this,a),this.context=new Kinetic.HitContext(this),this.setSize(b,c)},Kinetic.Util.extend(Kinetic.HitCanvas,Kinetic.Canvas)}(),function(){var a=",",b="(",c=")",d="([",e="])",f=";",g="()",h="=",i=["arc","arcTo","beginPath","bezierCurveTo","clearRect","clip","closePath","createLinearGradient","createPattern","createRadialGradient","drawImage","fill","fillText","getImageData","createImageData","lineTo","moveTo","putImageData","quadraticCurveTo","rect","restore","rotate","save","scale","setLineDash","setTransform","stroke","strokeText","transform","translate"];Kinetic.Context=function(a){this.init(a)},Kinetic.Context.prototype={init:function(a){this.canvas=a,this._context=a._canvas.getContext("2d"),Kinetic.enableTrace&&(this.traceArr=[],this._enableTrace())},fillShape:function(a){a.getFillEnabled()&&this._fill(a)},strokeShape:function(a){a.getStrokeEnabled()&&this._stroke(a)},fillStrokeShape:function(a){var b=a.getFillEnabled();b&&this._fill(a),a.getStrokeEnabled()&&this._stroke(a)},getTrace:function(i){var j,k,l,m,n=this.traceArr,o=n.length,p="";for(j=0;o>j;j++)k=n[j],l=k.method,l?(m=k.args,p+=l,p+=i?g:Kinetic.Util._isArray(m[0])?d+m.join(a)+e:b+m.join(a)+c):(p+=k.property,i||(p+=h+k.val)),p+=f;return p},clearTrace:function(){this.traceArr=[]},_trace:function(a){var b,c=this.traceArr;c.push(a),b=c.length,b>=Kinetic.traceArrMax&&c.shift()},reset:function(){var a=this.getCanvas().getPixelRatio();this.setTransform(1*a,0,0,1*a,0,0)},getCanvas:function(){return this.canvas},clear:function(a){var b=this.getCanvas();a?this.clearRect(a.x||0,a.y||0,a.width||0,a.height||0):this.clearRect(0,0,b.getWidth(),b.getHeight())},_applyLineCap:function(a){var b=a.getLineCap();b&&this.setAttr("lineCap",b)},_applyOpacity:function(a){var b=a.getAbsoluteOpacity();1!==b&&this.setAttr("globalAlpha",b)},_applyLineJoin:function(a){var b=a.getLineJoin();b&&this.setAttr("lineJoin",b)},setAttr:function(a,b){this._context[a]=b},arc:function(){var a=arguments;this._context.arc(a[0],a[1],a[2],a[3],a[4],a[5])},beginPath:function(){this._context.beginPath()},bezierCurveTo:function(){var a=arguments;this._context.bezierCurveTo(a[0],a[1],a[2],a[3],a[4],a[5])},clearRect:function(){var a=arguments;this._context.clearRect(a[0],a[1],a[2],a[3])},clip:function(){this._context.clip()},closePath:function(){this._context.closePath()},createImageData:function(){var a=arguments;return 2===a.length?this._context.createImageData(a[0],a[1]):1===a.length?this._context.createImageData(a[0]):void 0},createLinearGradient:function(){var a=arguments;return this._context.createLinearGradient(a[0],a[1],a[2],a[3])},createPattern:function(){var a=arguments;return this._context.createPattern(a[0],a[1])},createRadialGradient:function(){var a=arguments;return this._context.createRadialGradient(a[0],a[1],a[2],a[3],a[4],a[5])},drawImage:function(){var a=arguments,b=this._context;3===a.length?b.drawImage(a[0],a[1],a[2]):5===a.length?b.drawImage(a[0],a[1],a[2],a[3],a[4]):9===a.length&&b.drawImage(a[0],a[1],a[2],a[3],a[4],a[5],a[6],a[7],a[8])},fill:function(){this._context.fill()},fillText:function(){var a=arguments;this._context.fillText(a[0],a[1],a[2])},getImageData:function(){var a=arguments;return this._context.getImageData(a[0],a[1],a[2],a[3])},lineTo:function(){var a=arguments;this._context.lineTo(a[0],a[1])},moveTo:function(){var a=arguments;this._context.moveTo(a[0],a[1])},rect:function(){var a=arguments;this._context.rect(a[0],a[1],a[2],a[3])},putImageData:function(){var a=arguments;this._context.putImageData(a[0],a[1],a[2])},quadraticCurveTo:function(){var a=arguments;this._context.quadraticCurveTo(a[0],a[1],a[2],a[3])},restore:function(){this._context.restore()},rotate:function(){var a=arguments;this._context.rotate(a[0])},save:function(){this._context.save()},scale:function(){var a=arguments;this._context.scale(a[0],a[1])},setLineDash:function(){var a=arguments,b=this._context;this._context.setLineDash?b.setLineDash(a[0]):"mozDash"in b?b.mozDash=a[0]:"webkitLineDash"in b&&(b.webkitLineDash=a[0])},setTransform:function(){var a=arguments;this._context.setTransform(a[0],a[1],a[2],a[3],a[4],a[5])},stroke:function(){this._context.stroke()},strokeText:function(){var a=arguments;this._context.strokeText(a[0],a[1],a[2])},transform:function(){var a=arguments;this._context.transform(a[0],a[1],a[2],a[3],a[4],a[5])},translate:function(){var a=arguments;this._context.translate(a[0],a[1])},_enableTrace:function(){var a,b,c=this,d=i.length,e=Kinetic.Util._simplifyArray,f=this.setAttr,g=function(a){var d,f=c[a];c[a]=function(){return b=e(Array.prototype.slice.call(arguments,0)),d=f.apply(c,arguments),c._trace({method:a,args:b}),d}};for(a=0;d>a;a++)g(i[a]);c.setAttr=function(){f.apply(c,arguments),c._trace({property:arguments[0],val:arguments[1]})}}},Kinetic.SceneContext=function(a){Kinetic.Context.call(this,a)},Kinetic.SceneContext.prototype={_fillColor:function(a){var b=a.fill()||Kinetic.Util._getRGBAString({red:a.fillRed(),green:a.fillGreen(),blue:a.fillBlue(),alpha:a.fillAlpha()});this.setAttr("fillStyle",b),a._fillFunc(this)},_fillPattern:function(a){var b=a.getFillPatternImage(),c=a.getFillPatternX(),d=a.getFillPatternY(),e=a.getFillPatternScale(),f=Kinetic.getAngle(a.getFillPatternRotation()),g=a.getFillPatternOffset(),h=a.getFillPatternRepeat();(c||d)&&this.translate(c||0,d||0),f&&this.rotate(f),e&&this.scale(e.x,e.y),g&&this.translate(-1*g.x,-1*g.y),this.setAttr("fillStyle",this.createPattern(b,h||"repeat")),this.fill()},_fillLinearGradient:function(a){var b=a.getFillLinearGradientStartPoint(),c=a.getFillLinearGradientEndPoint(),d=a.getFillLinearGradientColorStops(),e=this.createLinearGradient(b.x,b.y,c.x,c.y);if(d){for(var f=0;f<d.length;f+=2)e.addColorStop(d[f],d[f+1]);this.setAttr("fillStyle",e),this.fill()}},_fillRadialGradient:function(a){for(var b=a.getFillRadialGradientStartPoint(),c=a.getFillRadialGradientEndPoint(),d=a.getFillRadialGradientStartRadius(),e=a.getFillRadialGradientEndRadius(),f=a.getFillRadialGradientColorStops(),g=this.createRadialGradient(b.x,b.y,d,c.x,c.y,e),h=0;h<f.length;h+=2)g.addColorStop(f[h],f[h+1]);this.setAttr("fillStyle",g),this.fill()},_fill:function(a){var b=a.fill()||a.fillRed()||a.fillGreen()||a.fillBlue(),c=a.getFillPatternImage(),d=a.getFillLinearGradientColorStops(),e=a.getFillRadialGradientColorStops(),f=a.getFillPriority();b&&"color"===f?this._fillColor(a):c&&"pattern"===f?this._fillPattern(a):d&&"linear-gradient"===f?this._fillLinearGradient(a):e&&"radial-gradient"===f?this._fillRadialGradient(a):b?this._fillColor(a):c?this._fillPattern(a):d?this._fillLinearGradient(a):e&&this._fillRadialGradient(a)},_stroke:function(a){var b=a.dash(),c=a.getStrokeScaleEnabled();a.hasStroke()&&(c||(this.save(),this.setTransform(1,0,0,1,0,0)),this._applyLineCap(a),b&&a.dashEnabled()&&this.setLineDash(b),this.setAttr("lineWidth",a.strokeWidth()),this.setAttr("strokeStyle",a.stroke()||Kinetic.Util._getRGBAString({red:a.strokeRed(),green:a.strokeGreen(),blue:a.strokeBlue(),alpha:a.strokeAlpha()})),a._strokeFunc(this),c||this.restore())},_applyShadow:function(a){var b=Kinetic.Util,c=a.getAbsoluteOpacity(),d=b.get(a.getShadowColor(),"black"),e=b.get(a.getShadowBlur(),5),f=b.get(a.getShadowOpacity(),1),g=b.get(a.getShadowOffset(),{x:0,y:0});f&&this.setAttr("globalAlpha",f*c),this.setAttr("shadowColor",d),this.setAttr("shadowBlur",e),this.setAttr("shadowOffsetX",g.x),this.setAttr("shadowOffsetY",g.y)}},Kinetic.Util.extend(Kinetic.SceneContext,Kinetic.Context),Kinetic.HitContext=function(a){Kinetic.Context.call(this,a)},Kinetic.HitContext.prototype={_fill:function(a){this.save(),this.setAttr("fillStyle",a.colorKey),a._fillFuncHit(this),this.restore()},_stroke:function(a){a.hasStroke()&&(this._applyLineCap(a),this.setAttr("lineWidth",a.strokeWidth()),this.setAttr("strokeStyle",a.colorKey),a._strokeFuncHit(this))}},Kinetic.Util.extend(Kinetic.HitContext,Kinetic.Context)}(),function(){var a="get",b="set";Kinetic.Factory={addGetterSetter:function(a,b,c,d,e){this.addGetter(a,b,c),this.addSetter(a,b,d,e),this.addOverloadedGetterSetter(a,b)},addGetter:function(b,c,d){var e=a+Kinetic.Util._capitalize(c);b.prototype[e]=function(){var a=this.attrs[c];return void 0===a?d:a}},addSetter:function(a,c,d,e){var f=b+Kinetic.Util._capitalize(c);a.prototype[f]=function(a){return d&&(a=d.call(this,a)),this._setAttr(c,a),e&&e.call(this),this}},addComponentsGetterSetter:function(c,d,e,f,g){var h,i,j=e.length,k=Kinetic.Util._capitalize,l=a+k(d),m=b+k(d);c.prototype[l]=function(){var a={};for(h=0;j>h;h++)i=e[h],a[i]=this.getAttr(d+k(i));return a},c.prototype[m]=function(a){var b,c=this.attrs[d];f&&(a=f.call(this,a));for(b in a)this._setAttr(d+k(b),a[b]);return this._fireChangeEvent(d,c,a),g&&g.call(this),this},this.addOverloadedGetterSetter(c,d)},addOverloadedGetterSetter:function(c,d){var e=Kinetic.Util._capitalize(d),f=b+e,g=a+e;c.prototype[d]=function(){return arguments.length?(this[f](arguments[0]),this):this[g]()}},backCompat:function(a,b){var c;for(c in b)a.prototype[c]=a.prototype[b[c]]},afterSetFilter:function(){this._filterUpToDate=!1}},Kinetic.Validators={RGBComponent:function(a){return a>255?255:0>a?0:Math.round(a)},alphaComponent:function(a){return a>1?1:1e-4>a?1e-4:a}}}(),function(){var a="absoluteOpacity",b="absoluteTransform",c="Change",d="children",e=".",f="",g="get",h="id",i="kinetic",j="listening",k="mouseenter",l="mouseleave",m="name",n="set",o="Shape",p=" ",q="stage",r="transform",s="Stage",t="visible",u=["id"],v=["xChange.kinetic","yChange.kinetic","scaleXChange.kinetic","scaleYChange.kinetic","skewXChange.kinetic","skewYChange.kinetic","rotationChange.kinetic","offsetXChange.kinetic","offsetYChange.kinetic","transformsEnabledChange.kinetic"].join(p);Kinetic.Util.addMethods(Kinetic.Node,{_init:function(c){var d=this;this._id=Kinetic.idCounter++,this.eventListeners={},this.attrs={},this._cache={},this._filterUpToDate=!1,this.setAttrs(c),this.on(v,function(){this._clearCache(r),d._clearSelfAndDescendantCache(b)}),this.on("visibleChange.kinetic",function(){d._clearSelfAndDescendantCache(t)}),this.on("listeningChange.kinetic",function(){d._clearSelfAndDescendantCache(j)}),this.on("opacityChange.kinetic",function(){d._clearSelfAndDescendantCache(a)})},_clearCache:function(a){a?delete this._cache[a]:this._cache={}},_getCache:function(a,b){var c=this._cache[a];return void 0===c&&(this._cache[a]=b.call(this)),this._cache[a]},_clearSelfAndDescendantCache:function(a){this._clearCache(a),this.children&&this.getChildren().each(function(b){b._clearSelfAndDescendantCache(a)})},clearCache:function(){return delete this._cache.canvas,this._filterUpToDate=!1,this},cache:function(a){{var b=a||{},c=b.x||0,d=b.y||0,e=b.width||this.width(),f=b.height||this.height(),g=b.drawBorder||!1;this.getLayer()}if(0===e||0===f)return void Kinetic.Util.warn("Width or height of caching configuration equals 0. Cache is ignored.");var h=new Kinetic.SceneCanvas({pixelRatio:1,width:e,height:f}),i=new Kinetic.SceneCanvas({pixelRatio:1,width:e,height:f}),j=new Kinetic.HitCanvas({width:e,height:f}),k=(this.transformsEnabled(),this.x(),this.y(),h.getContext()),l=j.getContext();return this.clearCache(),k.save(),l.save(),g&&(k.save(),k.beginPath(),k.rect(0,0,e,f),k.closePath(),k.setAttr("strokeStyle","red"),k.setAttr("lineWidth",5),k.stroke(),k.restore()),k.translate(-1*c,-1*d),l.translate(-1*c,-1*d),"Shape"===this.nodeType&&(k.translate(-1*this.x(),-1*this.y()),l.translate(-1*this.x(),-1*this.y())),this.drawScene(h,this),this.drawHit(j,this),k.restore(),l.restore(),this._cache.canvas={scene:h,filter:i,hit:j},this},_drawCachedSceneCanvas:function(a){a.save(),this.getLayer()._applyTransform(this,a),a.drawImage(this._getCachedSceneCanvas()._canvas,0,0),a.restore()},_getCachedSceneCanvas:function(){var a,b,c,d,e=this.filters(),f=this._cache.canvas,g=f.scene,h=f.filter,i=h.getContext();if(e){if(!this._filterUpToDate){try{for(a=e.length,i.clear(),i.drawImage(g._canvas,0,0),b=i.getImageData(0,0,h.getWidth(),h.getHeight()),c=0;a>c;c++)d=e[c],d.call(this,b),i.putImageData(b,0,0)}catch(j){Kinetic.Util.warn("Unable to apply filter. "+j.message)}this._filterUpToDate=!0}return h}return g},_drawCachedHitCanvas:function(a){var b=this._cache.canvas,c=b.hit;a.save(),this.getLayer()._applyTransform(this,a),a.drawImage(c._canvas,0,0),a.restore()},on:function(a,b){var c,d,g,h,i,j=a.split(p),k=j.length;for(c=0;k>c;c++)d=j[c],g=d.split(e),h=g[0],i=g[1]||f,this.eventListeners[h]||(this.eventListeners[h]=[]),this.eventListeners[h].push({name:i,handler:b});return this},off:function(a){var b,c,d,f,g,h,i=a.split(p),j=i.length;for(b=0;j>b;b++)if(d=i[b],f=d.split(e),g=f[0],h=f[1],g)this.eventListeners[g]&&this._off(g,h);else for(c in this.eventListeners)this._off(c,h);return this},dispatchEvent:function(a){var b={target:this,type:a.type,evt:a};this.fire(a.type,b)},addEventListener:function(a,b){this.on(a,function(a){b.call(this,a.evt)})},remove:function(){var c=this.getParent();return c&&c.children&&(c.children.splice(this.index,1),c._setChildrenIndices(),delete this.parent),this._clearSelfAndDescendantCache(q),this._clearSelfAndDescendantCache(b),this._clearSelfAndDescendantCache(t),this._clearSelfAndDescendantCache(j),this._clearSelfAndDescendantCache(a),this},destroy:function(){Kinetic._removeId(this.getId()),Kinetic._removeName(this.getName(),this._id),this.remove()},getAttr:function(a){var b=g+Kinetic.Util._capitalize(a);return Kinetic.Util._isFunction(this[b])?this[b]():this.attrs[a]},getAncestors:function(){for(var a=this.getParent(),b=new Kinetic.Collection;a;)b.push(a),a=a.getParent();return b},getAttrs:function(){return this.attrs||{}},setAttrs:function(a){var b,c;if(a)for(b in a)b===d||(c=n+Kinetic.Util._capitalize(b),Kinetic.Util._isFunction(this[c])?this[c](a[b]):this._setAttr(b,a[b]));return this},isListening:function(){return this._getCache(j,this._isListening)},_isListening:function(){var a=this.getListening(),b=this.getParent();return"inherit"===a?b?b.isListening():!0:a},isVisible:function(){return this._getCache(t,this._isVisible)},_isVisible:function(){var a=this.getVisible(),b=this.getParent();return"inherit"===a?b?b.isVisible():!0:a},shouldDrawHit:function(){var a=this.getLayer();return a&&a.hitGraphEnabled()&&this.isListening()&&this.isVisible()&&!Kinetic.isDragging()},show:function(){return this.setVisible(!0),this},hide:function(){return this.setVisible(!1),this},getZIndex:function(){return this.index||0},getAbsoluteZIndex:function(){function a(i){for(b=[],c=i.length,d=0;c>d;d++)e=i[d],h++,e.nodeType!==o&&(b=b.concat(e.getChildren().toArray())),e._id===g._id&&(d=c);b.length>0&&b[0].getDepth()<=f&&a(b)}var b,c,d,e,f=this.getDepth(),g=this,h=0;return g.nodeType!==s&&a(g.getStage().getChildren()),h},getDepth:function(){for(var a=0,b=this.parent;b;)a++,b=b.parent;return a},setPosition:function(a){return this.setX(a.x),this.setY(a.y),this},getPosition:function(){return{x:this.getX(),y:this.getY()}},getAbsolutePosition:function(){var a=this.getAbsoluteTransform().getMatrix(),b=new Kinetic.Transform,c=this.offset();return b.m=a.slice(),b.translate(c.x,c.y),b.getTranslation()},setAbsolutePosition:function(a){var b,c=this._clearTransform();return this.attrs.x=c.x,this.attrs.y=c.y,delete c.x,delete c.y,b=this.getAbsoluteTransform(),b.invert(),b.translate(a.x,a.y),a={x:this.attrs.x+b.getTranslation().x,y:this.attrs.y+b.getTranslation().y},this.setPosition({x:a.x,y:a.y}),this._setTransform(c),this},_setTransform:function(a){var c;for(c in a)this.attrs[c]=a[c];this._clearCache(r),this._clearSelfAndDescendantCache(b)},_clearTransform:function(){var a={x:this.getX(),y:this.getY(),rotation:this.getRotation(),scaleX:this.getScaleX(),scaleY:this.getScaleY(),offsetX:this.getOffsetX(),offsetY:this.getOffsetY(),skewX:this.getSkewX(),skewY:this.getSkewY()};return this.attrs.x=0,this.attrs.y=0,this.attrs.rotation=0,this.attrs.scaleX=1,this.attrs.scaleY=1,this.attrs.offsetX=0,this.attrs.offsetY=0,this.attrs.skewX=0,this.attrs.skewY=0,this._clearCache(r),this._clearSelfAndDescendantCache(b),a},move:function(a){var b=a.x,c=a.y,d=this.getX(),e=this.getY();return void 0!==b&&(d+=b),void 0!==c&&(e+=c),this.setPosition({x:d,y:e}),this},_eachAncestorReverse:function(a,b){var c,d,e=[],f=this.getParent();if(b&&b._id===this._id)return a(this),!0;for(e.unshift(this);f&&(!b||f._id!==b._id);)e.unshift(f),f=f.parent;for(c=e.length,d=0;c>d;d++)a(e[d])},rotate:function(a){return this.setRotation(this.getRotation()+a),this},moveToTop:function(){if(!this.parent)return void Kinetic.Util.warn("Node has no parent. moveToTop function is ignored.");var a=this.index;return this.parent.children.splice(a,1),this.parent.children.push(this),this.parent._setChildrenIndices(),!0},moveUp:function(){if(!this.parent)return void Kinetic.Util.warn("Node has no parent. moveUp function is ignored.");var a=this.index,b=this.parent.getChildren().length;return b-1>a?(this.parent.children.splice(a,1),this.parent.children.splice(a+1,0,this),this.parent._setChildrenIndices(),!0):!1},moveDown:function(){if(!this.parent)return void Kinetic.Util.warn("Node has no parent. moveDown function is ignored.");var a=this.index;return a>0?(this.parent.children.splice(a,1),this.parent.children.splice(a-1,0,this),this.parent._setChildrenIndices(),!0):!1},moveToBottom:function(){if(!this.parent)return void Kinetic.Util.warn("Node has no parent. moveToBottom function is ignored.");var a=this.index;return a>0?(this.parent.children.splice(a,1),this.parent.children.unshift(this),this.parent._setChildrenIndices(),!0):!1},setZIndex:function(a){if(!this.parent)return void Kinetic.Util.warn("Node has no parent. zIndex parameter is ignored.");var b=this.index;return this.parent.children.splice(b,1),this.parent.children.splice(a,0,this),this.parent._setChildrenIndices(),this},getAbsoluteOpacity:function(){return this._getCache(a,this._getAbsoluteOpacity)},_getAbsoluteOpacity:function(){var a=this.getOpacity();return this.getParent()&&(a*=this.getParent().getAbsoluteOpacity()),a},moveTo:function(a){return Kinetic.Node.prototype.remove.call(this),a.add(this),this},toObject:function(){var a,b,c,d,e=Kinetic.Util,f={},g=this.getAttrs();f.attrs={};for(a in g)b=g[a],e._isFunction(b)||e._isElement(b)||e._isObject(b)&&e._hasMethods(b)||(c=this[a],delete g[a],d=c?c.call(this):null,g[a]=b,d!==b&&(f.attrs[a]=b));return f.className=this.getClassName(),f},toJSON:function(){return JSON.stringify(this.toObject())},getParent:function(){return this.parent},getLayer:function(){var a=this.getParent();return a?a.getLayer():null},getStage:function(){return this._getCache(q,this._getStage)},_getStage:function(){var a=this.getParent();return a?a.getStage():void 0},fire:function(a,b,c){return c?this._fireAndBubble(a,b||{}):this._fire(a,b||{}),this},getAbsoluteTransform:function(a){return a?this._getAbsoluteTransform(a):this._getCache(b,this._getAbsoluteTransform)},_getAbsoluteTransform:function(a){var b,c,d=new Kinetic.Transform;return this._eachAncestorReverse(function(a){b=a.transformsEnabled(),c=a.getTransform(),"all"===b?d.multiply(c):"position"===b&&d.translate(a.x(),a.y())},a),d},getTransform:function(){return this._getCache(r,this._getTransform)},_getTransform:function(){var a=new Kinetic.Transform,b=this.getX(),c=this.getY(),d=Kinetic.getAngle(this.getRotation()),e=this.getScaleX(),f=this.getScaleY(),g=this.getSkewX(),h=this.getSkewY(),i=this.getOffsetX(),j=this.getOffsetY();return(0!==b||0!==c)&&a.translate(b,c),0!==d&&a.rotate(d),(0!==g||0!==h)&&a.skew(g,h),(1!==e||1!==f)&&a.scale(e,f),(0!==i||0!==j)&&a.translate(-1*i,-1*j),a},clone:function(a){var b,c,d,e,f,g=this.getClassName(),h=Kinetic.Util.cloneObject(this.attrs);for(var j in u){var k=u[j];delete h[k]}for(b in a)h[b]=a[b];var l=new Kinetic[g](h);for(b in this.eventListeners)for(c=this.eventListeners[b],d=c.length,e=0;d>e;e++)f=c[e],f.name.indexOf(i)<0&&(l.eventListeners[b]||(l.eventListeners[b]=[]),l.eventListeners[b].push(f));return l},toDataURL:function(a){a=a||{};var b=a.mimeType||null,c=a.quality||null,d=this.getStage(),e=a.x||0,f=a.y||0,g=new Kinetic.SceneCanvas({width:a.width||this.getWidth()||(d?d.getWidth():0),height:a.height||this.getHeight()||(d?d.getHeight():0),pixelRatio:1}),h=g.getContext();return h.save(),(e||f)&&h.translate(-1*e,-1*f),this.drawScene(g),h.restore(),g.toDataURL(b,c)},toImage:function(a){Kinetic.Util._getImage(this.toDataURL(a),function(b){a.callback(b)})},setSize:function(a){return this.setWidth(a.width),this.setHeight(a.height),this},getSize:function(){return{width:this.getWidth(),height:this.getHeight()}},getWidth:function(){return this.attrs.width||0},getHeight:function(){return this.attrs.height||0},getClassName:function(){return this.className||this.nodeType},getType:function(){return this.nodeType},getDragDistance:function(){return void 0!==this.attrs.dragDistance?this.attrs.dragDistance:this.parent?this.parent.getDragDistance():Kinetic.dragDistance},_get:function(a){return this.nodeType===a?[this]:[]},_off:function(a,b){var c,d,e=this.eventListeners[a];for(c=0;c<e.length;c++)if(d=e[c].name,!("kinetic"===d&&"kinetic"!==b||b&&d!==b)){if(e.splice(c,1),0===e.length){delete this.eventListeners[a];break}c--}},_fireChangeEvent:function(a,b,d){this._fire(a+c,{oldVal:b,newVal:d})},setId:function(a){var b=this.getId();return Kinetic._removeId(b),Kinetic._addId(this,a),this._setAttr(h,a),this
},setName:function(a){var b=this.getName();return Kinetic._removeName(b,this._id),Kinetic._addName(this,a),this._setAttr(m,a),this},setAttr:function(){var a=Array.prototype.slice.call(arguments),b=a[0],c=a[1],d=n+Kinetic.Util._capitalize(b),e=this[d];return Kinetic.Util._isFunction(e)?e.call(this,c):this._setAttr(b,c),this},_setAttr:function(a,b){var c;void 0!==b&&(c=this.attrs[a],this.attrs[a]=b,this._fireChangeEvent(a,c,b))},_setComponentAttr:function(a,b,c){var d;void 0!==c&&(d=this.attrs[a],d||(this.attrs[a]=this.getAttr(a)),this.attrs[a][b]=c,this._fireChangeEvent(a,d,c))},_fireAndBubble:function(a,b,c){var d=!0;b&&this.nodeType===o&&(b.target=this),a===k&&c&&this._id===c._id?d=!1:a===l&&c&&this._id===c._id&&(d=!1),d&&(this._fire(a,b),b&&!b.cancelBubble&&this.parent&&(c&&c.parent?this._fireAndBubble.call(this.parent,a,b,c.parent):this._fireAndBubble.call(this.parent,a,b)))},_fire:function(a,b){var c,d=this.eventListeners[a];if(b.type=a,d)for(c=0;c<d.length;c++)d[c].handler.call(this,b)},draw:function(){return this.drawScene(),this.drawHit(),this}}),Kinetic.Node.create=function(a,b){return this._createNode(JSON.parse(a),b)},Kinetic.Node._createNode=function(a,b){var c,d,e,f=Kinetic.Node.prototype.getClassName.call(a),g=a.children;if(b&&(a.attrs.container=b),c=new Kinetic[f](a.attrs),g)for(d=g.length,e=0;d>e;e++)c.add(this._createNode(g[e]));return c},Kinetic.Factory.addOverloadedGetterSetter(Kinetic.Node,"position"),Kinetic.Factory.addGetterSetter(Kinetic.Node,"x",0),Kinetic.Factory.addGetterSetter(Kinetic.Node,"y",0),Kinetic.Factory.addGetterSetter(Kinetic.Node,"opacity",1),Kinetic.Factory.addGetter(Kinetic.Node,"name"),Kinetic.Factory.addOverloadedGetterSetter(Kinetic.Node,"name"),Kinetic.Factory.addGetter(Kinetic.Node,"id"),Kinetic.Factory.addOverloadedGetterSetter(Kinetic.Node,"id"),Kinetic.Factory.addGetterSetter(Kinetic.Node,"rotation",0),Kinetic.Factory.addComponentsGetterSetter(Kinetic.Node,"scale",["x","y"]),Kinetic.Factory.addGetterSetter(Kinetic.Node,"scaleX",1),Kinetic.Factory.addGetterSetter(Kinetic.Node,"scaleY",1),Kinetic.Factory.addComponentsGetterSetter(Kinetic.Node,"skew",["x","y"]),Kinetic.Factory.addGetterSetter(Kinetic.Node,"skewX",0),Kinetic.Factory.addGetterSetter(Kinetic.Node,"skewY",0),Kinetic.Factory.addComponentsGetterSetter(Kinetic.Node,"offset",["x","y"]),Kinetic.Factory.addGetterSetter(Kinetic.Node,"offsetX",0),Kinetic.Factory.addGetterSetter(Kinetic.Node,"offsetY",0),Kinetic.Factory.addSetter(Kinetic.Node,"dragDistance"),Kinetic.Factory.addOverloadedGetterSetter(Kinetic.Node,"dragDistance"),Kinetic.Factory.addSetter(Kinetic.Node,"width",0),Kinetic.Factory.addOverloadedGetterSetter(Kinetic.Node,"width"),Kinetic.Factory.addSetter(Kinetic.Node,"height",0),Kinetic.Factory.addOverloadedGetterSetter(Kinetic.Node,"height"),Kinetic.Factory.addGetterSetter(Kinetic.Node,"listening","inherit"),Kinetic.Factory.addGetterSetter(Kinetic.Node,"filters",void 0,function(a){return this._filterUpToDate=!1,a}),Kinetic.Factory.addGetterSetter(Kinetic.Node,"visible","inherit"),Kinetic.Factory.addGetterSetter(Kinetic.Node,"transformsEnabled","all"),Kinetic.Factory.addOverloadedGetterSetter(Kinetic.Node,"size"),Kinetic.Factory.backCompat(Kinetic.Node,{rotateDeg:"rotate",setRotationDeg:"setRotation",getRotationDeg:"getRotation"}),Kinetic.Collection.mapMethods(Kinetic.Node)}(),function(){Kinetic.Filters.Grayscale=function(a){var b,c,d=a.data,e=d.length;for(b=0;e>b;b+=4)c=.34*d[b]+.5*d[b+1]+.16*d[b+2],d[b]=c,d[b+1]=c,d[b+2]=c}}(),function(){Kinetic.Filters.Brighten=function(a){var b,c=255*this.brightness(),d=a.data,e=d.length;for(b=0;e>b;b+=4)d[b]+=c,d[b+1]+=c,d[b+2]+=c},Kinetic.Factory.addGetterSetter(Kinetic.Node,"brightness",0,null,Kinetic.Factory.afterSetFilter)}(),function(){Kinetic.Filters.Invert=function(a){var b,c=a.data,d=c.length;for(b=0;d>b;b+=4)c[b]=255-c[b],c[b+1]=255-c[b+1],c[b+2]=255-c[b+2]}}(),function(){function a(){this.r=0,this.g=0,this.b=0,this.a=0,this.next=null}function b(b,e){var f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D=b.data,E=b.width,F=b.height,G=e+e+1,H=E-1,I=F-1,J=e+1,K=J*(J+1)/2,L=new a,M=null,N=L,O=null,P=null,Q=c[e],R=d[e];for(h=1;G>h;h++)N=N.next=new a,h==J&&(M=N);for(N.next=L,l=k=0,g=0;F>g;g++){for(u=v=w=x=m=n=o=p=0,q=J*(y=D[k]),r=J*(z=D[k+1]),s=J*(A=D[k+2]),t=J*(B=D[k+3]),m+=K*y,n+=K*z,o+=K*A,p+=K*B,N=L,h=0;J>h;h++)N.r=y,N.g=z,N.b=A,N.a=B,N=N.next;for(h=1;J>h;h++)i=k+((h>H?H:h)<<2),m+=(N.r=y=D[i])*(C=J-h),n+=(N.g=z=D[i+1])*C,o+=(N.b=A=D[i+2])*C,p+=(N.a=B=D[i+3])*C,u+=y,v+=z,w+=A,x+=B,N=N.next;for(O=L,P=M,f=0;E>f;f++)D[k+3]=B=p*Q>>R,0!==B?(B=255/B,D[k]=(m*Q>>R)*B,D[k+1]=(n*Q>>R)*B,D[k+2]=(o*Q>>R)*B):D[k]=D[k+1]=D[k+2]=0,m-=q,n-=r,o-=s,p-=t,q-=O.r,r-=O.g,s-=O.b,t-=O.a,i=l+((i=f+e+1)<H?i:H)<<2,u+=O.r=D[i],v+=O.g=D[i+1],w+=O.b=D[i+2],x+=O.a=D[i+3],m+=u,n+=v,o+=w,p+=x,O=O.next,q+=y=P.r,r+=z=P.g,s+=A=P.b,t+=B=P.a,u-=y,v-=z,w-=A,x-=B,P=P.next,k+=4;l+=E}for(f=0;E>f;f++){for(v=w=x=u=n=o=p=m=0,k=f<<2,q=J*(y=D[k]),r=J*(z=D[k+1]),s=J*(A=D[k+2]),t=J*(B=D[k+3]),m+=K*y,n+=K*z,o+=K*A,p+=K*B,N=L,h=0;J>h;h++)N.r=y,N.g=z,N.b=A,N.a=B,N=N.next;for(j=E,h=1;e>=h;h++)k=j+f<<2,m+=(N.r=y=D[k])*(C=J-h),n+=(N.g=z=D[k+1])*C,o+=(N.b=A=D[k+2])*C,p+=(N.a=B=D[k+3])*C,u+=y,v+=z,w+=A,x+=B,N=N.next,I>h&&(j+=E);for(k=f,O=L,P=M,g=0;F>g;g++)i=k<<2,D[i+3]=B=p*Q>>R,B>0?(B=255/B,D[i]=(m*Q>>R)*B,D[i+1]=(n*Q>>R)*B,D[i+2]=(o*Q>>R)*B):D[i]=D[i+1]=D[i+2]=0,m-=q,n-=r,o-=s,p-=t,q-=O.r,r-=O.g,s-=O.b,t-=O.a,i=f+((i=g+J)<I?i:I)*E<<2,m+=u+=O.r=D[i],n+=v+=O.g=D[i+1],o+=w+=O.b=D[i+2],p+=x+=O.a=D[i+3],O=O.next,q+=y=P.r,r+=z=P.g,s+=A=P.b,t+=B=P.a,u-=y,v-=z,w-=A,x-=B,P=P.next,k+=E}}var c=[512,512,456,512,328,456,335,512,405,328,271,456,388,335,292,512,454,405,364,328,298,271,496,456,420,388,360,335,312,292,273,512,482,454,428,405,383,364,345,328,312,298,284,271,259,496,475,456,437,420,404,388,374,360,347,335,323,312,302,292,282,273,265,512,497,482,468,454,441,428,417,405,394,383,373,364,354,345,337,328,320,312,305,298,291,284,278,271,265,259,507,496,485,475,465,456,446,437,428,420,412,404,396,388,381,374,367,360,354,347,341,335,329,323,318,312,307,302,297,292,287,282,278,273,269,265,261,512,505,497,489,482,475,468,461,454,447,441,435,428,422,417,411,405,399,394,389,383,378,373,368,364,359,354,350,345,341,337,332,328,324,320,316,312,309,305,301,298,294,291,287,284,281,278,274,271,268,265,262,259,257,507,501,496,491,485,480,475,470,465,460,456,451,446,442,437,433,428,424,420,416,412,408,404,400,396,392,388,385,381,377,374,370,367,363,360,357,354,350,347,344,341,338,335,332,329,326,323,320,318,315,312,310,307,304,302,299,297,294,292,289,287,285,282,280,278,275,273,271,269,267,265,263,261,259],d=[9,11,12,13,13,14,14,15,15,15,15,16,16,16,16,17,17,17,17,17,17,17,18,18,18,18,18,18,18,18,18,19,19,19,19,19,19,19,19,19,19,19,19,19,19,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24];Kinetic.Filters.Blur=function(a){var c=Math.round(this.blurRadius());c>0&&b(a,c)},Kinetic.Factory.addGetterSetter(Kinetic.Node,"blurRadius",0,null,Kinetic.Factory.afterSetFilter)}(),function(){function a(a,b,c){var d=4*(c*a.width+b),e=[];return e.push(a.data[d++],a.data[d++],a.data[d++],a.data[d++]),e}function b(a,b){return Math.sqrt(Math.pow(a[0]-b[0],2)+Math.pow(a[1]-b[1],2)+Math.pow(a[2]-b[2],2))}function c(a){for(var b=[0,0,0],c=0;c<a.length;c++)b[0]+=a[c][0],b[1]+=a[c][1],b[2]+=a[c][2];return b[0]/=a.length,b[1]/=a.length,b[2]/=a.length,b}function d(d,e){var f=a(d,0,0),g=a(d,d.width-1,0),h=a(d,0,d.height-1),i=a(d,d.width-1,d.height-1),j=e||10;if(b(f,g)<j&&b(g,i)<j&&b(i,h)<j&&b(h,f)<j){for(var k=c([g,f,i,h]),l=[],m=0;m<d.width*d.height;m++){var n=b(k,[d.data[4*m],d.data[4*m+1],d.data[4*m+2]]);l[m]=j>n?0:255}return l}}function e(a,b){for(var c=0;c<a.width*a.height;c++)a.data[4*c+3]=b[c]}function f(a,b,c){for(var d=[1,1,1,1,0,1,1,1,1],e=Math.round(Math.sqrt(d.length)),f=Math.floor(e/2),g=[],h=0;c>h;h++)for(var i=0;b>i;i++){for(var j=h*b+i,k=0,l=0;e>l;l++)for(var m=0;e>m;m++){var n=h+l-f,o=i+m-f;if(n>=0&&c>n&&o>=0&&b>o){var p=n*b+o,q=d[l*e+m];k+=a[p]*q}}g[j]=2040===k?255:0}return g}function g(a,b,c){for(var d=[1,1,1,1,1,1,1,1,1],e=Math.round(Math.sqrt(d.length)),f=Math.floor(e/2),g=[],h=0;c>h;h++)for(var i=0;b>i;i++){for(var j=h*b+i,k=0,l=0;e>l;l++)for(var m=0;e>m;m++){var n=h+l-f,o=i+m-f;if(n>=0&&c>n&&o>=0&&b>o){var p=n*b+o,q=d[l*e+m];k+=a[p]*q}}g[j]=k>=1020?255:0}return g}function h(a,b,c){for(var d=[1/9,1/9,1/9,1/9,1/9,1/9,1/9,1/9,1/9],e=Math.round(Math.sqrt(d.length)),f=Math.floor(e/2),g=[],h=0;c>h;h++)for(var i=0;b>i;i++){for(var j=h*b+i,k=0,l=0;e>l;l++)for(var m=0;e>m;m++){var n=h+l-f,o=i+m-f;if(n>=0&&c>n&&o>=0&&b>o){var p=n*b+o,q=d[l*e+m];k+=a[p]*q}}g[j]=k}return g}Kinetic.Filters.Mask=function(a){var b=this.threshold(),c=d(a,b);return c&&(c=f(c,a.width,a.height),c=g(c,a.width,a.height),c=h(c,a.width,a.height),e(a,c)),a},Kinetic.Factory.addGetterSetter(Kinetic.Node,"threshold",0,null,Kinetic.Factory.afterSetFilter)}(),function(){Kinetic.Filters.RGB=function(a){var b,c,d=a.data,e=d.length,f=this.red(),g=this.green(),h=this.blue();for(b=0;e>b;b+=4)c=(.34*d[b]+.5*d[b+1]+.16*d[b+2])/255,d[b]=c*f,d[b+1]=c*g,d[b+2]=c*h,d[b+3]=d[b+3]},Kinetic.Factory.addGetterSetter(Kinetic.Node,"red",0,function(a){return this._filterUpToDate=!1,a>255?255:0>a?0:Math.round(a)}),Kinetic.Factory.addGetterSetter(Kinetic.Node,"green",0,function(a){return this._filterUpToDate=!1,a>255?255:0>a?0:Math.round(a)}),Kinetic.Factory.addGetterSetter(Kinetic.Node,"blue",0,Kinetic.Validators.RGBComponent,Kinetic.Factory.afterSetFilter)}(),function(){Kinetic.Filters.HSV=function(a){var b,c,d,e,f,g=a.data,h=g.length,i=Math.pow(2,this.value()),j=Math.pow(2,this.saturation()),k=Math.abs(this.hue()+360)%360,l=i*j*Math.cos(k*Math.PI/180),m=i*j*Math.sin(k*Math.PI/180),n=.299*i+.701*l+.167*m,o=.587*i-.587*l+.33*m,p=.114*i-.114*l-.497*m,q=.299*i-.299*l-.328*m,r=.587*i+.413*l+.035*m,s=.114*i-.114*l+.293*m,t=.299*i-.3*l+1.25*m,u=.587*i-.586*l-1.05*m,v=.114*i+.886*l-.2*m;for(b=0;h>b;b+=4)c=g[b+0],d=g[b+1],e=g[b+2],f=g[b+3],g[b+0]=n*c+o*d+p*e,g[b+1]=q*c+r*d+s*e,g[b+2]=t*c+u*d+v*e,g[b+3]=f},Kinetic.Factory.addGetterSetter(Kinetic.Node,"hue",0,null,Kinetic.Factory.afterSetFilter),Kinetic.Factory.addGetterSetter(Kinetic.Node,"saturation",0,null,Kinetic.Factory.afterSetFilter),Kinetic.Factory.addGetterSetter(Kinetic.Node,"value",0,null,Kinetic.Factory.afterSetFilter)}(),function(){Kinetic.Factory.addGetterSetter(Kinetic.Node,"hue",0,null,Kinetic.Factory.afterSetFilter),Kinetic.Factory.addGetterSetter(Kinetic.Node,"saturation",0,null,Kinetic.Factory.afterSetFilter),Kinetic.Factory.addGetterSetter(Kinetic.Node,"luminance",0,null,Kinetic.Factory.afterSetFilter),Kinetic.Filters.HSL=function(a){var b,c,d,e,f,g=a.data,h=g.length,i=1,j=Math.pow(2,this.saturation()),k=Math.abs(this.hue()+360)%360,l=127*this.luminance(),m=i*j*Math.cos(k*Math.PI/180),n=i*j*Math.sin(k*Math.PI/180),o=.299*i+.701*m+.167*n,p=.587*i-.587*m+.33*n,q=.114*i-.114*m-.497*n,r=.299*i-.299*m-.328*n,s=.587*i+.413*m+.035*n,t=.114*i-.114*m+.293*n,u=.299*i-.3*m+1.25*n,v=.587*i-.586*m-1.05*n,w=.114*i+.886*m-.2*n;for(b=0;h>b;b+=4)c=g[b+0],d=g[b+1],e=g[b+2],f=g[b+3],g[b+0]=o*c+p*d+q*e+l,g[b+1]=r*c+s*d+t*e+l,g[b+2]=u*c+v*d+w*e+l,g[b+3]=f}}(),function(){Kinetic.Filters.Emboss=function(a){var b=10*this.embossStrength(),c=255*this.embossWhiteLevel(),d=this.embossDirection(),e=this.embossBlend(),f=0,g=0,h=a.data,i=a.width,j=a.height,k=4*i,l=j;switch(d){case"top-left":f=-1,g=-1;break;case"top":f=-1,g=0;break;case"top-right":f=-1,g=1;break;case"right":f=0,g=1;break;case"bottom-right":f=1,g=1;break;case"bottom":f=1,g=0;break;case"bottom-left":f=1,g=-1;break;case"left":f=0,g=-1}do{var m=(l-1)*k,n=f;1>l+n&&(n=0),l+n>j&&(n=0);var o=(l-1+n)*i*4,p=i;do{var q=m+4*(p-1),r=g;1>p+r&&(r=0),p+r>i&&(r=0);var s=o+4*(p-1+r),t=h[q]-h[s],u=h[q+1]-h[s+1],v=h[q+2]-h[s+2],w=t,x=w>0?w:-w,y=u>0?u:-u,z=v>0?v:-v;if(y>x&&(w=u),z>x&&(w=v),w*=b,e){var A=h[q]+w,B=h[q+1]+w,C=h[q+2]+w;h[q]=A>255?255:0>A?0:A,h[q+1]=B>255?255:0>B?0:B,h[q+2]=C>255?255:0>C?0:C}else{var D=c-w;0>D?D=0:D>255&&(D=255),h[q]=h[q+1]=h[q+2]=D}}while(--p)}while(--l)},Kinetic.Factory.addGetterSetter(Kinetic.Node,"embossStrength",.5,null,Kinetic.Factory.afterSetFilter),Kinetic.Factory.addGetterSetter(Kinetic.Node,"embossWhiteLevel",.5,null,Kinetic.Factory.afterSetFilter),Kinetic.Factory.addGetterSetter(Kinetic.Node,"embossDirection","top-left",null,Kinetic.Factory.afterSetFilter),Kinetic.Factory.addGetterSetter(Kinetic.Node,"embossBlend",!1,null,Kinetic.Factory.afterSetFilter)}(),function(){function a(a,b,c,d,e){var f,g=c-b,h=e-d;return 0===g?d+h/2:0===h?d:(f=(a-b)/g,f=h*f+d)}Kinetic.Filters.Enhance=function(b){var c,d,e,f,g=b.data,h=g.length,i=g[0],j=i,k=g[1],l=k,m=g[2],n=m,o=g[3],p=o,q=this.enhance();if(0!==q){for(f=0;h>f;f+=4)c=g[f+0],i>c?i=c:c>j&&(j=c),d=g[f+1],k>d?k=d:d>l&&(l=d),e=g[f+2],m>e?m=e:e>n&&(n=e);j===i&&(j=255,i=0),l===k&&(l=255,k=0),n===m&&(n=255,m=0),p===o&&(p=255,o=0);var r,s,t,u,v,w,x,y,z,A,B,C;for(q>0?(s=j+q*(255-j),t=i-q*(i-0),v=l+q*(255-l),w=k-q*(k-0),y=n+q*(255-n),C=m-q*(m-0),B=p+q*(255-p),z=o-q*(o-0)):(r=.5*(j+i),s=j+q*(j-r),t=i+q*(i-r),u=.5*(l+k),v=l+q*(l-u),w=k+q*(k-u),x=.5*(n+m),y=n+q*(n-x),C=m+q*(m-x),A=.5*(p+o),B=p+q*(p-A),z=o+q*(o-A)),f=0;h>f;f+=4)g[f+0]=a(g[f+0],i,j,t,s),g[f+1]=a(g[f+1],k,l,w,v),g[f+2]=a(g[f+2],m,n,C,y)}},Kinetic.Factory.addGetterSetter(Kinetic.Node,"enhance",0,null,Kinetic.Factory.afterSetFilter)}(),function(){Kinetic.Filters.Posterize=function(a){var b,c=Math.round(254*this.levels())+1,d=a.data,e=d.length,f=255/c;for(b=0;e>b;b+=1)d[b]=Math.floor(d[b]/f)*f},Kinetic.Factory.addGetterSetter(Kinetic.Node,"levels",.5,null,Kinetic.Factory.afterSetFilter)}(),function(){Kinetic.Filters.Noise=function(a){var b,c=255*this.noise(),d=a.data,e=d.length,f=c/2;for(b=0;e>b;b+=4)d[b+0]+=f-2*f*Math.random(),d[b+1]+=f-2*f*Math.random(),d[b+2]+=f-2*f*Math.random()},Kinetic.Factory.addGetterSetter(Kinetic.Node,"noise",.2,null,Kinetic.Factory.afterSetFilter)}(),function(){Kinetic.Filters.Pixelate=function(a){var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p=Math.ceil(this.pixelSize()),q=a.width,r=a.height,s=Math.ceil(q/p),t=Math.ceil(r/p);for(a=a.data,m=0;s>m;m+=1)for(n=0;t>n;n+=1){for(e=0,f=0,g=0,h=0,i=m*p,j=i+p,k=n*p,l=k+p,o=0,b=i;j>b;b+=1)if(!(b>=q))for(c=k;l>c;c+=1)c>=r||(d=4*(q*c+b),e+=a[d+0],f+=a[d+1],g+=a[d+2],h+=a[d+3],o+=1);for(e/=o,f/=o,g/=o,b=i;j>b;b+=1)if(!(b>=q))for(c=k;l>c;c+=1)c>=r||(d=4*(q*c+b),a[d+0]=e,a[d+1]=f,a[d+2]=g,a[d+3]=h)}},Kinetic.Factory.addGetterSetter(Kinetic.Node,"pixelSize",8,null,Kinetic.Factory.afterSetFilter)}(),function(){Kinetic.Filters.Threshold=function(a){var b,c=255*this.threshold(),d=a.data,e=d.length;for(b=0;e>b;b+=1)d[b]=d[b]<c?0:255},Kinetic.Factory.addGetterSetter(Kinetic.Node,"threshold",.5,null,Kinetic.Factory.afterSetFilter)}(),function(){Kinetic.Filters.Sepia=function(a){var b,c,d,e,f,g,h,i,j,k=a.data,l=a.width,m=a.height,n=4*l;do{b=(m-1)*n,c=l;do d=b+4*(c-1),e=k[d],f=k[d+1],g=k[d+2],h=.393*e+.769*f+.189*g,i=.349*e+.686*f+.168*g,j=.272*e+.534*f+.131*g,k[d]=h>255?255:h,k[d+1]=i>255?255:i,k[d+2]=j>255?255:j,k[d+3]=k[d+3];while(--c)}while(--m)}}(),function(){Kinetic.Filters.Solarize=function(a){var b=a.data,c=a.width,d=a.height,e=4*c,f=d;do{var g=(f-1)*e,h=c;do{var i=g+4*(h-1),j=b[i],k=b[i+1],l=b[i+2];j>127&&(j=255-j),k>127&&(k=255-k),l>127&&(l=255-l),b[i]=j,b[i+1]=k,b[i+2]=l}while(--h)}while(--f)}}(),function(){var a=function(a,b,c){var d,e,f,g,h=a.data,i=b.data,j=a.width,k=a.height,l=c.polarCenterX||j/2,m=c.polarCenterY||k/2,n=0,o=0,p=0,q=0,r=Math.sqrt(l*l+m*m);e=j-l,f=k-m,g=Math.sqrt(e*e+f*f),r=g>r?g:r;var s,t,u,v,w=k,x=j,y=360/x*Math.PI/180;for(t=0;x>t;t+=1)for(u=Math.sin(t*y),v=Math.cos(t*y),s=0;w>s;s+=1)e=Math.floor(l+r*s/w*v),f=Math.floor(m+r*s/w*u),d=4*(f*j+e),n=h[d+0],o=h[d+1],p=h[d+2],q=h[d+3],d=4*(t+s*j),i[d+0]=n,i[d+1]=o,i[d+2]=p,i[d+3]=q},b=function(a,b,c){var d,e,f,g,h,i,j=a.data,k=b.data,l=a.width,m=a.height,n=c.polarCenterX||l/2,o=c.polarCenterY||m/2,p=0,q=0,r=0,s=0,t=Math.sqrt(n*n+o*o);e=l-n,f=m-o,i=Math.sqrt(e*e+f*f),t=i>t?i:t;var u,v,w,x,y=m,z=l,A=c.polarRotation||0;for(e=0;l>e;e+=1)for(f=0;m>f;f+=1)g=e-n,h=f-o,u=Math.sqrt(g*g+h*h)*y/t,v=(180*Math.atan2(h,g)/Math.PI+360+A)%360,v=v*z/360,w=Math.floor(v),x=Math.floor(u),d=4*(x*l+w),p=j[d+0],q=j[d+1],r=j[d+2],s=j[d+3],d=4*(f*l+e),k[d+0]=p,k[d+1]=q,k[d+2]=r,k[d+3]=s},c=Kinetic.Util.createCanvasElement();Kinetic.Filters.Kaleidoscope=function(d){var e,f,g,h,i,j,k,l,m,n,o=d.width,p=d.height,q=Math.round(this.kaleidoscopePower()),r=Math.round(this.kaleidoscopeAngle()),s=Math.floor(o*(r%360)/360);if(!(1>q)){c.width=o,c.height=p;var t=c.getContext("2d").getImageData(0,0,o,p);a(d,t,{polarCenterX:o/2,polarCenterY:p/2});for(var u=o/Math.pow(2,q);8>=u;)u=2*u,q-=1;u=Math.ceil(u);var v=u,w=0,x=v,y=1;for(s+u>o&&(w=v,x=0,y=-1),f=0;p>f;f+=1)for(e=w;e!==x;e+=y)g=Math.round(e+s)%o,m=4*(o*f+g),i=t.data[m+0],j=t.data[m+1],k=t.data[m+2],l=t.data[m+3],n=4*(o*f+e),t.data[n+0]=i,t.data[n+1]=j,t.data[n+2]=k,t.data[n+3]=l;for(f=0;p>f;f+=1)for(v=Math.floor(u),h=0;q>h;h+=1){for(e=0;v+1>e;e+=1)m=4*(o*f+e),i=t.data[m+0],j=t.data[m+1],k=t.data[m+2],l=t.data[m+3],n=4*(o*f+2*v-e-1),t.data[n+0]=i,t.data[n+1]=j,t.data[n+2]=k,t.data[n+3]=l;v*=2}b(t,d,{polarRotation:0})}},Kinetic.Factory.addGetterSetter(Kinetic.Node,"kaleidoscopePower",2,null,Kinetic.Factory.afterSetFilter),Kinetic.Factory.addGetterSetter(Kinetic.Node,"kaleidoscopeAngle",0,null,Kinetic.Factory.afterSetFilter)}(),function(){function a(a){Kinetic.root.setTimeout(a,1e3/60)}function b(){return e.apply(Kinetic.root,arguments)}var c=500,d=function(){return Kinetic.root.performance&&Kinetic.root.performance.now?function(){return Kinetic.root.performance.now()}:function(){return(new Date).getTime()}}(),e=function(){return Kinetic.root.requestAnimationFrame||Kinetic.root.webkitRequestAnimationFrame||Kinetic.root.mozRequestAnimationFrame||Kinetic.root.oRequestAnimationFrame||Kinetic.root.msRequestAnimationFrame||a}();Kinetic.Animation=function(a,b){var c=Kinetic.Animation;this.func=a,this.setLayers(b),this.id=c.animIdCounter++,this.frame={time:0,timeDiff:0,lastTime:d()}},Kinetic.Animation.prototype={setLayers:function(a){var b=[];b=a?a.length>0?a:[a]:[],this.layers=b},getLayers:function(){return this.layers},addLayer:function(a){var b,c,d=this.layers;if(d){for(b=d.length,c=0;b>c;c++)if(d[c]._id===a._id)return!1}else this.layers=[];return this.layers.push(a),!0},isRunning:function(){var a,b=Kinetic.Animation,c=b.animations,d=c.length;for(a=0;d>a;a++)if(c[a].id===this.id)return!0;return!1},start:function(){var a=Kinetic.Animation;this.stop(),this.frame.timeDiff=0,this.frame.lastTime=d(),a._addAnimation(this)},stop:function(){Kinetic.Animation._removeAnimation(this)},_updateFrameObject:function(a){this.frame.timeDiff=a-this.frame.lastTime,this.frame.lastTime=a,this.frame.time+=this.frame.timeDiff,this.frame.frameRate=1e3/this.frame.timeDiff}},Kinetic.Animation.animations=[],Kinetic.Animation.animIdCounter=0,Kinetic.Animation.animRunning=!1,Kinetic.Animation._addAnimation=function(a){this.animations.push(a),this._handleAnimation()},Kinetic.Animation._removeAnimation=function(a){var b,c=a.id,d=this.animations,e=d.length;for(b=0;e>b;b++)if(d[b].id===c){this.animations.splice(b,1);break}},Kinetic.Animation._runFrames=function(){var a,b,c,e,f,g,h,i,j={},k=this.animations;for(e=0;e<k.length;e++){for(a=k[e],b=a.layers,c=a.func,a._updateFrameObject(d()),g=b.length,f=0;g>f;f++)h=b[f],void 0!==h._id&&(j[h._id]=h);c&&c.call(a,a.frame)}for(i in j)j[i].draw()},Kinetic.Animation._animationLoop=function(){var a=Kinetic.Animation;a.animations.length?(b(a._animationLoop),a._runFrames()):a.animRunning=!1},Kinetic.Animation._handleAnimation=function(){var a=this;this.animRunning||(this.animRunning=!0,a._animationLoop())};var f=Kinetic.Node.prototype.moveTo;Kinetic.Node.prototype.moveTo=function(a){f.call(this,a)},Kinetic.Layer.prototype.batchDraw=function(){var a=this,b=Kinetic.Animation;this.batchAnim||(this.batchAnim=new b(function(){a.lastBatchDrawTime&&d()-a.lastBatchDrawTime>c&&a.batchAnim.stop()},this)),this.lastBatchDrawTime=d(),this.batchAnim.isRunning()||(this.draw(),this.batchAnim.start())},Kinetic.Stage.prototype.batchDraw=function(){this.getChildren().each(function(a){a.batchDraw()})}}((1,eval)("this")),function(){var a={node:1,duration:1,easing:1,onFinish:1,yoyo:1},b=1,c=2,d=3,e=0;Kinetic.Tween=function(b){var c,d=this,g=b.node,h=g._id,i=b.duration||1,j=b.easing||Kinetic.Easings.Linear,k=!!b.yoyo;this.node=g,this._id=e++,this.anim=new Kinetic.Animation(function(){d.tween.onEnterFrame()},g.getLayer()),this.tween=new f(c,function(a){d._tweenFunc(a)},j,0,1,1e3*i,k),this._addListeners(),Kinetic.Tween.attrs[h]||(Kinetic.Tween.attrs[h]={}),Kinetic.Tween.attrs[h][this._id]||(Kinetic.Tween.attrs[h][this._id]={}),Kinetic.Tween.tweens[h]||(Kinetic.Tween.tweens[h]={});for(c in b)void 0===a[c]&&this._addAttr(c,b[c]);this.reset(),this.onFinish=b.onFinish,this.onReset=b.onReset},Kinetic.Tween.attrs={},Kinetic.Tween.tweens={},Kinetic.Tween.prototype={_addAttr:function(a,b){var c,d,e,f,g,h=this.node,i=h._id;if(e=Kinetic.Tween.tweens[i][a],e&&delete Kinetic.Tween.attrs[i][e][a],c=h.getAttr(a),Kinetic.Util._isArray(b))for(d=[],g=b.length,f=0;g>f;f++)d.push(b[f]-c[f]);else d=b-c;Kinetic.Tween.attrs[i][this._id][a]={start:c,diff:d},Kinetic.Tween.tweens[i][a]=this._id},_tweenFunc:function(a){var b,c,d,e,f,g,h,i=this.node,j=Kinetic.Tween.attrs[i._id][this._id];for(b in j){if(c=j[b],d=c.start,e=c.diff,Kinetic.Util._isArray(d))for(f=[],h=d.length,g=0;h>g;g++)f.push(d[g]+e[g]*a);else f=d+e*a;i.setAttr(b,f)}},_addListeners:function(){var a=this;this.tween.onPlay=function(){a.anim.start()},this.tween.onReverse=function(){a.anim.start()},this.tween.onPause=function(){a.anim.stop()},this.tween.onFinish=function(){a.onFinish&&a.onFinish()},this.tween.onReset=function(){a.onReset&&a.onReset()}},play:function(){return this.tween.play(),this},reverse:function(){return this.tween.reverse(),this},reset:function(){this.node;return this.tween.reset(),this},seek:function(a){this.node;return this.tween.seek(1e3*a),this},pause:function(){return this.tween.pause(),this},finish:function(){this.node;return this.tween.finish(),this},destroy:function(){var a,b=this.node._id,c=this._id,d=Kinetic.Tween.tweens[b];this.pause();for(a in d)delete Kinetic.Tween.tweens[b][a];delete Kinetic.Tween.attrs[b][c]}};var f=function(a,b,c,d,e,f,g){this.prop=a,this.propFunc=b,this.begin=d,this._pos=d,this.duration=f,this._change=0,this.prevPos=0,this.yoyo=g,this._time=0,this._position=0,this._startTime=0,this._finish=0,this.func=c,this._change=e-this.begin,this.pause()};f.prototype={fire:function(a){var b=this[a];b&&b()},setTime:function(a){a>this.duration?this.yoyo?(this._time=this.duration,this.reverse()):this.finish():0>a?this.yoyo?(this._time=0,this.play()):this.reset():(this._time=a,this.update())},getTime:function(){return this._time},setPosition:function(a){this.prevPos=this._pos,this.propFunc(a),this._pos=a},getPosition:function(a){return void 0===a&&(a=this._time),this.func(a,this.begin,this._change,this.duration)},play:function(){this.state=c,this._startTime=this.getTimer()-this._time,this.onEnterFrame(),this.fire("onPlay")},reverse:function(){this.state=d,this._time=this.duration-this._time,this._startTime=this.getTimer()-this._time,this.onEnterFrame(),this.fire("onReverse")},seek:function(a){this.pause(),this._time=a,this.update(),this.fire("onSeek")},reset:function(){this.pause(),this._time=0,this.update(),this.fire("onReset")},finish:function(){this.pause(),this._time=this.duration,this.update(),this.fire("onFinish")},update:function(){this.setPosition(this.getPosition(this._time))},onEnterFrame:function(){var a=this.getTimer()-this._startTime;this.state===c?this.setTime(a):this.state===d&&this.setTime(this.duration-a)},pause:function(){this.state=b,this.fire("onPause")},getTimer:function(){return(new Date).getTime()}},Kinetic.Easings={BackEaseIn:function(a,b,c,d){var e=1.70158;return c*(a/=d)*a*((e+1)*a-e)+b},BackEaseOut:function(a,b,c,d){var e=1.70158;return c*((a=a/d-1)*a*((e+1)*a+e)+1)+b},BackEaseInOut:function(a,b,c,d){var e=1.70158;return(a/=d/2)<1?c/2*a*a*(((e*=1.525)+1)*a-e)+b:c/2*((a-=2)*a*(((e*=1.525)+1)*a+e)+2)+b},ElasticEaseIn:function(a,b,c,d,e,f){var g=0;return 0===a?b:1==(a/=d)?b+c:(f||(f=.3*d),!e||e<Math.abs(c)?(e=c,g=f/4):g=f/(2*Math.PI)*Math.asin(c/e),-(e*Math.pow(2,10*(a-=1))*Math.sin(2*(a*d-g)*Math.PI/f))+b)},ElasticEaseOut:function(a,b,c,d,e,f){var g=0;return 0===a?b:1==(a/=d)?b+c:(f||(f=.3*d),!e||e<Math.abs(c)?(e=c,g=f/4):g=f/(2*Math.PI)*Math.asin(c/e),e*Math.pow(2,-10*a)*Math.sin(2*(a*d-g)*Math.PI/f)+c+b)},ElasticEaseInOut:function(a,b,c,d,e,f){var g=0;return 0===a?b:2==(a/=d/2)?b+c:(f||(f=.3*d*1.5),!e||e<Math.abs(c)?(e=c,g=f/4):g=f/(2*Math.PI)*Math.asin(c/e),1>a?-.5*e*Math.pow(2,10*(a-=1))*Math.sin(2*(a*d-g)*Math.PI/f)+b:e*Math.pow(2,-10*(a-=1))*Math.sin(2*(a*d-g)*Math.PI/f)*.5+c+b)},BounceEaseOut:function(a,b,c,d){return(a/=d)<1/2.75?7.5625*c*a*a+b:2/2.75>a?c*(7.5625*(a-=1.5/2.75)*a+.75)+b:2.5/2.75>a?c*(7.5625*(a-=2.25/2.75)*a+.9375)+b:c*(7.5625*(a-=2.625/2.75)*a+.984375)+b},BounceEaseIn:function(a,b,c,d){return c-Kinetic.Easings.BounceEaseOut(d-a,0,c,d)+b},BounceEaseInOut:function(a,b,c,d){return d/2>a?.5*Kinetic.Easings.BounceEaseIn(2*a,0,c,d)+b:.5*Kinetic.Easings.BounceEaseOut(2*a-d,0,c,d)+.5*c+b},EaseIn:function(a,b,c,d){return c*(a/=d)*a+b},EaseOut:function(a,b,c,d){return-c*(a/=d)*(a-2)+b},EaseInOut:function(a,b,c,d){return(a/=d/2)<1?c/2*a*a+b:-c/2*(--a*(a-2)-1)+b},StrongEaseIn:function(a,b,c,d){return c*(a/=d)*a*a*a*a+b},StrongEaseOut:function(a,b,c,d){return c*((a=a/d-1)*a*a*a*a+1)+b},StrongEaseInOut:function(a,b,c,d){return(a/=d/2)<1?c/2*a*a*a*a*a+b:c/2*((a-=2)*a*a*a*a+2)+b},Linear:function(a,b,c,d){return c*a/d+b}}}(),function(){Kinetic.DD={anim:new Kinetic.Animation,isDragging:!1,offset:{x:0,y:0},node:null,_drag:function(a){var b=Kinetic.DD,c=b.node;if(c){if(!b.isDragging){var d=c.getStage().getPointerPosition(),e=c.dragDistance(),f=Math.max(Math.abs(d.x-b.startPointerPos.x),Math.abs(d.y-b.startPointerPos.y));if(e>f)return}c._setDragPosition(a),b.isDragging||(b.isDragging=!0,c.fire("dragstart",{type:"dragstart",target:c,evt:a},!0)),c.fire("dragmove",{type:"dragmove",target:c,evt:a},!0)}},_endDragBefore:function(a){var b,c,d=Kinetic.DD,e=d.node;e&&(b=e.nodeType,c=e.getLayer(),d.anim.stop(),d.isDragging&&(d.isDragging=!1,Kinetic.listenClickTap=!1,a&&(a.dragEndNode=e)),delete d.node,(c||e).draw())},_endDragAfter:function(a){a=a||{};var b=a.dragEndNode;a&&b&&b.fire("dragend",{type:"dragend",target:b,evt:a},!0)}},Kinetic.Node.prototype.startDrag=function(){var a=Kinetic.DD,b=this.getStage(),c=this.getLayer(),d=b.getPointerPosition(),e=this.getAbsolutePosition();d&&(a.node&&a.node.stopDrag(),a.node=this,a.startPointerPos=d,a.offset.x=d.x-e.x,a.offset.y=d.y-e.y,a.anim.setLayers(c||this.getLayers()),a.anim.start(),this._setDragPosition())},Kinetic.Node.prototype._setDragPosition=function(a){var b=Kinetic.DD,c=this.getStage().getPointerPosition(),d=this.getDragBoundFunc();if(c){var e={x:c.x-b.offset.x,y:c.y-b.offset.y};void 0!==d&&(e=d.call(this,e,a)),this.setAbsolutePosition(e)}},Kinetic.Node.prototype.stopDrag=function(){var a=Kinetic.DD,b={};a._endDragBefore(b),a._endDragAfter(b)},Kinetic.Node.prototype.setDraggable=function(a){this._setAttr("draggable",a),this._dragChange()};var a=Kinetic.Node.prototype.destroy;Kinetic.Node.prototype.destroy=function(){var b=Kinetic.DD;b.node&&b.node._id===this._id&&this.stopDrag(),a.call(this)},Kinetic.Node.prototype.isDragging=function(){var a=Kinetic.DD;return a.node&&a.node._id===this._id&&a.isDragging},Kinetic.Node.prototype._listenDrag=function(){var a=this;this._dragCleanup(),"Stage"===this.getClassName()?this.on("contentMousedown.kinetic contentTouchstart.kinetic",function(b){Kinetic.DD.node||a.startDrag(b)}):this.on("mousedown.kinetic touchstart.kinetic",function(b){Kinetic.DD.node||a.startDrag(b)})},Kinetic.Node.prototype._dragChange=function(){if(this.attrs.draggable)this._listenDrag();else{this._dragCleanup();var a=this.getStage(),b=Kinetic.DD;a&&b.node&&b.node._id===this._id&&b.node.stopDrag()}},Kinetic.Node.prototype._dragCleanup=function(){"Stage"===this.getClassName()?(this.off("contentMousedown.kinetic"),this.off("contentTouchstart.kinetic")):(this.off("mousedown.kinetic"),this.off("touchstart.kinetic"))},Kinetic.Factory.addGetterSetter(Kinetic.Node,"dragBoundFunc"),Kinetic.Factory.addGetter(Kinetic.Node,"draggable",!1),Kinetic.Factory.addOverloadedGetterSetter(Kinetic.Node,"draggable");var b=Kinetic.document.documentElement;b.addEventListener("mouseup",Kinetic.DD._endDragBefore,!0),b.addEventListener("touchend",Kinetic.DD._endDragBefore,!0),b.addEventListener("mouseup",Kinetic.DD._endDragAfter,!1),b.addEventListener("touchend",Kinetic.DD._endDragAfter,!1)}(),function(){Kinetic.Util.addMethods(Kinetic.Container,{__init:function(a){this.children=new Kinetic.Collection,Kinetic.Node.call(this,a)},getChildren:function(a){if(a){var b=new Kinetic.Collection;return this.children.each(function(c){a(c)&&b.push(c)}),b}return this.children},hasChildren:function(){return this.getChildren().length>0},removeChildren:function(){for(var a,b=Kinetic.Collection.toCollection(this.children),c=0;c<b.length;c++)a=b[c],delete a.parent,a.index=0,a.hasChildren()&&a.removeChildren(),a.remove();return b=null,this.children=new Kinetic.Collection,this},destroyChildren:function(){for(var a,b=Kinetic.Collection.toCollection(this.children),c=0;c<b.length;c++)a=b[c],delete a.parent,a.index=0,a.destroy();return b=null,this.children=new Kinetic.Collection,this},add:function(a){if(!(arguments.length>1)){if(a.getParent())return void a.moveTo(this);var b=this.children;return this._validateAdd(a),a.index=b.length,a.parent=this,b.push(a),this._fire("add",{child:a}),this}for(var c=0;c<arguments.length;c++)this.add(arguments[c])},destroy:function(){this.hasChildren()&&this.destroyChildren(),Kinetic.Node.prototype.destroy.call(this)},find:function(a){var b,c,d,e,f,g,h,i=[],j=a.replace(/ /g,"").split(","),k=j.length;for(b=0;k>b;b++)if(d=j[b],"#"===d.charAt(0))f=this._getNodeById(d.slice(1)),f&&i.push(f);else if("."===d.charAt(0))e=this._getNodesByName(d.slice(1)),i=i.concat(e);else for(g=this.getChildren(),h=g.length,c=0;h>c;c++)i=i.concat(g[c]._get(d));return Kinetic.Collection.toCollection(i)},_getNodeById:function(a){var b=Kinetic.ids[a];return void 0!==b&&this.isAncestorOf(b)?b:null},_getNodesByName:function(a){var b=Kinetic.names[a]||[];return this._getDescendants(b)},_get:function(a){for(var b=Kinetic.Node.prototype._get.call(this,a),c=this.getChildren(),d=c.length,e=0;d>e;e++)b=b.concat(c[e]._get(a));return b},toObject:function(){var a=Kinetic.Node.prototype.toObject.call(this);a.children=[];for(var b=this.getChildren(),c=b.length,d=0;c>d;d++){var e=b[d];a.children.push(e.toObject())}return a},_getDescendants:function(a){for(var b=[],c=a.length,d=0;c>d;d++){var e=a[d];this.isAncestorOf(e)&&b.push(e)}return b},isAncestorOf:function(a){for(var b=a.getParent();b;){if(b._id===this._id)return!0;b=b.getParent()}return!1},clone:function(a){var b=Kinetic.Node.prototype.clone.call(this,a);return this.getChildren().each(function(a){b.add(a.clone())}),b},getAllIntersections:function(a){var b=[];return this.find("Shape").each(function(c){c.isVisible()&&c.intersects(a)&&b.push(c)}),b},_setChildrenIndices:function(){this.children.each(function(a,b){a.index=b})},drawScene:function(a,b){var c=this.getLayer(),d=a||c&&c.getCanvas(),e=d&&d.getContext(),f=this._cache.canvas,g=f&&f.scene;return this.isVisible()&&(g?this._drawCachedSceneCanvas(e):this._drawChildren(d,"drawScene",b)),this
},drawHit:function(a,b){var c=this.getLayer(),d=a||c&&c.hitCanvas,e=d&&d.getContext(),f=this._cache.canvas,g=f&&f.hit;return this.shouldDrawHit()&&(g?this._drawCachedHitCanvas(e):this._drawChildren(d,"drawHit",b)),this},_drawChildren:function(a,b,c){var d,e,f=this.getLayer(),g=a&&a.getContext(),h=this.getClipWidth(),i=this.getClipHeight(),j=h&&i;j&&f&&(d=this.getClipX(),e=this.getClipY(),g.save(),f._applyTransform(this,g),g.beginPath(),g.rect(d,e,h,i),g.clip(),g.reset()),this.children.each(function(d){d[b](a,c)}),j&&g.restore()}}),Kinetic.Util.extend(Kinetic.Container,Kinetic.Node),Kinetic.Container.prototype.get=Kinetic.Container.prototype.find,Kinetic.Factory.addComponentsGetterSetter(Kinetic.Container,"clip",["x","y","width","height"]),Kinetic.Factory.addGetterSetter(Kinetic.Container,"clipX"),Kinetic.Factory.addGetterSetter(Kinetic.Container,"clipY"),Kinetic.Factory.addGetterSetter(Kinetic.Container,"clipWidth"),Kinetic.Factory.addGetterSetter(Kinetic.Container,"clipHeight"),Kinetic.Collection.mapMethods(Kinetic.Container)}(),function(){function a(a){a.fill()}function b(a){a.stroke()}function c(a){a.fill()}function d(a){a.stroke()}function e(){this._clearCache(f)}var f="hasShadow";Kinetic.Util.addMethods(Kinetic.Shape,{__init:function(f){this.nodeType="Shape",this._fillFunc=a,this._strokeFunc=b,this._fillFuncHit=c,this._strokeFuncHit=d;for(var g,h=Kinetic.shapes;;)if(g=Kinetic.Util.getRandomColor(),g&&!(g in h))break;this.colorKey=g,h[g]=this,Kinetic.Node.call(this,f),this.on("shadowColorChange.kinetic shadowBlurChange.kinetic shadowOffsetChange.kinetic shadowOpacityChange.kinetic shadowEnabledChange.kinetic",e)},hasChildren:function(){return!1},getChildren:function(){return[]},getContext:function(){return this.getLayer().getContext()},getCanvas:function(){return this.getLayer().getCanvas()},hasShadow:function(){return this._getCache(f,this._hasShadow)},_hasShadow:function(){return this.getShadowEnabled()&&0!==this.getShadowOpacity()&&!!(this.getShadowColor()||this.getShadowBlur()||this.getShadowOffsetX()||this.getShadowOffsetY())},hasFill:function(){return!!(this.getFill()||this.getFillPatternImage()||this.getFillLinearGradientColorStops()||this.getFillRadialGradientColorStops())},hasStroke:function(){return!!(this.stroke()||this.strokeRed()||this.strokeGreen()||this.strokeBlue())},_get:function(a){return this.className===a||this.nodeType===a?[this]:[]},intersects:function(a){var b,c=this.getStage(),d=c.bufferHitCanvas;return d.getContext().clear(),this.drawScene(d),b=d.context.getImageData(Math.round(a.x),Math.round(a.y),1,1).data,b[3]>0},destroy:function(){Kinetic.Node.prototype.destroy.call(this),delete Kinetic.shapes[this.colorKey]},_useBufferCanvas:function(){return(this.hasShadow()||1!==this.getAbsoluteOpacity())&&this.hasFill()&&this.hasStroke()&&this.getStage()},drawScene:function(a,b){var c,d,e,f=this.getLayer(),g=a||f.getCanvas(),h=g.getContext(),i=this._cache.canvas,j=this.sceneFunc(),k=this.hasShadow();return this.isVisible()&&(i?this._drawCachedSceneCanvas(h):j&&(h.save(),this._useBufferCanvas()?(c=this.getStage(),d=c.bufferCanvas,e=d.getContext(),e.clear(),e.save(),e._applyLineJoin(this),f._applyTransform(this,e,b),j.call(this,e),e.restore(),k&&(h.save(),h._applyShadow(this),h.drawImage(d._canvas,0,0),h.restore()),h._applyOpacity(this),h.drawImage(d._canvas,0,0)):(h._applyLineJoin(this),f._applyTransform(this,h,b),k&&(h.save(),h._applyShadow(this),j.call(this,h),h.restore()),h._applyOpacity(this),j.call(this,h)),h.restore())),this},drawHit:function(a,b){var c=this.getLayer(),d=a||c.hitCanvas,e=d.getContext(),f=this.hitFunc()||this.sceneFunc(),g=this._cache.canvas,h=g&&g.hit;return this.shouldDrawHit()&&(h?this._drawCachedHitCanvas(e):f&&(e.save(),e._applyLineJoin(this),c._applyTransform(this,e,b),f.call(this,e),e.restore())),this},drawHitFromCache:function(a){var b,c,d,e,f,g,h,i,j=a||0,k=this._cache.canvas,l=this._getCachedSceneCanvas(),m=l.getContext(),n=k.hit,o=n.getContext(),p=l.getWidth(),q=l.getHeight();o.clear();try{for(b=m.getImageData(0,0,p,q),c=b.data,d=o.getImageData(0,0,p,q),e=d.data,f=c.length,g=Kinetic.Util._hexToRgb(this.colorKey),h=0;f>h;h+=4)i=c[h+3],i>j&&(e[h]=g.r,e[h+1]=g.g,e[h+2]=g.b,e[h+3]=255);o.putImageData(d,0,0)}catch(r){Kinetic.Util.warn("Unable to draw hit graph from cached scene canvas. "+r.message)}return this}}),Kinetic.Util.extend(Kinetic.Shape,Kinetic.Node),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"stroke"),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"strokeRed",0,Kinetic.Validators.RGBComponent),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"strokeGreen",0,Kinetic.Validators.RGBComponent),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"strokeBlue",0,Kinetic.Validators.RGBComponent),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"strokeAlpha",1,Kinetic.Validators.alphaComponent),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"strokeWidth",2),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"lineJoin"),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"lineCap"),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"sceneFunc"),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"hitFunc"),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"dash"),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"shadowColor"),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"shadowRed",0,Kinetic.Validators.RGBComponent),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"shadowGreen",0,Kinetic.Validators.RGBComponent),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"shadowBlue",0,Kinetic.Validators.RGBComponent),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"shadowAlpha",1,Kinetic.Validators.alphaComponent),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"shadowBlur"),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"shadowOpacity"),Kinetic.Factory.addComponentsGetterSetter(Kinetic.Shape,"shadowOffset",["x","y"]),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"shadowOffsetX",0),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"shadowOffsetY",0),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillPatternImage"),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fill"),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillRed",0,Kinetic.Validators.RGBComponent),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillGreen",0,Kinetic.Validators.RGBComponent),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillBlue",0,Kinetic.Validators.RGBComponent),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillAlpha",1,Kinetic.Validators.alphaComponent),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillPatternX",0),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillPatternY",0),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillLinearGradientColorStops"),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillRadialGradientStartRadius",0),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillRadialGradientEndRadius",0),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillRadialGradientColorStops"),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillPatternRepeat","repeat"),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillEnabled",!0),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"strokeEnabled",!0),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"shadowEnabled",!0),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"dashEnabled",!0),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"strokeScaleEnabled",!0),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillPriority","color"),Kinetic.Factory.addComponentsGetterSetter(Kinetic.Shape,"fillPatternOffset",["x","y"]),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillPatternOffsetX",0),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillPatternOffsetY",0),Kinetic.Factory.addComponentsGetterSetter(Kinetic.Shape,"fillPatternScale",["x","y"]),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillPatternScaleX",1),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillPatternScaleY",1),Kinetic.Factory.addComponentsGetterSetter(Kinetic.Shape,"fillLinearGradientStartPoint",["x","y"]),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillLinearGradientStartPointX",0),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillLinearGradientStartPointY",0),Kinetic.Factory.addComponentsGetterSetter(Kinetic.Shape,"fillLinearGradientEndPoint",["x","y"]),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillLinearGradientEndPointX",0),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillLinearGradientEndPointY",0),Kinetic.Factory.addComponentsGetterSetter(Kinetic.Shape,"fillRadialGradientStartPoint",["x","y"]),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillRadialGradientStartPointX",0),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillRadialGradientStartPointY",0),Kinetic.Factory.addComponentsGetterSetter(Kinetic.Shape,"fillRadialGradientEndPoint",["x","y"]),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillRadialGradientEndPointX",0),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillRadialGradientEndPointY",0),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillPatternRotation",0),Kinetic.Factory.backCompat(Kinetic.Shape,{dashArray:"dash",getDashArray:"getDash",setDashArray:"getDash",drawFunc:"sceneFunc",getDrawFunc:"getSceneFunc",setDrawFunc:"setSceneFunc",drawHitFunc:"hitFunc",getDrawHitFunc:"getHitFunc",setDrawHitFunc:"setHitFunc"}),Kinetic.Collection.mapMethods(Kinetic.Shape)}(),function(){function a(a,b){a.content.addEventListener(b,function(c){a[I+b](c)},!1)}var b="Stage",c="string",d="px",e="mouseout",f="mouseleave",g="mouseover",h="mouseenter",i="mousemove",j="mousedown",k="mouseup",l="click",m="dblclick",n="touchstart",o="touchend",p="tap",q="dbltap",r="touchmove",s="contentMouseout",t="contentMouseover",u="contentMousemove",v="contentMousedown",w="contentMouseup",x="contentClick",y="contentDblclick",z="contentTouchstart",A="contentTouchend",B="contentDbltap",C="contentTouchmove",D="div",E="relative",F="inline-block",G="kineticjs-content",H=" ",I="_",J="container",K="",L=[j,i,k,e,n,r,o,g],M=L.length;Kinetic.Util.addMethods(Kinetic.Stage,{___init:function(a){this.nodeType=b,Kinetic.Container.call(this,a),this._id=Kinetic.idCounter++,this._buildDOM(),this._bindContentEvents(),this._enableNestedTransforms=!1,Kinetic.stages.push(this)},_validateAdd:function(a){"Layer"!==a.getType()&&Kinetic.Util.error("You may only add layers to the stage.")},setContainer:function(a){if(typeof a===c){var b=a;if(a=Kinetic.document.getElementById(a),!a)throw"Can not find container in document with id "+b}return this._setAttr(J,a),this},shouldDrawHit:function(){return!0},draw:function(){return Kinetic.Node.prototype.draw.call(this),this},setHeight:function(a){return Kinetic.Node.prototype.setHeight.call(this,a),this._resizeDOM(),this},setWidth:function(a){return Kinetic.Node.prototype.setWidth.call(this,a),this._resizeDOM(),this},clear:function(){var a,b=this.children,c=b.length;for(a=0;c>a;a++)b[a].clear();return this},clone:function(a){return a||(a={}),a.container=Kinetic.document.createElement(D),Kinetic.Container.prototype.clone.call(this,a)},destroy:function(){var a=this.content;Kinetic.Container.prototype.destroy.call(this),a&&Kinetic.Util._isInDocument(a)&&this.getContainer().removeChild(a);var b=Kinetic.stages.indexOf(this);b>-1&&Kinetic.stages.splice(b,1)},getPointerPosition:function(){return this.pointerPos},getStage:function(){return this},getContent:function(){return this.content},toDataURL:function(a){function b(e){var f=i[e],j=f.toDataURL(),k=new Kinetic.window.Image;k.onload=function(){h.drawImage(k,0,0),e<i.length-1?b(e+1):a.callback(g.toDataURL(c,d))},k.src=j}a=a||{};var c=a.mimeType||null,d=a.quality||null,e=a.x||0,f=a.y||0,g=new Kinetic.SceneCanvas({width:a.width||this.getWidth(),height:a.height||this.getHeight(),pixelRatio:1}),h=g.getContext()._context,i=this.children;(e||f)&&h.translate(-1*e,-1*f),b(0)},toImage:function(a){var b=a.callback;a.callback=function(a){Kinetic.Util._getImage(a,function(a){b(a)})},this.toDataURL(a)},getIntersection:function(a){var b,c,d=this.getChildren(),e=d.length,f=e-1;for(b=f;b>=0;b--)if(c=d[b].getIntersection(a))return c;return null},_resizeDOM:function(){if(this.content){var a,b,c=this.getWidth(),e=this.getHeight(),f=this.getChildren(),g=f.length;for(this.content.style.width=c+d,this.content.style.height=e+d,this.bufferCanvas.setSize(c,e),this.bufferHitCanvas.setSize(c,e),a=0;g>a;a++)b=f[a],b.getCanvas().setSize(c,e),b.hitCanvas.setSize(c,e),b.draw()}},add:function(a){if(!(arguments.length>1))return Kinetic.Container.prototype.add.call(this,a),a._setCanvasSize(this.width(),this.height()),a.draw(),this.content.appendChild(a.canvas._canvas),this;for(var b=0;b<arguments.length;b++)this.add(arguments[b])},getParent:function(){return null},getLayer:function(){return null},getLayers:function(){return this.getChildren()},_bindContentEvents:function(){for(var b=0;M>b;b++)a(this,L[b])},_mouseover:function(a){Kinetic.UA.mobile||(this._setPointerPosition(a),this._fire(t,{evt:a}))},_mouseout:function(a){if(!Kinetic.UA.mobile){this._setPointerPosition(a);var b=this.targetShape;b&&!Kinetic.isDragging()&&(b._fireAndBubble(e,{evt:a}),b._fireAndBubble(f,{evt:a}),this.targetShape=null),this.pointerPos=void 0,this._fire(s,{evt:a})}},_mousemove:function(a){if(!Kinetic.UA.mobile){this._setPointerPosition(a);var b=Kinetic.DD,c=this.getIntersection(this.getPointerPosition());c&&c.isListening()?Kinetic.isDragging()||this.targetShape&&this.targetShape._id===c._id?c._fireAndBubble(i,{evt:a}):(this.targetShape&&(this.targetShape._fireAndBubble(e,{evt:a},c),this.targetShape._fireAndBubble(f,{evt:a},c)),c._fireAndBubble(g,{evt:a},this.targetShape),c._fireAndBubble(h,{evt:a},this.targetShape),this.targetShape=c):this.targetShape&&!Kinetic.isDragging()&&(this.targetShape._fireAndBubble(e,{evt:a}),this.targetShape._fireAndBubble(f,{evt:a}),this.targetShape=null),this._fire(u,{evt:a}),b&&b._drag(a)}a.preventDefault&&a.preventDefault()},_mousedown:function(a){if(!Kinetic.UA.mobile){this._setPointerPosition(a);var b=this.getIntersection(this.getPointerPosition());Kinetic.listenClickTap=!0,b&&b.isListening()&&(this.clickStartShape=b,b._fireAndBubble(j,{evt:a})),this._fire(v,{evt:a})}a.preventDefault&&a.preventDefault()},_mouseup:function(a){if(!Kinetic.UA.mobile){this._setPointerPosition(a);var b=this.getIntersection(this.getPointerPosition()),c=this.clickStartShape,d=!1;Kinetic.inDblClickWindow?(d=!0,Kinetic.inDblClickWindow=!1):Kinetic.inDblClickWindow=!0,setTimeout(function(){Kinetic.inDblClickWindow=!1},Kinetic.dblClickWindow),b&&b.isListening()&&(b._fireAndBubble(k,{evt:a}),Kinetic.listenClickTap&&c&&c._id===b._id&&(b._fireAndBubble(l,{evt:a}),d&&b._fireAndBubble(m,{evt:a}))),this._fire(w,{evt:a}),Kinetic.listenClickTap&&(this._fire(x,{evt:a}),d&&this._fire(y,{evt:a})),Kinetic.listenClickTap=!1}a.preventDefault&&a.preventDefault()},_touchstart:function(a){this._setPointerPosition(a);var b=this.getIntersection(this.getPointerPosition());Kinetic.listenClickTap=!0,b&&b.isListening()&&(this.tapStartShape=b,b._fireAndBubble(n,{evt:a}),b.isListening()&&a.preventDefault&&a.preventDefault()),this._fire(z,{evt:a})},_touchend:function(a){this._setPointerPosition(a);var b=this.getIntersection(this.getPointerPosition()),c=!1;Kinetic.inDblClickWindow?(c=!0,Kinetic.inDblClickWindow=!1):Kinetic.inDblClickWindow=!0,setTimeout(function(){Kinetic.inDblClickWindow=!1},Kinetic.dblClickWindow),b&&b.isListening()&&(b._fireAndBubble(o,{evt:a}),Kinetic.listenClickTap&&b._id===this.tapStartShape._id&&(b._fireAndBubble(p,{evt:a}),c&&b._fireAndBubble(q,{evt:a})),b.isListening()&&a.preventDefault&&a.preventDefault()),Kinetic.listenClickTap&&(this._fire(A,{evt:a}),c&&this._fire(B,{evt:a})),Kinetic.listenClickTap=!1},_touchmove:function(a){this._setPointerPosition(a);var b=Kinetic.DD,c=this.getIntersection(this.getPointerPosition());c&&c.isListening()&&(c._fireAndBubble(r,{evt:a}),c.isListening()&&a.preventDefault&&a.preventDefault()),this._fire(C,{evt:a}),b&&b._drag(a)},_setPointerPosition:function(a){var b,c=this._getContentPosition(),d=a.offsetX,e=a.clientX,f=null,g=null;a=a?a:window.event,void 0!==a.touches?a.touches.length>0&&(b=a.touches[0],f=b.clientX-c.left,g=b.clientY-c.top):void 0!==d?(f=d,g=a.offsetY):"mozilla"===Kinetic.UA.browser?(f=a.layerX,g=a.layerY):void 0!==e&&c&&(f=e-c.left,g=a.clientY-c.top),null!==f&&null!==g&&(this.pointerPos={x:f,y:g})},_getContentPosition:function(){var a=this.content.getBoundingClientRect?this.content.getBoundingClientRect():{top:0,left:0};return{top:a.top,left:a.left}},_buildDOM:function(){var a=this.getContainer();if(!a){if(Kinetic.Util.isBrowser())throw"Stage has not container. But container is required";a=Kinetic.document.createElement(D)}a.innerHTML=K,this.content=Kinetic.document.createElement(D),this.content.style.position=E,this.content.style.display=F,this.content.className=G,this.content.setAttribute("role","presentation"),a.appendChild(this.content),this.bufferCanvas=new Kinetic.SceneCanvas({pixelRatio:1}),this.bufferHitCanvas=new Kinetic.HitCanvas,this._resizeDOM()},_onContent:function(a,b){var c,d,e=a.split(H),f=e.length;for(c=0;f>c;c++)d=e[c],this.content.addEventListener(d,b,!1)},cache:function(){Kinetic.Util.warn("Cache function is not allowed for stage. You may use cache only for layers, groups and shapes.")},clearCache:function(){}}),Kinetic.Util.extend(Kinetic.Stage,Kinetic.Container),Kinetic.Factory.addGetter(Kinetic.Stage,"container"),Kinetic.Factory.addOverloadedGetterSetter(Kinetic.Stage,"container")}(),function(){Kinetic.Util.addMethods(Kinetic.BaseLayer,{___init:function(a){this.nodeType="Layer",Kinetic.Container.call(this,a)},createPNGStream:function(){return this.canvas._canvas.createPNGStream()},getCanvas:function(){return this.canvas},getHitCanvas:function(){return this.hitCanvas},getContext:function(){return this.getCanvas().getContext()},clear:function(a){return this.getContext().clear(a),this.getHitCanvas().getContext().clear(a),this},setZIndex:function(a){Kinetic.Node.prototype.setZIndex.call(this,a);var b=this.getStage();return b&&(b.content.removeChild(this.getCanvas()._canvas),a<b.getChildren().length-1?b.content.insertBefore(this.getCanvas()._canvas,b.getChildren()[a+1].getCanvas()._canvas):b.content.appendChild(this.getCanvas()._canvas)),this},moveToTop:function(){Kinetic.Node.prototype.moveToTop.call(this);var a=this.getStage();a&&(a.content.removeChild(this.getCanvas()._canvas),a.content.appendChild(this.getCanvas()._canvas))},moveUp:function(){if(Kinetic.Node.prototype.moveUp.call(this)){var a=this.getStage();a&&(a.content.removeChild(this.getCanvas()._canvas),this.index<a.getChildren().length-1?a.content.insertBefore(this.getCanvas()._canvas,a.getChildren()[this.index+1].getCanvas()._canvas):a.content.appendChild(this.getCanvas()._canvas))}},moveDown:function(){if(Kinetic.Node.prototype.moveDown.call(this)){var a=this.getStage();if(a){var b=a.getChildren();a.content.removeChild(this.getCanvas()._canvas),a.content.insertBefore(this.getCanvas()._canvas,b[this.index+1].getCanvas()._canvas)}}},moveToBottom:function(){if(Kinetic.Node.prototype.moveToBottom.call(this)){var a=this.getStage();if(a){var b=a.getChildren();a.content.removeChild(this.getCanvas()._canvas),a.content.insertBefore(this.getCanvas()._canvas,b[1].getCanvas()._canvas)}}},getLayer:function(){return this},remove:function(){var a=this.getCanvas()._canvas;return Kinetic.Node.prototype.remove.call(this),a&&a.parentNode&&Kinetic.Util._isInDocument(a)&&a.parentNode.removeChild(a),this},getStage:function(){return this.parent}}),Kinetic.Util.extend(Kinetic.BaseLayer,Kinetic.Container),Kinetic.Factory.addGetterSetter(Kinetic.BaseLayer,"clearBeforeDraw",!0),Kinetic.Collection.mapMethods(Kinetic.BaseLayer)}(),function(){var a="#",b="beforeDraw",c="draw",d=[{x:0,y:0},{x:-1,y:0},{x:-1,y:-1},{x:0,y:-1},{x:1,y:-1},{x:1,y:0},{x:1,y:1},{x:0,y:1},{x:-1,y:1}],e=d.length;Kinetic.Util.addMethods(Kinetic.Layer,{____init:function(a){this.nodeType="Layer",this.canvas=new Kinetic.SceneCanvas,this.hitCanvas=new Kinetic.HitCanvas,Kinetic.BaseLayer.call(this,a)},_setCanvasSize:function(a,b){this.canvas.setSize(a,b),this.hitCanvas.setSize(a,b)},_validateAdd:function(a){var b=a.getType();"Group"!==b&&"Shape"!==b&&Kinetic.Util.error("You may only add groups and shapes to a layer.")},getIntersection:function(a){var b,c,f,g;if(!this.hitGraphEnabled()||!this.isVisible())return null;for(c=0;e>c;c++){if(f=d[c],b=this._getIntersection({x:a.x+f.x,y:a.y+f.y}),g=b.shape)return g;if(!b.antialiased)return null}},_getIntersection:function(b){var c,d,e=this.hitCanvas.context._context.getImageData(b.x,b.y,1,1).data,f=e[3];return 255===f?(c=Kinetic.Util._rgbToHex(e[0],e[1],e[2]),d=Kinetic.shapes[a+c],{shape:d}):f>0?{antialiased:!0}:{}},drawScene:function(a,d){var e=this.getLayer(),f=a||e&&e.getCanvas();return this._fire(b,{node:this}),this.getClearBeforeDraw()&&f.getContext().clear(),Kinetic.Container.prototype.drawScene.call(this,f,d),this._fire(c,{node:this}),this},_applyTransform:function(a,b,c){var d=a.getAbsoluteTransform(c).getMatrix();b.transform(d[0],d[1],d[2],d[3],d[4],d[5])},drawHit:function(a,b){var c=this.getLayer(),d=a||c&&c.hitCanvas;return c&&c.getClearBeforeDraw()&&c.getHitCanvas().getContext().clear(),Kinetic.Container.prototype.drawHit.call(this,d,b),this},clear:function(a){return this.getContext().clear(a),this.getHitCanvas().getContext().clear(a),this},setVisible:function(a){return Kinetic.Node.prototype.setVisible.call(this,a),a?(this.getCanvas()._canvas.style.display="block",this.hitCanvas._canvas.style.display="block"):(this.getCanvas()._canvas.style.display="none",this.hitCanvas._canvas.style.display="none"),this},enableHitGraph:function(){return this.setHitGraphEnabled(!0),this},disableHitGraph:function(){return this.setHitGraphEnabled(!1),this}}),Kinetic.Util.extend(Kinetic.Layer,Kinetic.BaseLayer),Kinetic.Factory.addGetterSetter(Kinetic.Layer,"hitGraphEnabled",!0),Kinetic.Collection.mapMethods(Kinetic.Layer)}(),function(){Kinetic.Util.addMethods(Kinetic.FastLayer,{____init:function(a){this.nodeType="Layer",this.canvas=new Kinetic.SceneCanvas,Kinetic.BaseLayer.call(this,a)},_validateAdd:function(a){var b=a.getType();"Shape"!==b&&Kinetic.Util.error("You may only add shapes to a fast layer.")},_setCanvasSize:function(a,b){this.canvas.setSize(a,b)},hitGraphEnabled:function(){return!1},getIntersection:function(){return null},drawScene:function(a){var b=this.getLayer(),c=a||b&&b.getCanvas();return this.getClearBeforeDraw()&&c.getContext().clear(),Kinetic.Container.prototype.drawScene.call(this,c),this},_applyTransform:function(a,b,c){if(!c||c._id!==this._id){var d=a.getTransform().getMatrix();b.transform(d[0],d[1],d[2],d[3],d[4],d[5])}},draw:function(){return this.drawScene(),this},clear:function(a){return this.getContext().clear(a),this},setVisible:function(a){return Kinetic.Node.prototype.setVisible.call(this,a),this.getCanvas()._canvas.style.display=a?"block":"none",this}}),Kinetic.Util.extend(Kinetic.FastLayer,Kinetic.BaseLayer),Kinetic.Collection.mapMethods(Kinetic.FastLayer)}(),function(){Kinetic.Util.addMethods(Kinetic.Group,{___init:function(a){this.nodeType="Group",Kinetic.Container.call(this,a)},_validateAdd:function(a){var b=a.getType();"Group"!==b&&"Shape"!==b&&Kinetic.Util.error("You may only add groups and shapes to groups.")}}),Kinetic.Util.extend(Kinetic.Group,Kinetic.Container),Kinetic.Collection.mapMethods(Kinetic.Group)}(),function(){Kinetic.Rect=function(a){this.___init(a)},Kinetic.Rect.prototype={___init:function(a){Kinetic.Shape.call(this,a),this.className="Rect",this.sceneFunc(this._sceneFunc)},_sceneFunc:function(a){var b=this.getCornerRadius(),c=this.getWidth(),d=this.getHeight();a.beginPath(),b?(a.moveTo(b,0),a.lineTo(c-b,0),a.arc(c-b,b,b,3*Math.PI/2,0,!1),a.lineTo(c,d-b),a.arc(c-b,d-b,b,0,Math.PI/2,!1),a.lineTo(b,d),a.arc(b,d-b,b,Math.PI/2,Math.PI,!1),a.lineTo(0,b),a.arc(b,b,b,Math.PI,3*Math.PI/2,!1)):a.rect(0,0,c,d),a.closePath(),a.fillStrokeShape(this)}},Kinetic.Util.extend(Kinetic.Rect,Kinetic.Shape),Kinetic.Factory.addGetterSetter(Kinetic.Rect,"cornerRadius",0),Kinetic.Collection.mapMethods(Kinetic.Rect)}(),function(){var a=2*Math.PI-1e-4,b="Circle";Kinetic.Circle=function(a){this.___init(a)},Kinetic.Circle.prototype={___init:function(a){Kinetic.Shape.call(this,a),this.className=b,this.sceneFunc(this._sceneFunc)},_sceneFunc:function(b){b.beginPath(),b.arc(0,0,this.getRadius(),0,a,!1),b.closePath(),b.fillStrokeShape(this)},getWidth:function(){return 2*this.getRadius()},getHeight:function(){return 2*this.getRadius()},setWidth:function(a){Kinetic.Node.prototype.setWidth.call(this,a),this.setRadius(a/2)},setHeight:function(a){Kinetic.Node.prototype.setHeight.call(this,a),this.setRadius(a/2)}},Kinetic.Util.extend(Kinetic.Circle,Kinetic.Shape),Kinetic.Factory.addGetterSetter(Kinetic.Circle,"radius",0),Kinetic.Collection.mapMethods(Kinetic.Circle)}(),function(){var a=2*Math.PI-1e-4,b="Ellipse";Kinetic.Ellipse=function(a){this.___init(a)},Kinetic.Ellipse.prototype={___init:function(a){Kinetic.Shape.call(this,a),this.className=b,this.sceneFunc(this._sceneFunc)},_sceneFunc:function(b){var c=this.getRadius(),d=c.x,e=c.y;b.beginPath(),b.save(),d!==e&&b.scale(1,e/d),b.arc(0,0,d,0,a,!1),b.restore(),b.closePath(),b.fillStrokeShape(this)},getWidth:function(){return 2*this.getRadius().x},getHeight:function(){return 2*this.getRadius().y},setWidth:function(a){Kinetic.Node.prototype.setWidth.call(this,a),this.setRadius({x:a/2})},setHeight:function(a){Kinetic.Node.prototype.setHeight.call(this,a),this.setRadius({y:a/2})}},Kinetic.Util.extend(Kinetic.Ellipse,Kinetic.Shape),Kinetic.Factory.addComponentsGetterSetter(Kinetic.Ellipse,"radius",["x","y"]),Kinetic.Factory.addGetterSetter(Kinetic.Ellipse,"radiusX",0),Kinetic.Factory.addGetterSetter(Kinetic.Ellipse,"radiusY",0),Kinetic.Collection.mapMethods(Kinetic.Ellipse)}(),function(){var a=2*Math.PI-1e-4;Kinetic.Ring=function(a){this.___init(a)},Kinetic.Ring.prototype={___init:function(a){Kinetic.Shape.call(this,a),this.className="Ring",this.sceneFunc(this._sceneFunc)},_sceneFunc:function(b){b.beginPath(),b.arc(0,0,this.getInnerRadius(),0,a,!1),b.moveTo(this.getOuterRadius(),0),b.arc(0,0,this.getOuterRadius(),a,0,!0),b.closePath(),b.fillStrokeShape(this)},getWidth:function(){return 2*this.getOuterRadius()},getHeight:function(){return 2*this.getOuterRadius()},setWidth:function(a){Kinetic.Node.prototype.setWidth.call(this,a),this.setOuterRadius(a/2)},setHeight:function(a){Kinetic.Node.prototype.setHeight.call(this,a),this.setOuterRadius(a/2)}},Kinetic.Util.extend(Kinetic.Ring,Kinetic.Shape),Kinetic.Factory.addGetterSetter(Kinetic.Ring,"innerRadius",0),Kinetic.Factory.addGetterSetter(Kinetic.Ring,"outerRadius",0),Kinetic.Collection.mapMethods(Kinetic.Ring)}(),function(){Kinetic.Wedge=function(a){this.___init(a)},Kinetic.Wedge.prototype={___init:function(a){Kinetic.Shape.call(this,a),this.className="Wedge",this.sceneFunc(this._sceneFunc)},_sceneFunc:function(a){a.beginPath(),a.arc(0,0,this.getRadius(),0,Kinetic.getAngle(this.getAngle()),this.getClockwise()),a.lineTo(0,0),a.closePath(),a.fillStrokeShape(this)}},Kinetic.Util.extend(Kinetic.Wedge,Kinetic.Shape),Kinetic.Factory.addGetterSetter(Kinetic.Wedge,"radius",0),Kinetic.Factory.addGetterSetter(Kinetic.Wedge,"angle",0),Kinetic.Factory.addGetterSetter(Kinetic.Wedge,"clockwise",!1),Kinetic.Factory.backCompat(Kinetic.Wedge,{angleDeg:"angle",getAngleDeg:"getAngle",setAngleDeg:"setAngle"}),Kinetic.Collection.mapMethods(Kinetic.Wedge)}(),function(){Math.PI/180;Kinetic.Arc=function(a){this.___init(a)},Kinetic.Arc.prototype={___init:function(a){Kinetic.Shape.call(this,a),this.className="Arc",this.sceneFunc(this._sceneFunc)},_sceneFunc:function(a){var b=Kinetic.getAngle(this.angle()),c=this.clockwise();a.beginPath(),a.arc(0,0,this.getOuterRadius(),0,b,c),a.arc(0,0,this.getInnerRadius(),b,0,!c),a.closePath(),a.fillStrokeShape(this)}},Kinetic.Util.extend(Kinetic.Arc,Kinetic.Shape),Kinetic.Factory.addGetterSetter(Kinetic.Arc,"innerRadius",0),Kinetic.Factory.addGetterSetter(Kinetic.Arc,"outerRadius",0),Kinetic.Factory.addGetterSetter(Kinetic.Arc,"angle",0),Kinetic.Factory.addGetterSetter(Kinetic.Arc,"clockwise",!1),Kinetic.Collection.mapMethods(Kinetic.Arc)}(),function(){var a="Image";Kinetic.Image=function(a){this.___init(a)},Kinetic.Image.prototype={___init:function(b){Kinetic.Shape.call(this,b),this.className=a,this.sceneFunc(this._sceneFunc),this.hitFunc(this._hitFunc)},_useBufferCanvas:function(){return(this.hasShadow()||1!==this.getAbsoluteOpacity())&&this.hasStroke()},_sceneFunc:function(a){var b,c,d,e,f=this.getWidth(),g=this.getHeight(),h=this.getImage();h&&(b=this.getCrop(),c=b.width,d=b.height,e=c&&d?[h,b.x,b.y,c,d,0,0,f,g]:[h,0,0,f,g]),a.beginPath(),a.rect(0,0,f,g),a.closePath(),a.fillStrokeShape(this),h&&a.drawImage.apply(a,e)},_hitFunc:function(a){var b=this.getWidth(),c=this.getHeight();a.beginPath(),a.rect(0,0,b,c),a.closePath(),a.fillStrokeShape(this)},getWidth:function(){var a=this.getImage();return this.attrs.width||(a?a.width:0)},getHeight:function(){var a=this.getImage();return this.attrs.height||(a?a.height:0)}},Kinetic.Util.extend(Kinetic.Image,Kinetic.Shape),Kinetic.Factory.addGetterSetter(Kinetic.Image,"image"),Kinetic.Factory.addComponentsGetterSetter(Kinetic.Image,"crop",["x","y","width","height"]),Kinetic.Factory.addGetterSetter(Kinetic.Image,"cropX",0),Kinetic.Factory.addGetterSetter(Kinetic.Image,"cropY",0),Kinetic.Factory.addGetterSetter(Kinetic.Image,"cropWidth",0),Kinetic.Factory.addGetterSetter(Kinetic.Image,"cropHeight",0),Kinetic.Collection.mapMethods(Kinetic.Image)}(),function(){function a(a){a.fillText(this.partialText,0,0)}function b(a){a.strokeText(this.partialText,0,0)}var c="auto",d="center",e="Change.kinetic",f="2d",g="-",h="",i="left",j="text",k="Text",l="middle",m="normal",n="px ",o=" ",p="right",q="word",r="char",s="none",t=["fontFamily","fontSize","fontStyle","fontVariant","padding","align","lineHeight","text","width","height","wrap"],u=t.length,v=Kinetic.Util.createCanvasElement().getContext(f);Kinetic.Text=function(a){this.___init(a)},Kinetic.Text.prototype={___init:function(d){var f=this;void 0===d.width&&(d.width=c),void 0===d.height&&(d.height=c),Kinetic.Shape.call(this,d),this._fillFunc=a,this._strokeFunc=b,this.className=k;for(var g=0;u>g;g++)this.on(t[g]+e,f._setTextData);this._setTextData(),this.sceneFunc(this._sceneFunc),this.hitFunc(this._hitFunc)},_sceneFunc:function(a){var b,c=this.getPadding(),e=this.getTextHeight(),f=this.getLineHeight()*e,g=this.textArr,h=g.length,j=this.getWidth();for(a.setAttr("font",this._getContextFont()),a.setAttr("textBaseline",l),a.setAttr("textAlign",i),a.save(),a.translate(c,0),a.translate(0,c+e/2),b=0;h>b;b++){var k=g[b],m=k.text,n=k.width;a.save(),this.getAlign()===p?a.translate(j-n-2*c,0):this.getAlign()===d&&a.translate((j-n-2*c)/2,0),this.partialText=m,a.fillStrokeShape(this),a.restore(),a.translate(0,f)}a.restore()},_hitFunc:function(a){var b=this.getWidth(),c=this.getHeight();a.beginPath(),a.rect(0,0,b,c),a.closePath(),a.fillStrokeShape(this)},setText:function(a){var b=Kinetic.Util._isString(a)?a:a.toString();return this._setAttr(j,b),this},getWidth:function(){return this.attrs.width===c?this.getTextWidth()+2*this.getPadding():this.attrs.width},getHeight:function(){return this.attrs.height===c?this.getTextHeight()*this.textArr.length*this.getLineHeight()+2*this.getPadding():this.attrs.height},getTextWidth:function(){return this.textWidth},getTextHeight:function(){return this.textHeight},_getTextSize:function(a){var b,c=v,d=this.getFontSize();return c.save(),c.font=this._getContextFont(),b=c.measureText(a),c.restore(),{width:b.width,height:parseInt(d,10)}},_getContextFont:function(){return this.getFontStyle()+o+this.getFontVariant()+o+this.getFontSize()+n+this.getFontFamily()},_addTextLine:function(a,b){return this.textArr.push({text:a,width:b})},_getTextWidth:function(a){return v.measureText(a).width},_setTextData:function(){var a=this.getText().split("\n"),b=+this.getFontSize(),d=0,e=this.getLineHeight()*b,f=this.attrs.width,h=this.attrs.height,i=f!==c,j=h!==c,k=this.getPadding(),l=f-2*k,m=h-2*k,n=0,p=this.getWrap(),q=p!==s,t=p!==r&&q;this.textArr=[],v.save(),v.font=this._getContextFont();
for(var u=0,w=a.length;w>u;++u){var x=a[u],y=this._getTextWidth(x);if(i&&y>l)for(;x.length>0;){for(var z=0,A=x.length,B="",C=0;A>z;){var D=z+A>>>1,E=x.slice(0,D+1),F=this._getTextWidth(E);l>=F?(z=D+1,B=E,C=F):A=D}if(!B)break;if(t){var G=Math.max(B.lastIndexOf(o),B.lastIndexOf(g))+1;G>0&&(z=G,B=B.slice(0,z),C=this._getTextWidth(B))}if(this._addTextLine(B,C),d=Math.max(d,C),n+=e,!q||j&&n+e>m)break;if(x=x.slice(z),x.length>0&&(y=this._getTextWidth(x),l>=y)){this._addTextLine(x,y),n+=e,d=Math.max(d,y);break}}else this._addTextLine(x,y),n+=e,d=Math.max(d,y);if(j&&n+e>m)break}v.restore(),this.textHeight=b,this.textWidth=d}},Kinetic.Util.extend(Kinetic.Text,Kinetic.Shape),Kinetic.Factory.addGetterSetter(Kinetic.Text,"fontFamily","Arial"),Kinetic.Factory.addGetterSetter(Kinetic.Text,"fontSize",12),Kinetic.Factory.addGetterSetter(Kinetic.Text,"fontStyle",m),Kinetic.Factory.addGetterSetter(Kinetic.Text,"fontVariant",m),Kinetic.Factory.addGetterSetter(Kinetic.Text,"padding",0),Kinetic.Factory.addGetterSetter(Kinetic.Text,"align",i),Kinetic.Factory.addGetterSetter(Kinetic.Text,"lineHeight",1),Kinetic.Factory.addGetterSetter(Kinetic.Text,"wrap",q),Kinetic.Factory.addGetter(Kinetic.Text,"text",h),Kinetic.Factory.addOverloadedGetterSetter(Kinetic.Text,"text"),Kinetic.Collection.mapMethods(Kinetic.Text)}(),function(){Kinetic.Line=function(a){this.___init(a)},Kinetic.Line.prototype={___init:function(a){Kinetic.Shape.call(this,a),this.className="Line",this.on("pointsChange.kinetic tensionChange.kinetic closedChange.kinetic",function(){this._clearCache("tensionPoints")}),this.sceneFunc(this._sceneFunc)},_sceneFunc:function(a){var b,c,d,e=this.getPoints(),f=e.length,g=this.getTension(),h=this.getClosed();if(a.beginPath(),a.moveTo(e[0],e[1]),0!==g&&f>4){for(b=this.getTensionPoints(),c=b.length,d=h?0:4,h||a.quadraticCurveTo(b[0],b[1],b[2],b[3]);c-2>d;)a.bezierCurveTo(b[d++],b[d++],b[d++],b[d++],b[d++],b[d++]);h||a.quadraticCurveTo(b[c-2],b[c-1],e[f-2],e[f-1])}else for(d=2;f>d;d+=2)a.lineTo(e[d],e[d+1]);h?(a.closePath(),a.fillStrokeShape(this)):a.strokeShape(this)},getTensionPoints:function(){return this._getCache("tensionPoints",this._getTensionPoints)},_getTensionPoints:function(){return this.getClosed()?this._getTensionPointsClosed():Kinetic.Util._expandPoints(this.getPoints(),this.getTension())},_getTensionPointsClosed:function(){var a=this.getPoints(),b=a.length,c=this.getTension(),d=Kinetic.Util,e=d._getControlPoints(a[b-2],a[b-1],a[0],a[1],a[2],a[3],c),f=d._getControlPoints(a[b-4],a[b-3],a[b-2],a[b-1],a[0],a[1],c),g=Kinetic.Util._expandPoints(a,c),h=[e[2],e[3]].concat(g).concat([f[0],f[1],a[b-2],a[b-1],f[2],f[3],e[0],e[1],a[0],a[1]]);return h}},Kinetic.Util.extend(Kinetic.Line,Kinetic.Shape),Kinetic.Factory.addGetterSetter(Kinetic.Line,"closed",!1),Kinetic.Factory.addGetterSetter(Kinetic.Line,"tension",0),Kinetic.Factory.addGetterSetter(Kinetic.Line,"points"),Kinetic.Collection.mapMethods(Kinetic.Line)}(),function(){Kinetic.Sprite=function(a){this.___init(a)},Kinetic.Sprite.prototype={___init:function(a){Kinetic.Shape.call(this,a),this.className="Sprite",this.anim=new Kinetic.Animation,this.on("animationChange.kinetic",function(){this.frameIndex(0)}),this.on("frameRateChange.kinetic",function(){this.anim.isRunning()&&(clearInterval(this.interval),this._setInterval())}),this.sceneFunc(this._sceneFunc),this.hitFunc(this._hitFunc)},_sceneFunc:function(a){var b=this.getAnimation(),c=this.frameIndex(),d=4*c,e=this.getAnimations()[b],f=e[d+0],g=e[d+1],h=e[d+2],i=e[d+3],j=this.getImage();j&&a.drawImage(j,f,g,h,i,0,0,h,i)},_hitFunc:function(a){var b=this.getAnimation(),c=this.frameIndex(),d=4*c,e=this.getAnimations()[b],f=e[d+2],g=e[d+3];a.beginPath(),a.rect(0,0,f,g),a.closePath(),a.fillShape(this)},_useBufferCanvas:function(){return(this.hasShadow()||1!==this.getAbsoluteOpacity())&&this.hasStroke()},_setInterval:function(){var a=this;this.interval=setInterval(function(){a._updateIndex()},1e3/this.getFrameRate())},start:function(){var a=this.getLayer();this.anim.setLayers(a),this._setInterval(),this.anim.start()},stop:function(){this.anim.stop(),clearInterval(this.interval)},isRunning:function(){return this.anim.isRunning()},_updateIndex:function(){var a=this.frameIndex(),b=this.getAnimation(),c=this.getAnimations(),d=c[b],e=d.length/4;this.frameIndex(e-1>a?a+1:0)}},Kinetic.Util.extend(Kinetic.Sprite,Kinetic.Shape),Kinetic.Factory.addGetterSetter(Kinetic.Sprite,"animation"),Kinetic.Factory.addGetterSetter(Kinetic.Sprite,"animations"),Kinetic.Factory.addGetterSetter(Kinetic.Sprite,"image"),Kinetic.Factory.addGetterSetter(Kinetic.Sprite,"frameIndex",0),Kinetic.Factory.addGetterSetter(Kinetic.Sprite,"frameRate",17),Kinetic.Factory.backCompat(Kinetic.Sprite,{index:"frameIndex",getIndex:"getFrameIndex",setIndex:"setFrameIndex"}),Kinetic.Collection.mapMethods(Kinetic.Sprite)}(),function(){Kinetic.Path=function(a){this.___init(a)},Kinetic.Path.prototype={___init:function(a){this.dataArray=[];var b=this;Kinetic.Shape.call(this,a),this.className="Path",this.dataArray=Kinetic.Path.parsePathData(this.getData()),this.on("dataChange.kinetic",function(){b.dataArray=Kinetic.Path.parsePathData(this.getData())}),this.sceneFunc(this._sceneFunc)},_sceneFunc:function(a){var b=this.dataArray,c=!1;a.beginPath();for(var d=0;d<b.length;d++){var e=b[d].command,f=b[d].points;switch(e){case"L":a.lineTo(f[0],f[1]);break;case"M":a.moveTo(f[0],f[1]);break;case"C":a.bezierCurveTo(f[0],f[1],f[2],f[3],f[4],f[5]);break;case"Q":a.quadraticCurveTo(f[0],f[1],f[2],f[3]);break;case"A":var g=f[0],h=f[1],i=f[2],j=f[3],k=f[4],l=f[5],m=f[6],n=f[7],o=i>j?i:j,p=i>j?1:i/j,q=i>j?j/i:1;a.translate(g,h),a.rotate(m),a.scale(p,q),a.arc(0,0,o,k,k+l,1-n),a.scale(1/p,1/q),a.rotate(-m),a.translate(-g,-h);break;case"z":a.closePath(),c=!0}}c?a.fillStrokeShape(this):a.strokeShape(this)}},Kinetic.Util.extend(Kinetic.Path,Kinetic.Shape),Kinetic.Path.getLineLength=function(a,b,c,d){return Math.sqrt((c-a)*(c-a)+(d-b)*(d-b))},Kinetic.Path.getPointOnLine=function(a,b,c,d,e,f,g){void 0===f&&(f=b),void 0===g&&(g=c);var h=(e-c)/(d-b+1e-8),i=Math.sqrt(a*a/(1+h*h));b>d&&(i*=-1);var j,k=h*i;if(d===b)j={x:f,y:g+k};else if((g-c)/(f-b+1e-8)===h)j={x:f+i,y:g+k};else{var l,m,n=this.getLineLength(b,c,d,e);if(1e-8>n)return void 0;var o=(f-b)*(d-b)+(g-c)*(e-c);o/=n*n,l=b+o*(d-b),m=c+o*(e-c);var p=this.getLineLength(f,g,l,m),q=Math.sqrt(a*a-p*p);i=Math.sqrt(q*q/(1+h*h)),b>d&&(i*=-1),k=h*i,j={x:l+i,y:m+k}}return j},Kinetic.Path.getPointOnCubicBezier=function(a,b,c,d,e,f,g,h,i){function j(a){return a*a*a}function k(a){return 3*a*a*(1-a)}function l(a){return 3*a*(1-a)*(1-a)}function m(a){return(1-a)*(1-a)*(1-a)}var n=h*j(a)+f*k(a)+d*l(a)+b*m(a),o=i*j(a)+g*k(a)+e*l(a)+c*m(a);return{x:n,y:o}},Kinetic.Path.getPointOnQuadraticBezier=function(a,b,c,d,e,f,g){function h(a){return a*a}function i(a){return 2*a*(1-a)}function j(a){return(1-a)*(1-a)}var k=f*h(a)+d*i(a)+b*j(a),l=g*h(a)+e*i(a)+c*j(a);return{x:k,y:l}},Kinetic.Path.getPointOnEllipticalArc=function(a,b,c,d,e,f){var g=Math.cos(f),h=Math.sin(f),i={x:c*Math.cos(e),y:d*Math.sin(e)};return{x:a+(i.x*g-i.y*h),y:b+(i.x*h+i.y*g)}},Kinetic.Path.parsePathData=function(a){if(!a)return[];var b=a,c=["m","M","l","L","v","V","h","H","z","Z","c","C","q","Q","t","T","s","S","a","A"];b=b.replace(new RegExp(" ","g"),",");for(var d=0;d<c.length;d++)b=b.replace(new RegExp(c[d],"g"),"|"+c[d]);var e=b.split("|"),f=[],g=0,h=0;for(d=1;d<e.length;d++){var i=e[d],j=i.charAt(0);i=i.slice(1),i=i.replace(new RegExp(",-","g"),"-"),i=i.replace(new RegExp("-","g"),",-"),i=i.replace(new RegExp("e,-","g"),"e-");var k=i.split(",");k.length>0&&""===k[0]&&k.shift();for(var l=0;l<k.length;l++)k[l]=parseFloat(k[l]);for(;k.length>0&&!isNaN(k[0]);){var m,n,o,p,q,r,s,t,u,v,w=null,x=[],y=g,z=h;switch(j){case"l":g+=k.shift(),h+=k.shift(),w="L",x.push(g,h);break;case"L":g=k.shift(),h=k.shift(),x.push(g,h);break;case"m":var A=k.shift(),B=k.shift();if(g+=A,h+=B,w="M",f.length>2&&"z"===f[f.length-1].command)for(var C=f.length-2;C>=0;C--)if("M"===f[C].command){g=f[C].points[0]+A,h=f[C].points[1]+B;break}x.push(g,h),j="l";break;case"M":g=k.shift(),h=k.shift(),w="M",x.push(g,h),j="L";break;case"h":g+=k.shift(),w="L",x.push(g,h);break;case"H":g=k.shift(),w="L",x.push(g,h);break;case"v":h+=k.shift(),w="L",x.push(g,h);break;case"V":h=k.shift(),w="L",x.push(g,h);break;case"C":x.push(k.shift(),k.shift(),k.shift(),k.shift()),g=k.shift(),h=k.shift(),x.push(g,h);break;case"c":x.push(g+k.shift(),h+k.shift(),g+k.shift(),h+k.shift()),g+=k.shift(),h+=k.shift(),w="C",x.push(g,h);break;case"S":n=g,o=h,m=f[f.length-1],"C"===m.command&&(n=g+(g-m.points[2]),o=h+(h-m.points[3])),x.push(n,o,k.shift(),k.shift()),g=k.shift(),h=k.shift(),w="C",x.push(g,h);break;case"s":n=g,o=h,m=f[f.length-1],"C"===m.command&&(n=g+(g-m.points[2]),o=h+(h-m.points[3])),x.push(n,o,g+k.shift(),h+k.shift()),g+=k.shift(),h+=k.shift(),w="C",x.push(g,h);break;case"Q":x.push(k.shift(),k.shift()),g=k.shift(),h=k.shift(),x.push(g,h);break;case"q":x.push(g+k.shift(),h+k.shift()),g+=k.shift(),h+=k.shift(),w="Q",x.push(g,h);break;case"T":n=g,o=h,m=f[f.length-1],"Q"===m.command&&(n=g+(g-m.points[0]),o=h+(h-m.points[1])),g=k.shift(),h=k.shift(),w="Q",x.push(n,o,g,h);break;case"t":n=g,o=h,m=f[f.length-1],"Q"===m.command&&(n=g+(g-m.points[0]),o=h+(h-m.points[1])),g+=k.shift(),h+=k.shift(),w="Q",x.push(n,o,g,h);break;case"A":p=k.shift(),q=k.shift(),r=k.shift(),s=k.shift(),t=k.shift(),u=g,v=h,g=k.shift(),h=k.shift(),w="A",x=this.convertEndpointToCenterParameterization(u,v,g,h,s,t,p,q,r);break;case"a":p=k.shift(),q=k.shift(),r=k.shift(),s=k.shift(),t=k.shift(),u=g,v=h,g+=k.shift(),h+=k.shift(),w="A",x=this.convertEndpointToCenterParameterization(u,v,g,h,s,t,p,q,r)}f.push({command:w||j,points:x,start:{x:y,y:z},pathLength:this.calcLength(y,z,w||j,x)})}("z"===j||"Z"===j)&&f.push({command:"z",points:[],start:void 0,pathLength:0})}return f},Kinetic.Path.calcLength=function(a,b,c,d){var e,f,g,h,i=Kinetic.Path;switch(c){case"L":return i.getLineLength(a,b,d[0],d[1]);case"C":for(e=0,f=i.getPointOnCubicBezier(0,a,b,d[0],d[1],d[2],d[3],d[4],d[5]),h=.01;1>=h;h+=.01)g=i.getPointOnCubicBezier(h,a,b,d[0],d[1],d[2],d[3],d[4],d[5]),e+=i.getLineLength(f.x,f.y,g.x,g.y),f=g;return e;case"Q":for(e=0,f=i.getPointOnQuadraticBezier(0,a,b,d[0],d[1],d[2],d[3]),h=.01;1>=h;h+=.01)g=i.getPointOnQuadraticBezier(h,a,b,d[0],d[1],d[2],d[3]),e+=i.getLineLength(f.x,f.y,g.x,g.y),f=g;return e;case"A":e=0;var j=d[4],k=d[5],l=d[4]+k,m=Math.PI/180;if(Math.abs(j-l)<m&&(m=Math.abs(j-l)),f=i.getPointOnEllipticalArc(d[0],d[1],d[2],d[3],j,0),0>k)for(h=j-m;h>l;h-=m)g=i.getPointOnEllipticalArc(d[0],d[1],d[2],d[3],h,0),e+=i.getLineLength(f.x,f.y,g.x,g.y),f=g;else for(h=j+m;l>h;h+=m)g=i.getPointOnEllipticalArc(d[0],d[1],d[2],d[3],h,0),e+=i.getLineLength(f.x,f.y,g.x,g.y),f=g;return g=i.getPointOnEllipticalArc(d[0],d[1],d[2],d[3],l,0),e+=i.getLineLength(f.x,f.y,g.x,g.y)}return 0},Kinetic.Path.convertEndpointToCenterParameterization=function(a,b,c,d,e,f,g,h,i){var j=i*(Math.PI/180),k=Math.cos(j)*(a-c)/2+Math.sin(j)*(b-d)/2,l=-1*Math.sin(j)*(a-c)/2+Math.cos(j)*(b-d)/2,m=k*k/(g*g)+l*l/(h*h);m>1&&(g*=Math.sqrt(m),h*=Math.sqrt(m));var n=Math.sqrt((g*g*h*h-g*g*l*l-h*h*k*k)/(g*g*l*l+h*h*k*k));e===f&&(n*=-1),isNaN(n)&&(n=0);var o=n*g*l/h,p=n*-h*k/g,q=(a+c)/2+Math.cos(j)*o-Math.sin(j)*p,r=(b+d)/2+Math.sin(j)*o+Math.cos(j)*p,s=function(a){return Math.sqrt(a[0]*a[0]+a[1]*a[1])},t=function(a,b){return(a[0]*b[0]+a[1]*b[1])/(s(a)*s(b))},u=function(a,b){return(a[0]*b[1]<a[1]*b[0]?-1:1)*Math.acos(t(a,b))},v=u([1,0],[(k-o)/g,(l-p)/h]),w=[(k-o)/g,(l-p)/h],x=[(-1*k-o)/g,(-1*l-p)/h],y=u(w,x);return t(w,x)<=-1&&(y=Math.PI),t(w,x)>=1&&(y=0),0===f&&y>0&&(y-=2*Math.PI),1===f&&0>y&&(y+=2*Math.PI),[q,r,g,h,v,y,j,f]},Kinetic.Factory.addGetterSetter(Kinetic.Path,"data"),Kinetic.Collection.mapMethods(Kinetic.Path)}(),function(){function a(a){a.fillText(this.partialText,0,0)}function b(a){a.strokeText(this.partialText,0,0)}var c="",d="normal";Kinetic.TextPath=function(a){this.___init(a)},Kinetic.TextPath.prototype={___init:function(c){var d=this;this.dummyCanvas=Kinetic.Util.createCanvasElement(),this.dataArray=[],Kinetic.Shape.call(this,c),this._fillFunc=a,this._strokeFunc=b,this._fillFuncHit=a,this._strokeFuncHit=b,this.className="TextPath",this.dataArray=Kinetic.Path.parsePathData(this.attrs.data),this.on("dataChange.kinetic",function(){d.dataArray=Kinetic.Path.parsePathData(this.attrs.data)}),this.on("textChange.kinetic textStroke.kinetic textStrokeWidth.kinetic",d._setTextData),d._setTextData(),this.sceneFunc(this._sceneFunc)},_sceneFunc:function(a){a.setAttr("font",this._getContextFont()),a.setAttr("textBaseline","middle"),a.setAttr("textAlign","left"),a.save();for(var b=this.glyphInfo,c=0;c<b.length;c++){a.save();var d=b[c].p0;a.translate(d.x,d.y),a.rotate(b[c].rotation),this.partialText=b[c].text,a.fillStrokeShape(this),a.restore()}a.restore()},getTextWidth:function(){return this.textWidth},getTextHeight:function(){return this.textHeight},setText:function(a){Kinetic.Text.prototype.setText.call(this,a)},_getTextSize:function(a){var b=this.dummyCanvas,c=b.getContext("2d");c.save(),c.font=this._getContextFont();var d=c.measureText(a);return c.restore(),{width:d.width,height:parseInt(this.attrs.fontSize,10)}},_setTextData:function(){var a=this,b=this._getTextSize(this.attrs.text);this.textWidth=b.width,this.textHeight=b.height,this.glyphInfo=[];for(var c,d,e,f=this.attrs.text.split(""),g=-1,h=0,i=function(){h=0;for(var b=a.dataArray,d=g+1;d<b.length;d++){if(b[d].pathLength>0)return g=d,b[d];"M"==b[d].command&&(c={x:b[d].points[0],y:b[d].points[1]})}return{}},j=function(b){var f=a._getTextSize(b).width,g=0,j=0;for(d=void 0;Math.abs(f-g)/f>.01&&25>j;){j++;for(var k=g;void 0===e;)e=i(),e&&k+e.pathLength<f&&(k+=e.pathLength,e=void 0);if(e==={}||void 0===c)return void 0;var l=!1;switch(e.command){case"L":Kinetic.Path.getLineLength(c.x,c.y,e.points[0],e.points[1])>f?d=Kinetic.Path.getPointOnLine(f,c.x,c.y,e.points[0],e.points[1],c.x,c.y):e=void 0;break;case"A":var m=e.points[4],n=e.points[5],o=e.points[4]+n;0===h?h=m+1e-8:f>g?h+=Math.PI/180*n/Math.abs(n):h-=Math.PI/360*n/Math.abs(n),(0>n&&o>h||n>=0&&h>o)&&(h=o,l=!0),d=Kinetic.Path.getPointOnEllipticalArc(e.points[0],e.points[1],e.points[2],e.points[3],h,e.points[6]);break;case"C":0===h?h=f>e.pathLength?1e-8:f/e.pathLength:f>g?h+=(f-g)/e.pathLength:h-=(g-f)/e.pathLength,h>1&&(h=1,l=!0),d=Kinetic.Path.getPointOnCubicBezier(h,e.start.x,e.start.y,e.points[0],e.points[1],e.points[2],e.points[3],e.points[4],e.points[5]);break;case"Q":0===h?h=f/e.pathLength:f>g?h+=(f-g)/e.pathLength:h-=(g-f)/e.pathLength,h>1&&(h=1,l=!0),d=Kinetic.Path.getPointOnQuadraticBezier(h,e.start.x,e.start.y,e.points[0],e.points[1],e.points[2],e.points[3])}void 0!==d&&(g=Kinetic.Path.getLineLength(c.x,c.y,d.x,d.y)),l&&(l=!1,e=void 0)}},k=0;k<f.length&&(j(f[k]),void 0!==c&&void 0!==d);k++){var l=Kinetic.Path.getLineLength(c.x,c.y,d.x,d.y),m=0,n=Kinetic.Path.getPointOnLine(m+l/2,c.x,c.y,d.x,d.y),o=Math.atan2(d.y-c.y,d.x-c.x);this.glyphInfo.push({transposeX:n.x,transposeY:n.y,text:f[k],rotation:o,p0:c,p1:d}),c=d}}},Kinetic.TextPath.prototype._getContextFont=Kinetic.Text.prototype._getContextFont,Kinetic.Util.extend(Kinetic.TextPath,Kinetic.Shape),Kinetic.Factory.addGetterSetter(Kinetic.TextPath,"fontFamily","Arial"),Kinetic.Factory.addGetterSetter(Kinetic.TextPath,"fontSize",12),Kinetic.Factory.addGetterSetter(Kinetic.TextPath,"fontStyle",d),Kinetic.Factory.addGetterSetter(Kinetic.TextPath,"fontVariant",d),Kinetic.Factory.addGetter(Kinetic.TextPath,"text",c),Kinetic.Collection.mapMethods(Kinetic.TextPath)}(),function(){Kinetic.RegularPolygon=function(a){this.___init(a)},Kinetic.RegularPolygon.prototype={___init:function(a){Kinetic.Shape.call(this,a),this.className="RegularPolygon",this.sceneFunc(this._sceneFunc)},_sceneFunc:function(a){var b,c,d,e=this.attrs.sides,f=this.attrs.radius;for(a.beginPath(),a.moveTo(0,0-f),b=1;e>b;b++)c=f*Math.sin(2*b*Math.PI/e),d=-1*f*Math.cos(2*b*Math.PI/e),a.lineTo(c,d);a.closePath(),a.fillStrokeShape(this)}},Kinetic.Util.extend(Kinetic.RegularPolygon,Kinetic.Shape),Kinetic.Factory.addGetterSetter(Kinetic.RegularPolygon,"radius",0),Kinetic.Factory.addGetterSetter(Kinetic.RegularPolygon,"sides",0),Kinetic.Collection.mapMethods(Kinetic.RegularPolygon)}(),function(){Kinetic.Star=function(a){this.___init(a)},Kinetic.Star.prototype={___init:function(a){Kinetic.Shape.call(this,a),this.className="Star",this.sceneFunc(this._sceneFunc)},_sceneFunc:function(a){var b=this.innerRadius(),c=this.outerRadius(),d=this.numPoints();a.beginPath(),a.moveTo(0,0-c);for(var e=1;2*d>e;e++){var f=e%2===0?c:b,g=f*Math.sin(e*Math.PI/d),h=-1*f*Math.cos(e*Math.PI/d);a.lineTo(g,h)}a.closePath(),a.fillStrokeShape(this)}},Kinetic.Util.extend(Kinetic.Star,Kinetic.Shape),Kinetic.Factory.addGetterSetter(Kinetic.Star,"numPoints",5),Kinetic.Factory.addGetterSetter(Kinetic.Star,"innerRadius",0),Kinetic.Factory.addGetterSetter(Kinetic.Star,"outerRadius",0),Kinetic.Collection.mapMethods(Kinetic.Star)}(),function(){var a=["fontFamily","fontSize","fontStyle","padding","lineHeight","text"],b="Change.kinetic",c="none",d="up",e="right",f="down",g="left",h="Label",i=a.length;Kinetic.Label=function(a){this.____init(a)},Kinetic.Label.prototype={____init:function(a){var b=this;this.className=h,Kinetic.Group.call(this,a),this.on("add.kinetic",function(a){b._addListeners(a.child),b._sync()})},getText:function(){return this.find("Text")[0]},getTag:function(){return this.find("Tag")[0]},_addListeners:function(c){var d,e=this,f=function(){e._sync()};for(d=0;i>d;d++)c.on(a[d]+b,f)},getWidth:function(){return this.getText().getWidth()},getHeight:function(){return this.getText().getHeight()},_sync:function(){var a,b,c,h,i,j,k,l=this.getText(),m=this.getTag();if(l&&m){switch(a=l.getWidth(),b=l.getHeight(),c=m.getPointerDirection(),h=m.getPointerWidth(),k=m.getPointerHeight(),i=0,j=0,c){case d:i=a/2,j=-1*k;break;case e:i=a+h,j=b/2;break;case f:i=a/2,j=b+k;break;case g:i=-1*h,j=b/2}m.setAttrs({x:-1*i,y:-1*j,width:a,height:b}),l.setAttrs({x:-1*i,y:-1*j})}}},Kinetic.Util.extend(Kinetic.Label,Kinetic.Group),Kinetic.Collection.mapMethods(Kinetic.Label),Kinetic.Tag=function(a){this.___init(a)},Kinetic.Tag.prototype={___init:function(a){Kinetic.Shape.call(this,a),this.className="Tag",this.sceneFunc(this._sceneFunc)},_sceneFunc:function(a){var b=this.getWidth(),c=this.getHeight(),h=this.getPointerDirection(),i=this.getPointerWidth(),j=this.getPointerHeight();a.beginPath(),a.moveTo(0,0),h===d&&(a.lineTo((b-i)/2,0),a.lineTo(b/2,-1*j),a.lineTo((b+i)/2,0)),a.lineTo(b,0),h===e&&(a.lineTo(b,(c-j)/2),a.lineTo(b+i,c/2),a.lineTo(b,(c+j)/2)),a.lineTo(b,c),h===f&&(a.lineTo((b+i)/2,c),a.lineTo(b/2,c+j),a.lineTo((b-i)/2,c)),a.lineTo(0,c),h===g&&(a.lineTo(0,(c+j)/2),a.lineTo(-1*i,c/2),a.lineTo(0,(c-j)/2)),a.closePath(),a.fillStrokeShape(this)}},Kinetic.Util.extend(Kinetic.Tag,Kinetic.Shape),Kinetic.Factory.addGetterSetter(Kinetic.Tag,"pointerDirection",c),Kinetic.Factory.addGetterSetter(Kinetic.Tag,"pointerWidth",0),Kinetic.Factory.addGetterSetter(Kinetic.Tag,"pointerHeight",0),Kinetic.Factory.addGetterSetter(Kinetic.Tag,"cornerRadius",0),Kinetic.Collection.mapMethods(Kinetic.Tag)}();
(function(b){b.PlayerUtils=function(c){if(c.hasOwnProperty("getPlayerServices")){this.player=c;this.playerServices=c.getPlayerServices();this.scoreService=this.playerServices.getScore();this.timeService=this.playerServices.getTimeService();}};b.PlayerUtils.prototype.getPresentation=function a(){if(this.hasOwnProperty("playerServices")){return this.playerServices.getPresentation();}else{return undefined;}};b.PlayerUtils.prototype.getPresentationScore=function(c){return this.getPresentationScoreBase(c,false);};b.PlayerUtils.prototype.getFullPresentationScore=function(c){return this.getPresentationScoreBase(c,true);};b.PlayerUtils.prototype.getPresentationScoreBase=function(x,h){if(this.hasOwnProperty("scoreService")){var e=0,n=0,f=0,g=0,r=0,q=0,c=0,v=0,d=0,k=0,s,j,t,m=[];for(s=0;s<x.getPageCount();s++){j=x.getPage(s);if(j.isReportable()){t=this.scoreService.getPageScoreWithoutOpenActivitiesById(j.getId());if(t["maxScore"]){v=t["score"]/t["maxScore"];}else{v=j.isVisited()?1:0;}var w=j.getPageWeight();var l=!w&&w!==0?1:w;r+=v*l;e+=t.score;n+=t.errorCount;f+=t.checkCount;g+=t.maxScore;q+=t.mistakeCount;c+=l;m[k]={"page_number":(s+1),"page_name":j.getName(),"page_id":j.getId(),"score":Math.round(v*100)/100,"absolute_score":t["score"],"max_score":t["maxScore"]?t["maxScore"]:j.getModulesMaxScore(),"errors_count":t["errorCount"]?t["errorCount"]:0,"checks_count":t["checkCount"]?t["checkCount"]:0,"mistake_count":t["mistakeCount"]?t["mistakeCount"]:0,"time":t["time"]?parseInt(t["time"],10):0};if(h){m[k]["reportable"]=true;}k+=1;d+=1;}else{if(h){var p=this.timeService.getPageTimeById(j.getId());m[k]={"page_number":(s+1),"page_name":j.getName(),"page_id":j.getId(),"score":0,"absolute_score":0,"max_score":0,"errors_count":0,"checks_count":0,"mistake_count":0,"time":p?parseInt(p,10):0,"reportable":false};k+=1;}}}var u=0;var o=0;if(k>0){if(c){u=Math.round((r/c)*100)/100;o=r/c;}else{u=1;o=1;}}totalTime=parseInt(this.timeService.getTotalTime(),10);return{minScore:0,maxScore:d,rawScore:r,floatScore:o,scaledScore:u,errorsCount:n,checksCount:f,mistakeCount:q,paginatedResult:m,totalTime:totalTime};}};})(window);
/*! https://mths.be/startswith v0.2.0 by @mathias */
;if(!String.prototype.startsWith){(function(){var a=(function(){try{var g={};var f=Object.defineProperty;var d=f(g,g,g)&&f;}catch(e){}return d;}());var c={}.toString;var b=function(k){if(this==null){throw TypeError();}var h=String(this);if(k&&c.call(k)=="[object RegExp]"){throw TypeError();}var d=h.length;var l=String(k);var f=l.length;var g=arguments.length>1?arguments[1]:undefined;var j=g?Number(g):0;if(j!=j){j=0;}var e=Math.min(Math.max(j,0),d);if(f+e>d){return false;}var i=-1;while(++i<f){if(h.charCodeAt(e+i)!=l.charCodeAt(i)){return false;}}return true;};if(a){a(String.prototype,"startsWith",{"value":b,"configurable":true,"writable":true});}else{String.prototype.startsWith=b;}}());}
/*! @license DOMPurify 2.4.0 | (c) Cure53 and other contributors | Released under the Apache license 2.0 and Mozilla Public License 2.0 | github.com/cure53/DOMPurify/blob/2.4.0/LICENSE */
(function(b,a){typeof exports==="object"&&typeof module!=="undefined"?module.exports=a():typeof define==="function"&&define.amd?define(a):(b=typeof globalThis!=="undefined"?globalThis:b||self,b.DOMPurify=a());})(this,(function(){function ae(ah){return ae="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(ai){return typeof ai;}:function(ai){return ai&&"function"==typeof Symbol&&ai.constructor===Symbol&&ai!==Symbol.prototype?"symbol":typeof ai;},ae(ah);}function O(ai,ah){aj=Object.setPrototypeOf||function aj(al,ak){al.__proto__=ak;return al;};return aj(ai,ah);}function af(){if(typeof Reflect==="undefined"||!Reflect.construct){return false;}if(Reflect.construct.sham){return false;}if(typeof Proxy==="function"){return true;}try{Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}));return true;}catch(ah){return false;}}function p(ak,aj,ai){if(af()){ah=Reflect.construct;}else{ah=function ah(ap,ao,an){var am=[null];am.push.apply(am,ao);var aq=Function.bind.apply(ap,am);var al=new aq();if(an){O(al,an.prototype);}return al;};}return ah.apply(null,arguments);}function Q(ah){return e(ah)||y(ah)||v(ah)||m();}function e(ah){if(Array.isArray(ah)){return a(ah);}}function y(ah){if(typeof Symbol!=="undefined"&&ah[Symbol.iterator]!=null||ah["@@iterator"]!=null){return Array.from(ah);}}function v(ai,ah){if(!ai){return;}if(typeof ai==="string"){return a(ai,ah);}var aj=Object.prototype.toString.call(ai).slice(8,-1);if(aj==="Object"&&ai.constructor){aj=ai.constructor.name;}if(aj==="Map"||aj==="Set"){return Array.from(ai);}if(aj==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(aj)){return a(ai,ah);}}function a(ai,ah){if(ah==null||ah>ai.length){ah=ai.length;}for(var ak=0,aj=new Array(ah);ak<ah;ak++){aj[ak]=ai[ak];}return aj;}function m(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");}var n=Object.hasOwnProperty,N=Object.setPrototypeOf,S=Object.isFrozen,X=Object.getPrototypeOf,D=Object.getOwnPropertyDescriptor;var x=Object.freeze,P=Object.seal,o=Object.create;var U=typeof Reflect!=="undefined"&&Reflect,ac=U.apply,E=U.construct;if(!ac){ac=function ac(ai,ah,aj){return ai.apply(ah,aj);};}if(!x){x=function x(ah){return ah;};}if(!P){P=function P(ah){return ah;};}if(!E){E=function E(ai,ah){return p(ai,Q(ah));};}var F=ag(Array.prototype.forEach);var l=ag(Array.prototype.pop);var j=ag(Array.prototype.push);var R=ag(String.prototype.toLowerCase);var C=ag(String.prototype.match);var d=ag(String.prototype.replace);var ab=ag(String.prototype.indexOf);var ad=ag(String.prototype.trim);var t=ag(RegExp.prototype.test);var i=A(TypeError);function ag(ah){return function(aj){for(var ai=arguments.length,ak=new Array(ai>1?ai-1:0),al=1;al<ai;al++){ak[al-1]=arguments[al];}return ac(ah,aj,ak);};}function A(ah){return function(){for(var ai=arguments.length,ak=new Array(ai),aj=0;aj<ai;aj++){ak[aj]=arguments[aj];}return E(ah,ak);};}function r(am,al,ak){ak=ak?ak:R;if(N){N(am,null);}var ai=al.length;while(ai--){var aj=al[ai];if(typeof aj==="string"){var ah=ak(aj);if(ah!==aj){if(!S(al)){al[ai]=ah;}aj=ah;}}am[aj]=true;}return am;}function B(ah){var ai=o(null);var aj;for(aj in ah){if(ac(n,ah,[aj])){ai[aj]=ah[aj];}}return ai;}function T(ai,ak){while(ai!==null){var aj=D(ai,ak);if(aj){if(aj.get){return ag(aj.get);}if(typeof aj.value==="function"){return ag(aj.value);}}ai=X(ai);}function ah(al){console.warn("fallback value for",al);return null;}return ah;}var aa=x(["a","abbr","acronym","address","area","article","aside","audio","b","bdi","bdo","big","blink","blockquote","body","br","button","canvas","caption","center","cite","code","col","colgroup","content","data","datalist","dd","decorator","del","details","dfn","dialog","dir","div","dl","dt","element","em","fieldset","figcaption","figure","font","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","img","input","ins","kbd","label","legend","li","main","map","mark","marquee","menu","menuitem","meter","nav","nobr","ol","optgroup","option","output","p","picture","pre","progress","q","rp","rt","ruby","s","samp","section","select","shadow","small","source","spacer","span","strike","strong","style","sub","summary","sup","table","tbody","td","template","textarea","tfoot","th","thead","time","tr","track","tt","u","ul","var","video","wbr"]);var V=x(["svg","a","altglyph","altglyphdef","altglyphitem","animatecolor","animatemotion","animatetransform","circle","clippath","defs","desc","ellipse","filter","font","g","glyph","glyphref","hkern","image","line","lineargradient","marker","mask","metadata","mpath","path","pattern","polygon","polyline","radialgradient","rect","stop","style","switch","symbol","text","textpath","title","tref","tspan","view","vkern"]);var J=x(["feBlend","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence"]);var q=x(["animate","color-profile","cursor","discard","fedropshadow","font-face","font-face-format","font-face-name","font-face-src","font-face-uri","foreignobject","hatch","hatchpath","mesh","meshgradient","meshpatch","meshrow","missing-glyph","script","set","solidcolor","unknown","use"]);var c=x(["math","menclose","merror","mfenced","mfrac","mglyph","mi","mlabeledtr","mmultiscripts","mn","mo","mover","mpadded","mphantom","mroot","mrow","ms","mspace","msqrt","mstyle","msub","msup","msubsup","mtable","mtd","mtext","mtr","munder","munderover"]);var u=x(["maction","maligngroup","malignmark","mlongdiv","mscarries","mscarry","msgroup","mstack","msline","msrow","semantics","annotation","annotation-xml","mprescripts","none"]);var I=x(["#text"]);var K=x(["accept","action","align","alt","autocapitalize","autocomplete","autopictureinpicture","autoplay","background","bgcolor","border","capture","cellpadding","cellspacing","checked","cite","class","clear","color","cols","colspan","controls","controlslist","coords","crossorigin","datetime","decoding","default","dir","disabled","disablepictureinpicture","disableremoteplayback","download","draggable","enctype","enterkeyhint","face","for","headers","height","hidden","high","href","hreflang","id","inputmode","integrity","ismap","kind","label","lang","list","loading","loop","low","max","maxlength","media","method","min","minlength","multiple","muted","name","nonce","noshade","novalidate","nowrap","open","optimum","pattern","placeholder","playsinline","poster","preload","pubdate","radiogroup","readonly","rel","required","rev","reversed","role","rows","rowspan","spellcheck","scope","selected","shape","size","sizes","span","srclang","start","src","srcset","step","style","summary","tabindex","title","translate","type","usemap","valign","value","width","xmlns","slot"]);var h=x(["accent-height","accumulate","additive","alignment-baseline","ascent","attributename","attributetype","azimuth","basefrequency","baseline-shift","begin","bias","by","class","clip","clippathunits","clip-path","clip-rule","color","color-interpolation","color-interpolation-filters","color-profile","color-rendering","cx","cy","d","dx","dy","diffuseconstant","direction","display","divisor","dur","edgemode","elevation","end","fill","fill-opacity","fill-rule","filter","filterunits","flood-color","flood-opacity","font-family","font-size","font-size-adjust","font-stretch","font-style","font-variant","font-weight","fx","fy","g1","g2","glyph-name","glyphref","gradientunits","gradienttransform","height","href","id","image-rendering","in","in2","k","k1","k2","k3","k4","kerning","keypoints","keysplines","keytimes","lang","lengthadjust","letter-spacing","kernelmatrix","kernelunitlength","lighting-color","local","marker-end","marker-mid","marker-start","markerheight","markerunits","markerwidth","maskcontentunits","maskunits","max","mask","media","method","mode","min","name","numoctaves","offset","operator","opacity","order","orient","orientation","origin","overflow","paint-order","path","pathlength","patterncontentunits","patterntransform","patternunits","points","preservealpha","preserveaspectratio","primitiveunits","r","rx","ry","radius","refx","refy","repeatcount","repeatdur","restart","result","rotate","scale","seed","shape-rendering","specularconstant","specularexponent","spreadmethod","startoffset","stddeviation","stitchtiles","stop-color","stop-opacity","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke","stroke-width","style","surfacescale","systemlanguage","tabindex","targetx","targety","transform","transform-origin","text-anchor","text-decoration","text-rendering","textlength","type","u1","u2","unicode","values","viewbox","visibility","version","vert-adv-y","vert-origin-x","vert-origin-y","width","word-spacing","wrap","writing-mode","xchannelselector","ychannelselector","x","x1","x2","xmlns","y","y1","y2","z","zoomandpan"]);
var b=x(["accent","accentunder","align","bevelled","close","columnsalign","columnlines","columnspan","denomalign","depth","dir","display","displaystyle","encoding","fence","frame","height","href","id","largeop","length","linethickness","lspace","lquote","mathbackground","mathcolor","mathsize","mathvariant","maxsize","minsize","movablelimits","notation","numalign","open","rowalign","rowlines","rowspacing","rowspan","rspace","rquote","scriptlevel","scriptminsize","scriptsizemultiplier","selection","separator","separators","stretchy","subscriptshift","supscriptshift","symmetric","voffset","width","xmlns"]);var z=x(["xlink:href","xml:id","xlink:title","xml:space","xmlns:xlink"]);var w=P(/\{\{[\w\W]*|[\w\W]*\}\}/gm);var W=P(/<%[\w\W]*|[\w\W]*%>/gm);var H=P(/^data-[\-\w.\u00B7-\uFFFF]/);var G=P(/^aria-[\-\w]+$/);var k=P(/^(?:(?:(?:f|ht)tps?|mailto|tel|callto|cid|xmpp):|[^a-z]|[a-z+.\-]+(?:[^a-z+.\-:]|$))/i);var M=P(/^(?:\w+script|data):/i);var Z=P(/[\u0000-\u0020\u00A0\u1680\u180E\u2000-\u2029\u205F\u3000]/g);var s=P(/^html$/i);var L=function L(){return typeof window==="undefined"?null:window;};var g=function g(al,ah){if(ae(al)!=="object"||typeof al.createPolicy!=="function"){return null;}var am=null;var ao="data-tt-policy-suffix";if(ah.currentScript&&ah.currentScript.hasAttribute(ao)){am=ah.currentScript.getAttribute(ao);}var an="dompurify"+(am?"#"+am:"");try{return al.createPolicy(an,{createHTML:function ak(ap){return ap;},createScriptURL:function aj(ap){return ap;}});}catch(ai){console.warn("TrustedTypes policy "+an+" could not be created.");return null;}};function f(){var bA=arguments.length>0&&arguments[0]!==undefined?arguments[0]:L();var bM=function bM(bS){return f(bS);};bM.version="2.4.0";bM.removed=[];if(!bA||!bA.document||bA.document.nodeType!==9){bM.isSupported=false;return bM;}var bo=bA.document;var aW=bA.document;var bJ=bA.DocumentFragment,a6=bA.HTMLTemplateElement,bl=bA.Node,be=bA.Element,aA=bA.NodeFilter,ar=bA.NamedNodeMap,al=ar===void 0?bA.NamedNodeMap||bA.MozNamedAttrMap:ar,aJ=bA.HTMLFormElement,ba=bA.DOMParser,an=bA.trustedTypes;var aT=be.prototype;var bH=T(aT,"cloneNode");var ao=T(aT,"nextSibling");var au=T(aT,"childNodes");var a9=T(aT,"parentNode");if(typeof a6==="function"){var aQ=aW.createElement("template");if(aQ.content&&aQ.content.ownerDocument){aW=aQ.content.ownerDocument;}}var ak=g(an,bo);var bu=ak?ak.createHTML(""):"";var bR=aW,bD=bR.implementation,bz=bR.createNodeIterator,bN=bR.createDocumentFragment,bx=bR.getElementsByTagName;var bv=bo.importNode;var bq={};try{bq=B(aW).documentMode?aW.documentMode:{};}catch(a0){}var bw={};bM.isSupported=typeof a9==="function"&&bD&&typeof bD.createHTMLDocument!=="undefined"&&bq!==9;var aS=w,aM=W,bp=H,aZ=G,aP=M,bB=Z;var bf=k;var aj=null;var ay=r({},[].concat(Q(aa),Q(V),Q(J),Q(c),Q(I)));var bt=null;var bO=r({},[].concat(Q(K),Q(h),Q(b),Q(z)));var at=Object.seal(Object.create(null,{tagNameCheck:{writable:true,configurable:false,enumerable:true,value:null},attributeNameCheck:{writable:true,configurable:false,enumerable:true,value:null},allowCustomizedBuiltInElements:{writable:true,configurable:false,enumerable:true,value:false}}));var a4=null;var aN=null;var bb=true;var aw=true;var bF=false;var aF=false;var ap=false;var bh=false;var bK=false;var ah=false;var bg=false;var aO=false;var aK=true;var by=false;var bL="user-content-";var ax=true;var bc=false;var br={};var a1=null;var bI=r({},["annotation-xml","audio","colgroup","desc","foreignobject","head","iframe","math","mi","mn","mo","ms","mtext","noembed","noframes","noscript","plaintext","script","style","svg","template","thead","title","video","xmp"]);var aU=null;var bn=r({},["audio","video","img","source","image","track"]);var aR=null;var bi=r({},["alt","class","for","id","label","name","pattern","placeholder","role","summary","title","value","style","xmlns"]);var aq="http://www.w3.org/1998/Math/MathML";var aH="http://www.w3.org/2000/svg";var bm="http://www.w3.org/1999/xhtml";var av=bm;var aB=false;var a2;var aL=["application/xhtml+xml","text/html"];var bd="text/html";var bk;var aE=null;var bG=aW.createElement("form");var aD=function aD(bS){return bS instanceof RegExp||bS instanceof Function;};var bE=function bE(bS){if(aE&&aE===bS){return;}if(!bS||ae(bS)!=="object"){bS={};}bS=B(bS);a2=aL.indexOf(bS.PARSER_MEDIA_TYPE)===-1?a2=bd:a2=bS.PARSER_MEDIA_TYPE;bk=a2==="application/xhtml+xml"?function(bT){return bT;}:R;aj="ALLOWED_TAGS" in bS?r({},bS.ALLOWED_TAGS,bk):ay;bt="ALLOWED_ATTR" in bS?r({},bS.ALLOWED_ATTR,bk):bO;aR="ADD_URI_SAFE_ATTR" in bS?r(B(bi),bS.ADD_URI_SAFE_ATTR,bk):bi;aU="ADD_DATA_URI_TAGS" in bS?r(B(bn),bS.ADD_DATA_URI_TAGS,bk):bn;a1="FORBID_CONTENTS" in bS?r({},bS.FORBID_CONTENTS,bk):bI;a4="FORBID_TAGS" in bS?r({},bS.FORBID_TAGS,bk):{};aN="FORBID_ATTR" in bS?r({},bS.FORBID_ATTR,bk):{};br="USE_PROFILES" in bS?bS.USE_PROFILES:false;bb=bS.ALLOW_ARIA_ATTR!==false;aw=bS.ALLOW_DATA_ATTR!==false;bF=bS.ALLOW_UNKNOWN_PROTOCOLS||false;aF=bS.SAFE_FOR_TEMPLATES||false;ap=bS.WHOLE_DOCUMENT||false;ah=bS.RETURN_DOM||false;bg=bS.RETURN_DOM_FRAGMENT||false;aO=bS.RETURN_TRUSTED_TYPE||false;bK=bS.FORCE_BODY||false;aK=bS.SANITIZE_DOM!==false;by=bS.SANITIZE_NAMED_PROPS||false;ax=bS.KEEP_CONTENT!==false;bc=bS.IN_PLACE||false;bf=bS.ALLOWED_URI_REGEXP||bf;av=bS.NAMESPACE||bm;if(bS.CUSTOM_ELEMENT_HANDLING&&aD(bS.CUSTOM_ELEMENT_HANDLING.tagNameCheck)){at.tagNameCheck=bS.CUSTOM_ELEMENT_HANDLING.tagNameCheck;}if(bS.CUSTOM_ELEMENT_HANDLING&&aD(bS.CUSTOM_ELEMENT_HANDLING.attributeNameCheck)){at.attributeNameCheck=bS.CUSTOM_ELEMENT_HANDLING.attributeNameCheck;}if(bS.CUSTOM_ELEMENT_HANDLING&&typeof bS.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements==="boolean"){at.allowCustomizedBuiltInElements=bS.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements;}if(aF){aw=false;}if(bg){ah=true;}if(br){aj=r({},Q(I));bt=[];if(br.html===true){r(aj,aa);r(bt,K);}if(br.svg===true){r(aj,V);r(bt,h);r(bt,z);}if(br.svgFilters===true){r(aj,J);r(bt,h);r(bt,z);}if(br.mathMl===true){r(aj,c);r(bt,b);r(bt,z);}}if(bS.ADD_TAGS){if(aj===ay){aj=B(aj);}r(aj,bS.ADD_TAGS,bk);}if(bS.ADD_ATTR){if(bt===bO){bt=B(bt);}r(bt,bS.ADD_ATTR,bk);}if(bS.ADD_URI_SAFE_ATTR){r(aR,bS.ADD_URI_SAFE_ATTR,bk);}if(bS.FORBID_CONTENTS){if(a1===bI){a1=B(a1);}r(a1,bS.FORBID_CONTENTS,bk);}if(ax){aj["#text"]=true;}if(ap){r(aj,["html","head","body"]);}if(aj.table){r(aj,["tbody"]);delete a4.tbody;}if(x){x(bS);}aE=bS;};var aX=r({},["mi","mo","mn","ms","mtext"]);var aC=r({},["foreignobject","desc","title","annotation-xml"]);var aY=r({},["title","style","font","a","script"]);var ai=r({},V);r(ai,J);r(ai,q);var am=r({},c);r(am,u);var a8=function a8(bU){var bV=a9(bU);if(!bV||!bV.tagName){bV={namespaceURI:bm,tagName:"template"};}var bT=R(bU.tagName);var bS=R(bV.tagName);if(bU.namespaceURI===aH){if(bV.namespaceURI===bm){return bT==="svg";}if(bV.namespaceURI===aq){return bT==="svg"&&(bS==="annotation-xml"||aX[bS]);}return Boolean(ai[bT]);}if(bU.namespaceURI===aq){if(bV.namespaceURI===bm){return bT==="math";}if(bV.namespaceURI===aH){return bT==="math"&&aC[bS];}return Boolean(am[bT]);}if(bU.namespaceURI===bm){if(bV.namespaceURI===aH&&!aC[bS]){return false;}if(bV.namespaceURI===aq&&!aX[bS]){return false;}return !am[bT]&&(aY[bT]||!ai[bT]);}return false;};var bj=function bj(bT){j(bM.removed,{element:bT});try{bT.parentNode.removeChild(bT);}catch(bS){try{bT.outerHTML=bu;}catch(bS){bT.remove();}}};var a5=function a5(bT,bU){try{j(bM.removed,{attribute:bU.getAttributeNode(bT),from:bU});}catch(bS){j(bM.removed,{attribute:null,from:bU});}bU.removeAttribute(bT);
if(bT==="is"&&!bt[bT]){if(ah||bg){try{bj(bU);}catch(bS){}}else{try{bU.setAttribute(bT,"");}catch(bS){}}}};var aG=function aG(bU){var bX;var bW;if(bK){bU="<remove></remove>"+bU;}else{var bV=C(bU,/^[\r\n\t ]+/);bW=bV&&bV[0];}if(a2==="application/xhtml+xml"){bU='<html xmlns="http://www.w3.org/1999/xhtml"><head></head><body>'+bU+"</body></html>";}var bY=ak?ak.createHTML(bU):bU;if(av===bm){try{bX=new ba().parseFromString(bY,a2);}catch(bT){}}if(!bX||!bX.documentElement){bX=bD.createDocument(av,"template",null);try{bX.documentElement.innerHTML=aB?"":bY;}catch(bT){}}var bS=bX.body||bX.documentElement;if(bU&&bW){bS.insertBefore(aW.createTextNode(bW),bS.childNodes[0]||null);}if(av===bm){return bx.call(bX,ap?"html":"body")[0];}return ap?bX.documentElement:bS;};var az=function az(bS){return bz.call(bS.ownerDocument||bS,bS,aA.SHOW_ELEMENT|aA.SHOW_COMMENT|aA.SHOW_TEXT,null,false);};var bQ=function bQ(bS){return bS instanceof aJ&&(typeof bS.nodeName!=="string"||typeof bS.textContent!=="string"||typeof bS.removeChild!=="function"||!(bS.attributes instanceof al)||typeof bS.removeAttribute!=="function"||typeof bS.setAttribute!=="function"||typeof bS.namespaceURI!=="string"||typeof bS.insertBefore!=="function"||typeof bS.hasChildNodes!=="function");};var a3=function a3(bS){return ae(bl)==="object"?bS instanceof bl:bS&&ae(bS)==="object"&&typeof bS.nodeType==="number"&&typeof bS.nodeName==="string";};var a7=function a7(bU,bS,bT){if(!bw[bU]){return;}F(bw[bU],function(bV){bV.call(bM,bS,bT,aE);});};var aV=function aV(bW){var bX;a7("beforeSanitizeElements",bW,null);if(bQ(bW)){bj(bW);return true;}if(t(/[\u0080-\uFFFF]/,bW.nodeName)){bj(bW);return true;}var bV=bk(bW.nodeName);a7("uponSanitizeElement",bW,{tagName:bV,allowedTags:aj});if(bW.hasChildNodes()&&!a3(bW.firstElementChild)&&(!a3(bW.content)||!a3(bW.content.firstElementChild))&&t(/<[/\w]/g,bW.innerHTML)&&t(/<[/\w]/g,bW.textContent)){bj(bW);return true;}if(bV==="select"&&t(/<template/i,bW.innerHTML)){bj(bW);return true;}if(!aj[bV]||a4[bV]){if(!a4[bV]&&bs(bV)){if(at.tagNameCheck instanceof RegExp&&t(at.tagNameCheck,bV)){return false;}if(at.tagNameCheck instanceof Function&&at.tagNameCheck(bV)){return false;}}if(ax&&!a1[bV]){var bS=a9(bW)||bW.parentNode;var bY=au(bW)||bW.childNodes;if(bY&&bS){var bT=bY.length;for(var bU=bT-1;bU>=0;--bU){bS.insertBefore(bH(bY[bU],true),ao(bW));}}}bj(bW);return true;}if(bW instanceof be&&!a8(bW)){bj(bW);return true;}if((bV==="noscript"||bV==="noembed")&&t(/<\/no(script|embed)/i,bW.innerHTML)){bj(bW);return true;}if(aF&&bW.nodeType===3){bX=bW.textContent;bX=d(bX,aS," ");bX=d(bX,aM," ");if(bW.textContent!==bX){j(bM.removed,{element:bW.cloneNode()});bW.textContent=bX;}}a7("afterSanitizeElements",bW,null);return false;};var bC=function bC(bT,bS,bU){if(aK&&(bS==="id"||bS==="name")&&(bU in aW||bU in bG)){return false;}if(aw&&!aN[bS]&&t(bp,bS)){}else{if(bb&&t(aZ,bS)){}else{if(!bt[bS]||aN[bS]){if(bs(bT)&&(at.tagNameCheck instanceof RegExp&&t(at.tagNameCheck,bT)||at.tagNameCheck instanceof Function&&at.tagNameCheck(bT))&&(at.attributeNameCheck instanceof RegExp&&t(at.attributeNameCheck,bS)||at.attributeNameCheck instanceof Function&&at.attributeNameCheck(bS))||bS==="is"&&at.allowCustomizedBuiltInElements&&(at.tagNameCheck instanceof RegExp&&t(at.tagNameCheck,bU)||at.tagNameCheck instanceof Function&&at.tagNameCheck(bU))){}else{return false;}}else{if(aR[bS]){}else{if(t(bf,d(bU,bB,""))){}else{if((bS==="src"||bS==="xlink:href"||bS==="href")&&bT!=="script"&&ab(bU,"data:")===0&&aU[bT]){}else{if(bF&&!t(aP,d(bU,bB,""))){}else{if(!bU){}else{return false;}}}}}}}}return true;};var bs=function bs(bS){return bS.indexOf("-")>0;};var bP=function bP(bT){var bY;var b0;var b3;var bV;a7("beforeSanitizeAttributes",bT,null);var bX=bT.attributes;if(!bX){return;}var b2={attrName:"",attrValue:"",keepAttr:true,allowedAttributes:bt};bV=bX.length;while(bV--){bY=bX[bV];var bW=bY,bS=bW.name,bU=bW.namespaceURI;b0=bS==="value"?bY.value:ad(bY.value);b3=bk(bS);b2.attrName=b3;b2.attrValue=b0;b2.keepAttr=true;b2.forceKeepAttr=undefined;a7("uponSanitizeAttribute",bT,b2);b0=b2.attrValue;if(b2.forceKeepAttr){continue;}a5(bS,bT);if(!b2.keepAttr){continue;}if(t(/\/>/i,b0)){a5(bS,bT);continue;}if(aF){b0=d(b0,aS," ");b0=d(b0,aM," ");}var bZ=bk(bT.nodeName);if(!bC(bZ,b3,b0)){continue;}if(by&&(b3==="id"||b3==="name")){a5(bS,bT);b0=bL+b0;}if(ak&&ae(an)==="object"&&typeof an.getAttributeType==="function"){if(bU){}else{switch(an.getAttributeType(bZ,b3)){case"TrustedHTML":b0=ak.createHTML(b0);break;case"TrustedScriptURL":b0=ak.createScriptURL(b0);break;}}}try{if(bU){bT.setAttributeNS(bU,bS,b0);}else{bT.setAttribute(bS,b0);}l(bM.removed);}catch(b1){}}a7("afterSanitizeAttributes",bT,null);};var aI=function aI(bS){var bU;var bT=az(bS);a7("beforeSanitizeShadowDOM",bS,null);while(bU=bT.nextNode()){a7("uponSanitizeShadowNode",bU,null);if(aV(bU)){continue;}if(bU.content instanceof bJ){aI(bU.content);}bP(bU);}a7("afterSanitizeShadowDOM",bS,null);};bM.sanitize=function(bS){var bZ=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};var bY;var b1;var bT;var bW;var bU;aB=!bS;if(aB){bS="<!-->";}if(typeof bS!=="string"&&!a3(bS)){if(typeof bS.toString!=="function"){throw i("toString is not a function");}else{bS=bS.toString();if(typeof bS!=="string"){throw i("dirty is not a string, aborting");}}}if(!bM.isSupported){if(ae(bA.toStaticHTML)==="object"||typeof bA.toStaticHTML==="function"){if(typeof bS==="string"){return bA.toStaticHTML(bS);}if(a3(bS)){return bA.toStaticHTML(bS.outerHTML);}}return bS;}if(!bh){bE(bZ);}bM.removed=[];if(typeof bS==="string"){bc=false;}if(bc){if(bS.nodeName){var bV=bk(bS.nodeName);if(!aj[bV]||a4[bV]){throw i("root node is forbidden and cannot be sanitized in-place");}}}else{if(bS instanceof bl){bY=aG("<!---->");b1=bY.ownerDocument.importNode(bS,true);if(b1.nodeType===1&&b1.nodeName==="BODY"){bY=b1;}else{if(b1.nodeName==="HTML"){bY=b1;}else{bY.appendChild(b1);}}}else{if(!ah&&!aF&&!ap&&bS.indexOf("<")===-1){return ak&&aO?ak.createHTML(bS):bS;}bY=aG(bS);if(!bY){return ah?null:aO?bu:"";}}}if(bY&&bK){bj(bY.firstChild);}var bX=az(bc?bS:bY);while(bT=bX.nextNode()){if(bT.nodeType===3&&bT===bW){continue;}if(aV(bT)){continue;}if(bT.content instanceof bJ){aI(bT.content);}bP(bT);bW=bT;}bW=null;if(bc){return bS;}if(ah){if(bg){bU=bN.call(bY.ownerDocument);while(bY.firstChild){bU.appendChild(bY.firstChild);}}else{bU=bY;}if(bt.shadowroot){bU=bv.call(bo,bU,true);}return bU;}var b0=ap?bY.outerHTML:bY.innerHTML;if(ap&&aj["!doctype"]&&bY.ownerDocument&&bY.ownerDocument.doctype&&bY.ownerDocument.doctype.name&&t(s,bY.ownerDocument.doctype.name)){b0="<!DOCTYPE "+bY.ownerDocument.doctype.name+">\n"+b0;}if(aF){b0=d(b0,aS," ");b0=d(b0,aM," ");}return ak&&aO?ak.createHTML(b0):b0;};bM.setConfig=function(bS){bE(bS);bh=true;};bM.clearConfig=function(){aE=null;bh=false;};bM.isValidAttribute=function(bT,bS,bW){if(!aE){bE({});}var bV=bk(bT);var bU=bk(bS);return bC(bV,bU,bW);};bM.addHook=function(bT,bS){if(typeof bS!=="function"){return;}bw[bT]=bw[bT]||[];j(bw[bT],bS);};bM.removeHook=function(bS){if(bw[bS]){return l(bw[bS]);}};bM.removeHooks=function(bS){if(bw[bS]){bw[bS]=[];}};bM.removeAllHooks=function(){bw={};};return bM;}var Y=f();return Y;}));
function getScorm(){var a=function(){};var c=0;var b=null;var f=500;var e=false;function d(g){while((g.API_1484_11==null)&&(g.parent!=null)&&(g.parent!=g)){c++;if(c>f){alert("Error in finding API instance -- too deeply nested.");return null;}g=g.parent;}return g.API_1484_11;}a.getAPI=function(g){if(b==null){if((g.parent!=null)&&(g.parent!=g)){b=d(window.parent);}if((b==null)&&(window.opener!=null)){b=d(window.opener);}if((b==null)){b=d(g);}}};a.initializeScormCommunication=function(h){this.getAPI(h);if(e==false&&b!=null){var g=b.Initialize("");if(g=="true"){e=true;return true;}else{return false;}}if(e==false&&b==null){return false;}return true;};a.commitScormCommunication=function(){if(e==true){return b.Commit("");}return false;};a.terminateScormCommunication=function(){if(e==true){return b.Terminate("");}return false;};a.setMinScore=function(g){if(e==true){return b.SetValue("cmi.score.min",g);}return false;};a.setMaxScore=function(g){if(e==true){return b.SetValue("cmi.score.max",g);}return false;};a.setRawScore=function(g){if(e==true){return b.SetValue("cmi.score.raw",g);}return false;};a.setScaledScore=function(g){if(e==true){return b.SetValue("cmi.score.scaled",g);}return false;};a.setPageName=function(h,g){if(e==true){return b.SetValue("cmi.objectives."+h+".id",g);}return false;};a.setPageMinScore=function(g,h){if(e==true){return b.SetValue("cmi.objectives."+g+".score.min",h);}return false;};a.setPageMaxScore=function(g,h){if(e==true){return b.SetValue("cmi.objectives."+g+".score.max",h);}return false;};a.setPageRawScore=function(g,h){if(e==true){return b.SetValue("cmi.objectives."+g+".score.raw",h);}return false;};a.setPageScaledScore=function(g,h){if(e==true){return b.SetValue("cmi.objectives."+g+".score.scaled",h);}return false;};a.setCompleted=function(){if(e==true){return b.SetValue("cmi.completion_status","completed");}return false;};a.setIncomplete=function(){if(e==true){return b.SetValue("cmi.completion_status","incomplete");}return false;};a.setNotAttempted=function(){if(e==true){return b.SetValue("cmi.completion_status","not attempted");}return false;};a.setFailed=function(){if(e==true){return b.SetValue("cmi.success_status","failed");}return false;};a.setPassed=function(){if(e==true){return b.SetValue("cmi.success_status","passed");}return false;};a.setSessionTime=function(i){var g=Math.floor(i%1000/10);var j=Math.floor(i/1000);var h="PT"+j+"."+g+"S";if(e==true){return b.SetValue("cmi.session_time",h);}return false;};a.saveState=function(g){if(e==true){b.SetValue("cmi.exit","suspend");return b.SetValue("cmi.suspend_data",g);}return false;};a.loadState=function(){if(e==true){return b.GetValue("cmi.suspend_data");}return false;};a.saveLocation=function(g){if(e==true){return b.SetValue("cmi.location",g);}return false;};a.loadLocation=function(){if(e==true){return b.GetValue("cmi.location");}return false;};return a;}
function getScorm_1_2(){var a=function(){};var c=0;var b=null;var f=500;var e=false;function d(g){while((g.API==null)&&(g.parent!=null)&&(g.parent!=g)){c++;if(c>f){alert("Error in finding API instance -- too deeply nested.");return null;}g=g.parent;}return g.API;}a.getAPI=function(g){if(b==null){if((g.parent!=null)&&(g.parent!=g)){b=d(window.parent);}if((b==null)&&(window.opener!=null)){b=d(window.opener);}if((b==null)){b=d(g);}}};a.initializeScormCommunication=function(h){this.getAPI(h);if(e==false&&b!=null){var g=b.LMSInitialize("");if(g=="true"){e=true;return true;}else{return false;}}if(e==false&&b==null){return false;}return true;};a.commitScormCommunication=function(){if(e==true){return b.LMSCommit("");}return false;};a.terminateScormCommunication=function(){if(e==true){return b.LMSFinish("");}return false;};a.setMinScore=function(g){if(e==true){return b.LMSSetValue("cmi.core.score.min",g);}return false;};a.setMaxScore=function(g){if(e==true){return b.LMSSetValue("cmi.core.score.max",g);}return false;};a.setRawScore=function(g){if(e==true){return b.LMSSetValue("cmi.core.score.raw",g);}return false;};a.setScaledScore=function(g){return true;};a.setPageName=function(h,g){if(e==true){return b.LMSSetValue("cmi.objectives."+h+".id",g);}return false;};a.setPageMinScore=function(g,h){if(e==true){return b.LMSSetValue("cmi.objectives."+g+".score.min",h);}return false;};a.setPageMaxScore=function(g,h){if(e==true){return b.LMSSetValue("cmi.objectives."+g+".score.max",h);}return false;};a.setPageRawScore=function(g,h){if(e==true){return b.LMSSetValue("cmi.objectives."+g+".score.raw",h);}return false;};a.setPageScaledScore=function(g,h){return false;};a.setCompleted=function(){if(e==true){return b.LMSSetValue("cmi.core.lesson_status","completed");}return false;};a.setIncomplete=function(){if(e==true){return b.LMSSetValue("cmi.core.lesson_status","incomplete");}return false;};a.setNotAttempted=function(){if(e==true){return b.LMSSetValue("cmi.core.lesson_status","not attempted");}return false;};a.setFailed=function(){if(e==true){return b.LMSSetValue("cmi.core.lesson_status","failed");}return false;};a.setPassed=function(){if(e==true){return b.LMSSetValue("cmi.core.lesson_status","passed");}return false;};a.setSessionTime=function(n){var i=Math.floor(n%1000/10);n=n/1000;var k=Math.floor(n/3600);var g=Math.floor((n-k*3600)/60);var j=Math.floor(n%60);var l=(k<10?"0":"")+k+":"+(g<10?"0":"")+g+":"+(j<10?"0":"")+j+"."+i;if(e==true){return b.LMSSetValue("cmi.core.session_time",l);}return false;};a.saveState=function(g){if(e==true){b.LMSSetValue("cmi.core.exit","suspend");return b.LMSSetValue("cmi.suspend_data",g);}return false;};a.loadState=function(){if(e==true){return b.LMSGetValue("cmi.suspend_data");}return false;};a.saveLocation=function(g){return false;};a.loadLocation=function(){return false;};return a;}
(function(){function b(e){this.converter=e.converter;this.data=e.path||e.data;this.imageData=[];this.multiplier=e.multiplier||1;this.padding=e.padding||0;this.fps=e.fps||25;this.stepsPerFrame=~~e.stepsPerFrame||1;this.trailLength=e.trailLength||1;this.pointDistance=e.pointDistance||0.05;this.domClass=e.domClass||"sonic";this.backgroundColor=e.backgroundColor||"rgba(0,0,0,0)";this.fillColor=e.fillColor;this.strokeColor=e.strokeColor;this.stepMethod=typeof e.step=="string"?c[e.step]:e.step||c.square;this._setup=e.setup||f;this._teardown=e.teardown||f;this._preStep=e.preStep||f;this.pixelRatio=e.pixelRatio||null;this.width=e.width;this.height=e.height;this.fullWidth=this.width+2*this.padding;this.fullHeight=this.height+2*this.padding;this.domClass=e.domClass||"sonic";this.setup();}var f=function(){};var g=b.argTypes={DIM:1,DEGREE:2,RADIUS:3,OTHER:0};var d=b.argSignatures={arc:[1,1,3,2,2,0],bezier:[1,1,1,1,1,1,1,1],line:[1,1,1,1]};var a=b.pathMethods={bezier:function(A,G,q,j,x,H,m,F,D){A=1-A;var z=1-A,w=A*A,C=z*z,y=w*A,k=3*w*z,B=3*A*C,E=C*z;return[y*G+k*H+B*F+E*j,y*q+k*m+B*D+E*x];},arc:function(p,k,v,m,j,l){var q=(l-j)*p+j;var h=[Math.cos(q)*m+k,Math.sin(q)*m+v];h.angle=q;h.t=p;return h;},line:function(l,j,m,k,h){return[(k-j)*l+j,(h-m)*l+m];}};var c=b.stepMethods={square:function(l,j,m,k,h){this._.fillRect(l.x-3,l.y-3,6,6);},fader:function(l,j,m,k,h){this._.beginPath();if(this._last){this._.moveTo(this._last.x,this._last.y);}this._.lineTo(l.x,l.y);this._.closePath();this._.stroke();this._last=l;}};b.prototype={calculatePixelRatio:function(){var i=window.devicePixelRatio||1;var h=this._.webkitBackingStorePixelRatio||this._.mozBackingStorePixelRatio||this._.msBackingStorePixelRatio||this._.oBackingStorePixelRatio||this._.backingStorePixelRatio||1;return i/h;},setup:function(){var q,y,z,j,x=this.data;this.canvas=document.createElement("canvas");this._=this.canvas.getContext("2d");if(this.pixelRatio==null){this.pixelRatio=this.calculatePixelRatio();}this.canvas.className=this.domClass;if(this.pixelRatio!=1){this.canvas.style.height=this.fullHeight+"px";this.canvas.style.width=this.fullWidth+"px";this.fullHeight*=this.pixelRatio;this.fullWidth*=this.pixelRatio;this.canvas.height=this.fullHeight;this.canvas.width=this.fullWidth;this._.scale(this.pixelRatio,this.pixelRatio);}else{this.canvas.height=this.fullHeight;this.canvas.width=this.fullWidth;}this.points=[];for(var w=-1,n=x.length;++w<n;){q=x[w].slice(1);z=x[w][0];if(z in d){for(var k=-1,v=q.length;++k<v;){y=d[z][k];j=q[k];switch(y){case g.RADIUS:j*=this.multiplier;break;case g.DIM:j*=this.multiplier;j+=this.padding;break;case g.DEGREE:j*=Math.PI/180;break;}q[k]=j;}}q.unshift(0);for(var m,i=this.pointDistance,r=i;r<=1;r+=i){r=Math.round(r*1/i)/(1/i);q[0]=r;m=a[z].apply(null,q);this.points.push({x:m[0],y:m[1],progress:r});}}this.frame=0;if(this.converter&&this.converter.setup){this.converter.setup(this);}},prep:function(m){if(m in this.imageData){return;}this._.clearRect(0,0,this.fullWidth,this.fullHeight);this._.fillStyle=this.backgroundColor;this._.fillRect(0,0,this.fullWidth,this.fullHeight);var v=this.points,k=v.length,h=this.pointDistance,l,w,j;this._setup();for(var q=-1,p=k*this.trailLength;++q<p&&!this.stopped;){w=m+q;l=v[w]||v[w-k];if(!l){continue;}this.alpha=Math.round(1000*(q/(p-1)))/1000;this._.globalAlpha=this.alpha;if(this.fillColor){this._.fillStyle=this.fillColor;}if(this.strokeColor){this._.strokeStyle=this.strokeColor;}j=m/(this.points.length-1);indexD=q/(p-1);this._preStep(l,indexD,j);this.stepMethod(l,indexD,j);}this._teardown();this.imageData[m]=this._.getImageData(0,0,this.fullWidth,this.fullWidth);return true;},draw:function(){if(!this.prep(this.frame)){this._.clearRect(0,0,this.fullWidth,this.fullWidth);this._.putImageData(this.imageData[this.frame],0,0);}if(this.converter&&this.converter.step){this.converter.step(this);}if(!this.iterateFrame()){if(this.converter&&this.converter.teardown){this.converter.teardown(this);this.converter=null;}}},iterateFrame:function(){this.frame+=this.stepsPerFrame;if(this.frame>=this.points.length){this.frame=0;return false;}return true;},play:function(){this.stopped=false;var h=this;this.timer=setInterval(function(){h.draw();},1000/this.fps);},stop:function(){this.stopped=true;this.timer&&clearInterval(this.timer);}};window.Sonic=b;})();
/*
 * jQuery treegrid Plugin 0.2.0
 * https://github.com/maxazan/jquery-treegrid
 * 
 * Copyright 2013, Pomazan Max
 * Licensed under the MIT licenses.
 */

(function(b){var e={initTree:function(a){var c=b.extend({},this.treegrid.defaults,a);return this.each(function(){var a=b(this);a.treegrid("setTreeContainer",b(this));a.treegrid("setSettings",c);c.getRootNodes.apply(this,[b(this)]).treegrid("initNode",c)})},initNode:function(a){return this.each(function(){var c=b(this);c.treegrid("setTreeContainer",a.getTreeGridContainer.apply(this));c.treegrid("getChildNodes").treegrid("initNode",a);c.treegrid("initExpander").treegrid("initIndent").treegrid("initEvents").treegrid("initState").treegrid("initSettingsEvents")})},
initEvents:function(){var a=b(this);a.on("change",function(){var a=b(this);a.treegrid("render");a.treegrid("getSetting","saveState")&&a.treegrid("saveState")});a.on("collapse",function(){var a=b(this);a.removeClass("treegrid-expanded");a.addClass("treegrid-collapsed")});a.on("expand",function(){var a=b(this);a.removeClass("treegrid-collapsed");a.addClass("treegrid-expanded")});return a},initSettingsEvents:function(){var a=b(this);a.on("change",function(){var a=b(this);"function"===typeof a.treegrid("getSetting",
"onChange")&&a.treegrid("getSetting","onChange").apply(a)});a.on("collapse",function(){var a=b(this);"function"===typeof a.treegrid("getSetting","onCollapse")&&a.treegrid("getSetting","onCollapse").apply(a)});a.on("expand",function(){var a=b(this);"function"===typeof a.treegrid("getSetting","onExpand")&&a.treegrid("getSetting","onExpand").apply(a)});return a},initExpander:function(){var a=b(this),c=a.find("td").get(a.treegrid("getSetting","treeColumn")),d=a.treegrid("getSetting","expanderTemplate"),
e=a.treegrid("getSetting","getExpander").apply(this);e&&e.remove();b(d).prependTo(c).click(function(){b(b(this).closest("tr")).treegrid("toggle")});return a},initIndent:function(){var a=b(this);a.find(".treegrid-indent").remove();for(var c=0;c<b(this).treegrid("getDepth");c++)b(a.treegrid("getSetting","indentTemplate")).insertBefore(a.find(".treegrid-expander"));return a},initState:function(){var a=b(this);a.treegrid("getSetting","saveState")&&!a.treegrid("isFirstInit")?a.treegrid("restoreState"):
"expanded"===a.treegrid("getSetting","initialState")?a.treegrid("expand"):a.treegrid("collapse");return a},isFirstInit:function(){var a=b(this).treegrid("getTreeContainer");void 0===a.data("first_init")&&a.data("first_init",void 0===b.cookie(a.treegrid("getSetting","saveStateName")));return a.data("first_init")},saveState:function(){var a=b(this);if("cookie"===a.treegrid("getSetting","saveStateMethod")){var c=b.cookie(a.treegrid("getSetting","saveStateName"))||"",c=""===c?[]:c.split(","),d=a.treegrid("getNodeId");
a.treegrid("isExpanded")?-1===b.inArray(d,c)&&c.push(d):a.treegrid("isCollapsed")&&-1!==b.inArray(d,c)&&c.splice(b.inArray(d,c),1);b.cookie(a.treegrid("getSetting","saveStateName"),c.join(","))}return a},restoreState:function(){var a=b(this);if("cookie"===a.treegrid("getSetting","saveStateMethod")){var c=b.cookie(a.treegrid("getSetting","saveStateName")).split(",");-1!==b.inArray(a.treegrid("getNodeId"),c)?a.treegrid("expand"):a.treegrid("collapse")}return a},getSetting:function(a){return!b(this).treegrid("getTreeContainer")?
null:b(this).treegrid("getTreeContainer").data("settings")[a]},setSettings:function(a){b(this).treegrid("getTreeContainer").data("settings",a)},getTreeContainer:function(){return b(this).data("treegrid")},setTreeContainer:function(a){return b(this).data("treegrid",a)},getRootNodes:function(){return b(this).treegrid("getSetting","getRootNodes").apply(this,[b(this).treegrid("getTreeContainer")])},getAllNodes:function(){return b(this).treegrid("getSetting","getAllNodes").apply(this,[b(this).treegrid("getTreeContainer")])},
isNode:function(){return null!==b(this).treegrid("getNodeId")},getNodeId:function(){return null===b(this).treegrid("getSetting","getNodeId")?null:b(this).treegrid("getSetting","getNodeId").apply(this)},getParentNodeId:function(){return b(this).treegrid("getSetting","getParentNodeId").apply(this)},getParentNode:function(){return null===b(this).treegrid("getParentNodeId")?null:b(this).treegrid("getSetting","getNodeById").apply(this,[b(this).treegrid("getParentNodeId"),b(this).treegrid("getTreeContainer")])},
getChildNodes:function(){return b(this).treegrid("getSetting","getChildNodes").apply(this,[b(this).treegrid("getNodeId"),b(this).treegrid("getTreeContainer")])},getDepth:function(){return null===b(this).treegrid("getParentNode")?0:b(this).treegrid("getParentNode").treegrid("getDepth")+1},isRoot:function(){return 0===b(this).treegrid("getDepth")},isLeaf:function(){return 0===b(this).treegrid("getChildNodes").length},isLast:function(){if(b(this).treegrid("isNode")){var a=b(this).treegrid("getParentNode");
if(null===a){if(b(this).treegrid("getNodeId")===b(this).treegrid("getRootNodes").last().treegrid("getNodeId"))return!0}else if(b(this).treegrid("getNodeId")===a.treegrid("getChildNodes").last().treegrid("getNodeId"))return!0}return!1},isFirst:function(){if(b(this).treegrid("isNode")){var a=b(this).treegrid("getParentNode");if(null===a){if(b(this).treegrid("getNodeId")===b(this).treegrid("getRootNodes").first().treegrid("getNodeId"))return!0}else if(b(this).treegrid("getNodeId")===a.treegrid("getChildNodes").first().treegrid("getNodeId"))return!0}return!1},
isExpanded:function(){return b(this).hasClass("treegrid-expanded")},isCollapsed:function(){return b(this).hasClass("treegrid-collapsed")},isOneOfParentsCollapsed:function(){var a=b(this);return a.treegrid("isRoot")?!1:a.treegrid("getParentNode").treegrid("isCollapsed")?!0:a.treegrid("getParentNode").treegrid("isOneOfParentsCollapsed")},expand:function(){return b(this).each(function(){var a=b(this);!a.treegrid("isLeaf")&&!a.treegrid("isExpanded")&&(a.trigger("expand"),a.trigger("change"))})},expandAll:function(){var a=
b(this);a.treegrid("getRootNodes").treegrid("expandRecursive");return a},expandRecursive:function(){return b(this).each(function(){var a=b(this);a.treegrid("expand");a.treegrid("isLeaf")||a.treegrid("getChildNodes").treegrid("expandRecursive")})},collapse:function(){return b(this).each(function(){var a=b(this);!a.treegrid("isLeaf")&&!a.treegrid("isCollapsed")&&(a.trigger("collapse"),a.trigger("change"))})},collapseAll:function(){var a=b(this);a.treegrid("getRootNodes").treegrid("collapseRecursive");
return a},collapseRecursive:function(){return b(this).each(function(){var a=b(this);a.treegrid("collapse");a.treegrid("isLeaf")||a.treegrid("getChildNodes").treegrid("collapseRecursive")})},toggle:function(){var a=b(this);a.treegrid("isExpanded")?a.treegrid("collapse"):a.treegrid("expand");return a},render:function(){return b(this).each(function(){var a=b(this);a.treegrid("isOneOfParentsCollapsed")?a.hide():a.show();a.treegrid("isLeaf")||(a.treegrid("renderExpander"),a.treegrid("getChildNodes").treegrid("render"))})},
renderExpander:function(){return b(this).each(function(){var a=b(this),c=a.treegrid("getSetting","getExpander").apply(this);c?a.treegrid("isCollapsed")?(c.removeClass(a.treegrid("getSetting","expanderExpandedClass")),c.addClass(a.treegrid("getSetting","expanderCollapsedClass"))):(c.removeClass(a.treegrid("getSetting","expanderCollapsedClass")),c.addClass(a.treegrid("getSetting","expanderExpandedClass"))):(a.treegrid("initExpander"),a.treegrid("renderExpander"))})}};b.fn.treegrid=function(a){if(e[a])return e[a].apply(this,
Array.prototype.slice.call(arguments,1));if("object"===typeof a||!a)return e.initTree.apply(this,arguments);b.error("Method with name "+a+" does not exists for jQuery.treegrid")};b.fn.treegrid.defaults={initialState:"expanded",saveState:!1,saveStateMethod:"cookie",saveStateName:"tree-grid-state",expanderTemplate:'<span class="treegrid-expander"></span>',indentTemplate:'<span class="treegrid-indent"></span>',expanderExpandedClass:"treegrid-expander-expanded",expanderCollapsedClass:"treegrid-expander-collapsed",
treeColumn:0,getExpander:function(){return b(this).find(".treegrid-expander")},getNodeId:function(){var a=/treegrid-([A-Za-z0-9_-]+)/;return a.test(b(this).attr("class"))?a.exec(b(this).attr("class"))[1]:null},getParentNodeId:function(){var a=/treegrid-parent-([A-Za-z0-9_-]+)/;return a.test(b(this).attr("class"))?a.exec(b(this).attr("class"))[1]:null},getNodeById:function(a,b){return b.find("tr.treegrid-"+a)},getChildNodes:function(a,b){return b.find("tr.treegrid-parent-"+a)},getTreeGridContainer:function(){return b(this).closest("table")},
getRootNodes:function(a){a=b.grep(a.find("tr"),function(a){var a=b(a).attr("class"),d=/treegrid-parent-([A-Za-z0-9_-]+)/;return/treegrid-([A-Za-z0-9_-]+)/.test(a)&&!d.test(a)});return b(a)},getAllNodes:function(a){a=b.grep(a.find("tr"),function(a){a=b(a).attr("class");return/treegrid-([A-Za-z0-9_-]+)/.test(a)});return b(a)},onCollapse:null,onExpand:null,onChange:null}})(jQuery);
var Base64={_keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",encode:function(b){var q,k,g,p,j,i,m,l="",f=0;for(b=Base64._utf8_encode(b);f<b.length;){p=(q=b.charCodeAt(f++))>>2,j=(3&q)<<4|(k=b.charCodeAt(f++))>>4,i=(15&k)<<2|(g=b.charCodeAt(f++))>>6,m=63&g,isNaN(k)?i=m=64:isNaN(g)&&(m=64),l=l+this._keyStr.charAt(p)+this._keyStr.charAt(j)+this._keyStr.charAt(i)+this._keyStr.charAt(m);}return l;},decode:function(b){var p,j,f,m,i,g,l="",k=0;for(b=b.replace(/[^A-Za-z0-9\+\/\=]/g,"");k<b.length;){p=this._keyStr.indexOf(b.charAt(k++))<<2|(m=this._keyStr.indexOf(b.charAt(k++)))>>4,j=(15&m)<<4|(i=this._keyStr.indexOf(b.charAt(k++)))>>2,f=(3&i)<<6|(g=this._keyStr.indexOf(b.charAt(k++))),l+=String.fromCharCode(p),64!=i&&(l+=String.fromCharCode(j)),64!=g&&(l+=String.fromCharCode(f));}return l=Base64._utf8_decode(l);},_utf8_encode:function(b){b=b.replace(/\r\n/g,"\n");for(var a="",c=0;c<b.length;c++){var d=b.charCodeAt(c);d<128?a+=String.fromCharCode(d):d>127&&d<2048?(a+=String.fromCharCode(d>>6|192),a+=String.fromCharCode(63&d|128)):(a+=String.fromCharCode(d>>12|224),a+=String.fromCharCode(d>>6&63|128),a+=String.fromCharCode(63&d|128));}return a;},_utf8_decode:function(b){for(var a="",c=0,d=c1=c2=0;c<b.length;){(d=b.charCodeAt(c))<128?(a+=String.fromCharCode(d),c++):d>191&&d<224?(c2=b.charCodeAt(c+1),a+=String.fromCharCode((31&d)<<6|63&c2),c+=2):(c2=b.charCodeAt(c+1),c3=b.charCodeAt(c+2),a+=String.fromCharCode((15&d)<<12|(63&c2)<<6|63&c3),c+=3);}return a;}};
window.ydpjs_1_0_0_0=window.ydpjs_1_0_0_0||{};
(function(d){var c=function(a){this._initialize(a)},b=c.prototype;b.onClick=null;b.onPress=null;b._clip=null;b.setY=function(a){this._clip.y=a};b.getY=function(){return this._clip.y};b._initialize=function(a){void 0!=a&&(a.gotoAndStop(0),a.onMouseOver=ydpjs_1_0_0_0.Delegate.create(this,this._onButtonMouseOver),a.onMouseOut=ydpjs_1_0_0_0.Delegate.create(this,this._onButtonMouseOut),a.onClick=ydpjs_1_0_0_0.Delegate.create(this,this._onButtonClick),a.onPress=ydpjs_1_0_0_0.Delegate.create(this,this._onButtonPress),
this._clip=a)};b._onButtonMouseOver=function(a){a.target.gotoAndStop(1)};b._onButtonMouseOut=function(a){a.target.gotoAndStop(0)};b._onButtonPress=function(a){null!=this.onPress&&(a.target=this,this.onPress(a))};b._onButtonClick=function(a){null!=this.onClick&&(a.target=this,this.onClick(a))};b.toString=function(){return"[ButtonDecorator]"};d.ydpjs_1_0_0_0.ButtonDecorator=c})(window);
window.ydpjs_1_0_0_0=window.ydpjs_1_0_0_0||{};(function(b){var a=function(){};a.create=function(a,b,e){var c=Array.prototype.slice.call(arguments),c=c.slice(2);return function(){var d=Array.prototype.slice.call(arguments).concat(c);b.apply(a,d)}};b.ydpjs_1_0_0_0.Delegate=a})(window);
window.ydpjs_1_0_0_0=window.ydpjs_1_0_0_0||{};
(function(d){var c=function(a){this._initialize(a)},b=c.prototype;b._clip=null;b._thumbBtn=null;b._track=null;b._height=null;b._value=null;b.onChange=null;b.getValue=function(){return this._value};b._initialize=function(a){this._thumbBtn=new ydpjs_1_0_0_0.ButtonDecorator(a.thumbClip);this._thumbBtn.onPress=ydpjs_1_0_0_0.Delegate.create(this,this._onThumbPress);this._track=a.trackClip;this._height=2*this._track.y;this._thumbBtn.setY(this._track.y-this._height/2);this._updateValue();this._clip=a};b._onThumbPress=
function(a){a.onMouseMove=ydpjs_1_0_0_0.Delegate.create(this,this._onThumbMove)};b._onThumbMove=function(a){a=this._clip.globalToLocal(a.stageX,a.stageY);a=Math.max(0,Math.min(a.y,this._height));this._thumbBtn.setY(a);this._updateValue()};b._updateValue=function(){var a=this._thumbBtn.getY()/this._height;null!=this.onChange&&a!=this._value&&(this._value=a,this.onChange({target:this}))};d.ydpjs_1_0_0_0.Slider=c})(window);
/*!
 * zoom.js 0.3
 * http://lab.hakim.se/zoom-js
 * MIT licensed
 *
 * Copyright (C) 2011-2014 Hakim El Hattab, http://hakim.se
 *
 * Modified by Karol Gebert:
 * - removed pan function and all related functions
 * - added support for zooming elements in iframe
 *
 * Modified by Andrzej Krawczyk:
 * - added destroy function for zoom object
 *
 * Modified by Maciej Zawlocki:
 * - fixed issue with positioning when zooming in an iframe
 *
 * Modified by Michał Sawoniuk:
 * - added option to zoom in on an element other than document.body
 */
;zoom=(function(){var h=800;var a=1;var i=-1;var c;function e(o,q,n){if(!c){return;}if(!n){n={iframeTopOffset:0,topWindowHeight:0,topWindowWidth:0};}var m=d();o.width=o.width||1;o.height=o.height||1;var p=window.innerHeight;if(n.topWindowHeight>0){p=n.topWindowHeight;}var j=window.innerWidth;if(n.topWindowWidth>0){j=n.topWindowWidth;}o.x-=(j-(o.width*q))/2;o.y-=(p-(o.height*q))/2;o.y-=n.iframeTopOffset*q;m.y+=n.iframeTopOffset;if(g(c)){if(q===1){c.style.transform="";c.style.OTransform="";c.style.msTransform="";c.style.MozTransform="";c.style.WebkitTransform="";}else{var k=m.x+"px "+m.y+"px",l="translate("+-o.x+"px,"+-o.y+"px) scale("+q+")";c.style.transformOrigin=k;c.style.OTransformOrigin=k;c.style.msTransformOrigin=k;c.style.MozTransformOrigin=k;c.style.WebkitTransformOrigin=k;c.style.transform=l;c.style.OTransform=l;c.style.msTransform=l;c.style.MozTransform=l;c.style.WebkitTransform=l;}}else{if(q===1){c.style.position="";c.style.left="";c.style.top="";c.style.width="";c.style.height="";c.style.zoom="";}else{c.style.position="relative";c.style.left=(-(m.x+o.x)/q)+"px";c.style.top=(-(m.y+o.y)/q)+"px";c.style.width=(q*100)+"%";c.style.height=(q*100)+"%";c.style.zoom=q;}}a=q;}function d(){return{x:window.scrollX!==undefined?window.scrollX:window.pageXOffset,y:window.scrollY!==undefined?window.scrollY:window.pageYOffset};}function b(j){if(a!==1&&j.keyCode===27){zoom.out();}}function f(j){return(j&&j.elementToZoom)?j.elementToZoom:document.body;}function g(j){return"WebkitTransform" in j.style||"MozTransform" in j.style||"msTransform" in j.style||"OTransform" in j.style||"transform" in j.style;}return{init:function(j){document.addEventListener("keyup",b);var k=f(j);if(g(k)){k.style.transition="transform "+h+"ms ease";k.style.OTransition="-o-transform "+h+"ms ease";k.style.msTransition="-ms-transform "+h+"ms ease";k.style.MozTransition="-moz-transform "+h+"ms ease";k.style.WebkitTransition="-webkit-transform "+h+"ms ease";}},destroy:function(){document.removeEventListener("keyup",b);},to:function(k){if(a!==1){this.out();}else{c=f(k);k.x=k.x||0;k.y=k.y||0;k.topWindowHeight=k.topWindowHeight||0;k.topWindowWidth=k.topWindowWidth||0;k.iframeTopOffset=k.iframeTopOffset||0;if(!!k.element){var n=typeof k.padding==="number"?k.padding:20;var l=k.element.getBoundingClientRect();k.x=l.left-n;k.y=l.top-n;k.width=l.width+(n*2);k.height=l.height+(n*2);}var m=window.innerHeight;if(k.topWindowHeight>0){m=k.topWindowHeight;}var j=window.innerWidth;if(k.topWindowWidth>0){j=k.topWindowWidth;}if(k.width!==undefined&&k.height!==undefined){k.scale=Math.max(Math.min(j/k.width,m/k.height),1);if(Math.min(j/k.width,m/k.height)<=1){k.scale=Math.min(j/k.width,m/k.height)+1;}}if(k.scale>1){k.x*=k.scale;k.y*=k.scale;k.x=Math.max(k.x,0);k.y=Math.max(k.y,0);e(k,k.scale,k);if(typeof k.callback==="function"){i=setTimeout(k.callback,h);}}}},out:function(){e({x:0,y:0},1);a=1;},magnify:function(j){this.to(j);},reset:function(){this.out();},zoomLevel:function(){return a;}};})();
(function(){var _after=1;var _afterThrow=2;var _afterFinally=3;var _before=4;var _around=5;var _intro=6;var _regexEnabled=true;var _arguments="arguments";var _undef="undefined";var getType=(function(){var toString=Object.prototype.toString,toStrings={},nodeTypes={1:"element",3:"textnode",9:"document",11:"fragment"},types="Arguments Array Boolean Date Document Element Error Fragment Function NodeList Null Number Object RegExp String TextNode Undefined Window".split(" ");for(var i=types.length;i--;){var type=types[i],constructor=window[type];if(constructor){try{toStrings[toString.call(new constructor)]=type.toLowerCase()}catch(e){}}}return function(item){return item==null&&(item===undefined?_undef:"null")||item.nodeType&&nodeTypes[item.nodeType]||typeof item.length=="number"&&(item.callee&&_arguments||item.alert&&"window"||item.item&&"nodelist")||toStrings[toString.call(item)]}})();var isFunc=function(obj){return getType(obj)=="function"};var weaveOne=function(source,method,advice){var old=source[method];if(advice.type!=_intro&&!isFunc(old)){var oldObject=old;old=function(){var code=arguments.length>0?_arguments+"[0]":"";for(var i=1;i<arguments.length;i++){code+=","+_arguments+"["+i+"]"}return eval("oldObject("+code+");")}}var aspect;if(advice.type==_after||advice.type==_afterThrow||advice.type==_afterFinally){aspect=function(){var returnValue,exceptionThrown=null;try{returnValue=old.apply(this,arguments)}catch(e){exceptionThrown=e}if(advice.type==_after){if(exceptionThrown==null){returnValue=advice.value.apply(this,[returnValue,method])}else{throw exceptionThrown}}else{if(advice.type==_afterThrow&&exceptionThrown!=null){returnValue=advice.value.apply(this,[exceptionThrown,method])}else{if(advice.type==_afterFinally){returnValue=advice.value.apply(this,[returnValue,exceptionThrown,method])}}}return returnValue}}else{if(advice.type==_before){aspect=function(){advice.value.apply(this,[arguments,method]);return old.apply(this,arguments)}}else{if(advice.type==_intro){aspect=function(){return advice.value.apply(this,arguments)}}else{if(advice.type==_around){aspect=function(){var invocation={object:this,args:Array.prototype.slice.call(arguments)};return advice.value.apply(invocation.object,[{arguments:invocation.args,method:method,proceed:function(){return old.apply(invocation.object,invocation.args)}}])}}}}}aspect.unweave=function(){source[method]=old;pointcut=source=aspect=old=null};source[method]=aspect;return aspect};var search=function(source,pointcut,advice){var methods=[];for(var method in source){var item=null;try{item=source[method]}catch(e){}if(item!=null&&method.match(pointcut.method)&&isFunc(item)){methods[methods.length]={source:source,method:method,advice:advice}}}return methods};var weave=function(pointcut,advice){var source=typeof(pointcut.target.prototype)!=_undef?pointcut.target.prototype:pointcut.target;var advices=[];if(advice.type!=_intro&&typeof(source[pointcut.method])==_undef){var methods=search(pointcut.target,pointcut,advice);if(methods.length==0){methods=search(source,pointcut,advice)}for(var i in methods){advices[advices.length]=weaveOne(methods[i].source,methods[i].method,methods[i].advice)}}else{advices[0]=weaveOne(source,pointcut.method,advice)}return _regexEnabled?advices:advices[0]};jQuery.aop={after:function(pointcut,advice){return weave(pointcut,{type:_after,value:advice})},afterThrow:function(pointcut,advice){return weave(pointcut,{type:_afterThrow,value:advice})},afterFinally:function(pointcut,advice){return weave(pointcut,{type:_afterFinally,value:advice})},before:function(pointcut,advice){return weave(pointcut,{type:_before,value:advice})},around:function(pointcut,advice){return weave(pointcut,{type:_around,value:advice})},introduction:function(pointcut,advice){return weave(pointcut,{type:_intro,value:advice})},setup:function(settings){_regexEnabled=settings.regexMatch}}})();
/*! @source http://purl.eligrey.com/github/Blob.js/blob/master/Blob.js */
(function(a){a.URL=a.URL||a.webkitURL;if(a.Blob&&a.URL){try{new Blob;return;}catch(d){}}var c=a.BlobBuilder||a.WebKitBlobBuilder||a.MozBlobBuilder||(function(p){var g=function(z){return Object.prototype.toString.call(z).match(/^\[object\s(.*)\]$/)[1];},y=function m(){this.data=[];},w=function i(B,z,A){this.data=B;this.size=B.length;this.type=z;this.encoding=A;},q=y.prototype,v=w.prototype,s=p.FileReaderSync,e=function(z){this.code=this[this.name=z];},r=("NOT_FOUND_ERR SECURITY_ERR ABORT_ERR NOT_READABLE_ERR ENCODING_ERR "+"NO_MODIFICATION_ALLOWED_ERR INVALID_STATE_ERR SYNTAX_ERR").split(" "),u=r.length,l=p.URL||p.webkitURL||p,t=l.createObjectURL,f=l.revokeObjectURL,k=l,o=p.btoa,j=p.atob,h=p.ArrayBuffer,n=p.Uint8Array,x=/^[\w-]+:\/*\[?[\w\.:-]+\]?(?::[0-9]+)?/;w.fake=v.fake=true;while(u--){e.prototype[r[u]]=u+1;}if(!l.createObjectURL){k=p.URL=function(A){var z=document.createElementNS("http://www.w3.org/1999/xhtml","a"),B;z.href=A;if(!("origin" in z)){if(z.protocol.toLowerCase()==="data:"){z.origin=null;}else{B=A.match(x);z.origin=B&&B[1];}}return z;};}k.createObjectURL=function(A){var B=A.type,z;if(B===null){B="application/octet-stream";}if(A instanceof w){z="data:"+B;if(A.encoding==="base64"){return z+";base64,"+A.data;}else{if(A.encoding==="URI"){return z+","+decodeURIComponent(A.data);}}if(o){return z+";base64,"+o(A.data);}else{return z+","+encodeURIComponent(A.data);}}else{if(t){return t.call(l,A);}}};k.revokeObjectURL=function(z){if(z.substring(0,5)!=="data:"&&f){f.call(l,z);}};q.append=function(D){var F=this.data;if(n&&(D instanceof h||D instanceof n)){var E="",A=new n(D),B=0,C=A.length;for(;B<C;B++){E+=String.fromCharCode(A[B]);}F.push(E);}else{if(g(D)==="Blob"||g(D)==="File"){if(s){var z=new s;F.push(z.readAsBinaryString(D));}else{throw new e("NOT_READABLE_ERR");}}else{if(D instanceof w){if(D.encoding==="base64"&&j){F.push(j(D.data));}else{if(D.encoding==="URI"){F.push(decodeURIComponent(D.data));}else{if(D.encoding==="raw"){F.push(D.data);}}}}else{if(typeof D!=="string"){D+="";}F.push(unescape(encodeURIComponent(D)));}}}};q.getBlob=function(z){if(!arguments.length){z=null;}return new w(this.data.join(""),z,"raw");};q.toString=function(){return"[object BlobBuilder]";};v.slice=function(C,z,B){var A=arguments.length;if(A<3){B=null;}return new w(this.data.slice(C,A>1?z:this.data.length),B,this.encoding);};v.toString=function(){return"[object Blob]";};v.close=function(){this.size=0;delete this.data;};return y;}(a));a.Blob=function(j,h){var l=h?(h.type||""):"";var g=new c();if(j){for(var k=0,e=j.length;k<e;k++){if(Uint8Array&&j[k] instanceof Uint8Array){g.append(j[k].buffer);}else{g.append(j[k]);}}}var f=g.getBlob(l);if(!f.slice&&f.webkitSlice){f.slice=f.webkitSlice;}return f;};var b=Object.getPrototypeOf||function(e){return e.__proto__;};a.Blob.prototype=b(new a.Blob());}(typeof self!=="undefined"&&self||typeof window!=="undefined"&&window||this.content||this));
// ----------------------------------------------------------------------------
// Buzz, a Javascript HTML5 Audio library
// v 1.0.x beta
// Licensed under the MIT license.
// http://buzz.jaysalvat.com/
// ----------------------------------------------------------------------------
// Copyright (C) 2011 Jay Salvat
// http://jaysalvat.com/
// ----------------------------------------------------------------------------
// Permission is hereby granted, free of charge, to any person obtaining a copy
// of this software and associated documentation files ( the "Software" ), to deal
// in the Software without restriction, including without limitation the rights
// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
// copies of the Software, and to permit persons to whom the Software is
// furnished to do so, subject to the following conditions:
//
// The above copyright notice and this permission notice shall be included in
// all copies or substantial portions of the Software.
//
// THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
// THE SOFTWARE.
// ----------------------------------------------------------------------------

var buzz={defaults:{autoplay:false,duration:5000,formats:[],loop:false,placeholder:"--",preload:"metadata",volume:80},types:{mp3:"audio/mpeg",ogg:"audio/ogg",wav:"audio/wav",aac:"audio/aac",m4a:"audio/x-m4a"},sounds:[],el:document.createElement("audio"),sound:function(src,options){options=options||{};var pid=0,events=[],eventsOnce={},supported=buzz.isSupported();this.load=function(){if(!supported){return this}this.sound.load();return this};this.play=function(){if(!supported){return this}this.sound.play();return this};this.togglePlay=function(){if(!supported){return this}if(this.sound.paused){this.sound.play()}else{this.sound.pause()}return this};this.pause=function(){if(!supported){return this}this.sound.pause();return this};this.isPaused=function(){if(!supported){return null}return this.sound.paused};this.stop=function(){if(!supported){return this}this.setTime(0);this.sound.pause();return this};this.isEnded=function(){if(!supported){return null}return this.sound.ended};this.loop=function(){if(!supported){return this}this.sound.loop="loop";this.bind("ended.buzzloop",function(){this.currentTime=0;this.play()});return this};this.unloop=function(){if(!supported){return this}this.sound.removeAttribute("loop");this.unbind("ended.buzzloop");return this};this.mute=function(){if(!supported){return this}this.sound.muted=true;return this};this.unmute=function(){if(!supported){return this}this.sound.muted=false;return this};this.toggleMute=function(){if(!supported){return this}this.sound.muted=!this.sound.muted;return this};this.isMuted=function(){if(!supported){return null}return this.sound.muted};this.setVolume=function(volume){if(!supported){return this}if(volume<0){volume=0}if(volume>100){volume=100}this.volume=volume;this.sound.volume=volume/100;return this};this.getVolume=function(){if(!supported){return this}return this.volume};this.increaseVolume=function(value){return this.setVolume(this.volume+(value||1))};this.decreaseVolume=function(value){return this.setVolume(this.volume-(value||1))};this.setTime=function(time){if(!supported){return this}this.whenReady(function(){this.sound.currentTime=time});return this};this.getTime=function(){if(!supported){return null}var time=Math.round(this.sound.currentTime*100)/100;return isNaN(time)?buzz.defaults.placeholder:time};this.setPercent=function(percent){if(!supported){return this}return this.setTime(buzz.fromPercent(percent,this.sound.duration))};this.getPercent=function(){if(!supported){return null}var percent=Math.round(buzz.toPercent(this.sound.currentTime,this.sound.duration));return isNaN(percent)?buzz.defaults.placeholder:percent};this.setSpeed=function(duration){if(!supported){return this}this.sound.playbackRate=duration};this.getSpeed=function(){if(!supported){return null}return this.sound.playbackRate};this.getDuration=function(){if(!supported){return null}var duration=Math.round(this.sound.duration*100)/100;return isNaN(duration)?buzz.defaults.placeholder:duration};this.getPlayed=function(){if(!supported){return null}return timerangeToArray(this.sound.played)};this.getBuffered=function(){if(!supported){return null}return timerangeToArray(this.sound.buffered)};this.getSeekable=function(){if(!supported){return null}return timerangeToArray(this.sound.seekable)};this.getErrorCode=function(){if(supported&&this.sound.error){return this.sound.error.code}return 0};this.getErrorMessage=function(){if(!supported){return null}switch(this.getErrorCode()){case 1:return"MEDIA_ERR_ABORTED";case 2:return"MEDIA_ERR_NETWORK";case 3:return"MEDIA_ERR_DECODE";case 4:return"MEDIA_ERR_SRC_NOT_SUPPORTED";default:return null}};this.getStateCode=function(){if(!supported){return null}return this.sound.readyState};this.getStateMessage=function(){if(!supported){return null}switch(this.getStateCode()){case 0:return"HAVE_NOTHING";case 1:return"HAVE_METADATA";case 2:return"HAVE_CURRENT_DATA";case 3:return"HAVE_FUTURE_DATA";case 4:return"HAVE_ENOUGH_DATA";default:return null}};this.getNetworkStateCode=function(){if(!supported){return null}return this.sound.networkState};this.getNetworkStateMessage=function(){if(!supported){return null}switch(this.getNetworkStateCode()){case 0:return"NETWORK_EMPTY";case 1:return"NETWORK_IDLE";case 2:return"NETWORK_LOADING";case 3:return"NETWORK_NO_SOURCE";default:return null}};this.set=function(key,value){if(!supported){return this}this.sound[key]=value;return this};this.get=function(key){if(!supported){return null}return key?this.sound[key]:this.sound};this.bind=function(types,func){if(!supported){return this}types=types.split(" ");var that=this,efunc=function(e){func.call(that,e)};for(var t=0;t<types.length;t++){var type=types[t],idx=type;type=idx.split(".")[0];events.push({idx:idx,func:efunc});this.sound.addEventListener(type,efunc,true)}return this};this.unbind=function(types){if(!supported){return this}types=types.split(" ");for(var t=0;t<types.length;t++){var idx=types[t],type=idx.split(".")[0];for(var i=0;i<events.length;i++){var namespace=events[i].idx.split(".");if(events[i].idx==idx||(namespace[1]&&namespace[1]==idx.replace(".",""))){this.sound.removeEventListener(type,events[i].func,true);events.splice(i,1)}}}return this};this.bindOnce=function(type,func){if(!supported){return this}var that=this;eventsOnce[pid++]=false;this.bind(type+"."+pid,function(){if(!eventsOnce[pid]){eventsOnce[pid]=true;func.call(that)}that.unbind(type+"."+pid)})};this.trigger=function(types){if(!supported){return this}types=types.split(" ");for(var t=0;t<types.length;t++){var idx=types[t];for(var i=0;i<events.length;i++){var eventType=events[i].idx.split(".");if(events[i].idx==idx||(eventType[0]&&eventType[0]==idx.replace(".",""))){var evt=document.createEvent("HTMLEvents");evt.initEvent(eventType[0],false,true);this.sound.dispatchEvent(evt)}}}return this};this.fadeTo=function(to,duration,callback){if(!supported){return this}if(duration instanceof Function){callback=duration;duration=buzz.defaults.duration}else{duration=duration||buzz.defaults.duration}var from=this.volume,delay=duration/Math.abs(from-to),that=this;this.play();function doFade(){setTimeout(function(){if(from<to&&that.volume<to){that.setVolume(that.volume+=1);doFade()}else{if(from>to&&that.volume>to){that.setVolume(that.volume-=1);doFade()}else{if(callback instanceof Function){callback.apply(that)}}}},delay)}this.whenReady(function(){doFade()});return this};this.fadeIn=function(duration,callback){if(!supported){return this}return this.setVolume(0).fadeTo(100,duration,callback)};this.fadeOut=function(duration,callback){if(!supported){return this}return this.fadeTo(0,duration,callback)};this.fadeWith=function(sound,duration){if(!supported){return this}this.fadeOut(duration,function(){this.stop()});sound.play().fadeIn(duration);return this};this.whenReady=function(func){if(!supported){return null}var that=this;if(this.sound.readyState===0){this.bind("canplay.buzzwhenready",function(){func.call(that)})}else{func.call(that)}};function timerangeToArray(timeRange){var array=[],length=timeRange.length-1;for(var i=0;i<=length;i++){array.push({start:timeRange.start(length),end:timeRange.end(length)})}return array}function getExt(filename){return filename.split(".").pop()}function addSource(sound,src){var source=document.createElement("source");source.src=src;if(buzz.types[getExt(src)]){source.type=buzz.types[getExt(src)]}sound.appendChild(source)}if(supported&&src){for(var i in buzz.defaults){if(buzz.defaults.hasOwnProperty(i)){options[i]=options[i]||buzz.defaults[i]}}this.sound=document.createElement("audio");if(src instanceof Array){for(var j in src){if(src.hasOwnProperty(j)){addSource(this.sound,src[j])}}}else{if(options.formats.length){for(var k in options.formats){if(options.formats.hasOwnProperty(k)){addSource(this.sound,src+"."+options.formats[k])}}}else{addSource(this.sound,src)}}if(options.loop){this.loop()}if(options.autoplay){this.sound.autoplay="autoplay"}if(options.preload===true){this.sound.preload="auto"}else{if(options.preload===false){this.sound.preload="none"}else{this.sound.preload=options.preload}}this.setVolume(options.volume);buzz.sounds.push(this)}},group:function(sounds){sounds=argsToArray(sounds,arguments);this.getSounds=function(){return sounds};this.add=function(soundArray){soundArray=argsToArray(soundArray,arguments);for(var a=0;a<soundArray.length;a++){sounds.push(soundArray[a])}};this.remove=function(soundArray){soundArray=argsToArray(soundArray,arguments);for(var a=0;a<soundArray.length;a++){for(var i=0;i<sounds.length;i++){if(sounds[i]==soundArray[a]){sounds.splice(i,1);break}}}};this.load=function(){fn("load");return this};this.play=function(){fn("play");return this};this.togglePlay=function(){fn("togglePlay");return this};this.pause=function(time){fn("pause",time);return this};this.stop=function(){fn("stop");return this};this.mute=function(){fn("mute");return this};this.unmute=function(){fn("unmute");return this};this.toggleMute=function(){fn("toggleMute");return this};this.setVolume=function(volume){fn("setVolume",volume);return this};this.increaseVolume=function(value){fn("increaseVolume",value);return this};this.decreaseVolume=function(value){fn("decreaseVolume",value);return this};this.loop=function(){fn("loop");return this};this.unloop=function(){fn("unloop");return this};this.setTime=function(time){fn("setTime",time);return this};this.set=function(key,value){fn("set",key,value);return this};this.bind=function(type,func){fn("bind",type,func);return this};this.unbind=function(type){fn("unbind",type);return this};this.bindOnce=function(type,func){fn("bindOnce",type,func);return this};this.trigger=function(type){fn("trigger",type);return this};this.fade=function(from,to,duration,callback){fn("fade",from,to,duration,callback);return this};this.fadeIn=function(duration,callback){fn("fadeIn",duration,callback);return this};this.fadeOut=function(duration,callback){fn("fadeOut",duration,callback);return this};function fn(){var args=argsToArray(null,arguments),func=args.shift();for(var i=0;i<sounds.length;i++){sounds[i][func].apply(sounds[i],args)}}function argsToArray(array,args){return(array instanceof Array)?array:Array.prototype.slice.call(args)}},all:function(){return new buzz.group(buzz.sounds)},isSupported:function(){return !!buzz.el.canPlayType},isOGGSupported:function(){return !!buzz.el.canPlayType&&buzz.el.canPlayType('audio/ogg; codecs="vorbis"')},isWAVSupported:function(){return !!buzz.el.canPlayType&&buzz.el.canPlayType('audio/wav; codecs="1"')},isMP3Supported:function(){return !!buzz.el.canPlayType&&buzz.el.canPlayType("audio/mpeg;")},isAACSupported:function(){return !!buzz.el.canPlayType&&(buzz.el.canPlayType("audio/x-m4a;")||buzz.el.canPlayType("audio/aac;"))},toTimer:function(time,withHours){var h,m,s;h=Math.floor(time/3600);h=isNaN(h)?"--":(h>=10)?h:"0"+h;m=withHours?Math.floor(time/60%60):Math.floor(time/60);m=isNaN(m)?"--":(m>=10)?m:"0"+m;s=Math.floor(time%60);s=isNaN(s)?"--":(s>=10)?s:"0"+s;return withHours?h+":"+m+":"+s:m+":"+s},fromTimer:function(time){var splits=time.toString().split(":");if(splits&&splits.length==3){time=(parseInt(splits[0],10)*3600)+(parseInt(splits[1],10)*60)+parseInt(splits[2],10)}if(splits&&splits.length==2){time=(parseInt(splits[0],10)*60)+parseInt(splits[1],10)}return time},toPercent:function(value,total,decimal){var r=Math.pow(10,decimal||0);return Math.round(((value*100)/total)*r)/r},fromPercent:function(percent,total,decimal){var r=Math.pow(10,decimal||0);return Math.round(((total/100)*percent)*r)/r}};
var MONTH_NAMES="January February March April May June July August September October November December Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec".split(" "),DAY_NAMES="Sunday Monday Tuesday Wednesday Thursday Friday Saturday Sun Mon Tue Wed Thu Fri Sat".split(" ");function LZ(b){return(0>b||9<b?"":"0")+b;}function isDate(d,c){return 0==getDateFromFormat(d,c)?!1:!0;}function compareDates(e,c,g,f){e=getDateFromFormat(e,c);g=getDateFromFormat(g,f);return 0==e||0==g?-1:e>g?1:0;}function formatDate(x,w){var w=w+"",u="",r=0,v="",t="",v=x.getYear()+"",t=x.getMonth()+1,p=x.getDate(),q=x.getDay(),g=x.getHours(),o=x.getMinutes(),n=x.getSeconds(),s={};4>v.length&&(v=""+(v-0+1900));s.y=""+v;s.yyyy=v;s.yy=v.substring(2,4);s.M=t;s.MM=LZ(t);s.MMM=MONTH_NAMES[t-1];s.NNN=MONTH_NAMES[t+11];s.d=p;s.dd=LZ(p);s.E=DAY_NAMES[q+7];s.EE=DAY_NAMES[q];s.H=g;s.HH=LZ(g);s.h=0==g?12:12<g?g-12:g;s.hh=LZ(s.h);s.K=11<g?g-12:g;s.k=g+1;s.KK=LZ(s.K);s.kk=LZ(s.k);s.a=11<g?"PM":"AM";s.m=o;s.mm=LZ(o);s.s=n;for(s.ss=LZ(n);r<w.length;){v=w.charAt(r);for(t="";w.charAt(r)==v&&r<w.length;){t+=w.charAt(r++);}u=null!=s[t]?u+s[t]:u+t;}return u;}function _isInteger(d){for(var c=0;c<d.length;c++){if(-1=="1234567890".indexOf(d.charAt(c))){return !1;}}return !0;}function _getInt(f,e,i,g){for(;g>=i;g--){var j=f.substring(e,e+g);if(j.length<i){break;}if(_isInteger(j)){return j;}}return null;}function getDateFromFormat(F,E){for(var F=F+"",E=E+"",C=0,y=0,D="",B="",w,x,t=new Date,v=t.getYear(),u=t.getMonth()+1,A=1,z=t.getHours(),s=t.getMinutes(),t=t.getSeconds(),r="";y<E.length;){D=E.charAt(y);for(B="";E.charAt(y)==D&&y<E.length;){B+=E.charAt(y++);}if("yyyy"==B||"yy"==B||"y"==B){"yyyy"==B&&(x=w=4);"yy"==B&&(x=w=2);"y"==B&&(w=2,x=4);v=_getInt(F,C,w,x);if(null==v){return 0;}C+=v.length;2==v.length&&(v=70<v?1900+(v-0):2000+(v-0));}else{if("MMM"==B||"NNN"==B){for(D=u=0;D<MONTH_NAMES.length;D++){var q=MONTH_NAMES[D];if(F.substring(C,C+q.length).toLowerCase()==q.toLowerCase()&&("MMM"==B||"NNN"==B&&11<D)){u=D+1;12<u&&(u-=12);C+=q.length;break;}}if(1>u||12<u){return 0;}}else{if("EE"==B||"E"==B){for(D=0;D<DAY_NAMES.length;D++){if(B=DAY_NAMES[D],F.substring(C,C+B.length).toLowerCase()==B.toLowerCase()){C+=B.length;break;}}}else{if("MM"==B||"M"==B){u=_getInt(F,C,B.length,2);if(null==u||1>u||12<u){return 0;}C+=u.length;}else{if("dd"==B||"d"==B){A=_getInt(F,C,B.length,2);if(null==A||1>A||31<A){return 0;}C+=A.length;}else{if("hh"==B||"h"==B){z=_getInt(F,C,B.length,2);if(null==z||1>z||12<z){return 0;}C+=z.length;}else{if("HH"==B||"H"==B){z=_getInt(F,C,B.length,2);if(null==z||0>z||23<z){return 0;}C+=z.length;}else{if("KK"==B||"K"==B){z=_getInt(F,C,B.length,2);if(null==z||0>z||11<z){return 0;}C+=z.length;}else{if("kk"==B||"k"==B){z=_getInt(F,C,B.length,2);if(null==z||1>z||24<z){return 0;}C+=z.length;z--;}else{if("mm"==B||"m"==B){s=_getInt(F,C,B.length,2);if(null==s||0>s||59<s){return 0;}C+=s.length;}else{if("ss"==B||"s"==B){t=_getInt(F,C,B.length,2);if(null==t||0>t||59<t){return 0;}C+=t.length;}else{if("a"==B){if("am"==F.substring(C,C+2).toLowerCase()){r="AM";}else{if("pm"==F.substring(C,C+2).toLowerCase()){r="PM";}else{return 0;}}C+=2;}else{if(F.substring(C,C+B.length)!=B){return 0;}C+=B.length;}}}}}}}}}}}}}if(C!=F.length){return 0;}if(2==u){if(0==v%4&&0!=v%100||0==v%400){if(29<A){return 0;}}else{if(28<A){return 0;}}}if((4==u||6==u||9==u||11==u)&&30<A){return 0;}12>z&&"PM"==r?z=z-0+12:11<z&&"AM"==r&&(z-=12);return(new Date(v,u-1,A,z,s,t)).getTime();}function parseDate(g){var f=2==arguments.length?arguments[1]:!1;generalFormats="y-M-d;MMM d, y;MMM d,y;y-MMM-d;d-MMM-y;MMM d".split(";");monthFirst="M/d/y M-d-y M.d.y MMM-d M/d M-d".split(" ");dateFirst="d/M/y d-M-y d.M.y d-MMM d/M d-M".split(" ");for(var f=["generalFormats",f?"dateFirst":"monthFirst",f?"monthFirst":"dateFirst"],k=null,i=0;i<f.length;i++){for(var l=window[f[i]],j=0;j<l.length;j++){if(k=getDateFromFormat(g,l[j]),0!=k){return new Date(k);}}}return null;}function Stack(){this.arrStack=[];this.intIndex=0;this.Size=getSize;this.IsEmpty=isStackEmpty;this.Push=pushElement;this.Pop=popElement;this.Get=getElement;this.toString=dumpStack;}function dumpStack(){var d=0,c="";if(0==this.intIndex){return null;}for(d=0;d<this.intIndex;d++){c=0==c.length?c+this.arrStack[d]:c+(","+this.arrStack[d]);}return c;}function getSize(){return this.intIndex;}function isStackEmpty(){return 0==this.intIndex?!0:!1;}function pushElement(b){debugAssert("Pushing "+b);this.arrStack[this.intIndex]=b;this.intIndex++;}function popElement(){var b;b=null;0<this.intIndex&&(this.intIndex--,b=this.arrStack[this.intIndex]);return b;}function getElement(d){var c;0<=d&&d<this.intIndex&&(c=this.arrStack[this.intIndex-d-1]);return c;}var lstAlpha="a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,uv,w,x,y,z",lstDigits="0,1,2,3,4,5,6,7,8,9",lstArithOps="^,*,/,%,+,-",lstLogicOps="!,&,|",lstCompaOps="<,<=,>,>=,<>,=",lstFuncOps="AVG ABS ACOS ASC ASIN ATAN CDATE CHR COS DATE FIX HEX IIF LCASE LEFT LOG MAX MID MIN RIGHT ROUND SIN SQRT TAN UCASE".split(" ");function Tokanize(r){var q,o,l,p,n,g,k,f;p=o=q=0;k="";l=[];for(r=Trim(r);q<r.length;){f="";n=r.substr(q,1);window&&window.status&&(window.status="Processing "+n);switch(n){case" ":0<k.length&&(l[p]=k,p++,k="");break;case"(":o++;0<k.length&&(l[p]=k,p++,k="");l[p]=n;p++;break;case")":o--;0<k.length&&(l[p]=k,p++,k="");l[p]=n;p++;break;case"^":0<k.length&&(l[p]=k,p++,k="");l[p]=n;p++;break;case"*":0<k.length&&(l[p]=k,p++,k="");l[p]=n;p++;break;case"/":0<k.length&&(l[p]=k,p++,k="");l[p]=n;p++;break;case"%":0<k.length&&(l[p]=k,p++,k="");l[p]=n;p++;break;case"&":0<k.length&&(l[p]=k,p++,k="");l[p]=n;p++;break;case"|":0<k.length&&(l[p]=k,p++,k="");l[p]=n;p++;break;case",":0<k.length&&(l[p]=k,p++,k="");l[p]=n;p++;break;case"-":0<k.length&&(l[p]=k,p++,k="");g=r.substr(q+1,1);0<l.length&&(f=l[p-1]);0==q||(IsOperator(f)||"("==f||","==f)&&(IsDigit(g)||"("==g)?k+=n:(l[p]=n,p++,k="");break;case"+":0<k.length&&(l[p]=k,p++,k="");g=r.substr(q+1,1);0<l.length&&(f=l[p-1]);0==q||(IsOperator(f)||"("==f||","==f)&&(IsDigit(g)||"("==g)?k+=n:(l[p]=n,p++,k="");break;case"<":g=r.substr(q+1,1);0<k.length&&(l[p]=k,p++,k="");"="==g?(l[p]=n+"=",p++,q++):">"==g?(l[p]=n+">",p++,q++):(l[p]=n,p++);break;case">":g=r.substr(q+1,1);0<k.length&&(l[p]=k,p++,k="");"="==g?(l[p]=n+"=",p++,q++):(l[p]=n,p++);break;case"=":0<k.length&&(l[p]=k,p++,k="");l[p]=n;p++;break;case"'":0<k.length&&(l[p]=k,p++,k="");n=r.indexOf(n,q+1);if(0>n){throw"Unterminated string constant";}k+=r.substring(q+1,n);l[p]=k;p++;k="";q=n;break;case'"':0<k.length&&(l[p]=k,p++,k="");n=r.indexOf(n,q+1);if(0>n){throw"Unterminated string constant";}k+=r.substring(q+1,n);l[p]=k;p++;k="";q=n;break;default:k+=n;}q++;}if(0<o){throw"Unbalanced parenthesis!";}0<k.length&&(l[p]=k);return l;}function IsDigit(b){return 0<=lstDigits.indexOf(b)?!0:!1;}function IsAlpha(b){return 0<=lstAlpha.indexOf(b)||0<=lstAlpha.toUpperCase().indexOf(b)?!0:!1;}function IsOperator(b){return 0<=lstArithOps.indexOf(b)||0<=lstCompaOps.indexOf(b)?!0:!1;}function IsFunction(d){for(var c=0,d=d.toUpperCase(),c=0;c<lstFuncOps.length;c++){if(d==lstFuncOps[c]){return !0;}}return !1;}function Trim(b){if(1>b.length){return"";}b=RTrim(b);b=LTrim(b);return""==b?"":b;}function RTrim(e){var c=String.fromCharCode(32),g=e.length,f="";if(0>g){return"";}for(g-=1;-1<g;){if(e.charAt(g)!=c){f=e.substring(0,g+1);break;}g-=1;}return f;}function LTrim(f){var e=String.fromCharCode(32);if(1>i){return"";}for(var i=f.length,g="",j=0;j<i;){if(f.charAt(j)!=e){g=f.substring(j,i);break;}j+=1;}return g;}var UNARY_NEG="\ufffd",ARG_TERMINAL="\ufffd",LESS_THAN="\ufffd",GREATER_THAN="\ufffd",NOT_EQUAL="\ufffd",DEBUG_ON=!1,NUMARIC_OP="*,/,%,^";
function Expression(){function g(){n=Tokanize(m);if(null==n||void 0==n){throw"Unable to tokanize the expression!";}if(0>=n.length){throw"Unable to tokanize the expression!";}var e=n,c,j,d,p,o;d=0;arrPFix=[];c=new Stack;for(j=0;j<e.length;j++){p=e[j];debugAssert("Processing token ["+p+"]");switch(p){case"(":0<c.Size()&&IsFunction(c.Get(0))&&(arrPFix[d]=ARG_TERMINAL,d++);c.Push(p);break;case")":o=!0;for(debugAssert("Stack.Pop ["+c.toString());!c.IsEmpty();){if(p=c.Pop(),"("!=p){arrPFix[d]=p,d++;}else{o=!1;break;}}if(c.IsEmpty()&&o){throw"Unbalanced parenthesis!";}break;case",":if(c.IsEmpty()){break;}for(debugAssert("Pop stack till opening bracket found!");!c.IsEmpty();){p=c.Get(0);if("("==p){break;}arrPFix[d]=c.Pop();d++;}break;case"!":case"-":if("-"==p&&(o=null,0<j&&(o=e[j-1]),null==o||IsOperator(o)||"("==o)){debugAssert("Unary negation!"),p=UNARY_NEG;}case"^":case"*":case"/":case"%":case"+":if("+"==p&&(o=null,0<j&&(o=e[j-1]),null==o||IsOperator(o)||"("==o)){debugAssert("Unary add, Skipping");break;}case"&":case"|":case">":case"<":case"=":case">=":case"<=":case"<>":o="";c.IsEmpty()||(o=c.Get(0));if(c.IsEmpty()||!c.IsEmpty()&&"("==o){debugAssert("Empty stack pushing operator ["+p+"]");}else{if(Precedence(p)>Precedence(o)){debugAssert("["+p+"] has higher precedence over ["+o+"]");}else{for(;!c.IsEmpty();){if(o=c.Get(0),"("==o||Precedence(o)<Precedence(p)){debugAssert("["+o+"] has lesser precedence over ["+p+"]");break;}else{arrPFix[d]=c.Pop(),d++;}}}}c.Push(p);break;default:if(IsFunction(p)){o="";c.IsEmpty()||(o=c.Get(0));if(c.IsEmpty()||!c.IsEmpty()&&"("==o){debugAssert("Empty stack pushing operator ["+p+"]");}else{if(Precedence(p)>Precedence(o)){debugAssert("["+p+"] has higher precedence over ["+o+"]");}else{for(;!c.IsEmpty();){if(o=c.Get(0),"("==o||Precedence(o)<Precedence(p)){debugAssert("["+o+"] has lesser precedence over ["+p+"]");break;}else{arrPFix[d]=c.Pop(),d++;}}}}c.Push(p);}else{debugAssert("Token ["+p+"] is a variable/number!"),IsNumber(p)?p=ToNumber(p):IsBoolean(p)?p=ToBoolean(p):isDate(p,i)&&(p=getDateFromFormat(p,i)),arrPFix[d]=p,d++;}}debugAssert("Stack   : "+c.toString()+"\nRPN Exp : "+arrPFix.toString());}for(;!c.IsEmpty();){arrPFix[d]=c.Pop(),d++;}l=arrPFix;if(null==l||void 0==l){throw"Unable to convert the expression to postfix form!";}if(0>=l.length){throw"Unable to convert the expression to postfix form!";}return l.toString();}function f(d){var c;debugAssert(d);if(null==k||void 0==k){throw"Variable values are not supplied!";}c=k[d];if(void 0==c||null==c){throw"Variable ["+d+"] not defined";}debugAssert(d+" - "+c);return c;}var m=null,k=null,n=null,l=null,i="dd/MM/yyyy";this.DateFormat=function(b){i=b;};this.Expression=function(b){m=b;};this.Parse=g;this.Evaluate=function(){var p,j,b,a,h,e,o;(null==l||void 0==l)&&g();if(0==l.length){throw"Unable to parse the expression!";}o=l;if(null==o||void 0==o){throw"Invalid postfix expression!";}if(0==o.length){throw"Invalid postfix expression!";}p=0;for(j=new Stack;p<o.length;){b=o[p];switch(b){case ARG_TERMINAL:j.Push(b);break;case UNARY_NEG:if(j.IsEmpty()){throw"No operand to negate!";}h=j.Pop();IsVariable(h)&&(h=f(h));b=ToNumber(h);if(isNaN(b)){throw"Not a numaric value!";}b=0-b;j.Push(b);break;case"!":if(j.IsEmpty()){throw"No operand on stack!";}h=j.Pop();IsVariable(h)&&(h=f(h));h=ToBoolean(h);if(null==h){throw"Not a boolean value!";}j.Push(!h);break;case"*":case"/":case"%":case"^":if(j.IsEmpty()||2>j.Size()){throw"Stack is empty, can not perform ["+b+"]";}objTmp=null;e=j.Pop();h=j.Pop();IsVariable(h)&&(h=f(h));IsVariable(e)&&(e=f(e));h=ToNumber(h);e=ToNumber(e);if(isNaN(h)||isNaN(e)){throw"Either one of the operand is not a number can not perform ["+b+"]";}"^"==b?j.Push(Math.pow(h,e)):"*"==b?j.Push(h*e):"/"==b?j.Push(h/e):(debugAssert(h+" - "+e),j.Push(h%e));break;case"+":case"-":if(j.IsEmpty()||2>j.Size()){throw"Stack is empty, can not perform ["+b+"]";}a="+"==b?"Addition":"Substraction";e=j.Pop();h=j.Pop();IsVariable(h)&&(h=f(h));IsVariable(e)&&(e=f(e));if(IsBoolean(h)||IsBoolean(e)){throw"Can not perform "+a+" with boolean values!";}if(isDate(h,i)&&isDate(h,i)){throw a+" of two dates not supported!";}if("object"==typeof h||"object"==typeof h){throw a+" of two objects not supported!";}if("undefined"==typeof h||"undefined"==typeof h){throw a+" of two undefined not supported!";}if(IsNumber(h)&&IsNumber(e)){h=ToNumber(h),e=ToNumber(e),"+"==b?j.Push(h+e):j.Push(h-e);}else{if("+"==b){j.Push(h+e);}else{throw strOP+" not supported for strings!";}}break;case"=":case"<":case">":case"<>":case"<=":case">=":if(j.IsEmpty()||2>j.Size()){throw"Stack is empty, can not perform ["+b+"]";}e=j.Pop();h=j.Pop();IsVariable(h)&&(h=f(h));IsVariable(e)&&(e=f(e));if(IsNumber(h)&&IsNumber(e)){h=ToNumber(h),e=ToNumber(e),"="==b?j.Push(h==e):"<>"==b?j.Push(h!=e):">"==b?j.Push(h>e):"<"==b?j.Push(h<e):"<="==b?j.Push(h<=e):">="==b&&j.Push(h>=e);}else{if(IsBoolean(h)&&IsBoolean(e)&&("="==b||"<>"==b)){a=ToBoolean(h),e=ToBoolean(e),"="==b?j.Push(a==e):"<>"==b&&j.Push(a!=e);}else{if(isDate(h,i)&&isDate(e,i)){a="string"==typeof h?getDateFromFormat(h,i):h,e="string"==typeof h?getDateFromFormat(e,i):e,"="==b?j.Push(a==e):"<>"==b?j.Push(a!=e):">"==b?j.Push(a>e):"<"==b?j.Push(a<e):"<="==b?j.Push(a<=e):">="==b&&j.Push(a>=e);}else{if("string"==typeof h&&"string"==typeof e&&("="==b||"<>"==b)){"="==b?j.Push(h==e):"<>"==b&&j.Push(h!=e);}else{throw"For "+b+" operator LHS & RHS should be of same data type!";}}}}break;case"&":case"|":if(j.IsEmpty()||2>j.Size()){throw"Stack is empty, can not perform ["+b+"]";}e=j.Pop();h=j.Pop();IsVariable(h)&&(h=f(h));IsVariable(e)&&(e=f(e));if(IsBoolean(h)&&IsBoolean(e)){a=ToBoolean(h),e=ToBoolean(e),"&"==b?j.Push(a&&e):"|"==b&&j.Push(a||e);}else{throw"Logical operator requires LHS & RHS of boolean type!";}break;default:IsNumber(b)||IsBoolean(b)||isDate(b,i)||"number"==typeof b||"boolean"==typeof b||"object"==typeof b||IsVariable(b)?j.Push(b):HandleFunctions(b,j,i,k);}p++;}if(j.IsEmpty()||1<j.Size()){throw"Unable to evaluate expression!";}return j.Pop();};this.AddVariable=function(d,c){if(null==k||void 0==k){k=[];}k[d]=c;};this.Reset=function(){l=n=m=k=null;};}function HandleFunctions(g,f,m,k){var n,l,i;if(!IsFunction(g)){throw"Unsupported function token ["+g+"]";}n=g.toUpperCase();for(i=[];!f.IsEmpty();){if(g=f.Pop(),g!=ARG_TERMINAL){i[i.length]=g;}else{break;}}switch(n){case"DATE":g=new Date;f.Push(formatDate(g,m));break;case"ACOS":case"ASIN":case"ATAN":throw"Function ["+n+"] is not implemented!";case"ABS":case"CHR":case"COS":case"FIX":case"HEX":case"LOG":case"ROUND":case"SIN":case"SQRT":case"TAN":if(1>i.length){throw n+" requires atleast one argument!";}if(1<i.length){throw n+" requires only one argument!";}g=i[0];if(IsVariable(g)){l=k[g];if(void 0==l||null==l){throw"Variable ["+g+"] not defined";}g=l;}if(IsNumber(g)){l=ToNumber(g),"ABS"==n?f.Push(Math.abs(l)):"CHR"==n?f.Push(String.fromCharCode(l)):"COS"==n?f.Push(Math.cos(l)):"FIX"==n?f.Push(Math.floor(l)):"HEX"==n?f.Push(l.toString(16)):"LOG"==n?f.Push(Math.log(l)):"ROUND"==n?f.Push(Math.round(l)):"SIN"==n?f.Push(Math.sin(l)):"SQRT"==n?f.Push(Math.sqrt(l)):"TAN"==n&&f.Push(Math.tan(l));}else{throw n+" operates on numeric operands only!";}break;case"ASC":if(1<i.length){throw n+" requires only one argument!";}if(1>i.length){throw n+" requires atleast one argument!";}g=i[0];if(IsVariable(g)){l=k[g];if(void 0==l||null==l){throw"Variable ["+g+"] not defined";}g=l;}if(IsNumber(g)||IsBoolean(g)||isDate(g,m)||"string"!=typeof g){throw n+" requires a string type operand!";
}f.Push(g.charCodeAt(0));break;case"LCASE":case"UCASE":case"CDATE":if(1>i.length){throw n+" requires atleast one argument!";}if(1<i.length){throw n+" requires only one argument!";}g=i[0];if(IsVariable(g)){l=k[g];if(void 0==l||null==l){throw"Variable ["+g+"] not defined";}g=l;}if("CDATE"==n&&!isDate(g,m)){throw"CDate can not convert ["+g+"] to a valid date!";}if("number"==typeof g||"string"!=typeof g){throw n+" requires a string type operand!";}"LCASE"==n?f.Push(g.toLowerCase()):"UCASE"==n?f.Push(g.toUpperCase()):"CDATE"==n&&(l=getDateFromFormat(g,m),f.Push(new Date(l)));break;case"LEFT":case"RIGHT":if(2>i.length){throw n+" requires atleast two arguments!";}if(2<i.length){throw n+" requires only two arguments!";}for(m=0;m<i.length;m++){g=i[m];if(IsVariable(g)){l=k[g];if(void 0==l||null==l){throw"Variable ["+g+"] not defined";}g=l;}if(0==m&&!IsNumber(g)){throw n+" oprator requires numaric length!";}i[m]=g;}g=new String(i[1]);l=ToNumber(i[0]);"LEFT"==n?f.Push(n.substring(0,l)):f.Push(n.substr(g.length-l,l));break;case"MID":case"IIF":if(3>i.length){throw n+" requires atleast three arguments!";}if(3<i.length){throw n+" requires only three arguments!";}for(m=0;m<i.length;m++){g=i[m];if(IsVariable(g)){l=k[g];if(void 0==l||null==l){throw"Variable ["+g+"] not defined";}g=l;}if("MID"==g&&1>=m&&!IsNumber(g)){throw n+" oprator requires numaric lengths!";}if("IIF"==g&&2==m&&!IsBoolean(g)){throw n+" oprator requires boolean condition!";}i[m]=g;}"MID"==n?(g=new String(i[2]),k=ToNumber(i[1]),i=ToNumber(i[0]),f.Push(g.substring(k,i))):(g=ToBoolean(i[2]),k=i[1],i=i[0],g?f.Push(k):f.Push(i));break;case"AVG":case"MAX":case"MIN":if(2>i.length){throw n+" requires atleast two operands!";}for(m=l=0;m<i.length;m++){g=i[m];if(IsVariable(g)){l=k[g];if(void 0==l||null==l){throw"Variable ["+g+"] not defined";}g=l;}if(!IsNumber(g)){throw n+" requires numaric operands only!";}g=ToNumber(g);"AVG"==n?l+=g:"MAX"==n&&l<g?l=g:"MIN"==n&&(1==m?l=g:l>g&&(l=g));}"AVG"==n?f.Push(l/i.length):f.Push(l);}}function IsNumber(d){var c=Number.NaN,c=new Number(d);return isNaN(c)?!1:!0;}function IsBoolean(e){var c=typeof e,f=null;return"boolean"==c?!0:"number"==c||("function"==c||void 0==c)||IsNumber(e)?!1:"object"==c&&(f=e.toString(),"TRUE"==f.toUpperCase()||"FALSE"==f.toUpperCase())?!0:"TRUE"==e.toUpperCase()||"FALSE"==e.toUpperCase()?!0:!1;}function IsVariable(b){return 0<=lstArithOps.indexOf(b)||0<=lstLogicOps.indexOf(b)||0<=lstCompaOps.indexOf(b)||"string"==typeof b&&("TRUE"==b.toUpperCase()||"FALSE"==b.toUpperCase()||null!=parseDate(b))||"number"==typeof b||"boolean"==typeof b||"object"==typeof b||IsNumber(b)||IsFunction(b)?!1:!0;}function ToNumber(d){var c=Number.NaN;if("number"==typeof d){return d;}c=new Number(d);return c.valueOf();}function ToBoolean(d){var c=Number.NaN,c=null;if(null==d||void 0==d){throw"Boolean value is not defined!";}return"boolean"==typeof d?d:"number"==typeof d?0<pobjval:IsNumber(d)?(c=ToNumber(d),isNaN(c)?null:0<c):"object"==typeof d?(c=d.toString(),"TRUE"==c.toUpperCase()?!0:"FALSE"==c.toUpperCase()?!1:null):"string"==typeof d?"TRUE"==d.toUpperCase()?!0:"FALSE"==d.toUpperCase()?!1:null:null;}function Precedence(d){var c=0;switch(d){case"+":case"-":c=5;break;case"*":case"/":case"%":c=6;break;case"^":c=7;break;case UNARY_NEG:case"!":c=10;break;case"(":c=99;break;case"&":case"|":c=3;break;case">":case">=":case"<":case"<=":case"=":case"<>":c=4;break;default:c=IsFunction(d)?9:0;}debugAssert("Precedence of "+d+" is "+c);return c;}function debugAssert(b){DEBUG_ON&&alert(b.toString());}
/*! @source http://purl.eligrey.com/github/fileSaver.js/blob/master/fileSaver.js */
;var saveAs=saveAs||(typeof navigator!=="undefined"&&navigator.msSaveOrOpenBlob&&navigator.msSaveOrOpenBlob.bind(navigator))||(function(l){if(typeof navigator!=="undefined"&&/MSIE [1-9]\./.test(navigator.userAgent)){return;}var m=l.document,i=function(){return l.URL||l.webkitURL||l;},p=m.createElementNS("http://www.w3.org/1999/xhtml","a"),d="download" in p,q=function(s){var r=m.createEvent("MouseEvents");r.initMouseEvent("click",true,false,l,0,0,0,0,0,false,false,false,false,0,null);s.dispatchEvent(r);},g=l.webkitRequestFileSystem,n=l.requestFileSystem||g||l.mozRequestFileSystem,e=function(r){(l.setImmediate||l.setTimeout)(function(){throw r;},0);},k="application/octet-stream",h=0,c=10,o=function(s){var r=function(){if(typeof s==="string"){i().revokeObjectURL(s);}else{s.remove();}};if(l.chrome){r();}else{setTimeout(r,c);}},j=function(s,r,v){r=[].concat(r);var u=r.length;while(u--){var w=s["on"+r[u]];if(typeof w==="function"){try{w.call(s,v||s);}catch(t){e(t);}}}},b=function(r,s){var t=this,z=r.type,C=false,v,u,y=function(){j(t,"writestart progress write writeend".split(" "));},B=function(){if(C||!v){v=i().createObjectURL(r);}if(u){u.location.href=v;}else{var D=l.open(v,"_blank");if(D==undefined&&typeof safari!=="undefined"){l.location.href=v;}}t.readyState=t.DONE;y();o(v);},x=function(D){return function(){if(t.readyState!==t.DONE){return D.apply(this,arguments);}};},w={create:true,exclusive:false},A;t.readyState=t.INIT;if(!s){s="download";}if(d){v=i().createObjectURL(r);p.href=v;p.download=s;q(p);t.readyState=t.DONE;y();o(v);return;}if(l.chrome&&z&&z!==k){A=r.slice||r.webkitSlice;r=A.call(r,0,r.size,k);C=true;}if(g&&s!=="download"){s+=".download";}if(z===k||g){u=l;}if(!n){B();return;}h+=r.size;n(l.TEMPORARY,h,x(function(D){D.root.getDirectory("saved",w,x(function(E){var F=function(){E.getFile(s,w,x(function(G){G.createWriter(x(function(H){H.onwriteend=function(I){u.location.href=G.toURL();t.readyState=t.DONE;j(t,"writeend",I);o(G);};H.onerror=function(){var I=H.error;if(I.code!==I.ABORT_ERR){B();}};"writestart progress write abort".split(" ").forEach(function(I){H["on"+I]=t["on"+I];});H.write(r);t.abort=function(){H.abort();t.readyState=t.DONE;};t.readyState=t.WRITING;}),B);}),B);};E.getFile(s,{create:false},x(function(G){G.remove();F();}),x(function(G){if(G.code===G.NOT_FOUND_ERR){F();}else{B();}}));}),B);}),B);},a=b.prototype,f=function(r,s){return new b(r,s);};a.abort=function(){var r=this;r.readyState=r.DONE;j(r,"abort");};a.readyState=a.INIT=0;a.WRITING=1;a.DONE=2;a.error=a.onwritestart=a.onprogress=a.onwrite=a.onabort=a.onerror=a.onwriteend=null;return f;}(typeof self!=="undefined"&&self||typeof window!=="undefined"&&window||this.content));if(typeof module!=="undefined"&&module!==null){module.exports=saveAs;}else{if((typeof define!=="undefined"&&define!==null)&&(define.amd!=null)){define([],function(){return saveAs;});}}
/*
 * HTML Parser By John Resig (ejohn.org)
 * Original code by Erik Arvidsson, Mozilla Public License
 * http://erik.eae.net/simplehtmlparser/simplehtmlparser.js
 *
 * // Use like so:
 * HTMLParser(htmlString, {
 *     start: function(tag, attrs, unary) {},
 *     end: function(tag) {},
 *     chars: function(text) {},
 *     comment: function(text) {}
 * });
 *
 * // or to get an XML string:
 * HTMLtoXML(htmlString);
 *
 * // or to get an XML DOM Document
 * HTMLtoDOM(htmlString);
 *
 * // or to inject into an existing document/DOM node
 * HTMLtoDOM(htmlString, document);
 * HTMLtoDOM(htmlString, document.body);
 *
 */

(function(){function g(a){for(var b={},a=a.split(","),c=0;c<a.length;c++)b[a[c]]=!0;return b}var h=/^<([-A-Za-z0-9_:]+)((?:\s+\w+(?:\s*=\s*(?:(?:"[^"]*")|(?:'[^']*')|[^>\s]+))?)*)\s*(\/?)>/,k=/^<\/([-A-Za-z0-9_:]+)[^>]*>/,m=/([-A-Za-z0-9_]+)(?:\s*=\s*(?:(?:"((?:\\.|[^"])*)")|(?:'((?:\\.|[^'])*)')|([^>\s]+)))?/g,n=g("area,base,basefont,br,col,frame,hr,img,input,isindex,link,meta,param,embed"),o=g("address,applet,blockquote,button,center,dd,del,dir,div,dl,dt,fieldset,form,frameset,hr,iframe,ins,isindex,li,map,menu,noframes,noscript,object,ol,p,pre,script,table,tbody,td,tfoot,th,thead,tr,ul"),
p=g("a,abbr,acronym,applet,b,basefont,bdo,big,br,button,cite,code,del,dfn,em,font,i,iframe,img,input,ins,kbd,label,map,object,q,s,samp,script,select,small,span,strike,strong,sub,sup,textarea,tt,u,var"),q=g("colgroup,dd,dt,li,options,p,td,tfoot,th,thead,tr"),r=g("checked,compact,declare,defer,disabled,ismap,multiple,nohref,noresize,noshade,nowrap,readonly,selected"),s=g("script,style"),l=this.HTMLParser=function(a,b){function c(a,c,d,f){c=c.toLowerCase();if(o[c])for(;e.last()&&p[e.last()];)i("",e.last());
q[c]&&e.last()==c&&i("",c);(f=n[c]||!!f)||e.push(c);if(b.start){var g=[];d.replace(m,function(b,c,a,d,e){b=a?a:d?d:e?e:r[c]?c:"";g.push({name:c,value:b,escaped:b.replace(/(^|[^\\])"/g,'$1\\"')})});b.start&&b.start(c,g,f)}}function i(c,a){if(a)for(d=e.length-1;0<=d&&e[d]!=a;d--);else var d=0;if(0<=d){for(var f=e.length-1;f>=d;f--)b.end&&b.end(e[f]);e.length=d}}var d,f,e=[],g=a;for(e.last=function(){return this[this.length-1]};a;){f=!0;if(!e.last()||!s[e.last()]){if(0==a.indexOf("<\!--"))d=a.indexOf("--\>"),
0<=d&&(b.comment&&b.comment(a.substring(4,d)),a=a.substring(d+3),f=!1);else if(0==a.indexOf("</")){if(d=a.match(k))a=a.substring(d[0].length),d[0].replace(k,i),f=!1}else if(0==a.indexOf("<")&&(d=a.match(h)))a=a.substring(d[0].length),d[0].replace(h,c),f=!1;f&&(d=a.indexOf("<"),f=0>d?a:a.substring(0,d),a=0>d?"":a.substring(d),b.chars&&b.chars(f))}else a=a.replace(RegExp("(.*)</"+e.last()+"[^>]*>"),function(a,c){c=c.replace(/<\!--(.*?)--\>/g,"$1").replace(/<!\[CDATA\[(.*?)]]\>/g,"$1");b.chars&&b.chars(c);
return""}),i("",e.last());if(a==g)throw"Parse Error: "+a;g=a}i()};this.HTMLtoXML=function(a){var b="";l(a,{start:function(c,a,d){b+="<"+c;for(c=0;c<a.length;c++)b+=" "+a[c].name+'="'+a[c].escaped+'"';b+=(d?"/":"")+">"},end:function(a){b+="</"+a+">"},chars:function(a){b+=a},comment:function(a){b+="<\!--"+a+"--\>"}});return b};this.HTMLtoDOM=function(a,b){var c=g("html,head,body,title"),i={link:"head",base:"head"};b?b=b.ownerDocument||b.getOwnerDocument&&b.getOwnerDocument()||b:"undefined"!=typeof DOMDocument?
b=new DOMDocument:"undefined"!=typeof document&&document.implementation&&document.implementation.createDocument?b=document.implementation.createDocument("","",null):"undefined"!=typeof ActiveX&&(b=new ActiveXObject("Msxml.DOMDocument"));var d=[];if(!(b.documentElement||b.getDocumentElement&&b.getDocumentElement())&&b.createElement){var f=b.createElement("html"),e=b.createElement("head");e.appendChild(b.createElement("title"));f.appendChild(e);f.appendChild(b.createElement("body"));b.appendChild(f)}if(b.getElementsByTagName)for(var h in c)c[h]=
b.getElementsByTagName(h)[0];var j=c.body;l(a,{start:function(a,e,f){if(c[a])j=c[a],f||d.push(j);else{var g=b.createElement(a),h;for(h in e)g.setAttribute(e[h].name,e[h].value);i[a]&&"boolean"!=typeof c[i[a]]?c[i[a]].appendChild(g):j&&j.appendChild&&j.appendChild(g);f||(d.push(g),j=g)}},end:function(){d.length-=1;j=d[d.length-1]},chars:function(a){j.appendChild(b.createTextNode(a))},comment:function(){}});return b}})();
/*
 jCanvas v6.0
Copyright 2012, Caleb Evans
Licensed under the MIT license
*/
(function(d,Q,Z,O,$,o,C,f,s){var K,L,R,S,T,U;function x(){}function A(c){c?w(aa,c):A.prefs=aa=x.prototype=w({},M);return this}function F(c,a){c.fillStyle=a.fillStyle;c.strokeStyle=a.strokeStyle;c.lineWidth=a.strokeWidth;a.rounded?(c.lineCap="round",c.lineJoin="round"):(c.lineCap=a.strokeCap,c.lineJoin=a.strokeJoin,c.miterLimit=a.miterLimit);c.shadowOffsetX=a.shadowX;c.shadowOffsetY=a.shadowY;c.shadowBlur=a.shadowBlur;c.shadowColor=a.shadowColor;c.globalAlpha=a.opacity;c.globalCompositeOperation=a.compositing}
function v(c){return c&&c.getContext?c.getContext("2d"):f}function I(c,a){a.closed&&c.closePath();c.fill();"transparent"!==a.fillStyle&&(c.shadowColor="transparent");c.stroke();a.closed||c.closePath();a._toRad&&c.restore();a.mask&&(a.autosave&&c.save(),c.clip())}function ba(c,a){if(!a.translateX&&!a.translateY&&(a.x||a.y))a.translateX=a.x,a.translateY=a.y;a.translate&&(a.translateX=a.translateY=a.translate);c.translate(a.translateX,a.translateY)}function ca(c,a){1!==a.scale&&(a.scaleX=a.scaleY=a.scale);
c.translate(a.x,a.y);c.scale(a.scaleX,a.scaleY);c.translate(-a.x,-a.y)}function da(c,a){a._toRad=a.inDegrees?z/180:1;a.rotate=a.rotate||a.angle;c.translate(a.x,a.y);c.rotate(a.rotate*a._toRad);c.translate(-a.x,-a.y)}function E(c,a,b,e,i){b._toRad=b.inDegrees?z/180:1;a.save();i=i||e;!c&&!b.fromCenter&&(b.x+=e/2,b.y+=i/2);(b.rotate||b.angle)&&da(a,b);(1!==b.scale||1!==b.scaleX||1!==b.scaleY)&&ca(a,b);(b.translate||b.translateX||b.translateY)&&ba(a,b)}function P(c){var a;K===c?a=L:((a=d.data(c,"jCanvas"))||
(a=d.data(c,"jCanvas",{layers:[],intersects:[],drag:{},event:{}})),K=c,L=a);return a}function ea(c,a,b){b&&b.visible&&(b.method===d.fn.draw?b.fn.call(c[0],a):b.method&&b.method.call(c,b))}function D(c,a,b){var e,i,g,B="function"===typeof a,n,a=a||{};if(a.layer&&!a._layer){e=d(c);i=e.getLayers();B&&(a={method:d.fn.draw,fn:a});a=w(new x,a);if(!B){a.method=d.fn[a.method]||b;n=P(c);for(g in A.events)A.events.hasOwnProperty(g)&&a[g]&&(A.events[g](e,n),a._event=o);if(a.draggable){a._event=o;c=["mousedown",
"mousemove","mouseup"];for(b=0;b<c.length;b+=1)g=c[b],A.events[g](e,n);n.mouseout||(e.bind("mouseout.jCanvas",function(){n.drag={};e.drawLayers()}),n.mouseout=o)}}a.layer=o;a._layer=o;a.index===s&&(a.index=i.length);i.splice(a.index,0,a)}}function fa(c){var a;for(a=0;a<H.length;a+=1)c[H[a]]=c["_"+H[a]]}function ga(c){var a;for(a=0;a<H.length;a+=1)c["_"+H[a]]=c[H[a]],V[H[a]]=1}function ha(c){var a,b,e=[],i=1;c.match(/^#?[a-z0-9]+$/i)&&("transparent"===c&&(c="rgba(0,0,0,0)"),b=Q.head,a=b.style.color,
b.style.color=c,c=d.css(b,"color"),b.style.color=a);c.match(/^rgb/i)&&(e=c.match(/[0-9]+/gi),c.match(/%/gi)&&(i=2.55),e[0]*=i,e[1]*=i,e[2]*=i,e[3]=e[3]!==s?$(e[3]):1);return e}function ka(c){var a=3,b;"object"!==typeof c.start&&(c.start=ha(c.start),c.end=ha(c.end));c.now=[];if(1!==c.start[3]||1!==c.end[3])a=4;for(b=0;b<a;b+=1)c.now[b]=c.start[b]+(c.end[b]-c.start[b])*c.pos,3>b&&(c.now[b]=N(c.now[b]));1!==c.start[3]||1!==c.end[3]?c.now="rgba("+c.now.join(",")+")":(c.now.slice(0,3),c.now="rgb("+c.now.join(",")+
")");c.elem.nodeName?c.elem.style[c.prop]=c.now:c.elem[c.prop]=c.now}function J(c){A.events[c]=function(a,b){var e="mouseover"===c||"mouseout"===c?"mousemove":c,i=b.event;b[e]||(a.bind(e+".jCanvas",function(b){i.x=b.offsetX;i.y=b.offsetY;i.type=e;a.drawLayers(o);b.preventDefault()}),b[e]=o)}}function G(c,a,b){var c=P(c),e=c.event,a=a.isPointInPath(e.x,e.y);b.mouseX=e.x;b.mouseY=e.y;!a&&(b._hovered&&!b._fired)&&(b._mousedout=o);a&&c.intersects.push(b)}function ia(c,a,b){var e,i=/\b(\d*\.?\d*)\w\w\b/gi;
if(R===b.text&&S===b.font)b.width=T,b.height=U;else{b.width=a.measureText(b.text).width;a=c.style.fontSize;if(e=b.font.match(i))c.style.fontSize=b.font.match(i)[0];b.height=$(d.css(c,"fontSize"));c.style.fontSize=a}}var M,aa,w=d.extend,N=O.round,z=O.PI,ja=O.sin,W=O.cos,la=d.event.fix;U=T=S=R=L=K=void 0;var H,V;d.fn.jCanvas=A;A.version="6.0";A.events={};M={angle:0,align:"center",autosave:o,baseline:"middle",bringToFront:C,ccw:C,closed:C,compositing:"source-over",cornerRadius:0,cropFromCenter:o,draggable:!1,
each:f,end:360,fillStyle:"transparent",font:"12pt sans-serif",fromCenter:o,height:f,inDegrees:o,load:f,mask:C,method:f,miterLimit:10,opacity:1,projection:0,r1:f,r2:f,radius:0,repeat:"repeat",rotate:0,rounded:C,scale:1,scaleX:1,scaleY:1,shadowBlur:0,shadowColor:"transparent",shadowX:0,shadowY:0,sHeight:f,sides:3,source:"",start:0,strokeCap:"butt",strokeJoin:"miter",strokeStyle:"transparent",strokeWidth:1,sWidth:f,sx:f,sy:f,text:"",translate:0,translateX:0,translateY:0,visible:o,width:f,x:0,y:0};A();
A.extend=function(c){M=w(M,c.props);A();c.name&&(d.fn[c.name]=function(a){var b,e,i=w(new x,a);for(b=0;b<this.length;b+=1)if(a=this[b],e=v(a))F(e,i),c.fn.call(a,e,i);return this});return d.fn[c.name]};d.fn.getLayers=function(){var c=this[0];return!c||!c.getContext?[]:P(c).layers};d.fn.getLayer=function(c){var a=this.getLayers(),b;if(!c||!c.layer){if("string"===typeof c)for(b=0;b<a.length;b+=1)if(a[b].name===c){c=b;break}c=a[c||0]}return c};d.fn.setLayer=function(c,a){var b,e;c||(a=c,c=0);for(b=0;b<
this.length;b+=1)e=d(this[b]).getLayer(c),w(e,a);return this};d.fn.removeLayer=function(c){var a,b,e,i,g=typeof c;for(a=0;a<this.length;a+=1){b=d(this[a]).getLayers();if("string"===g)for(i=0;i<b.length;i+=1){if(b[i].name===c){e=i;break}}else e="number"===g?c:"";b[e]&&b.splice(e,1)}return this};d.fn.removeLayers=function(){var c,a;for(a=0;a<this.length;a+=1)c=d(this[a]).getLayers(),c.length=0;return this};d.fn.getLayerGroup=function(c){var a=this.getLayers(),b=[],e;if(c!==s)for(e=0;e<a.length;e+=1)a[e].group===
c&&b.push(a[e]);return b};d.fn.setLayerGroup=function(c,a){var b,e,i;for(b=0;b<this.length;b+=1){e=d(this[b]).getLayers();for(i=0;i<e.length;i+=1)e[i].group===c&&w(e[i],a)}return this};d.fn.removeLayerGroup=function(c){var a,b,e;if(c!==s)for(a=0;a<this.length;a+=1){b=d(this[a]).getLayers();for(e=0;e<b.length;e+=1)b[e].group===c&&(b.splice(e,1),e-=1)}return this};d.fn.drawLayer=function(c){var a,b,e,i;for(a=0;a<this.length;a+=1)e=d(this[a]),b=v(this[a]),i=e.getLayer(c),ea(e,b,i);return this};d.fn.drawLayers=
function(c){var a,b,e,i,g,B,n;for(b=0;b<this.length;b+=1)if(a=d(this[b]),e=v(this[b])){e.clearRect(0,0,this[b].width,this[b].height);K===this[b]?n=L:(n=P(this[b]),K=this[b],L=n);i=n.layers;for(B=0;B<i.length;B+=1)if(g=i[B],g.index=B,c&&(g._fired=C),ea(a,e,g),g._mousedout)g._mousedout=C,g._fired=o,g._hovered=C,g.mouseout&&g.mouseout.call(this[b],g);g=n.intersects[n.intersects.length-1]||{};a=n.event;a=a.type;B=g[a];e=n.drag;if(g._event){if((g.mouseover||g.mouseout)&&!g._hovered&&!g._fired)g._fired=
o,g._hovered=o,g.mouseover&&g.mouseover.call(this[b],g);B&&!g._fired&&(g._fired=o,B.call(this[b],g));g.draggable&&"mousedown"===a&&(g.bringToFront&&(i.splice(g.index,1),g.index=i.push(g)),e.layer=g,e.dragging=o,e.startX=g.x,e.startY=g.y,e.endX=g.mouseX,e.endY=g.mouseY,g.dragstart&&g.dragstart.call(this[b],g))}if(e.layer&&(e.dragging&&"mouseup"===a&&(e.layer.dragstop&&e.layer.dragstop.call(this[b],e.layer),n.drag={}),e.dragging&&"mousemove"===a))e.layer.x=e.layer.mouseX-(e.endX-e.startX),e.layer.y=
e.layer.mouseY-(e.endY-e.startY),e.layer.drag&&e.layer.drag.call(this[b],e.layer)}n.intersects=[];return this};d.fn.addLayer=function(c){var a,b,c=c||{};for(a=0;a<this.length;a+=1)if(b=v(this[a]))c.layer=o,D(this[a],c);return this};H=["width","height","opacity"];V={};d.fn.animateLayer=function(){function c(a,b){return function(){fa(b);a.drawLayers();g[4]&&g[4].call(a[0],b)}}function a(a,b){return function(c,e){fa(b);a.drawLayers();g[5]&&g[5].call(a[0],c,e,b)}}var b,e,i,g=[].slice.call(arguments,0);
"object"===typeof g[0]&&!g[0].layer&&g.unshift(0);"object"===typeof g[2]?(g.splice(2,0,g[2].duration||f),g.splice(3,0,g[3].easing||f),g.splice(4,0,g[4].complete||f),g.splice(5,0,g[5].step||f)):(g[2]===s?(g.splice(2,0,f),g.splice(3,0,f),g.splice(4,0,f)):"function"===typeof g[2]&&(g.splice(2,0,f),g.splice(3,0,f)),g[3]===s)?(g[3]=f,g.splice(4,0,f)):"function"===typeof g[3]&&g.splice(3,0,f);for(e=0;e<this.length;e+=1)if(b=d(this[e]),i=v(this[e]))if((i=b.getLayer(g[0]))&&i.method!==d.fn.draw)ga(i),ga(g[1]),
i.style=V,d(i).animate(g[1],{duration:g[2],easing:d.easing[g[3]]?g[3]:f,complete:c(b,i),step:a(b,i)});return this};d.fn.animateLayerGroup=function(c){var a,b,e=[].slice.call(arguments,0),i,g;for(b=0;b<this.length;b+=1){a=d(this[b]);i=a.getLayerGroup(c);for(g=0;g<i.length;g+=1)a.animateLayer.apply(a,[i[g]].concat(e.slice(1)))}};d.fn.delayLayer=function(c,a){var b,e,a=a||0;for(b=0;b<this.length;b+=1)e=d(this[b]).getLayer(c),d(e).delay(a);return this};d.fn.delayLayerGroup=function(c,a){var b,e,i,g,a=
a||0;for(e=0;e<this.length;e+=1){b=d(this[e]);i=b.getLayerGroup(c);for(g=0;g<i.length;g+=1)b.delayLayer.call(b,c,a)}};d.fn.stopLayer=function(c,a){var b,e;for(b=0;b<this.length;b+=1)e=d(this[b]).getLayer(c),d(e).stop(a);return this};d.fn.stopLayerGroup=function(c,a){var b,e,i,g;for(e=0;e<this.length;e+=1){b=d(this[e]);i=b.getLayerGroup(c);for(g=0;g<i.length;g+=1)b.stopLayer.call(b,c,a)}};(function(c){var a;for(a=0;a<c.length;a+=1)d.fx.step[c[a]]=ka})("color backgroundColor borderColor borderTopColor borderRightColor borderBottomColor borderLeftColor fillStyle outlineColor strokeStyle shadowColor".split(" "));
J("click");J("dblclick");J("mousedown");J("mouseup");J("mousemove");J("mouseover");J("mouseout");d.event.fix=function(c){var a,c=la.call(d.event,c);if(c.pageX!==s&&c.offsetX===s&&(a=d(c.target).offset()))c.offsetX=c.pageX-a.left,c.offsetY=c.pageY-a.top;return c};d.fn.draw=function a(b){var e,i,b=b||{};"function"===typeof b&&(b={fn:b});for(e=0;e<this.length;e+=1)if((i=v(this[e]))&&b.fn)D(this[e],b,a),b.fn.call(this[e],i);return this};d.fn.clearCanvas=function(a){for(var b,e=w(new x,a),a=0;a<this.length;a+=
1)if(b=v(this[a]))E(a,b,e,e.width,e.height),!e.x||!e.y||!e.width||!e.height?b.clearRect(0,0,this[a].width,this[a].height):b.clearRect(e.x-e.width/2,e.y-e.height/2,e.width,e.height);return this};d.fn.saveCanvas=function(){var a,b;for(a=0;a<this.length;a+=1)(b=v(this[a]))&&b.save();return this};d.fn.restoreCanvas=function(){var a,b;for(a=0;a<this.length;a+=1)(b=v(this[a]))&&b.restore();return this};d.fn.translateCanvas=function(a){for(var b,e=w(new x,a),a=0;a<this.length;a+=1)if(b=v(this[a]))e.autosave&&
b.save(),ba(b,e);return this};d.fn.scaleCanvas=function(a){for(var b,e=w(new x,a),a=0;a<this.length;a+=1)if(b=v(this[a]))e.autosave&&b.save(),ca(b,e);return this};d.fn.rotateCanvas=function(a){for(var b,e=w(new x,a),a=0;a<this.length;a+=1)if(b=v(this[a]))e.autosave&&b.save(),da(b,e);return this};d.fn.drawRect=function b(e){var i,g,d=w(new x,e),n,y,r,t,j;for(i=0;i<this.length;i+=1)if(g=v(this[i]))D(this[i],e,b),F(g,d),E(i,g,d,d.width,d.height),g.beginPath(),n=d.x-d.width/2,y=d.y-d.height/2,(j=d.cornerRadius)?
(d.closed=o,r=d.x+d.width/2,t=d.y+d.height/2,0>r-n-2*j&&(j=(r-n)/2),0>t-y-2*j&&(j=(t-y)/2),g.moveTo(n+j,y),g.lineTo(r-j,y),g.arc(r-j,y+j,j,3*z/2,2*z,C),g.lineTo(r,t-j),g.arc(r-j,t-j,j,0,z/2,C),g.lineTo(n+j,t),g.arc(n+j,t-j,j,z/2,z,C),g.lineTo(n,y+j),g.arc(n+j,y+j,j,z,3*z/2,C)):g.rect(n,y,d.width,d.height),d._event&&G(this[i],g,e),I(g,d);return this};d.fn.drawArc=function e(d){var g,f,n=w(new x,d),d=d||{};!n.inDegrees&&360===n.end&&(d.end=n.end=2*z);for(g=0;g<this.length;g+=1)if(f=v(this[g]))D(this[g],
d,e),F(f,n),E(g,f,n,2*n.radius),f.beginPath(),f.arc(n.x,n.y,n.radius,n.start*n._toRad-z/2,n.end*n._toRad-z/2,n.ccw),n._event&&G(this[g],f,d),I(f,n);return this};d.fn.drawEllipse=function i(g){var d,n,f=w(new x,g),r=4*f.width/3,t=f.height;f.closed=o;for(d=0;d<this.length;d+=1)if(n=v(this[d]))D(this[d],g,i),F(n,f),E(d,n,f,f.width,f.height),n.beginPath(),n.moveTo(f.x,f.y-t/2),n.bezierCurveTo(f.x-r/2,f.y-t/2,f.x-r/2,f.y+t/2,f.x,f.y+t/2),n.bezierCurveTo(f.x+r/2,f.y+t/2,f.x+r/2,f.y-t/2,f.x,f.y-t/2),f._event&&
G(this[d],n,g),I(n,f);return this};d.fn.drawPolygon=function g(d){var f,y,r=w(new x,d),t=2*z/r.sides,j=z/r.sides,l=j+z/2,m=r.radius*W(t/2),p,q,k;r.closed=o;for(f=0;f<this.length;f+=1)if(y=v(this[f])){D(this[f],d,g);F(y,r);E(f,y,r,2*r.radius);y.beginPath();for(k=0;k<r.sides;k+=1)p=r.x+N(r.radius*W(l)),q=r.y+N(r.radius*ja(l)),y.lineTo(p,q),r.projection&&(p=r.x+N((m+m*r.projection)*W(l+j)),q=r.y+N((m+m*r.projection)*ja(l+j)),y.lineTo(p,q)),l+=t;r._event&&G(this[f],y,d);I(y,r)}return this};d.fn.drawLine=
function B(d){var f,r,t=w(new x,d),j,l,m;for(f=0;f<this.length;f+=1)if(r=v(this[f])){D(this[f],d,B);F(r,t);E(f,r,t,0);j=1;for(r.beginPath();o;)if(l=t["x"+j],m=t["y"+j],l!==s&&m!==s)r.lineTo(l,m),j+=1;else break;t._event&&G(this[f],r,d);I(r,t)}return this};d.fn.drawQuad=function n(d){var f,t,j=w(new x,d),l,m,p,q,k;for(f=0;f<this.length;f+=1)if(t=v(this[f])){D(this[f],d,n);F(t,j);E(f,t,j,0);l=2;t.beginPath();for(t.moveTo(j.x1,j.y1);o;)if(m=j["x"+l],p=j["y"+l],q=j["cx"+(l-1)],k=j["cy"+(l-1)],m!==s&&
p!==s&&q!==s&&k!==s)t.quadraticCurveTo(q,k,m,p),l+=1;else break;j._event&&G(this[f],t,d);I(t,j)}return this};d.fn.drawBezier=function y(d){var f,j,l=w(new x,d),m,p,q,k,h,u,X,Y;for(f=0;f<this.length;f+=1)if(j=v(this[f])){D(this[f],d,y);F(j,l);E(f,j,l,0);m=2;p=1;j.beginPath();for(j.moveTo(l.x1,l.y1);o;)if(q=l["x"+m],k=l["y"+m],h=l["cx"+p],u=l["cy"+p],X=l["cx"+(p+1)],Y=l["cy"+(p+1)],q!==s&&k!==s&&h!==s&&u!==s&&X!==s&&Y!==s)j.bezierCurveTo(h,u,X,Y,q,k),m+=1,p+=2;else break;l._event&&G(this[f],j,d);I(j,
l)}return this};d.fn.drawText=function r(f){var j,l,m=w(new x,f);for(j=0;j<this.length;j+=1)if(d(this[j]),l=v(this[j]))(D(this[j],f,r),F(l,m),l.textBaseline=m.baseline,l.textAlign=m.align,l.font=m.font,ia(this[j],l,m),E(j,l,m,m.width,m.height),l.fillText(m.text,m.x,m.y),"transparent"!==m.fillStyle&&(l.shadowColor="transparent"),l.strokeText(m.text,m.x,m.y),m._event)?(l.beginPath(),l.rect(m.x-m.width/2,m.y-m.height/2,m.width,m.height),l.restore(),G(this[j],l,f),l.closePath()):l.restore();R=m.text;
S=m.font;T=m.width;U=m.height;return this};d.fn.measureText=function(d){var f;f=d&&"object"!==typeof d?this.getLayer(d):w(new x,d);(d=v(this[0]))&&ia(this[0],d,f);return f};d.fn.drawImage=function t(d){function l(l,t,k){return function(){t||((s=u.width/u.height,h.width===f&&h.sWidth===f&&(d.width=h.width=h.sWidth=u.width),h.height===f&&h.sHeight===f&&(d.height=h.height=h.sHeight=u.height),h.width===f&&h.sWidth!==f&&(h.width=h.sWidth),h.height===f&&h.sHeight!==f&&(h.height=h.sHeight),h.sWidth===f&&
h.width!==f&&(d.sWidth=h.sWidth=u.width),h.sHeight===f&&h.height!==f&&(d.sHeight=h.sHeight=u.height),h.sx===f&&(h.sx=h.cropFromCenter?u.width/2:0),h.sy===f&&(h.sy=h.cropFromCenter?u.height/2:0),h.cropFromCenter||(h.sx+=h.sWidth/2,h.sy+=h.sHeight/2),h.sx+h.sWidth/2>u.width&&(h.sx=u.width-h.sWidth/2),0>h.sx-h.sWidth/2&&(h.sx=h.sWidth/2),0>h.sy-h.sHeight/2&&(h.sy=h.sHeight/2),h.sy+h.sHeight/2>u.height&&(h.sy=u.height-h.sHeight/2),h.width!==f&&h.height===f)?d.height=h.height=h.width/s:h.width===f&&h.height!==
f?d.width=h.width=h.height*s:h.width===f&&h.height===f&&(d.width=h.width=u.width,d.height=h.height=u.height));E(t,k,h,h.width,h.height);k.drawImage(u,h.sx-h.sWidth/2,h.sy-h.sHeight/2,h.sWidth,h.sHeight,h.x-h.width/2,h.y-h.height/2,h.width,h.height);h._event?(k.beginPath(),k.rect(h.x-h.width/2,h.y-h.height/2,h.width,h.height),k.restore(),G(m[t],k,d),k.closePath()):k.restore();h.load&&h.load.call(l,d)}}var m=this,p,q,k,h=w(new x,d),u,o,s;o=h.source.getContext;h.source.src||o?(u=h.source,h.width=u.width,
h.height=u.height):h.source&&(u=new Z,u.src=h.source);for(q=0;q<m.length;q+=1)if(p=m[q],k=v(m[q]))D(m[q],d,t),F(k,h),u&&(u.complete||o?l(p,q,k)():u.onload=l(p,q,k));return m};d.fn.createPattern=d.fn.pattern=function(d){function j(){k=m.createPattern(q,p.repeat);p.load&&p.load.call(l[0],k)}var l=this,m,p=w(new x,d),q,k;(m=v(l[0]))?"function"===typeof p.source?(q=Q.createElement("canvas"),q.width=p.width,q.height=p.height,d=v(q),p.source.call(q,d),j()):(d=p.source.getContext,p.source.src||d?q=p.source:
(q=new Z,q.src=p.source),q.complete||d?j():q.onload=j):k=f;return k};d.fn.createGradient=d.fn.gradient=function(d){var j,d=w(new x,d),l=[],m,p,q,k,h,u,o;if(j=v(this[0])){d.x1=d.x1||0;d.y1=d.y1||0;d.x2=d.x2||0;d.y2=d.y2||0;j=d.r1!==f||d.r2!==f?j.createRadialGradient(d.x1,d.y1,d.r1,d.x2,d.y2,d.r2):j.createLinearGradient(d.x1,d.y1,d.x2,d.y2);for(k=1;d["c"+k]!==s;k+=1)d["s"+k]!==s?l.push(d["s"+k]):l.push(f);m=l.length;l[0]===f&&(l[0]=0);l[m-1]===f&&(l[m-1]=1);for(k=0;k<m;k+=1){if(l[k]!==f){u=1;o=0;p=
l[k];for(h=k+1;h<m;h+=1)if(l[h]!==f){q=l[h];break}else u+=1;p>q&&(l[h]=l[k])}else l[k]===f&&(o+=1,l[k]=p+o*((q-p)/u));j.addColorStop(l[k],d["c"+(k+1)])}}else j=f;return j};d.fn.setPixels=function j(d){var f,p,q,k=w(new x,d),h={},u,o,s,z;for(p=0;p<this.length;p+=1)if(f=this[p],q=v(f)){D(this[p],d,j);E(p,q,k,k.width,k.height);if(!k.x||!k.y||!k.width||!k.height)k.width=f.width,k.height=f.height,k.x=k.width/2,k.y=k.height/2;u=q.getImageData(k.x-k.width/2,k.y-k.height/2,k.width,k.height);o=u.data;z=o.length;
h=[];if(k.each)for(s=0;s<z;s+=4)h.r=o[s],h.g=o[s+1],h.b=o[s+2],h.a=o[s+3],k.each.call(f,h),o[s]=h.r,o[s+1]=h.g,o[s+2]=h.b,o[s+3]=h.a;q.putImageData(u,k.x-k.width/2,k.y-k.height/2);q.restore()}return this};d.fn.getCanvasImage=function(d,l){var m=this[0];return m&&m.toDataURL?m.toDataURL("image/"+d,l):f};d.support.canvas=Q.createElement("canvas").getContext!==s;A.defaults=M;d.jCanvas=A})(jQuery,document,Image,Math,parseFloat,!0,!1,null);
